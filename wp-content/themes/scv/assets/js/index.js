var iy=Object.defineProperty;var ry=(r,t,e)=>t in r?iy(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var H=(r,t,e)=>(ry(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();function sn(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function m_(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.__proto__=t}/*!
 * GSAP 3.11.3
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Xi={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},$a={duration:.5,overwrite:!1,delay:0},_f,Ci,He,rr=1e8,_e=1/rr,od=Math.PI*2,ny=od/4,sy=0,g_=Math.sqrt,ay=Math.cos,oy=Math.sin,ei=function(t){return typeof t=="string"},Oe=function(t){return typeof t=="function"},vn=function(t){return typeof t=="number"},vf=function(t){return typeof t>"u"},Kr=function(t){return typeof t=="object"},Li=function(t){return t!==!1},__=function(){return typeof window<"u"},Ml=function(t){return Oe(t)||ei(t)},v_=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},pi=Array.isArray,ld=/(?:-?\.?\d|\.)+/gi,x_=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Aa=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Nu=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,y_=/[+-]=-?[.\d]+/,E_=/[^,'"\[\]\s]+/gi,ly=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Ae,Qi,hd,xf,ji={},Xh={},T_,b_=function(t){return(Xh=Gs(t,ji))&&Ei},yf=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},Kh=function(t,e){return!e&&console.warn(t)},S_=function(t,e){return t&&(ji[t]=e)&&Xh&&(Xh[t]=e)||ji},$o=function(){return 0},hy={suppressEvents:!0,isStart:!0,kill:!1},Ah={suppressEvents:!0,kill:!1},uy={suppressEvents:!0},Ef={},Nn=[],ud={},w_,zi={},Gu={},hp=30,Mh=[],Tf="",bf=function(t){var e=t[0],i,n;if(Kr(e)||Oe(e)||(t=[t]),!(i=(e._gsap||{}).harness)){for(n=Mh.length;n--&&!Mh[n].targetTest(e););i=Mh[n]}for(n=t.length;n--;)t[n]&&(t[n]._gsap||(t[n]._gsap=new j_(t[n],i)))||t.splice(n,1);return t},Ds=function(t){return t._gsap||bf(nr(t))[0]._gsap},A_=function(t,e,i){return(i=t[e])&&Oe(i)?t[e]():vf(i)&&t.getAttribute&&t.getAttribute(e)||i},Di=function(t,e){return(t=t.split(",")).forEach(e)||t},Ue=function(t){return Math.round(t*1e5)/1e5||0},ni=function(t){return Math.round(t*1e7)/1e7||0},Fa=function(t,e){var i=e.charAt(0),n=parseFloat(e.substr(2));return t=parseFloat(t),i==="+"?t+n:i==="-"?t-n:i==="*"?t*n:t/n},cy=function(t,e){for(var i=e.length,n=0;t.indexOf(e[n])<0&&++n<i;);return n<i},jh=function(){var t=Nn.length,e=Nn.slice(0),i,n;for(ud={},Nn.length=0,i=0;i<t;i++)n=e[i],n&&n._lazy&&(n.render(n._lazy[0],n._lazy[1],!0)._lazy=0)},M_=function(t,e,i,n){Nn.length&&jh(),t.render(e,i,n||Ci&&e<0&&(t._initted||t._startAt)),Nn.length&&jh()},C_=function(t){var e=parseFloat(t);return(e||e===0)&&(t+"").match(E_).length<2?e:ei(t)?t.trim():t},L_=function(t){return t},ur=function(t,e){for(var i in e)i in t||(t[i]=e[i]);return t},dy=function(t){return function(e,i){for(var n in i)n in e||n==="duration"&&t||n==="ease"||(e[n]=i[n])}},Gs=function(t,e){for(var i in e)t[i]=e[i];return t},up=function r(t,e){for(var i in e)i!=="__proto__"&&i!=="constructor"&&i!=="prototype"&&(t[i]=Kr(e[i])?r(t[i]||(t[i]={}),e[i]):e[i]);return t},Yh=function(t,e){var i={},n;for(n in t)n in e||(i[n]=t[n]);return i},Bo=function(t){var e=t.parent||Ae,i=t.keyframes?dy(pi(t.keyframes)):ur;if(Li(t.inherit))for(;e;)i(t,e.vars.defaults),e=e.parent||e._dp;return t},fy=function(t,e){for(var i=t.length,n=i===e.length;n&&i--&&t[i]===e[i];);return i<0},D_=function(t,e,i,n,s){i===void 0&&(i="_first"),n===void 0&&(n="_last");var a=t[n],o;if(s)for(o=e[s];a&&a[s]>o;)a=a._prev;return a?(e._next=a._next,a._next=e):(e._next=t[i],t[i]=e),e._next?e._next._prev=e:t[n]=e,e._prev=a,e.parent=e._dp=t,e},_u=function(t,e,i,n){i===void 0&&(i="_first"),n===void 0&&(n="_last");var s=e._prev,a=e._next;s?s._next=a:t[i]===e&&(t[i]=a),a?a._prev=s:t[n]===e&&(t[n]=s),e._next=e._prev=e.parent=null},Xn=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove(t),t._act=0},Rs=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var i=t;i;)i._dirty=1,i=i.parent;return t},py=function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t},cd=function(t,e,i,n){return t._startAt&&(Ci?t._startAt.revert(Ah):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,n))},my=function r(t){return!t||t._ts&&r(t.parent)},cp=function(t){return t._repeat?qa(t._tTime,t=t.duration()+t._rDelay)*t:0},qa=function(t,e){var i=Math.floor(t/=e);return t&&i===t?i-1:i},$h=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},vu=function(t){return t._end=ni(t._start+(t._tDur/Math.abs(t._ts||t._rts||_e)||0))},xu=function(t,e){var i=t._dp;return i&&i.smoothChildTiming&&t._ts&&(t._start=ni(i._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),vu(t),i._dirty||Rs(i,t)),t},R_=function(t,e){var i;if((e._time||e._initted&&!e._dur)&&(i=$h(t.rawTime(),e),(!e._dur||gl(0,e.totalDuration(),i)-e._tTime>_e)&&e.render(i,!0)),Rs(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(i=t;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;t._zTime=-_e}},Pr=function(t,e,i,n){return e.parent&&Xn(e),e._start=ni((vn(i)?i:i||t!==Ae?Ji(t,i,e):t._time)+e._delay),e._end=ni(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),D_(t,e,"_first","_last",t._sort?"_start":0),dd(e)||(t._recent=e),n||R_(t,e),t._ts<0&&xu(t,t._tTime),t},P_=function(t,e){return(ji.ScrollTrigger||yf("scrollTrigger",e))&&ji.ScrollTrigger.create(e,t)},I_=function(t,e,i,n,s){if(wf(t,e,s),!t._initted)return 1;if(!i&&t._pt&&!Ci&&(t._dur&&t.vars.lazy!==!1||!t._dur&&t.vars.lazy)&&w_!==Hi.frame)return Nn.push(t),t._lazy=[s,n],1},gy=function r(t){var e=t.parent;return e&&e._ts&&e._initted&&!e._lock&&(e.rawTime()<0||r(e))},dd=function(t){var e=t.data;return e==="isFromStart"||e==="isStart"},_y=function(t,e,i,n){var s=t.ratio,a=e<0||!e&&(!t._start&&gy(t)&&!(!t._initted&&dd(t))||(t._ts<0||t._dp._ts<0)&&!dd(t))?0:1,o=t._rDelay,l=0,h,u,f;if(o&&t._repeat&&(l=gl(0,t._tDur,e),u=qa(l,o),t._yoyo&&u&1&&(a=1-a),u!==qa(t._tTime,o)&&(s=1-a,t.vars.repeatRefresh&&t._initted&&t.invalidate())),a!==s||Ci||n||t._zTime===_e||!e&&t._zTime){if(!t._initted&&I_(t,e,n,i,l))return;for(f=t._zTime,t._zTime=e||(i?_e:0),i||(i=e&&!f),t.ratio=a,t._from&&(a=1-a),t._time=0,t._tTime=l,h=t._pt;h;)h.r(a,h.d),h=h._next;e<0&&cd(t,e,i,!0),t._onUpdate&&!i&&sr(t,"onUpdate"),l&&t._repeat&&!i&&t.parent&&sr(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===a&&(a&&Xn(t,1),!i&&!Ci&&(sr(t,a?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)},vy=function(t,e,i){var n;if(i>e)for(n=t._first;n&&n._start<=i;){if(n.data==="isPause"&&n._start>e)return n;n=n._next}else for(n=t._last;n&&n._start>=i;){if(n.data==="isPause"&&n._start<e)return n;n=n._prev}},Za=function(t,e,i,n){var s=t._repeat,a=ni(e)||0,o=t._tTime/t._tDur;return o&&!n&&(t._time*=a/t._dur),t._dur=a,t._tDur=s?s<0?1e10:ni(a*(s+1)+t._rDelay*s):a,o>0&&!n&&xu(t,t._tTime=t._tDur*o),t.parent&&vu(t),i||Rs(t.parent,t),t},dp=function(t){return t instanceof Ai?Rs(t):Za(t,t._dur)},xy={_start:0,endTime:$o,totalDuration:$o},Ji=function r(t,e,i){var n=t.labels,s=t._recent||xy,a=t.duration()>=rr?s.endTime(!1):t._dur,o,l,h;return ei(e)&&(isNaN(e)||e in n)?(l=e.charAt(0),h=e.substr(-1)==="%",o=e.indexOf("="),l==="<"||l===">"?(o>=0&&(e=e.replace(/=/,"")),(l==="<"?s._start:s.endTime(s._repeat>=0))+(parseFloat(e.substr(1))||0)*(h?(o<0?s:i).totalDuration()/100:1)):o<0?(e in n||(n[e]=a),n[e]):(l=parseFloat(e.charAt(o-1)+e.substr(o+1)),h&&i&&(l=l/100*(pi(i)?i[0]:i).totalDuration()),o>1?r(t,e.substr(0,o-1),i)+l:a+l)):e==null?a:+e},ko=function(t,e,i){var n=vn(e[1]),s=(n?2:1)+(t<2?0:1),a=e[s],o,l;if(n&&(a.duration=e[1]),a.parent=i,t){for(o=a,l=i;l&&!("immediateRender"in o);)o=l.vars.defaults||{},l=Li(l.vars.inherit)&&l.parent;a.immediateRender=Li(o.immediateRender),t<2?a.runBackwards=1:a.startAt=e[s-1]}return new je(e[0],a,e[s+1])},ts=function(t,e){return t||t===0?e(t):e},gl=function(t,e,i){return i<t?t:i>e?e:i},di=function(t,e){return!ei(t)||!(e=ly.exec(t))?"":e[1]},yy=function(t,e,i){return ts(i,function(n){return gl(t,e,n)})},fd=[].slice,O_=function(t,e){return t&&Kr(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&Kr(t[0]))&&!t.nodeType&&t!==Qi},Ey=function(t,e,i){return i===void 0&&(i=[]),t.forEach(function(n){var s;return ei(n)&&!e||O_(n,1)?(s=i).push.apply(s,nr(n)):i.push(n)})||i},nr=function(t,e,i){return He&&!e&&He.selector?He.selector(t):ei(t)&&!i&&(hd||!Ja())?fd.call((e||xf).querySelectorAll(t),0):pi(t)?Ey(t,i):O_(t)?fd.call(t,0):t?[t]:[]},pd=function(t){return t=nr(t)[0]||Kh("Invalid scope")||{},function(e){var i=t.current||t.nativeElement||t;return nr(e,i.querySelectorAll?i:i===t?Kh("Invalid scope")||xf.createElement("div"):t)}},F_=function(t){return t.sort(function(){return .5-Math.random()})},B_=function(t){if(Oe(t))return t;var e=Kr(t)?t:{each:t},i=Ps(e.ease),n=e.from||0,s=parseFloat(e.base)||0,a={},o=n>0&&n<1,l=isNaN(n)||o,h=e.axis,u=n,f=n;return ei(n)?u=f={center:.5,edges:.5,end:1}[n]||0:!o&&l&&(u=n[0],f=n[1]),function(c,_,g){var d=(g||e).length,p=a[d],v,A,E,S,L,T,x,m,w;if(!p){if(w=e.grid==="auto"?0:(e.grid||[1,rr])[1],!w){for(x=-rr;x<(x=g[w++].getBoundingClientRect().left)&&w<d;);w--}for(p=a[d]=[],v=l?Math.min(w,d)*u-.5:n%w,A=w===rr?0:l?d*f/w-.5:n/w|0,x=0,m=rr,T=0;T<d;T++)E=T%w-v,S=A-(T/w|0),p[T]=L=h?Math.abs(h==="y"?S:E):g_(E*E+S*S),L>x&&(x=L),L<m&&(m=L);n==="random"&&F_(p),p.max=x-m,p.min=m,p.v=d=(parseFloat(e.amount)||parseFloat(e.each)*(w>d?d-1:h?h==="y"?d/w:w:Math.max(w,d/w))||0)*(n==="edges"?-1:1),p.b=d<0?s-d:s,p.u=di(e.amount||e.each)||0,i=i&&d<0?V_(i):i}return d=(p[c]-p.min)/p.max||0,ni(p.b+(i?i(d):d)*p.v)+p.u}},md=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(i){var n=ni(Math.round(parseFloat(i)/t)*t*e);return(n-n%1)/e+(vn(i)?0:di(i))}},k_=function(t,e){var i=pi(t),n,s;return!i&&Kr(t)&&(n=i=t.radius||rr,t.values?(t=nr(t.values),(s=!vn(t[0]))&&(n*=n)):t=md(t.increment)),ts(e,i?Oe(t)?function(a){return s=t(a),Math.abs(s-a)<=n?s:a}:function(a){for(var o=parseFloat(s?a.x:a),l=parseFloat(s?a.y:0),h=rr,u=0,f=t.length,c,_;f--;)s?(c=t[f].x-o,_=t[f].y-l,c=c*c+_*_):c=Math.abs(t[f]-o),c<h&&(h=c,u=f);return u=!n||h<=n?t[u]:a,s||u===a||vn(a)?u:u+di(a)}:md(t))},U_=function(t,e,i,n){return ts(pi(t)?!e:i===!0?!!(i=0):!n,function(){return pi(t)?t[~~(Math.random()*t.length)]:(i=i||1e-5)&&(n=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((t-i/2+Math.random()*(e-t+i*.99))/i)*i*n)/n})},Ty=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return function(n){return e.reduce(function(s,a){return a(s)},n)}},by=function(t,e){return function(i){return t(parseFloat(i))+(e||di(i))}},Sy=function(t,e,i){return G_(t,e,0,1,i)},N_=function(t,e,i){return ts(i,function(n){return t[~~e(n)]})},wy=function r(t,e,i){var n=e-t;return pi(t)?N_(t,r(0,t.length),e):ts(i,function(s){return(n+(s-t)%n)%n+t})},Ay=function r(t,e,i){var n=e-t,s=n*2;return pi(t)?N_(t,r(0,t.length-1),e):ts(i,function(a){return a=(s+(a-t)%s)%s||0,t+(a>n?s-a:a)})},qo=function(t){for(var e=0,i="",n,s,a,o;~(n=t.indexOf("random(",e));)a=t.indexOf(")",n),o=t.charAt(n+7)==="[",s=t.substr(n+7,a-n-7).match(o?E_:ld),i+=t.substr(e,n-e)+U_(o?s:+s[0],o?0:+s[1],+s[2]||1e-5),e=a+1;return i+t.substr(e,t.length-e)},G_=function(t,e,i,n,s){var a=e-t,o=n-i;return ts(s,function(l){return i+((l-t)/a*o||0)})},My=function r(t,e,i,n){var s=isNaN(t+e)?0:function(_){return(1-_)*t+_*e};if(!s){var a=ei(t),o={},l,h,u,f,c;if(i===!0&&(n=1)&&(i=null),a)t={p:t},e={p:e};else if(pi(t)&&!pi(e)){for(u=[],f=t.length,c=f-2,h=1;h<f;h++)u.push(r(t[h-1],t[h]));f--,s=function(g){g*=f;var d=Math.min(c,~~g);return u[d](g-d)},i=e}else n||(t=Gs(pi(t)?[]:{},t));if(!u){for(l in e)Sf.call(o,t,l,"get",e[l]);s=function(g){return Cf(g,o)||(a?t.p:t)}}}return ts(i,s)},fp=function(t,e,i){var n=t.labels,s=rr,a,o,l;for(a in n)o=n[a]-e,o<0==!!i&&o&&s>(o=Math.abs(o))&&(l=a,s=o);return l},sr=function(t,e,i){var n=t.vars,s=n[e],a=He,o=t._ctx,l,h,u;if(!!s)return l=n[e+"Params"],h=n.callbackScope||t,i&&Nn.length&&jh(),o&&(He=o),u=l?s.apply(h,l):s.call(h),He=a,u},wo=function(t){return Xn(t),t.scrollTrigger&&t.scrollTrigger.kill(!!Ci),t.progress()<1&&sr(t,"onInterrupt"),t},Ma,Cy=function(t){t=!t.name&&t.default||t;var e=t.name,i=Oe(t),n=e&&!i&&t.init?function(){this._props=[]}:t,s={init:$o,render:Cf,add:Sf,kill:Vy,modifier:Hy,rawVars:0},a={targetTest:0,get:0,getSetter:Mf,aliases:{},register:0};if(Ja(),t!==n){if(zi[e])return;ur(n,ur(Yh(t,s),a)),Gs(n.prototype,Gs(s,Yh(t,a))),zi[n.prop=e]=n,t.targetTest&&(Mh.push(n),Ef[e]=1),e=(e==="css"?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}S_(e,n),t.register&&t.register(Ei,n,Ri)},xe=255,Ao={aqua:[0,xe,xe],lime:[0,xe,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,xe],navy:[0,0,128],white:[xe,xe,xe],olive:[128,128,0],yellow:[xe,xe,0],orange:[xe,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[xe,0,0],pink:[xe,192,203],cyan:[0,xe,xe],transparent:[xe,xe,xe,0]},zu=function(t,e,i){return t+=t<0?1:t>1?-1:0,(t*6<1?e+(i-e)*t*6:t<.5?i:t*3<2?e+(i-e)*(2/3-t)*6:e)*xe+.5|0},z_=function(t,e,i){var n=t?vn(t)?[t>>16,t>>8&xe,t&xe]:0:Ao.black,s,a,o,l,h,u,f,c,_,g;if(!n){if(t.substr(-1)===","&&(t=t.substr(0,t.length-1)),Ao[t])n=Ao[t];else if(t.charAt(0)==="#"){if(t.length<6&&(s=t.charAt(1),a=t.charAt(2),o=t.charAt(3),t="#"+s+s+a+a+o+o+(t.length===5?t.charAt(4)+t.charAt(4):"")),t.length===9)return n=parseInt(t.substr(1,6),16),[n>>16,n>>8&xe,n&xe,parseInt(t.substr(7),16)/255];t=parseInt(t.substr(1),16),n=[t>>16,t>>8&xe,t&xe]}else if(t.substr(0,3)==="hsl"){if(n=g=t.match(ld),!e)l=+n[0]%360/360,h=+n[1]/100,u=+n[2]/100,a=u<=.5?u*(h+1):u+h-u*h,s=u*2-a,n.length>3&&(n[3]*=1),n[0]=zu(l+1/3,s,a),n[1]=zu(l,s,a),n[2]=zu(l-1/3,s,a);else if(~t.indexOf("="))return n=t.match(x_),i&&n.length<4&&(n[3]=1),n}else n=t.match(ld)||Ao.transparent;n=n.map(Number)}return e&&!g&&(s=n[0]/xe,a=n[1]/xe,o=n[2]/xe,f=Math.max(s,a,o),c=Math.min(s,a,o),u=(f+c)/2,f===c?l=h=0:(_=f-c,h=u>.5?_/(2-f-c):_/(f+c),l=f===s?(a-o)/_+(a<o?6:0):f===a?(o-s)/_+2:(s-a)/_+4,l*=60),n[0]=~~(l+.5),n[1]=~~(h*100+.5),n[2]=~~(u*100+.5)),i&&n.length<4&&(n[3]=1),n},W_=function(t){var e=[],i=[],n=-1;return t.split(Gn).forEach(function(s){var a=s.match(Aa)||[];e.push.apply(e,a),i.push(n+=a.length+1)}),e.c=i,e},pp=function(t,e,i){var n="",s=(t+n).match(Gn),a=e?"hsla(":"rgba(",o=0,l,h,u,f;if(!s)return t;if(s=s.map(function(c){return(c=z_(c,e,1))&&a+(e?c[0]+","+c[1]+"%,"+c[2]+"%,"+c[3]:c.join(","))+")"}),i&&(u=W_(t),l=i.c,l.join(n)!==u.c.join(n)))for(h=t.replace(Gn,"1").split(Aa),f=h.length-1;o<f;o++)n+=h[o]+(~l.indexOf(o)?s.shift()||a+"0,0,0,0)":(u.length?u:s.length?s:i).shift());if(!h)for(h=t.split(Gn),f=h.length-1;o<f;o++)n+=h[o]+s[o];return n+h[f]},Gn=function(){var r="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",t;for(t in Ao)r+="|"+t+"\\b";return new RegExp(r+")","gi")}(),Ly=/hsl[a]?\(/,H_=function(t){var e=t.join(" "),i;if(Gn.lastIndex=0,Gn.test(e))return i=Ly.test(e),t[1]=pp(t[1],i),t[0]=pp(t[0],i,W_(t[1])),!0},Zo,Hi=function(){var r=Date.now,t=500,e=33,i=r(),n=i,s=1e3/240,a=s,o=[],l,h,u,f,c,_,g=function d(p){var v=r()-n,A=p===!0,E,S,L,T;if(v>t&&(i+=v-e),n+=v,L=n-i,E=L-a,(E>0||A)&&(T=++f.frame,c=L-f.time*1e3,f.time=L=L/1e3,a+=E+(E>=s?4:s-E),S=1),A||(l=h(d)),S)for(_=0;_<o.length;_++)o[_](L,c,T,p)};return f={time:0,frame:0,tick:function(){g(!0)},deltaRatio:function(p){return c/(1e3/(p||60))},wake:function(){T_&&(!hd&&__()&&(Qi=hd=window,xf=Qi.document||{},ji.gsap=Ei,(Qi.gsapVersions||(Qi.gsapVersions=[])).push(Ei.version),b_(Xh||Qi.GreenSockGlobals||!Qi.gsap&&Qi||{}),u=Qi.requestAnimationFrame),l&&f.sleep(),h=u||function(p){return setTimeout(p,a-f.time*1e3+1|0)},Zo=1,g(2))},sleep:function(){(u?Qi.cancelAnimationFrame:clearTimeout)(l),Zo=0,h=$o},lagSmoothing:function(p,v){t=p||1/_e,e=Math.min(v,t,0)},fps:function(p){s=1e3/(p||240),a=f.time*1e3+s},add:function(p,v,A){var E=v?function(S,L,T,x){p(S,L,T,x),f.remove(E)}:p;return f.remove(p),o[A?"unshift":"push"](E),Ja(),E},remove:function(p,v){~(v=o.indexOf(p))&&o.splice(v,1)&&_>=v&&_--},_listeners:o},f}(),Ja=function(){return!Zo&&Hi.wake()},ce={},Dy=/^[\d.\-M][\d.\-,\s]/,Ry=/["']/g,Py=function(t){for(var e={},i=t.substr(1,t.length-3).split(":"),n=i[0],s=1,a=i.length,o,l,h;s<a;s++)l=i[s],o=s!==a-1?l.lastIndexOf(","):l.length,h=l.substr(0,o),e[n]=isNaN(h)?h.replace(Ry,"").trim():+h,n=l.substr(o+1).trim();return e},Iy=function(t){var e=t.indexOf("(")+1,i=t.indexOf(")"),n=t.indexOf("(",e);return t.substring(e,~n&&n<i?t.indexOf(")",i+1):i)},Oy=function(t){var e=(t+"").split("("),i=ce[e[0]];return i&&e.length>1&&i.config?i.config.apply(null,~t.indexOf("{")?[Py(e[1])]:Iy(t).split(",").map(C_)):ce._CE&&Dy.test(t)?ce._CE("",t):i},V_=function(t){return function(e){return 1-t(1-e)}},X_=function r(t,e){for(var i=t._first,n;i;)i instanceof Ai?r(i,e):i.vars.yoyoEase&&(!i._yoyo||!i._repeat)&&i._yoyo!==e&&(i.timeline?r(i.timeline,e):(n=i._ease,i._ease=i._yEase,i._yEase=n,i._yoyo=e)),i=i._next},Ps=function(t,e){return t&&(Oe(t)?t:ce[t]||Oy(t))||e},Zs=function(t,e,i,n){i===void 0&&(i=function(l){return 1-e(1-l)}),n===void 0&&(n=function(l){return l<.5?e(l*2)/2:1-e((1-l)*2)/2});var s={easeIn:e,easeOut:i,easeInOut:n},a;return Di(t,function(o){ce[o]=ji[o]=s,ce[a=o.toLowerCase()]=i;for(var l in s)ce[a+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=ce[o+"."+l]=s[l]}),s},K_=function(t){return function(e){return e<.5?(1-t(1-e*2))/2:.5+t((e-.5)*2)/2}},Wu=function r(t,e,i){var n=e>=1?e:1,s=(i||(t?.3:.45))/(e<1?e:1),a=s/od*(Math.asin(1/n)||0),o=function(u){return u===1?1:n*Math.pow(2,-10*u)*oy((u-a)*s)+1},l=t==="out"?o:t==="in"?function(h){return 1-o(1-h)}:K_(o);return s=od/s,l.config=function(h,u){return r(t,h,u)},l},Hu=function r(t,e){e===void 0&&(e=1.70158);var i=function(a){return a?--a*a*((e+1)*a+e)+1:0},n=t==="out"?i:t==="in"?function(s){return 1-i(1-s)}:K_(i);return n.config=function(s){return r(t,s)},n};Di("Linear,Quad,Cubic,Quart,Quint,Strong",function(r,t){var e=t<5?t+1:t;Zs(r+",Power"+(e-1),t?function(i){return Math.pow(i,e)}:function(i){return i},function(i){return 1-Math.pow(1-i,e)},function(i){return i<.5?Math.pow(i*2,e)/2:1-Math.pow((1-i)*2,e)/2})});ce.Linear.easeNone=ce.none=ce.Linear.easeIn;Zs("Elastic",Wu("in"),Wu("out"),Wu());(function(r,t){var e=1/t,i=2*e,n=2.5*e,s=function(o){return o<e?r*o*o:o<i?r*Math.pow(o-1.5/t,2)+.75:o<n?r*(o-=2.25/t)*o+.9375:r*Math.pow(o-2.625/t,2)+.984375};Zs("Bounce",function(a){return 1-s(1-a)},s)})(7.5625,2.75);Zs("Expo",function(r){return r?Math.pow(2,10*(r-1)):0});Zs("Circ",function(r){return-(g_(1-r*r)-1)});Zs("Sine",function(r){return r===1?1:-ay(r*ny)+1});Zs("Back",Hu("in"),Hu("out"),Hu());ce.SteppedEase=ce.steps=ji.SteppedEase={config:function(t,e){t===void 0&&(t=1);var i=1/t,n=t+(e?0:1),s=e?1:0,a=1-_e;return function(o){return((n*gl(0,a,o)|0)+s)*i}}};$a.ease=ce["quad.out"];Di("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(r){return Tf+=r+","+r+"Params,"});var j_=function(t,e){this.id=sy++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:A_,this.set=e?e.getSetter:Mf},Qa=function(){function r(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,Za(this,+e.duration,1,1),this.data=e.data,He&&(this._ctx=He,He.data.push(this)),Zo||Hi.wake()}var t=r.prototype;return t.delay=function(i){return i||i===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+i-this._delay),this._delay=i,this):this._delay},t.duration=function(i){return arguments.length?this.totalDuration(this._repeat>0?i+(i+this._rDelay)*this._repeat:i):this.totalDuration()&&this._dur},t.totalDuration=function(i){return arguments.length?(this._dirty=0,Za(this,this._repeat<0?i:(i-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(i,n){if(Ja(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(xu(this,i),!s._dp||s.parent||R_(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&i<this._tDur||this._ts<0&&i>0||!this._tDur&&!i)&&Pr(this._dp,this,this._start-this._delay)}return(this._tTime!==i||!this._dur&&!n||this._initted&&Math.abs(this._zTime)===_e||!i&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=i),M_(this,i,n)),this},t.time=function(i,n){return arguments.length?this.totalTime(Math.min(this.totalDuration(),i+cp(this))%(this._dur+this._rDelay)||(i?this._dur:0),n):this._time},t.totalProgress=function(i,n){return arguments.length?this.totalTime(this.totalDuration()*i,n):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},t.progress=function(i,n){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-i:i)+cp(this),n):this.duration()?Math.min(1,this._time/this._dur):this.ratio},t.iteration=function(i,n){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(i-1)*s,n):this._repeat?qa(this._tTime,s)+1:1},t.timeScale=function(i){if(!arguments.length)return this._rts===-_e?0:this._rts;if(this._rts===i)return this;var n=this.parent&&this._ts?$h(this.parent._time,this):this._tTime;return this._rts=+i||0,this._ts=this._ps||i===-_e?0:this._rts,this.totalTime(gl(-this._delay,this._tDur,n),!0),vu(this),py(this)},t.paused=function(i){return arguments.length?(this._ps!==i&&(this._ps=i,i?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Ja(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==_e&&(this._tTime-=_e)))),this):this._ps},t.startTime=function(i){if(arguments.length){this._start=i;var n=this.parent||this._dp;return n&&(n._sort||!this.parent)&&Pr(n,this,i-this._delay),this}return this._start},t.endTime=function(i){return this._start+(Li(i)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(i){var n=this.parent||this._dp;return n?i&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?$h(n.rawTime(i),this):this._tTime:this._tTime},t.revert=function(i){i===void 0&&(i=uy);var n=Ci;return Ci=i,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(i),this.totalTime(-.01,i.suppressEvents)),this.data!=="nested"&&i.kill!==!1&&this.kill(),Ci=n,this},t.globalTime=function(i){for(var n=this,s=arguments.length?i:n.rawTime();n;)s=n._start+s/(n._ts||1),n=n._dp;return!this.parent&&this.vars.immediateRender?-1:s},t.repeat=function(i){return arguments.length?(this._repeat=i===1/0?-2:i,dp(this)):this._repeat===-2?1/0:this._repeat},t.repeatDelay=function(i){if(arguments.length){var n=this._time;return this._rDelay=i,dp(this),n?this.time(n):this}return this._rDelay},t.yoyo=function(i){return arguments.length?(this._yoyo=i,this):this._yoyo},t.seek=function(i,n){return this.totalTime(Ji(this,i),Li(n))},t.restart=function(i,n){return this.play().totalTime(i?-this._delay:0,Li(n))},t.play=function(i,n){return i!=null&&this.seek(i,n),this.reversed(!1).paused(!1)},t.reverse=function(i,n){return i!=null&&this.seek(i||this.totalDuration(),n),this.reversed(!0).paused(!1)},t.pause=function(i,n){return i!=null&&this.seek(i,n),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(i){return arguments.length?(!!i!==this.reversed()&&this.timeScale(-this._rts||(i?-_e:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-_e,this},t.isActive=function(){var i=this.parent||this._dp,n=this._start,s;return!!(!i||this._ts&&this._initted&&i.isActive()&&(s=i.rawTime(!0))>=n&&s<this.endTime(!0)-_e)},t.eventCallback=function(i,n,s){var a=this.vars;return arguments.length>1?(n?(a[i]=n,s&&(a[i+"Params"]=s),i==="onUpdate"&&(this._onUpdate=n)):delete a[i],this):a[i]},t.then=function(i){var n=this;return new Promise(function(s){var a=Oe(i)?i:L_,o=function(){var h=n.then;n.then=null,Oe(a)&&(a=a(n))&&(a.then||a===n)&&(n.then=h),s(a),n.then=h};n._initted&&n.totalProgress()===1&&n._ts>=0||!n._tTime&&n._ts<0?o():n._prom=o})},t.kill=function(){wo(this)},r}();ur(Qa.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-_e,_prom:0,_ps:!1,_rts:1});var Ai=function(r){m_(t,r);function t(i,n){var s;return i===void 0&&(i={}),s=r.call(this,i)||this,s.labels={},s.smoothChildTiming=!!i.smoothChildTiming,s.autoRemoveChildren=!!i.autoRemoveChildren,s._sort=Li(i.sortChildren),Ae&&Pr(i.parent||Ae,sn(s),n),i.reversed&&s.reverse(),i.paused&&s.paused(!0),i.scrollTrigger&&P_(sn(s),i.scrollTrigger),s}var e=t.prototype;return e.to=function(n,s,a){return ko(0,arguments,this),this},e.from=function(n,s,a){return ko(1,arguments,this),this},e.fromTo=function(n,s,a,o){return ko(2,arguments,this),this},e.set=function(n,s,a){return s.duration=0,s.parent=this,Bo(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new je(n,s,Ji(this,a),1),this},e.call=function(n,s,a){return Pr(this,je.delayedCall(0,n,s),a)},e.staggerTo=function(n,s,a,o,l,h,u){return a.duration=s,a.stagger=a.stagger||o,a.onComplete=h,a.onCompleteParams=u,a.parent=this,new je(n,a,Ji(this,l)),this},e.staggerFrom=function(n,s,a,o,l,h,u){return a.runBackwards=1,Bo(a).immediateRender=Li(a.immediateRender),this.staggerTo(n,s,a,o,l,h,u)},e.staggerFromTo=function(n,s,a,o,l,h,u,f){return o.startAt=a,Bo(o).immediateRender=Li(o.immediateRender),this.staggerTo(n,s,o,l,h,u,f)},e.render=function(n,s,a){var o=this._time,l=this._dirty?this.totalDuration():this._tDur,h=this._dur,u=n<=0?0:ni(n),f=this._zTime<0!=n<0&&(this._initted||!h),c,_,g,d,p,v,A,E,S,L,T,x;if(this!==Ae&&u>l&&n>=0&&(u=l),u!==this._tTime||a||f){if(o!==this._time&&h&&(u+=this._time-o,n+=this._time-o),c=u,S=this._start,E=this._ts,v=!E,f&&(h||(o=this._zTime),(n||!s)&&(this._zTime=n)),this._repeat){if(T=this._yoyo,p=h+this._rDelay,this._repeat<-1&&n<0)return this.totalTime(p*100+n,s,a);if(c=ni(u%p),u===l?(d=this._repeat,c=h):(d=~~(u/p),d&&d===u/p&&(c=h,d--),c>h&&(c=h)),L=qa(this._tTime,p),!o&&this._tTime&&L!==d&&(L=d),T&&d&1&&(c=h-c,x=1),d!==L&&!this._lock){var m=T&&L&1,w=m===(T&&d&1);if(d<L&&(m=!m),o=m?0:h,this._lock=1,this.render(o||(x?0:ni(d*p)),s,!h)._lock=0,this._tTime=u,!s&&this.parent&&sr(this,"onRepeat"),this.vars.repeatRefresh&&!x&&(this.invalidate()._lock=1),o&&o!==this._time||v!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(h=this._dur,l=this._tDur,w&&(this._lock=2,o=m?h:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!x&&this.invalidate()),this._lock=0,!this._ts&&!v)return this;X_(this,x)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(A=vy(this,ni(o),ni(c)),A&&(u-=c-(c=A._start))),this._tTime=u,this._time=c,this._act=!E,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=n,o=0),!o&&c&&!s&&(sr(this,"onStart"),this._tTime!==u))return this;if(c>=o&&n>=0)for(_=this._first;_;){if(g=_._next,(_._act||c>=_._start)&&_._ts&&A!==_){if(_.parent!==this)return this.render(n,s,a);if(_.render(_._ts>0?(c-_._start)*_._ts:(_._dirty?_.totalDuration():_._tDur)+(c-_._start)*_._ts,s,a),c!==this._time||!this._ts&&!v){A=0,g&&(u+=this._zTime=-_e);break}}_=g}else{_=this._last;for(var R=n<0?n:c;_;){if(g=_._prev,(_._act||R<=_._end)&&_._ts&&A!==_){if(_.parent!==this)return this.render(n,s,a);if(_.render(_._ts>0?(R-_._start)*_._ts:(_._dirty?_.totalDuration():_._tDur)+(R-_._start)*_._ts,s,a||Ci&&(_._initted||_._startAt)),c!==this._time||!this._ts&&!v){A=0,g&&(u+=this._zTime=R?-_e:_e);break}}_=g}}if(A&&!s&&(this.pause(),A.render(c>=o?0:-_e)._zTime=c>=o?1:-1,this._ts))return this._start=S,vu(this),this.render(n,s,a);this._onUpdate&&!s&&sr(this,"onUpdate",!0),(u===l&&this._tTime>=this.totalDuration()||!u&&o)&&(S===this._start||Math.abs(E)!==Math.abs(this._ts))&&(this._lock||((n||!h)&&(u===l&&this._ts>0||!u&&this._ts<0)&&Xn(this,1),!s&&!(n<0&&!o)&&(u||o||!l)&&(sr(this,u===l&&n>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom())))}return this},e.add=function(n,s){var a=this;if(vn(s)||(s=Ji(this,s,n)),!(n instanceof Qa)){if(pi(n))return n.forEach(function(o){return a.add(o,s)}),this;if(ei(n))return this.addLabel(n,s);if(Oe(n))n=je.delayedCall(0,n);else return this}return this!==n?Pr(this,n,s):this},e.getChildren=function(n,s,a,o){n===void 0&&(n=!0),s===void 0&&(s=!0),a===void 0&&(a=!0),o===void 0&&(o=-rr);for(var l=[],h=this._first;h;)h._start>=o&&(h instanceof je?s&&l.push(h):(a&&l.push(h),n&&l.push.apply(l,h.getChildren(!0,s,a)))),h=h._next;return l},e.getById=function(n){for(var s=this.getChildren(1,1,1),a=s.length;a--;)if(s[a].vars.id===n)return s[a]},e.remove=function(n){return ei(n)?this.removeLabel(n):Oe(n)?this.killTweensOf(n):(_u(this,n),n===this._recent&&(this._recent=this._last),Rs(this))},e.totalTime=function(n,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=ni(Hi.time-(this._ts>0?n/this._ts:(this.totalDuration()-n)/-this._ts))),r.prototype.totalTime.call(this,n,s),this._forcing=0,this):this._tTime},e.addLabel=function(n,s){return this.labels[n]=Ji(this,s),this},e.removeLabel=function(n){return delete this.labels[n],this},e.addPause=function(n,s,a){var o=je.delayedCall(0,s||$o,a);return o.data="isPause",this._hasPause=1,Pr(this,o,Ji(this,n))},e.removePause=function(n){var s=this._first;for(n=Ji(this,n);s;)s._start===n&&s.data==="isPause"&&Xn(s),s=s._next},e.killTweensOf=function(n,s,a){for(var o=this.getTweensOf(n,a),l=o.length;l--;)Pn!==o[l]&&o[l].kill(n,s);return this},e.getTweensOf=function(n,s){for(var a=[],o=nr(n),l=this._first,h=vn(s),u;l;)l instanceof je?cy(l._targets,o)&&(h?(!Pn||l._initted&&l._ts)&&l.globalTime(0)<=s&&l.globalTime(l.totalDuration())>s:!s||l.isActive())&&a.push(l):(u=l.getTweensOf(o,s)).length&&a.push.apply(a,u),l=l._next;return a},e.tweenTo=function(n,s){s=s||{};var a=this,o=Ji(a,n),l=s,h=l.startAt,u=l.onStart,f=l.onStartParams,c=l.immediateRender,_,g=je.to(a,ur({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:s.duration||Math.abs((o-(h&&"time"in h?h.time:a._time))/a.timeScale())||_e,onStart:function(){if(a.pause(),!_){var p=s.duration||Math.abs((o-(h&&"time"in h?h.time:a._time))/a.timeScale());g._dur!==p&&Za(g,p,0,1).render(g._time,!0,!0),_=1}u&&u.apply(g,f||[])}},s));return c?g.render(0):g},e.tweenFromTo=function(n,s,a){return this.tweenTo(s,ur({startAt:{time:Ji(this,n)}},a))},e.recent=function(){return this._recent},e.nextLabel=function(n){return n===void 0&&(n=this._time),fp(this,Ji(this,n))},e.previousLabel=function(n){return n===void 0&&(n=this._time),fp(this,Ji(this,n),1)},e.currentLabel=function(n){return arguments.length?this.seek(n,!0):this.previousLabel(this._time+_e)},e.shiftChildren=function(n,s,a){a===void 0&&(a=0);for(var o=this._first,l=this.labels,h;o;)o._start>=a&&(o._start+=n,o._end+=n),o=o._next;if(s)for(h in l)l[h]>=a&&(l[h]+=n);return Rs(this)},e.invalidate=function(n){var s=this._first;for(this._lock=0;s;)s.invalidate(n),s=s._next;return r.prototype.invalidate.call(this,n)},e.clear=function(n){n===void 0&&(n=!0);for(var s=this._first,a;s;)a=s._next,this.remove(s),s=a;return this._dp&&(this._time=this._tTime=this._pTime=0),n&&(this.labels={}),Rs(this)},e.totalDuration=function(n){var s=0,a=this,o=a._last,l=rr,h,u,f;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-n:n));if(a._dirty){for(f=a.parent;o;)h=o._prev,o._dirty&&o.totalDuration(),u=o._start,u>l&&a._sort&&o._ts&&!a._lock?(a._lock=1,Pr(a,o,u-o._delay,1)._lock=0):l=u,u<0&&o._ts&&(s-=u,(!f&&!a._dp||f&&f.smoothChildTiming)&&(a._start+=u/a._ts,a._time-=u,a._tTime-=u),a.shiftChildren(-u,!1,-1/0),l=0),o._end>s&&o._ts&&(s=o._end),o=h;Za(a,a===Ae&&a._time>s?a._time:s,1,1),a._dirty=0}return a._tDur},t.updateRoot=function(n){if(Ae._ts&&(M_(Ae,$h(n,Ae)),w_=Hi.frame),Hi.frame>=hp){hp+=Xi.autoSleep||120;var s=Ae._first;if((!s||!s._ts)&&Xi.autoSleep&&Hi._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||Hi.sleep()}}},t}(Qa);ur(Ai.prototype,{_lock:0,_hasPause:0,_forcing:0});var Fy=function(t,e,i,n,s,a,o){var l=new Ri(this._pt,t,e,0,1,Q_,null,s),h=0,u=0,f,c,_,g,d,p,v,A;for(l.b=i,l.e=n,i+="",n+="",(v=~n.indexOf("random("))&&(n=qo(n)),a&&(A=[i,n],a(A,t,e),i=A[0],n=A[1]),c=i.match(Nu)||[];f=Nu.exec(n);)g=f[0],d=n.substring(h,f.index),_?_=(_+1)%5:d.substr(-5)==="rgba("&&(_=1),g!==c[u++]&&(p=parseFloat(c[u-1])||0,l._pt={_next:l._pt,p:d||u===1?d:",",s:p,c:g.charAt(1)==="="?Fa(p,g)-p:parseFloat(g)-p,m:_&&_<4?Math.round:0},h=Nu.lastIndex);return l.c=h<n.length?n.substring(h,n.length):"",l.fp=o,(y_.test(n)||v)&&(l.e=0),this._pt=l,l},Sf=function(t,e,i,n,s,a,o,l,h,u){Oe(n)&&(n=n(s||0,t,a));var f=t[e],c=i!=="get"?i:Oe(f)?h?t[e.indexOf("set")||!Oe(t["get"+e.substr(3)])?e:"get"+e.substr(3)](h):t[e]():f,_=Oe(f)?h?Gy:Z_:Af,g;if(ei(n)&&(~n.indexOf("random(")&&(n=qo(n)),n.charAt(1)==="="&&(g=Fa(c,n)+(di(c)||0),(g||g===0)&&(n=g))),!u||c!==n||gd)return!isNaN(c*n)&&n!==""?(g=new Ri(this._pt,t,e,+c||0,n-(c||0),typeof f=="boolean"?Wy:J_,0,_),h&&(g.fp=h),o&&g.modifier(o,this,t),this._pt=g):(!f&&!(e in t)&&yf(e,n),Fy.call(this,t,e,c,n,_,l||Xi.stringFilter,h))},By=function(t,e,i,n,s){if(Oe(t)&&(t=Uo(t,s,e,i,n)),!Kr(t)||t.style&&t.nodeType||pi(t)||v_(t))return ei(t)?Uo(t,s,e,i,n):t;var a={},o;for(o in t)a[o]=Uo(t[o],s,e,i,n);return a},Y_=function(t,e,i,n,s,a){var o,l,h,u;if(zi[t]&&(o=new zi[t]).init(s,o.rawVars?e[t]:By(e[t],n,s,a,i),i,n,a)!==!1&&(i._pt=l=new Ri(i._pt,s,t,0,1,o.render,o,0,o.priority),i!==Ma))for(h=i._ptLookup[i._targets.indexOf(s)],u=o._props.length;u--;)h[o._props[u]]=l;return o},Pn,gd,wf=function r(t,e,i){var n=t.vars,s=n.ease,a=n.startAt,o=n.immediateRender,l=n.lazy,h=n.onUpdate,u=n.onUpdateParams,f=n.callbackScope,c=n.runBackwards,_=n.yoyoEase,g=n.keyframes,d=n.autoRevert,p=t._dur,v=t._startAt,A=t._targets,E=t.parent,S=E&&E.data==="nested"?E.vars.targets:A,L=t._overwrite==="auto"&&!_f,T=t.timeline,x,m,w,R,M,C,b,D,O,B,P,F,I;if(T&&(!g||!s)&&(s="none"),t._ease=Ps(s,$a.ease),t._yEase=_?V_(Ps(_===!0?s:_,$a.ease)):0,_&&t._yoyo&&!t._repeat&&(_=t._yEase,t._yEase=t._ease,t._ease=_),t._from=!T&&!!n.runBackwards,!T||g&&!n.stagger){if(D=A[0]?Ds(A[0]).harness:0,F=D&&n[D.prop],x=Yh(n,Ef),v&&(v._zTime<0&&v.progress(1),e<0&&c&&o&&!d?v.render(-1,!0):v.revert(c&&p?Ah:hy),v._lazy=0),a){if(Xn(t._startAt=je.set(A,ur({data:"isStart",overwrite:!1,parent:E,immediateRender:!0,lazy:Li(l),startAt:null,delay:0,onUpdate:h,onUpdateParams:u,callbackScope:f,stagger:0},a))),t._startAt._dp=0,e<0&&(Ci||!o&&!d)&&t._startAt.revert(Ah),o&&p&&e<=0&&i<=0){e&&(t._zTime=e);return}}else if(c&&p&&!v){if(e&&(o=!1),w=ur({overwrite:!1,data:"isFromStart",lazy:o&&Li(l),immediateRender:o,stagger:0,parent:E},x),F&&(w[D.prop]=F),Xn(t._startAt=je.set(A,w)),t._startAt._dp=0,e<0&&(Ci?t._startAt.revert(Ah):t._startAt.render(-1,!0)),t._zTime=e,!o)r(t._startAt,_e,_e);else if(!e)return}for(t._pt=t._ptCache=0,l=p&&Li(l)||l&&!p,m=0;m<A.length;m++){if(M=A[m],b=M._gsap||bf(A)[m]._gsap,t._ptLookup[m]=B={},ud[b.id]&&Nn.length&&jh(),P=S===A?m:S.indexOf(M),D&&(O=new D).init(M,F||x,t,P,S)!==!1&&(t._pt=R=new Ri(t._pt,M,O.name,0,1,O.render,O,0,O.priority),O._props.forEach(function(y){B[y]=R}),O.priority&&(C=1)),!D||F)for(w in x)zi[w]&&(O=Y_(w,x,t,P,M,S))?O.priority&&(C=1):B[w]=R=Sf.call(t,M,w,"get",x[w],P,S,0,n.stringFilter);t._op&&t._op[m]&&t.kill(M,t._op[m]),L&&t._pt&&(Pn=t,Ae.killTweensOf(M,B,t.globalTime(e)),I=!t.parent,Pn=0),t._pt&&l&&(ud[b.id]=1)}C&&tv(t),t._onInit&&t._onInit(t)}t._onUpdate=h,t._initted=(!t._op||t._pt)&&!I,g&&e<=0&&T.render(rr,!0,!0)},ky=function(t,e,i,n,s,a,o){var l=(t._pt&&t._ptCache||(t._ptCache={}))[e],h,u,f,c;if(!l)for(l=t._ptCache[e]=[],f=t._ptLookup,c=t._targets.length;c--;){if(h=f[c][e],h&&h.d&&h.d._pt)for(h=h.d._pt;h&&h.p!==e&&h.fp!==e;)h=h._next;if(!h)return gd=1,t.vars[e]="+=0",wf(t,o),gd=0,1;l.push(h)}for(c=l.length;c--;)u=l[c],h=u._pt||u,h.s=(n||n===0)&&!s?n:h.s+(n||0)+a*h.c,h.c=i-h.s,u.e&&(u.e=Ue(i)+di(u.e)),u.b&&(u.b=h.s+di(u.b))},Uy=function(t,e){var i=t[0]?Ds(t[0]).harness:0,n=i&&i.aliases,s,a,o,l;if(!n)return e;s=Gs({},e);for(a in n)if(a in s)for(l=n[a].split(","),o=l.length;o--;)s[l[o]]=s[a];return s},Ny=function(t,e,i,n){var s=e.ease||n||"power1.inOut",a,o;if(pi(e))o=i[t]||(i[t]=[]),e.forEach(function(l,h){return o.push({t:h/(e.length-1)*100,v:l,e:s})});else for(a in e)o=i[a]||(i[a]=[]),a==="ease"||o.push({t:parseFloat(t),v:e[a],e:s})},Uo=function(t,e,i,n,s){return Oe(t)?t.call(e,i,n,s):ei(t)&&~t.indexOf("random(")?qo(t):t},$_=Tf+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",q_={};Di($_+",id,stagger,delay,duration,paused,scrollTrigger",function(r){return q_[r]=1});var je=function(r){m_(t,r);function t(i,n,s,a){var o;typeof n=="number"&&(s.duration=n,n=s,s=null),o=r.call(this,a?n:Bo(n))||this;var l=o.vars,h=l.duration,u=l.delay,f=l.immediateRender,c=l.stagger,_=l.overwrite,g=l.keyframes,d=l.defaults,p=l.scrollTrigger,v=l.yoyoEase,A=n.parent||Ae,E=(pi(i)||v_(i)?vn(i[0]):"length"in n)?[i]:nr(i),S,L,T,x,m,w,R,M;if(o._targets=E.length?bf(E):Kh("GSAP target "+i+" not found. https://greensock.com",!Xi.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=_,g||c||Ml(h)||Ml(u)){if(n=o.vars,S=o.timeline=new Ai({data:"nested",defaults:d||{},targets:A&&A.data==="nested"?A.vars.targets:E}),S.kill(),S.parent=S._dp=sn(o),S._start=0,c||Ml(h)||Ml(u)){if(x=E.length,R=c&&B_(c),Kr(c))for(m in c)~$_.indexOf(m)&&(M||(M={}),M[m]=c[m]);for(L=0;L<x;L++)T=Yh(n,q_),T.stagger=0,v&&(T.yoyoEase=v),M&&Gs(T,M),w=E[L],T.duration=+Uo(h,sn(o),L,w,E),T.delay=(+Uo(u,sn(o),L,w,E)||0)-o._delay,!c&&x===1&&T.delay&&(o._delay=u=T.delay,o._start+=u,T.delay=0),S.to(w,T,R?R(L,w,E):0),S._ease=ce.none;S.duration()?h=u=0:o.timeline=0}else if(g){Bo(ur(S.vars.defaults,{ease:"none"})),S._ease=Ps(g.ease||n.ease||"none");var C=0,b,D,O;if(pi(g))g.forEach(function(B){return S.to(E,B,">")}),S.duration();else{T={};for(m in g)m==="ease"||m==="easeEach"||Ny(m,g[m],T,g.easeEach);for(m in T)for(b=T[m].sort(function(B,P){return B.t-P.t}),C=0,L=0;L<b.length;L++)D=b[L],O={ease:D.e,duration:(D.t-(L?b[L-1].t:0))/100*h},O[m]=D.v,S.to(E,O,C),C+=O.duration;S.duration()<h&&S.to({},{duration:h-S.duration()})}}h||o.duration(h=S.duration())}else o.timeline=0;return _===!0&&!_f&&(Pn=sn(o),Ae.killTweensOf(E),Pn=0),Pr(A,sn(o),s),n.reversed&&o.reverse(),n.paused&&o.paused(!0),(f||!h&&!g&&o._start===ni(A._time)&&Li(f)&&my(sn(o))&&A.data!=="nested")&&(o._tTime=-_e,o.render(Math.max(0,-u)||0)),p&&P_(sn(o),p),o}var e=t.prototype;return e.render=function(n,s,a){var o=this._time,l=this._tDur,h=this._dur,u=n<0,f=n>l-_e&&!u?l:n<_e?0:n,c,_,g,d,p,v,A,E,S;if(!h)_y(this,n,s,a);else if(f!==this._tTime||!n||a||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==u){if(c=f,E=this.timeline,this._repeat){if(d=h+this._rDelay,this._repeat<-1&&u)return this.totalTime(d*100+n,s,a);if(c=ni(f%d),f===l?(g=this._repeat,c=h):(g=~~(f/d),g&&g===f/d&&(c=h,g--),c>h&&(c=h)),v=this._yoyo&&g&1,v&&(S=this._yEase,c=h-c),p=qa(this._tTime,d),c===o&&!a&&this._initted)return this._tTime=f,this;g!==p&&(E&&this._yEase&&X_(E,v),this.vars.repeatRefresh&&!v&&!this._lock&&(this._lock=a=1,this.render(ni(d*g),!0).invalidate()._lock=0))}if(!this._initted){if(I_(this,u?n:c,a,s,f))return this._tTime=0,this;if(o!==this._time)return this;if(h!==this._dur)return this.render(n,s,a)}if(this._tTime=f,this._time=c,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=A=(S||this._ease)(c/h),this._from&&(this.ratio=A=1-A),c&&!o&&!s&&(sr(this,"onStart"),this._tTime!==f))return this;for(_=this._pt;_;)_.r(A,_.d),_=_._next;E&&E.render(n<0?n:!c&&v?-_e:E._dur*E._ease(c/this._dur),s,a)||this._startAt&&(this._zTime=n),this._onUpdate&&!s&&(u&&cd(this,n,s,a),sr(this,"onUpdate")),this._repeat&&g!==p&&this.vars.onRepeat&&!s&&this.parent&&sr(this,"onRepeat"),(f===this._tDur||!f)&&this._tTime===f&&(u&&!this._onUpdate&&cd(this,n,!0,!0),(n||!h)&&(f===this._tDur&&this._ts>0||!f&&this._ts<0)&&Xn(this,1),!s&&!(u&&!o)&&(f||o||v)&&(sr(this,f===l?"onComplete":"onReverseComplete",!0),this._prom&&!(f<l&&this.timeScale()>0)&&this._prom()))}return this},e.targets=function(){return this._targets},e.invalidate=function(n){return(!n||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(n),r.prototype.invalidate.call(this,n)},e.resetTo=function(n,s,a,o){Zo||Hi.wake(),this._ts||this.play();var l=Math.min(this._dur,(this._dp._time-this._start)*this._ts),h;return this._initted||wf(this,l),h=this._ease(l/this._dur),ky(this,n,s,a,o,h,l)?this.resetTo(n,s,a,o):(xu(this,0),this.parent||D_(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},e.kill=function(n,s){if(s===void 0&&(s="all"),!n&&(!s||s==="all"))return this._lazy=this._pt=0,this.parent?wo(this):this;if(this.timeline){var a=this.timeline.totalDuration();return this.timeline.killTweensOf(n,s,Pn&&Pn.vars.overwrite!==!0)._first||wo(this),this.parent&&a!==this.timeline.totalDuration()&&Za(this,this._dur*this.timeline._tDur/a,0,1),this}var o=this._targets,l=n?nr(n):o,h=this._ptLookup,u=this._pt,f,c,_,g,d,p,v;if((!s||s==="all")&&fy(o,l))return s==="all"&&(this._pt=0),wo(this);for(f=this._op=this._op||[],s!=="all"&&(ei(s)&&(d={},Di(s,function(A){return d[A]=1}),s=d),s=Uy(o,s)),v=o.length;v--;)if(~l.indexOf(o[v])){c=h[v],s==="all"?(f[v]=s,g=c,_={}):(_=f[v]=f[v]||{},g=s);for(d in g)p=c&&c[d],p&&((!("kill"in p.d)||p.d.kill(d)===!0)&&_u(this,p,"_pt"),delete c[d]),_!=="all"&&(_[d]=1)}return this._initted&&!this._pt&&u&&wo(this),this},t.to=function(n,s){return new t(n,s,arguments[2])},t.from=function(n,s){return ko(1,arguments)},t.delayedCall=function(n,s,a,o){return new t(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:n,onComplete:s,onReverseComplete:s,onCompleteParams:a,onReverseCompleteParams:a,callbackScope:o})},t.fromTo=function(n,s,a){return ko(2,arguments)},t.set=function(n,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new t(n,s)},t.killTweensOf=function(n,s,a){return Ae.killTweensOf(n,s,a)},t}(Qa);ur(je.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Di("staggerTo,staggerFrom,staggerFromTo",function(r){je[r]=function(){var t=new Ai,e=fd.call(arguments,0);return e.splice(r==="staggerFromTo"?5:4,0,0),t[r].apply(t,e)}});var Af=function(t,e,i){return t[e]=i},Z_=function(t,e,i){return t[e](i)},Gy=function(t,e,i,n){return t[e](n.fp,i)},zy=function(t,e,i){return t.setAttribute(e,i)},Mf=function(t,e){return Oe(t[e])?Z_:vf(t[e])&&t.setAttribute?zy:Af},J_=function(t,e){return e.set(e.t,e.p,Math.round((e.s+e.c*t)*1e6)/1e6,e)},Wy=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},Q_=function(t,e){var i=e._pt,n="";if(!t&&e.b)n=e.b;else if(t===1&&e.e)n=e.e;else{for(;i;)n=i.p+(i.m?i.m(i.s+i.c*t):Math.round((i.s+i.c*t)*1e4)/1e4)+n,i=i._next;n+=e.c}e.set(e.t,e.p,n,e)},Cf=function(t,e){for(var i=e._pt;i;)i.r(t,i.d),i=i._next},Hy=function(t,e,i,n){for(var s=this._pt,a;s;)a=s._next,s.p===n&&s.modifier(t,e,i),s=a},Vy=function(t){for(var e=this._pt,i,n;e;)n=e._next,e.p===t&&!e.op||e.op===t?_u(this,e,"_pt"):e.dep||(i=1),e=n;return!i},Xy=function(t,e,i,n){n.mSet(t,e,n.m.call(n.tween,i,n.mt),n)},tv=function(t){for(var e=t._pt,i,n,s,a;e;){for(i=e._next,n=s;n&&n.pr>e.pr;)n=n._next;(e._prev=n?n._prev:a)?e._prev._next=e:s=e,(e._next=n)?n._prev=e:a=e,e=i}t._pt=s},Ri=function(){function r(e,i,n,s,a,o,l,h,u){this.t=i,this.s=s,this.c=a,this.p=n,this.r=o||J_,this.d=l||this,this.set=h||Af,this.pr=u||0,this._next=e,e&&(e._prev=this)}var t=r.prototype;return t.modifier=function(i,n,s){this.mSet=this.mSet||this.set,this.set=Xy,this.m=i,this.mt=s,this.tween=n},r}();Di(Tf+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(r){return Ef[r]=1});ji.TweenMax=ji.TweenLite=je;ji.TimelineLite=ji.TimelineMax=Ai;Ae=new Ai({sortChildren:!1,defaults:$a,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Xi.stringFilter=H_;var to=[],Ch={},Ky=[],mp=0,Vu=function(t){return(Ch[t]||Ky).map(function(e){return e()})},_d=function(){var t=Date.now(),e=[];t-mp>2&&(Vu("matchMediaInit"),to.forEach(function(i){var n=i.queries,s=i.conditions,a,o,l,h;for(o in n)a=Qi.matchMedia(n[o]).matches,a&&(l=1),a!==s[o]&&(s[o]=a,h=1);h&&(i.revert(),l&&e.push(i))}),Vu("matchMediaRevert"),e.forEach(function(i){return i.onMatch(i)}),mp=t,Vu("matchMedia"))},ev=function(){function r(e,i){this.selector=i&&pd(i),this.data=[],this._r=[],this.isReverted=!1,e&&this.add(e)}var t=r.prototype;return t.add=function(i,n,s){Oe(i)&&(s=n,n=i,i=Oe);var a=this,o=function(){var h=He,u=a.selector,f;return h&&h!==a&&h.data.push(a),s&&(a.selector=pd(s)),He=a,f=n.apply(a,arguments),Oe(f)&&a._r.push(f),He=h,a.selector=u,a.isReverted=!1,f};return a.last=o,i===Oe?o(a):i?a[i]=o:o},t.ignore=function(i){var n=He;He=null,i(this),He=n},t.getTweens=function(){var i=[];return this.data.forEach(function(n){return n instanceof r?i.push.apply(i,n.getTweens()):n instanceof je&&!(n.parent&&n.parent.data==="nested")&&i.push(n)}),i},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(i,n){var s=this;if(i){var a=this.getTweens();this.data.forEach(function(l){l.data==="isFlip"&&(l.revert(),l.getChildren(!0,!0,!1).forEach(function(h){return a.splice(a.indexOf(h),1)}))}),a.map(function(l){return{g:l.globalTime(0),t:l}}).sort(function(l,h){return h.g-l.g||-1}).forEach(function(l){return l.t.revert(i)}),this.data.forEach(function(l){return!(l instanceof Qa)&&l.revert&&l.revert(i)}),this._r.forEach(function(l){return l(i,s)}),this.isReverted=!0}else this.data.forEach(function(l){return l.kill&&l.kill()});if(this.clear(),n){var o=to.indexOf(this);~o&&to.splice(o,1)}},t.revert=function(i){this.kill(i||{})},r}(),jy=function(){function r(e){this.contexts=[],this.scope=e}var t=r.prototype;return t.add=function(i,n,s){Kr(i)||(i={matches:i});var a=new ev(0,s||this.scope),o=a.conditions={},l,h,u;this.contexts.push(a),n=a.add("onMatch",n),a.queries=i;for(h in i)h==="all"?u=1:(l=Qi.matchMedia(i[h]),l&&(to.indexOf(a)<0&&to.push(a),(o[h]=l.matches)&&(u=1),l.addListener?l.addListener(_d):l.addEventListener("change",_d)));return u&&n(a),this},t.revert=function(i){this.kill(i||{})},t.kill=function(i){this.contexts.forEach(function(n){return n.kill(i,!0)})},r}(),qh={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach(function(n){return Cy(n)})},timeline:function(t){return new Ai(t)},getTweensOf:function(t,e){return Ae.getTweensOf(t,e)},getProperty:function(t,e,i,n){ei(t)&&(t=nr(t)[0]);var s=Ds(t||{}).get,a=i?L_:C_;return i==="native"&&(i=""),t&&(e?a((zi[e]&&zi[e].get||s)(t,e,i,n)):function(o,l,h){return a((zi[o]&&zi[o].get||s)(t,o,l,h))})},quickSetter:function(t,e,i){if(t=nr(t),t.length>1){var n=t.map(function(u){return Ei.quickSetter(u,e,i)}),s=n.length;return function(u){for(var f=s;f--;)n[f](u)}}t=t[0]||{};var a=zi[e],o=Ds(t),l=o.harness&&(o.harness.aliases||{})[e]||e,h=a?function(u){var f=new a;Ma._pt=0,f.init(t,i?u+i:u,Ma,0,[t]),f.render(1,f),Ma._pt&&Cf(1,Ma)}:o.set(t,l);return a?h:function(u){return h(t,l,i?u+i:u,o,1)}},quickTo:function(t,e,i){var n,s=Ei.to(t,Gs((n={},n[e]="+=0.1",n.paused=!0,n),i||{})),a=function(l,h,u){return s.resetTo(e,l,h,u)};return a.tween=s,a},isTweening:function(t){return Ae.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=Ps(t.ease,$a.ease)),up($a,t||{})},config:function(t){return up(Xi,t||{})},registerEffect:function(t){var e=t.name,i=t.effect,n=t.plugins,s=t.defaults,a=t.extendTimeline;(n||"").split(",").forEach(function(o){return o&&!zi[o]&&!ji[o]&&Kh(e+" effect requires "+o+" plugin.")}),Gu[e]=function(o,l,h){return i(nr(o),ur(l||{},s),h)},a&&(Ai.prototype[e]=function(o,l,h){return this.add(Gu[e](o,Kr(l)?l:(h=l)&&{},this),h)})},registerEase:function(t,e){ce[t]=Ps(e)},parseEase:function(t,e){return arguments.length?Ps(t,e):ce},getById:function(t){return Ae.getById(t)},exportRoot:function(t,e){t===void 0&&(t={});var i=new Ai(t),n,s;for(i.smoothChildTiming=Li(t.smoothChildTiming),Ae.remove(i),i._dp=0,i._time=i._tTime=Ae._time,n=Ae._first;n;)s=n._next,(e||!(!n._dur&&n instanceof je&&n.vars.onComplete===n._targets[0]))&&Pr(i,n,n._start-n._delay),n=s;return Pr(Ae,i,0),i},context:function(t,e){return t?new ev(t,e):He},matchMedia:function(t){return new jy(t)},matchMediaRefresh:function(){return to.forEach(function(t){var e=t.conditions,i,n;for(n in e)e[n]&&(e[n]=!1,i=1);i&&t.revert()})||_d()},addEventListener:function(t,e){var i=Ch[t]||(Ch[t]=[]);~i.indexOf(e)||i.push(e)},removeEventListener:function(t,e){var i=Ch[t],n=i&&i.indexOf(e);n>=0&&i.splice(n,1)},utils:{wrap:wy,wrapYoyo:Ay,distribute:B_,random:U_,snap:k_,normalize:Sy,getUnit:di,clamp:yy,splitColor:z_,toArray:nr,selector:pd,mapRange:G_,pipe:Ty,unitize:by,interpolate:My,shuffle:F_},install:b_,effects:Gu,ticker:Hi,updateRoot:Ai.updateRoot,plugins:zi,globalTimeline:Ae,core:{PropTween:Ri,globals:S_,Tween:je,Timeline:Ai,Animation:Qa,getCache:Ds,_removeLinkedListItem:_u,reverting:function(){return Ci},context:function(t){return t&&He&&(He.data.push(t),t._ctx=He),He},suppressOverwrites:function(t){return _f=t}}};Di("to,from,fromTo,delayedCall,set,killTweensOf",function(r){return qh[r]=je[r]});Hi.add(Ai.updateRoot);Ma=qh.to({},{duration:0});var Yy=function(t,e){for(var i=t._pt;i&&i.p!==e&&i.op!==e&&i.fp!==e;)i=i._next;return i},$y=function(t,e){var i=t._targets,n,s,a;for(n in e)for(s=i.length;s--;)a=t._ptLookup[s][n],a&&(a=a.d)&&(a._pt&&(a=Yy(a,n)),a&&a.modifier&&a.modifier(e[n],t,i[s],n))},Xu=function(t,e){return{name:t,rawVars:1,init:function(n,s,a){a._onInit=function(o){var l,h;if(ei(s)&&(l={},Di(s,function(u){return l[u]=1}),s=l),e){l={};for(h in s)l[h]=e(s[h]);s=l}$y(o,s)}}}},Ei=qh.registerPlugin({name:"attr",init:function(t,e,i,n,s){var a,o,l;this.tween=i;for(a in e)l=t.getAttribute(a)||"",o=this.add(t,"setAttribute",(l||0)+"",e[a],n,s,0,0,a),o.op=a,o.b=l,this._props.push(a)},render:function(t,e){for(var i=e._pt;i;)Ci?i.set(i.t,i.p,i.b,i):i.r(t,i.d),i=i._next}},{name:"endArray",init:function(t,e){for(var i=e.length;i--;)this.add(t,i,t[i]||0,e[i],0,0,0,0,0,1)}},Xu("roundProps",md),Xu("modifiers"),Xu("snap",k_))||qh;je.version=Ai.version=Ei.version="3.11.3";T_=1;__()&&Ja();ce.Power0;ce.Power1;ce.Power2;ce.Power3;ce.Power4;ce.Linear;ce.Quad;ce.Cubic;ce.Quart;ce.Quint;ce.Strong;ce.Elastic;ce.Back;ce.SteppedEase;ce.Bounce;ce.Sine;ce.Expo;ce.Circ;/*!
 * CSSPlugin 3.11.3
 * https://greensock.com
 *
 * Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var gp,In,Ba,Lf,Ss,_p,Df,qy=function(){return typeof window<"u"},xn={},cs=180/Math.PI,ka=Math.PI/180,ia=Math.atan2,vp=1e8,Rf=/([A-Z])/g,Zy=/(left|right|width|margin|padding|x)/i,Jy=/[\s,\(]\S/,un={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},vd=function(t,e){return e.set(e.t,e.p,Math.round((e.s+e.c*t)*1e4)/1e4+e.u,e)},Qy=function(t,e){return e.set(e.t,e.p,t===1?e.e:Math.round((e.s+e.c*t)*1e4)/1e4+e.u,e)},tE=function(t,e){return e.set(e.t,e.p,t?Math.round((e.s+e.c*t)*1e4)/1e4+e.u:e.b,e)},eE=function(t,e){var i=e.s+e.c*t;e.set(e.t,e.p,~~(i+(i<0?-.5:.5))+e.u,e)},iv=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},rv=function(t,e){return e.set(e.t,e.p,t!==1?e.b:e.e,e)},iE=function(t,e,i){return t.style[e]=i},rE=function(t,e,i){return t.style.setProperty(e,i)},nE=function(t,e,i){return t._gsap[e]=i},sE=function(t,e,i){return t._gsap.scaleX=t._gsap.scaleY=i},aE=function(t,e,i,n,s){var a=t._gsap;a.scaleX=a.scaleY=i,a.renderTransform(s,a)},oE=function(t,e,i,n,s){var a=t._gsap;a[e]=i,a.renderTransform(s,a)},Ce="transform",br=Ce+"Origin",lE=function(t,e){var i=this,n=this.target,s=n.style;if(t in xn){if(this.tfm=this.tfm||{},t!=="transform"&&(t=un[t]||t,~t.indexOf(",")?t.split(",").forEach(function(a){return i.tfm[a]=on(n,a)}):this.tfm[t]=n._gsap.x?n._gsap[t]:on(n,t)),this.props.indexOf(Ce)>=0)return;n._gsap.svg&&(this.svgo=n.getAttribute("data-svg-origin"),this.props.push(br,e,"")),t=Ce}(s||e)&&this.props.push(t,e,s[t])},nv=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},hE=function(){var t=this.props,e=this.target,i=e.style,n=e._gsap,s,a;for(s=0;s<t.length;s+=3)t[s+1]?e[t[s]]=t[s+2]:t[s+2]?i[t[s]]=t[s+2]:i.removeProperty(t[s].replace(Rf,"-$1").toLowerCase());if(this.tfm){for(a in this.tfm)n[a]=this.tfm[a];n.svg&&(n.renderTransform(),e.setAttribute("data-svg-origin",this.svgo||"")),s=Df(),s&&!s.isStart&&!i[Ce]&&(nv(i),n.uncache=1)}},sv=function(t,e){var i={target:t,props:[],revert:hE,save:lE};return e&&e.split(",").forEach(function(n){return i.save(n)}),i},av,xd=function(t,e){var i=In.createElementNS?In.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):In.createElement(t);return i.style?i:In.createElement(t)},Gr=function r(t,e,i){var n=getComputedStyle(t);return n[e]||n.getPropertyValue(e.replace(Rf,"-$1").toLowerCase())||n.getPropertyValue(e)||!i&&r(t,eo(e)||e,1)||""},xp="O,Moz,ms,Ms,Webkit".split(","),eo=function(t,e,i){var n=e||Ss,s=n.style,a=5;if(t in s&&!i)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);a--&&!(xp[a]+t in s););return a<0?null:(a===3?"ms":a>=0?xp[a]:"")+t},yd=function(){qy()&&window.document&&(gp=window,In=gp.document,Ba=In.documentElement,Ss=xd("div")||{style:{}},xd("div"),Ce=eo(Ce),br=Ce+"Origin",Ss.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",av=!!eo("perspective"),Df=Ei.core.reverting,Lf=1)},Ku=function r(t){var e=xd("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,n=this.nextSibling,s=this.style.cssText,a;if(Ba.appendChild(e),e.appendChild(this),this.style.display="block",t)try{a=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=r}catch{}else this._gsapBBox&&(a=this._gsapBBox());return i&&(n?i.insertBefore(this,n):i.appendChild(this)),Ba.removeChild(e),this.style.cssText=s,a},yp=function(t,e){for(var i=e.length;i--;)if(t.hasAttribute(e[i]))return t.getAttribute(e[i])},ov=function(t){var e;try{e=t.getBBox()}catch{e=Ku.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===Ku||(e=Ku.call(t,!0)),e&&!e.width&&!e.x&&!e.y?{x:+yp(t,["x","cx","x1"])||0,y:+yp(t,["y","cy","y1"])||0,width:0,height:0}:e},lv=function(t){return!!(t.getCTM&&(!t.parentNode||t.ownerSVGElement)&&ov(t))},Jo=function(t,e){if(e){var i=t.style;e in xn&&e!==br&&(e=Ce),i.removeProperty?((e.substr(0,2)==="ms"||e.substr(0,6)==="webkit")&&(e="-"+e),i.removeProperty(e.replace(Rf,"-$1").toLowerCase())):i.removeAttribute(e)}},On=function(t,e,i,n,s,a){var o=new Ri(t._pt,e,i,0,1,a?rv:iv);return t._pt=o,o.b=n,o.e=s,t._props.push(i),o},Ep={deg:1,rad:1,turn:1},uE={grid:1,flex:1},Kn=function r(t,e,i,n){var s=parseFloat(i)||0,a=(i+"").trim().substr((s+"").length)||"px",o=Ss.style,l=Zy.test(e),h=t.tagName.toLowerCase()==="svg",u=(h?"client":"offset")+(l?"Width":"Height"),f=100,c=n==="px",_=n==="%",g,d,p,v;return n===a||!s||Ep[n]||Ep[a]?s:(a!=="px"&&!c&&(s=r(t,e,i,"px")),v=t.getCTM&&lv(t),(_||a==="%")&&(xn[e]||~e.indexOf("adius"))?(g=v?t.getBBox()[l?"width":"height"]:t[u],Ue(_?s/g*f:s/100*g)):(o[l?"width":"height"]=f+(c?a:n),d=~e.indexOf("adius")||n==="em"&&t.appendChild&&!h?t:t.parentNode,v&&(d=(t.ownerSVGElement||{}).parentNode),(!d||d===In||!d.appendChild)&&(d=In.body),p=d._gsap,p&&_&&p.width&&l&&p.time===Hi.time&&!p.uncache?Ue(s/p.width*f):((_||a==="%")&&!uE[Gr(d,"display")]&&(o.position=Gr(t,"position")),d===t&&(o.position="static"),d.appendChild(Ss),g=Ss[u],d.removeChild(Ss),o.position="absolute",l&&_&&(p=Ds(d),p.time=Hi.time,p.width=d[u]),Ue(c?g*s/f:g&&s?f/g*s:0))))},on=function(t,e,i,n){var s;return Lf||yd(),e in un&&e!=="transform"&&(e=un[e],~e.indexOf(",")&&(e=e.split(",")[0])),xn[e]&&e!=="transform"?(s=tl(t,n),s=e!=="transformOrigin"?s[e]:s.svg?s.origin:Jh(Gr(t,br))+" "+s.zOrigin+"px"):(s=t.style[e],(!s||s==="auto"||n||~(s+"").indexOf("calc("))&&(s=Zh[e]&&Zh[e](t,e,i)||Gr(t,e)||A_(t,e)||(e==="opacity"?1:0))),i&&!~(s+"").trim().indexOf(" ")?Kn(t,e,s,i)+i:s},cE=function(t,e,i,n){if(!i||i==="none"){var s=eo(e,t,1),a=s&&Gr(t,s,1);a&&a!==i?(e=s,i=a):e==="borderColor"&&(i=Gr(t,"borderTopColor"))}var o=new Ri(this._pt,t.style,e,0,1,Q_),l=0,h=0,u,f,c,_,g,d,p,v,A,E,S,L;if(o.b=i,o.e=n,i+="",n+="",n==="auto"&&(t.style[e]=n,n=Gr(t,e)||n,t.style[e]=i),u=[i,n],H_(u),i=u[0],n=u[1],c=i.match(Aa)||[],L=n.match(Aa)||[],L.length){for(;f=Aa.exec(n);)p=f[0],A=n.substring(l,f.index),g?g=(g+1)%5:(A.substr(-5)==="rgba("||A.substr(-5)==="hsla(")&&(g=1),p!==(d=c[h++]||"")&&(_=parseFloat(d)||0,S=d.substr((_+"").length),p.charAt(1)==="="&&(p=Fa(_,p)+S),v=parseFloat(p),E=p.substr((v+"").length),l=Aa.lastIndex-E.length,E||(E=E||Xi.units[e]||S,l===n.length&&(n+=E,o.e+=E)),S!==E&&(_=Kn(t,e,d,E)||0),o._pt={_next:o._pt,p:A||h===1?A:",",s:_,c:v-_,m:g&&g<4||e==="zIndex"?Math.round:0});o.c=l<n.length?n.substring(l,n.length):""}else o.r=e==="display"&&n==="none"?rv:iv;return y_.test(n)&&(o.e=0),this._pt=o,o},Tp={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},dE=function(t){var e=t.split(" "),i=e[0],n=e[1]||"50%";return(i==="top"||i==="bottom"||n==="left"||n==="right")&&(t=i,i=n,n=t),e[0]=Tp[i]||i,e[1]=Tp[n]||n,e.join(" ")},fE=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var i=e.t,n=i.style,s=e.u,a=i._gsap,o,l,h;if(s==="all"||s===!0)n.cssText="",l=1;else for(s=s.split(","),h=s.length;--h>-1;)o=s[h],xn[o]&&(l=1,o=o==="transformOrigin"?br:Ce),Jo(i,o);l&&(Jo(i,Ce),a&&(a.svg&&i.removeAttribute("transform"),tl(i,1),a.uncache=1,nv(n)))}},Zh={clearProps:function(t,e,i,n,s){if(s.data!=="isFromStart"){var a=t._pt=new Ri(t._pt,e,i,0,0,fE);return a.u=n,a.pr=-10,a.tween=s,t._props.push(i),1}}},Qo=[1,0,0,1,0,0],hv={},uv=function(t){return t==="matrix(1, 0, 0, 1, 0, 0)"||t==="none"||!t},bp=function(t){var e=Gr(t,Ce);return uv(e)?Qo:e.substr(7).match(x_).map(Ue)},Pf=function(t,e){var i=t._gsap||Ds(t),n=t.style,s=bp(t),a,o,l,h;return i.svg&&t.getAttribute("transform")?(l=t.transform.baseVal.consolidate().matrix,s=[l.a,l.b,l.c,l.d,l.e,l.f],s.join(",")==="1,0,0,1,0,0"?Qo:s):(s===Qo&&!t.offsetParent&&t!==Ba&&!i.svg&&(l=n.display,n.display="block",a=t.parentNode,(!a||!t.offsetParent)&&(h=1,o=t.nextElementSibling,Ba.appendChild(t)),s=bp(t),l?n.display=l:Jo(t,"display"),h&&(o?a.insertBefore(t,o):a?a.appendChild(t):Ba.removeChild(t))),e&&s.length>6?[s[0],s[1],s[4],s[5],s[12],s[13]]:s)},Ed=function(t,e,i,n,s,a){var o=t._gsap,l=s||Pf(t,!0),h=o.xOrigin||0,u=o.yOrigin||0,f=o.xOffset||0,c=o.yOffset||0,_=l[0],g=l[1],d=l[2],p=l[3],v=l[4],A=l[5],E=e.split(" "),S=parseFloat(E[0])||0,L=parseFloat(E[1])||0,T,x,m,w;i?l!==Qo&&(x=_*p-g*d)&&(m=S*(p/x)+L*(-d/x)+(d*A-p*v)/x,w=S*(-g/x)+L*(_/x)-(_*A-g*v)/x,S=m,L=w):(T=ov(t),S=T.x+(~E[0].indexOf("%")?S/100*T.width:S),L=T.y+(~(E[1]||E[0]).indexOf("%")?L/100*T.height:L)),n||n!==!1&&o.smooth?(v=S-h,A=L-u,o.xOffset=f+(v*_+A*d)-v,o.yOffset=c+(v*g+A*p)-A):o.xOffset=o.yOffset=0,o.xOrigin=S,o.yOrigin=L,o.smooth=!!n,o.origin=e,o.originIsAbsolute=!!i,t.style[br]="0px 0px",a&&(On(a,o,"xOrigin",h,S),On(a,o,"yOrigin",u,L),On(a,o,"xOffset",f,o.xOffset),On(a,o,"yOffset",c,o.yOffset)),t.setAttribute("data-svg-origin",S+" "+L)},tl=function(t,e){var i=t._gsap||new j_(t);if("x"in i&&!e&&!i.uncache)return i;var n=t.style,s=i.scaleX<0,a="px",o="deg",l=getComputedStyle(t),h=Gr(t,br)||"0",u,f,c,_,g,d,p,v,A,E,S,L,T,x,m,w,R,M,C,b,D,O,B,P,F,I,y,k,U,N,W,G;return u=f=c=d=p=v=A=E=S=0,_=g=1,i.svg=!!(t.getCTM&&lv(t)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(n[Ce]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[Ce]!=="none"?l[Ce]:"")),n.scale=n.rotate=n.translate="none"),x=Pf(t,i.svg),i.svg&&(i.uncache?(F=t.getBBox(),h=i.xOrigin-F.x+"px "+(i.yOrigin-F.y)+"px",P=""):P=!e&&t.getAttribute("data-svg-origin"),Ed(t,P||h,!!P||i.originIsAbsolute,i.smooth!==!1,x)),L=i.xOrigin||0,T=i.yOrigin||0,x!==Qo&&(M=x[0],C=x[1],b=x[2],D=x[3],u=O=x[4],f=B=x[5],x.length===6?(_=Math.sqrt(M*M+C*C),g=Math.sqrt(D*D+b*b),d=M||C?ia(C,M)*cs:0,A=b||D?ia(b,D)*cs+d:0,A&&(g*=Math.abs(Math.cos(A*ka))),i.svg&&(u-=L-(L*M+T*b),f-=T-(L*C+T*D))):(G=x[6],N=x[7],y=x[8],k=x[9],U=x[10],W=x[11],u=x[12],f=x[13],c=x[14],m=ia(G,U),p=m*cs,m&&(w=Math.cos(-m),R=Math.sin(-m),P=O*w+y*R,F=B*w+k*R,I=G*w+U*R,y=O*-R+y*w,k=B*-R+k*w,U=G*-R+U*w,W=N*-R+W*w,O=P,B=F,G=I),m=ia(-b,U),v=m*cs,m&&(w=Math.cos(-m),R=Math.sin(-m),P=M*w-y*R,F=C*w-k*R,I=b*w-U*R,W=D*R+W*w,M=P,C=F,b=I),m=ia(C,M),d=m*cs,m&&(w=Math.cos(m),R=Math.sin(m),P=M*w+C*R,F=O*w+B*R,C=C*w-M*R,B=B*w-O*R,M=P,O=F),p&&Math.abs(p)+Math.abs(d)>359.9&&(p=d=0,v=180-v),_=Ue(Math.sqrt(M*M+C*C+b*b)),g=Ue(Math.sqrt(B*B+G*G)),m=ia(O,B),A=Math.abs(m)>2e-4?m*cs:0,S=W?1/(W<0?-W:W):0),i.svg&&(P=t.getAttribute("transform"),i.forceCSS=t.setAttribute("transform","")||!uv(Gr(t,Ce)),P&&t.setAttribute("transform",P))),Math.abs(A)>90&&Math.abs(A)<270&&(s?(_*=-1,A+=d<=0?180:-180,d+=d<=0?180:-180):(g*=-1,A+=A<=0?180:-180)),e=e||i.uncache,i.x=u-((i.xPercent=u&&(!e&&i.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-u)?-50:0)))?t.offsetWidth*i.xPercent/100:0)+a,i.y=f-((i.yPercent=f&&(!e&&i.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-f)?-50:0)))?t.offsetHeight*i.yPercent/100:0)+a,i.z=c+a,i.scaleX=Ue(_),i.scaleY=Ue(g),i.rotation=Ue(d)+o,i.rotationX=Ue(p)+o,i.rotationY=Ue(v)+o,i.skewX=A+o,i.skewY=E+o,i.transformPerspective=S+a,(i.zOrigin=parseFloat(h.split(" ")[2])||0)&&(n[br]=Jh(h)),i.xOffset=i.yOffset=0,i.force3D=Xi.force3D,i.renderTransform=i.svg?mE:av?cv:pE,i.uncache=0,i},Jh=function(t){return(t=t.split(" "))[0]+" "+t[1]},ju=function(t,e,i){var n=di(e);return Ue(parseFloat(e)+parseFloat(Kn(t,"x",i+"px",n)))+n},pE=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,cv(t,e)},rs="0deg",po="0px",ns=") ",cv=function(t,e){var i=e||this,n=i.xPercent,s=i.yPercent,a=i.x,o=i.y,l=i.z,h=i.rotation,u=i.rotationY,f=i.rotationX,c=i.skewX,_=i.skewY,g=i.scaleX,d=i.scaleY,p=i.transformPerspective,v=i.force3D,A=i.target,E=i.zOrigin,S="",L=v==="auto"&&t&&t!==1||v===!0;if(E&&(f!==rs||u!==rs)){var T=parseFloat(u)*ka,x=Math.sin(T),m=Math.cos(T),w;T=parseFloat(f)*ka,w=Math.cos(T),a=ju(A,a,x*w*-E),o=ju(A,o,-Math.sin(T)*-E),l=ju(A,l,m*w*-E+E)}p!==po&&(S+="perspective("+p+ns),(n||s)&&(S+="translate("+n+"%, "+s+"%) "),(L||a!==po||o!==po||l!==po)&&(S+=l!==po||L?"translate3d("+a+", "+o+", "+l+") ":"translate("+a+", "+o+ns),h!==rs&&(S+="rotate("+h+ns),u!==rs&&(S+="rotateY("+u+ns),f!==rs&&(S+="rotateX("+f+ns),(c!==rs||_!==rs)&&(S+="skew("+c+", "+_+ns),(g!==1||d!==1)&&(S+="scale("+g+", "+d+ns),A.style[Ce]=S||"translate(0, 0)"},mE=function(t,e){var i=e||this,n=i.xPercent,s=i.yPercent,a=i.x,o=i.y,l=i.rotation,h=i.skewX,u=i.skewY,f=i.scaleX,c=i.scaleY,_=i.target,g=i.xOrigin,d=i.yOrigin,p=i.xOffset,v=i.yOffset,A=i.forceCSS,E=parseFloat(a),S=parseFloat(o),L,T,x,m,w;l=parseFloat(l),h=parseFloat(h),u=parseFloat(u),u&&(u=parseFloat(u),h+=u,l+=u),l||h?(l*=ka,h*=ka,L=Math.cos(l)*f,T=Math.sin(l)*f,x=Math.sin(l-h)*-c,m=Math.cos(l-h)*c,h&&(u*=ka,w=Math.tan(h-u),w=Math.sqrt(1+w*w),x*=w,m*=w,u&&(w=Math.tan(u),w=Math.sqrt(1+w*w),L*=w,T*=w)),L=Ue(L),T=Ue(T),x=Ue(x),m=Ue(m)):(L=f,m=c,T=x=0),(E&&!~(a+"").indexOf("px")||S&&!~(o+"").indexOf("px"))&&(E=Kn(_,"x",a,"px"),S=Kn(_,"y",o,"px")),(g||d||p||v)&&(E=Ue(E+g-(g*L+d*x)+p),S=Ue(S+d-(g*T+d*m)+v)),(n||s)&&(w=_.getBBox(),E=Ue(E+n/100*w.width),S=Ue(S+s/100*w.height)),w="matrix("+L+","+T+","+x+","+m+","+E+","+S+")",_.setAttribute("transform",w),A&&(_.style[Ce]=w)},gE=function(t,e,i,n,s){var a=360,o=ei(s),l=parseFloat(s)*(o&&~s.indexOf("rad")?cs:1),h=l-n,u=n+h+"deg",f,c;return o&&(f=s.split("_")[1],f==="short"&&(h%=a,h!==h%(a/2)&&(h+=h<0?a:-a)),f==="cw"&&h<0?h=(h+a*vp)%a-~~(h/a)*a:f==="ccw"&&h>0&&(h=(h-a*vp)%a-~~(h/a)*a)),t._pt=c=new Ri(t._pt,e,i,n,h,Qy),c.e=u,c.u="deg",t._props.push(i),c},Sp=function(t,e){for(var i in e)t[i]=e[i];return t},_E=function(t,e,i){var n=Sp({},i._gsap),s="perspective,force3D,transformOrigin,svgOrigin",a=i.style,o,l,h,u,f,c,_,g;n.svg?(h=i.getAttribute("transform"),i.setAttribute("transform",""),a[Ce]=e,o=tl(i,1),Jo(i,Ce),i.setAttribute("transform",h)):(h=getComputedStyle(i)[Ce],a[Ce]=e,o=tl(i,1),a[Ce]=h);for(l in xn)h=n[l],u=o[l],h!==u&&s.indexOf(l)<0&&(_=di(h),g=di(u),f=_!==g?Kn(i,l,h,g):parseFloat(h),c=parseFloat(u),t._pt=new Ri(t._pt,o,l,f,c-f,vd),t._pt.u=g||0,t._props.push(l));Sp(o,n)};Di("padding,margin,Width,Radius",function(r,t){var e="Top",i="Right",n="Bottom",s="Left",a=(t<3?[e,i,n,s]:[e+s,e+i,n+i,n+s]).map(function(o){return t<2?r+o:"border"+o+r});Zh[t>1?"border"+r:r]=function(o,l,h,u,f){var c,_;if(arguments.length<4)return c=a.map(function(g){return on(o,g,h)}),_=c.join(" "),_.split(c[0]).length===5?c[0]:_;c=(u+"").split(" "),_={},a.forEach(function(g,d){return _[g]=c[d]=c[d]||c[(d-1)/2|0]}),o.init(l,_,f)}});var If={name:"css",register:yd,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,i,n,s){var a=this._props,o=t.style,l=i.vars.startAt,h,u,f,c,_,g,d,p,v,A,E,S,L,T,x,m;Lf||yd(),this.styles=this.styles||sv(t),m=this.styles.props,this.tween=i;for(d in e)if(d!=="autoRound"&&(u=e[d],!(zi[d]&&Y_(d,e,i,n,t,s)))){if(_=typeof u,g=Zh[d],_==="function"&&(u=u.call(i,n,t,s),_=typeof u),_==="string"&&~u.indexOf("random(")&&(u=qo(u)),g)g(this,t,d,u,i)&&(x=1);else if(d.substr(0,2)==="--")h=(getComputedStyle(t).getPropertyValue(d)+"").trim(),u+="",Gn.lastIndex=0,Gn.test(h)||(p=di(h),v=di(u)),v?p!==v&&(h=Kn(t,d,h,v)+v):p&&(u+=p),this.add(o,"setProperty",h,u,n,s,0,0,d),a.push(d),m.push(d,0,o[d]);else if(_!=="undefined"){if(l&&d in l?(h=typeof l[d]=="function"?l[d].call(i,n,t,s):l[d],ei(h)&&~h.indexOf("random(")&&(h=qo(h)),di(h+"")||(h+=Xi.units[d]||di(on(t,d))||""),(h+"").charAt(1)==="="&&(h=on(t,d))):h=on(t,d),c=parseFloat(h),A=_==="string"&&u.charAt(1)==="="&&u.substr(0,2),A&&(u=u.substr(2)),f=parseFloat(u),d in un&&(d==="autoAlpha"&&(c===1&&on(t,"visibility")==="hidden"&&f&&(c=0),m.push("visibility",0,o.visibility),On(this,o,"visibility",c?"inherit":"hidden",f?"inherit":"hidden",!f)),d!=="scale"&&d!=="transform"&&(d=un[d],~d.indexOf(",")&&(d=d.split(",")[0]))),E=d in xn,E){if(this.styles.save(d),S||(L=t._gsap,L.renderTransform&&!e.parseTransform||tl(t,e.parseTransform),T=e.smoothOrigin!==!1&&L.smooth,S=this._pt=new Ri(this._pt,o,Ce,0,1,L.renderTransform,L,0,-1),S.dep=1),d==="scale")this._pt=new Ri(this._pt,L,"scaleY",c,(A?Fa(c,A+f):f)-c||0,vd),this._pt.u=0,a.push("scaleY",d),d+="X";else if(d==="transformOrigin"){m.push(br,0,o[br]),u=dE(u),L.svg?Ed(t,u,0,T,0,this):(v=parseFloat(u.split(" ")[2])||0,v!==L.zOrigin&&On(this,L,"zOrigin",L.zOrigin,v),On(this,o,d,Jh(h),Jh(u)));continue}else if(d==="svgOrigin"){Ed(t,u,1,T,0,this);continue}else if(d in hv){gE(this,L,d,c,A?Fa(c,A+u):u);continue}else if(d==="smoothOrigin"){On(this,L,"smooth",L.smooth,u);continue}else if(d==="force3D"){L[d]=u;continue}else if(d==="transform"){_E(this,u,t);continue}}else d in o||(d=eo(d)||d);if(E||(f||f===0)&&(c||c===0)&&!Jy.test(u)&&d in o)p=(h+"").substr((c+"").length),f||(f=0),v=di(u)||(d in Xi.units?Xi.units[d]:p),p!==v&&(c=Kn(t,d,h,v)),this._pt=new Ri(this._pt,E?L:o,d,c,(A?Fa(c,A+f):f)-c,!E&&(v==="px"||d==="zIndex")&&e.autoRound!==!1?eE:vd),this._pt.u=v||0,p!==v&&v!=="%"&&(this._pt.b=h,this._pt.r=tE);else if(d in o)cE.call(this,t,d,h,A?A+u:u);else if(d in t)this.add(t,d,h||t[d],A?A+u:u,n,s);else{yf(d,u);continue}E||(d in o?m.push(d,0,o[d]):m.push(d,1,h||t[d])),a.push(d)}}x&&tv(this)},render:function(t,e){if(e.tween._time||!Df())for(var i=e._pt;i;)i.r(t,i.d),i=i._next;else e.styles.revert()},get:on,aliases:un,getSetter:function(t,e,i){var n=un[e];return n&&n.indexOf(",")<0&&(e=n),e in xn&&e!==br&&(t._gsap.x||on(t,"x"))?i&&_p===i?e==="scale"?sE:nE:(_p=i||{})&&(e==="scale"?aE:oE):t.style&&!vf(t.style[e])?iE:~e.indexOf("-")?rE:Mf(t,e)},core:{_removeProperty:Jo,_getMatrix:Pf}};Ei.utils.checkPrefix=eo;Ei.core.getStyleSaver=sv;(function(r,t,e,i){var n=Di(r+","+t+","+e,function(s){xn[s]=1});Di(t,function(s){Xi.units[s]="deg",hv[s]=1}),un[n[13]]=r+","+t,Di(i,function(s){var a=s.split(":");un[a[1]]=n[a[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Di("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(r){Xi.units[r]="px"});Ei.registerPlugin(If);var Ot=Ei.registerPlugin(If)||Ei;Ot.core.Tween;function wp(r,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,i.key,i)}}function vE(r,t,e){return t&&wp(r.prototype,t),e&&wp(r,e),r}/*!
 * Observer 3.11.3
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var fi,Td,Vi,Fn,Bn,Ua,dv,ds,No,fv,cn,_r,pv=function(){return fi||typeof window<"u"&&(fi=window.gsap)&&fi.registerPlugin&&fi},mv=1,Ca=[],ue=[],zr=[],Go=Date.now,bd=function(t,e){return e},xE=function(){var t=No.core,e=t.bridge||{},i=t._scrollers,n=t._proxies;i.push.apply(i,ue),n.push.apply(n,zr),ue=i,zr=n,bd=function(a,o){return e[a](o)}},zn=function(t,e){return~zr.indexOf(t)&&zr[zr.indexOf(t)+1][e]},zo=function(t){return!!~fv.indexOf(t)},Ti=function(t,e,i,n,s){return t.addEventListener(e,i,{passive:!n,capture:!!s})},gi=function(t,e,i,n){return t.removeEventListener(e,i,!!n)},Cl="scrollLeft",Ll="scrollTop",Sd=function(){return cn&&cn.isPressed||ue.cache++},Qh=function(t,e){var i=function n(s){if(s||s===0){mv&&(Vi.history.scrollRestoration="manual");var a=cn&&cn.isPressed;s=n.v=Math.round(s)||(cn&&cn.iOS?1:0),t(s),n.cacheID=ue.cache,a&&bd("ss",s)}else(e||ue.cache!==n.cacheID||bd("ref"))&&(n.cacheID=ue.cache,n.v=t());return n.v+n.offset};return i.offset=0,t&&i},xi={s:Cl,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:Qh(function(r){return arguments.length?Vi.scrollTo(r,Ye.sc()):Vi.pageXOffset||Fn[Cl]||Bn[Cl]||Ua[Cl]||0})},Ye={s:Ll,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:xi,sc:Qh(function(r){return arguments.length?Vi.scrollTo(xi.sc(),r):Vi.pageYOffset||Fn[Ll]||Bn[Ll]||Ua[Ll]||0})},bi=function(t){return fi.utils.toArray(t)[0]||(typeof t=="string"&&fi.config().nullTargetWarn!==!1?console.warn("Element not found:",t):null)},jn=function(t,e){var i=e.s,n=e.sc;zo(t)&&(t=Fn.scrollingElement||Bn);var s=ue.indexOf(t),a=n===Ye.sc?1:2;!~s&&(s=ue.push(t)-1),ue[s+a]||t.addEventListener("scroll",Sd);var o=ue[s+a],l=o||(ue[s+a]=Qh(zn(t,i),!0)||(zo(t)?n:Qh(function(h){return arguments.length?t[i]=h:t[i]})));return l.target=t,o||(l.smooth=fi.getProperty(t,"scrollBehavior")==="smooth"),l},wd=function(t,e,i){var n=t,s=t,a=Go(),o=a,l=e||50,h=Math.max(500,l*3),u=function(g,d){var p=Go();d||p-a>l?(s=n,n=g,o=a,a=p):i?n+=g:n=s+(g-s)/(p-o)*(a-o)},f=function(){s=n=i?0:n,o=a=0},c=function(g){var d=o,p=s,v=Go();return(g||g===0)&&g!==n&&u(g),a===o||v-o>h?0:(n+(i?p:-p))/((i?v:a)-d)*1e3};return{update:u,reset:f,getVelocity:c}},mo=function(t,e){return e&&!t._gsapAllow&&t.preventDefault(),t.changedTouches?t.changedTouches[0]:t},Ap=function(t){var e=Math.max.apply(Math,t),i=Math.min.apply(Math,t);return Math.abs(e)>=Math.abs(i)?e:i},gv=function(){No=fi.core.globals().ScrollTrigger,No&&No.core&&xE()},_v=function(t){return fi=t||pv(),fi&&typeof document<"u"&&document.body&&(Vi=window,Fn=document,Bn=Fn.documentElement,Ua=Fn.body,fv=[Vi,Fn,Bn,Ua],fi.utils.clamp,ds="onpointerenter"in Ua?"pointer":"mouse",dv=Ve.isTouch=Vi.matchMedia&&Vi.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in Vi||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,_r=Ve.eventTypes=("ontouchstart"in Bn?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in Bn?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return mv=0},500),gv(),Td=1),Td};xi.op=Ye;ue.cache=0;var Ve=function(){function r(e){this.init(e)}var t=r.prototype;return t.init=function(i){Td||_v(fi)||console.warn("Please gsap.registerPlugin(Observer)"),No||gv();var n=i.tolerance,s=i.dragMinimum,a=i.type,o=i.target,l=i.lineHeight,h=i.debounce,u=i.preventDefault,f=i.onStop,c=i.onStopDelay,_=i.ignore,g=i.wheelSpeed,d=i.event,p=i.onDragStart,v=i.onDragEnd,A=i.onDrag,E=i.onPress,S=i.onRelease,L=i.onRight,T=i.onLeft,x=i.onUp,m=i.onDown,w=i.onChangeX,R=i.onChangeY,M=i.onChange,C=i.onToggleX,b=i.onToggleY,D=i.onHover,O=i.onHoverEnd,B=i.onMove,P=i.ignoreCheck,F=i.isNormalizer,I=i.onGestureStart,y=i.onGestureEnd,k=i.onWheel,U=i.onEnable,N=i.onDisable,W=i.onClick,G=i.scrollSpeed,z=i.capture,X=i.allowClicks,K=i.lockAxis,$=i.onLockAxis;this.target=o=bi(o)||Bn,this.vars=i,_&&(_=fi.utils.toArray(_)),n=n||1e-9,s=s||0,g=g||1,G=G||1,a=a||"wheel,touch,pointer",h=h!==!1,l||(l=parseFloat(Vi.getComputedStyle(Ua).lineHeight)||22);var q,J,Q,rt,mt,vt,_t,tt=this,Lt=0,dt=0,Tt=jn(o,xi),Ht=jn(o,Ye),Y=Tt(),V=Ht(),it=~a.indexOf("touch")&&!~a.indexOf("pointer")&&_r[0]==="pointerdown",at=zo(o),ut=o.ownerDocument||Fn,ct=[0,0,0],St=[0,0,0],gt=0,ht=function(){return gt=Go()},wt=function(pt,Rt){return(tt.event=pt)&&_&&~_.indexOf(pt.target)||Rt&&it&&pt.pointerType!=="touch"||P&&P(pt,Rt)},Nt=function(){tt._vx.reset(),tt._vy.reset(),J.pause(),f&&f(tt)},Mt=function(){var pt=tt.deltaX=Ap(ct),Rt=tt.deltaY=Ap(St),It=Math.abs(pt)>=n,jt=Math.abs(Rt)>=n;M&&(It||jt)&&M(tt,pt,Rt,ct,St),It&&(L&&tt.deltaX>0&&L(tt),T&&tt.deltaX<0&&T(tt),w&&w(tt),C&&tt.deltaX<0!=Lt<0&&C(tt),Lt=tt.deltaX,ct[0]=ct[1]=ct[2]=0),jt&&(m&&tt.deltaY>0&&m(tt),x&&tt.deltaY<0&&x(tt),R&&R(tt),b&&tt.deltaY<0!=dt<0&&b(tt),dt=tt.deltaY,St[0]=St[1]=St[2]=0),(rt||Q)&&(B&&B(tt),Q&&(A(tt),Q=!1),rt=!1),vt&&!(vt=!1)&&$&&$(tt),mt&&(k(tt),mt=!1),q=0},Ut=function(pt,Rt,It){ct[It]+=pt,St[It]+=Rt,tt._vx.update(pt),tt._vy.update(Rt),h?q||(q=requestAnimationFrame(Mt)):Mt()},Vt=function(pt,Rt){K&&!_t&&(tt.axis=_t=Math.abs(pt)>Math.abs(Rt)?"x":"y",vt=!0),_t!=="y"&&(ct[2]+=pt,tt._vx.update(pt,!0)),_t!=="x"&&(St[2]+=Rt,tt._vy.update(Rt,!0)),h?q||(q=requestAnimationFrame(Mt)):Mt()},Ft=function(pt){if(!wt(pt,1)){pt=mo(pt,u);var Rt=pt.clientX,It=pt.clientY,jt=Rt-tt.x,ye=It-tt.y,te=tt.isDragging;tt.x=Rt,tt.y=It,(te||Math.abs(tt.startX-Rt)>=s||Math.abs(tt.startY-It)>=s)&&(A&&(Q=!0),te||(tt.isDragging=!0),Vt(jt,ye),te||p&&p(tt))}},Z=tt.onPress=function(Qt){wt(Qt,1)||(tt.axis=_t=null,J.pause(),tt.isPressed=!0,Qt=mo(Qt),Lt=dt=0,tt.startX=tt.x=Qt.clientX,tt.startY=tt.y=Qt.clientY,tt._vx.reset(),tt._vy.reset(),Ti(F?o:ut,_r[1],Ft,u,!0),tt.deltaX=tt.deltaY=0,E&&E(tt))},Et=function(pt){if(!wt(pt,1)){gi(F?o:ut,_r[1],Ft,!0);var Rt=tt.isDragging&&(Math.abs(tt.x-tt.startX)>3||Math.abs(tt.y-tt.startY)>3),It=mo(pt);Rt||(tt._vx.reset(),tt._vy.reset(),u&&X&&fi.delayedCall(.08,function(){if(Go()-gt>300&&!pt.defaultPrevented){if(pt.target.click)pt.target.click();else if(ut.createEvent){var jt=ut.createEvent("MouseEvents");jt.initMouseEvent("click",!0,!0,Vi,1,It.screenX,It.screenY,It.clientX,It.clientY,!1,!1,!1,!1,0,null),pt.target.dispatchEvent(jt)}}})),tt.isDragging=tt.isGesturing=tt.isPressed=!1,f&&!F&&J.restart(!0),v&&Rt&&v(tt),S&&S(tt,Rt)}},yt=function(pt){return pt.touches&&pt.touches.length>1&&(tt.isGesturing=!0)&&I(pt,tt.isDragging)},lt=function(){return(tt.isGesturing=!1)||y(tt)},xt=function(pt){if(!wt(pt)){var Rt=Tt(),It=Ht();Ut((Rt-Y)*G,(It-V)*G,1),Y=Rt,V=It,f&&J.restart(!0)}},Bt=function(pt){if(!wt(pt)){pt=mo(pt,u),k&&(mt=!0);var Rt=(pt.deltaMode===1?l:pt.deltaMode===2?Vi.innerHeight:1)*g;Ut(pt.deltaX*Rt,pt.deltaY*Rt,0),f&&!F&&J.restart(!0)}},ee=function(pt){if(!wt(pt)){var Rt=pt.clientX,It=pt.clientY,jt=Rt-tt.x,ye=It-tt.y;tt.x=Rt,tt.y=It,rt=!0,(jt||ye)&&Vt(jt,ye)}},ie=function(pt){tt.event=pt,D(tt)},Be=function(pt){tt.event=pt,O(tt)},re=function(pt){return wt(pt)||mo(pt,u)&&W(tt)};J=tt._dc=fi.delayedCall(c||.25,Nt).pause(),tt.deltaX=tt.deltaY=0,tt._vx=wd(0,50,!0),tt._vy=wd(0,50,!0),tt.scrollX=Tt,tt.scrollY=Ht,tt.isDragging=tt.isGesturing=tt.isPressed=!1,tt.enable=function(Qt){return tt.isEnabled||(Ti(at?ut:o,"scroll",Sd),a.indexOf("scroll")>=0&&Ti(at?ut:o,"scroll",xt,u,z),a.indexOf("wheel")>=0&&Ti(o,"wheel",Bt,u,z),(a.indexOf("touch")>=0&&dv||a.indexOf("pointer")>=0)&&(Ti(o,_r[0],Z,u,z),Ti(ut,_r[2],Et),Ti(ut,_r[3],Et),X&&Ti(o,"click",ht,!1,!0),W&&Ti(o,"click",re),I&&Ti(ut,"gesturestart",yt),y&&Ti(ut,"gestureend",lt),D&&Ti(o,ds+"enter",ie),O&&Ti(o,ds+"leave",Be),B&&Ti(o,ds+"move",ee)),tt.isEnabled=!0,Qt&&Qt.type&&Z(Qt),U&&U(tt)),tt},tt.disable=function(){tt.isEnabled&&(Ca.filter(function(Qt){return Qt!==tt&&zo(Qt.target)}).length||gi(at?ut:o,"scroll",Sd),tt.isPressed&&(tt._vx.reset(),tt._vy.reset(),gi(F?o:ut,_r[1],Ft,!0)),gi(at?ut:o,"scroll",xt,z),gi(o,"wheel",Bt,z),gi(o,_r[0],Z,z),gi(ut,_r[2],Et),gi(ut,_r[3],Et),gi(o,"click",ht,!0),gi(o,"click",re),gi(ut,"gesturestart",yt),gi(ut,"gestureend",lt),gi(o,ds+"enter",ie),gi(o,ds+"leave",Be),gi(o,ds+"move",ee),tt.isEnabled=tt.isPressed=tt.isDragging=!1,N&&N(tt))},tt.kill=function(){tt.disable();var Qt=Ca.indexOf(tt);Qt>=0&&Ca.splice(Qt,1),cn===tt&&(cn=0)},Ca.push(tt),F&&zo(o)&&(cn=tt),tt.enable(d)},vE(r,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),r}();Ve.version="3.11.3";Ve.create=function(r){return new Ve(r)};Ve.register=_v;Ve.getAll=function(){return Ca.slice()};Ve.getById=function(r){return Ca.filter(function(t){return t.vars.id===r})[0]};pv()&&fi.registerPlugin(Ve);/*!
 * ScrollTrigger 3.11.3
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var $t,Ta,he,Se,Ir,Ie,vv,tu,eu,La,Lh,Dl,ui,yu,Ad,_i,Mp,Cp,ba,xv,Yu,yv,Ui,Ev,Tv,bv,Dn,Md,Of,$u,Rl=1,vi=Date.now,qu=vi(),lr=0,Pl=0,Lp=function(){return yu=1},Dp=function(){return yu=0},Lr=function(t){return t},Mo=function(t){return Math.round(t*1e5)/1e5||0},Sv=function(){return typeof window<"u"},wv=function(){return $t||Sv()&&($t=window.gsap)&&$t.registerPlugin&&$t},zs=function(t){return!!~vv.indexOf(t)},Av=function(t){return zn(t,"getBoundingClientRect")||(zs(t)?function(){return Fh.width=he.innerWidth,Fh.height=he.innerHeight,Fh}:function(){return ln(t)})},yE=function(t,e,i){var n=i.d,s=i.d2,a=i.a;return(a=zn(t,"getBoundingClientRect"))?function(){return a()[n]}:function(){return(e?he["inner"+s]:t["client"+s])||0}},EE=function(t,e){return!e||~zr.indexOf(t)?Av(t):function(){return Fh}},kn=function(t,e){var i=e.s,n=e.d2,s=e.d,a=e.a;return(i="scroll"+n)&&(a=zn(t,i))?a()-Av(t)()[s]:zs(t)?(Ir[i]||Ie[i])-(he["inner"+n]||Ir["client"+n]||Ie["client"+n]):t[i]-t["offset"+n]},Il=function(t,e){for(var i=0;i<ba.length;i+=3)(!e||~e.indexOf(ba[i+1]))&&t(ba[i],ba[i+1],ba[i+2])},yr=function(t){return typeof t=="string"},yi=function(t){return typeof t=="function"},Co=function(t){return typeof t=="number"},Dh=function(t){return typeof t=="object"},go=function(t,e,i){return t&&t.progress(e?0:1)&&i&&t.pause()},Zu=function(t,e){if(t.enabled){var i=e(t);i&&i.totalTime&&(t.callbackAnimation=i)}},ra=Math.abs,Mv="left",Cv="top",Ff="right",Bf="bottom",Is="width",Os="height",Wo="Right",Ho="Left",Vo="Top",Xo="Bottom",ke="padding",tr="margin",io="Width",kf="Height",ii="px",Or=function(t){return he.getComputedStyle(t)},TE=function(t){var e=Or(t).position;t.style.position=e==="absolute"||e==="fixed"?e:"relative"},Rp=function(t,e){for(var i in e)i in t||(t[i]=e[i]);return t},ln=function(t,e){var i=e&&Or(t)[Ad]!=="matrix(1, 0, 0, 1, 0, 0)"&&$t.to(t,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),n=t.getBoundingClientRect();return i&&i.progress(0).kill(),n},Cd=function(t,e){var i=e.d2;return t["offset"+i]||t["client"+i]||0},Lv=function(t){var e=[],i=t.labels,n=t.duration(),s;for(s in i)e.push(i[s]/n);return e},bE=function(t){return function(e){return $t.utils.snap(Lv(t),e)}},Uf=function(t){var e=$t.utils.snap(t),i=Array.isArray(t)&&t.slice(0).sort(function(n,s){return n-s});return i?function(n,s,a){a===void 0&&(a=.001);var o;if(!s)return e(n);if(s>0){for(n-=a,o=0;o<i.length;o++)if(i[o]>=n)return i[o];return i[o-1]}else for(o=i.length,n+=a;o--;)if(i[o]<=n)return i[o];return i[0]}:function(n,s,a){a===void 0&&(a=.001);var o=e(n);return!s||Math.abs(o-n)<a||o-n<0==s<0?o:e(s<0?n-t:n+t)}},SE=function(t){return function(e,i){return Uf(Lv(t))(e,i.direction)}},Ol=function(t,e,i,n){return i.split(",").forEach(function(s){return t(e,s,n)})},ri=function(t,e,i,n,s){return t.addEventListener(e,i,{passive:!n,capture:!!s})},Je=function(t,e,i,n){return t.removeEventListener(e,i,!!n)},Fl=function(t,e,i){return i&&i.wheelHandler&&t(e,"wheel",i)},Pp={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},Bl={toggleActions:"play",anticipatePin:0},iu={top:0,left:0,center:.5,bottom:1,right:1},Rh=function(t,e){if(yr(t)){var i=t.indexOf("="),n=~i?+(t.charAt(i-1)+1)*parseFloat(t.substr(i+1)):0;~i&&(t.indexOf("%")>i&&(n*=e/100),t=t.substr(0,i-1)),t=n+(t in iu?iu[t]*e:~t.indexOf("%")?parseFloat(t)*e/100:parseFloat(t)||0)}return t},kl=function(t,e,i,n,s,a,o,l){var h=s.startColor,u=s.endColor,f=s.fontSize,c=s.indent,_=s.fontWeight,g=Se.createElement("div"),d=zs(i)||zn(i,"pinType")==="fixed",p=t.indexOf("scroller")!==-1,v=d?Ie:i,A=t.indexOf("start")!==-1,E=A?h:u,S="border-color:"+E+";font-size:"+f+";color:"+E+";font-weight:"+_+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return S+="position:"+((p||l)&&d?"fixed;":"absolute;"),(p||l||!d)&&(S+=(n===Ye?Ff:Bf)+":"+(a+parseFloat(c))+"px;"),o&&(S+="box-sizing:border-box;text-align:left;width:"+o.offsetWidth+"px;"),g._isStart=A,g.setAttribute("class","gsap-marker-"+t+(e?" marker-"+e:"")),g.style.cssText=S,g.innerText=e||e===0?t+"-"+e:t,v.children[0]?v.insertBefore(g,v.children[0]):v.appendChild(g),g._offset=g["offset"+n.op.d2],Ph(g,0,n,A),g},Ph=function(t,e,i,n){var s={display:"block"},a=i[n?"os2":"p2"],o=i[n?"p2":"os2"];t._isFlipped=n,s[i.a+"Percent"]=n?-100:0,s[i.a]=n?"1px":0,s["border"+a+io]=1,s["border"+o+io]=0,s[i.p]=e+"px",$t.set(t,s)},se=[],Ld={},el,Ip=function(){return vi()-lr>34&&(el||(el=requestAnimationFrame(Vs)))},na=function(){(!Ui||!Ui.isPressed||Ui.startX>Ie.clientWidth)&&(ue.cache++,Ui?el||(el=requestAnimationFrame(Vs)):Vs(),lr||Hs("scrollStart"),lr=vi())},Ju=function(){bv=he.innerWidth,Tv=he.innerHeight},Lo=function(){ue.cache++,!ui&&!yv&&!Se.fullscreenElement&&!Se.webkitFullscreenElement&&(!Ev||bv!==he.innerWidth||Math.abs(he.innerHeight-Tv)>he.innerHeight*.25)&&tu.restart(!0)},Ws={},wE=[],Dv=function r(){return Je(de,"scrollEnd",r)||ws(!0)},Hs=function(t){return Ws[t]&&Ws[t].map(function(e){return e()})||wE},Ni=[],Rv=function(t){for(var e=0;e<Ni.length;e+=5)(!t||Ni[e+4]&&Ni[e+4].query===t)&&(Ni[e].style.cssText=Ni[e+1],Ni[e].getBBox&&Ni[e].setAttribute("transform",Ni[e+2]||""),Ni[e+3].uncache=1)},Nf=function(t,e){var i;for(_i=0;_i<se.length;_i++)i=se[_i],i&&(!e||i._ctx===e)&&(t?i.kill(1):i.revert(!0,!0));e&&Rv(e),e||Hs("revert")},Pv=function(t,e){ue.cache++,(e||!Er)&&ue.forEach(function(i){return yi(i)&&i.cacheID++&&(i.rec=0)}),yr(t)&&(he.history.scrollRestoration=Of=t)},Er,Fs=0,Op,AE=function(){if(Op!==Fs){var t=Op=Fs;requestAnimationFrame(function(){return t===Fs&&ws(!0)})}},ws=function(t,e){if(lr&&!t){ri(de,"scrollEnd",Dv);return}Er=de.isRefreshing=!0,ue.forEach(function(n){return yi(n)&&n.cacheID++&&(n.rec=n())});var i=Hs("refreshInit");xv&&de.sort(),e||Nf(),ue.forEach(function(n){yi(n)&&(n.smooth&&(n.target.style.scrollBehavior="auto"),n(0))}),se.slice(0).forEach(function(n){return n.refresh()}),se.forEach(function(n,s){if(n._subPinOffset&&n.pin){var a=n.vars.horizontal?"offsetWidth":"offsetHeight",o=n.pin[a];n.revert(!0,1),n.adjustPinSpacing(n.pin[a]-o),n.revert(!1,1)}}),se.forEach(function(n){return n.vars.end==="max"&&n.setPositions(n.start,Math.max(n.start+1,kn(n.scroller,n._dir)))}),i.forEach(function(n){return n&&n.render&&n.render(-1)}),ue.forEach(function(n){yi(n)&&(n.smooth&&requestAnimationFrame(function(){return n.target.style.scrollBehavior="smooth"}),n.rec&&n(n.rec))}),Pv(Of,1),tu.pause(),Fs++,Vs(2),se.forEach(function(n){return yi(n.vars.onRefresh)&&n.vars.onRefresh(n)}),Er=de.isRefreshing=!1,Hs("refresh")},Fp=0,Ih=1,Ts,Vs=function(t){if(!Er||t===2){de.isUpdating=!0,Ts&&Ts.update(0);var e=se.length,i=vi(),n=i-qu>=50,s=e&&se[0].scroll();if(Ih=Fp>s?-1:1,Fp=s,n&&(lr&&!yu&&i-lr>200&&(lr=0,Hs("scrollEnd")),Lh=qu,qu=i),Ih<0){for(_i=e;_i-- >0;)se[_i]&&se[_i].update(0,n);Ih=1}else for(_i=0;_i<e;_i++)se[_i]&&se[_i].update(0,n);de.isUpdating=!1}el=0},Dd=[Mv,Cv,Bf,Ff,tr+Xo,tr+Wo,tr+Vo,tr+Ho,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],Oh=Dd.concat([Is,Os,"boxSizing","max"+io,"max"+kf,"position",tr,ke,ke+Vo,ke+Wo,ke+Xo,ke+Ho]),ME=function(t,e,i){Na(i);var n=t._gsap;if(n.spacerIsNative)Na(n.spacerState);else if(t._gsap.swappedIn){var s=e.parentNode;s&&(s.insertBefore(t,e),s.removeChild(e))}t._gsap.swappedIn=!1},Qu=function(t,e,i,n){if(!t._gsap.swappedIn){for(var s=Dd.length,a=e.style,o=t.style,l;s--;)l=Dd[s],a[l]=i[l];a.position=i.position==="absolute"?"absolute":"relative",i.display==="inline"&&(a.display="inline-block"),o[Bf]=o[Ff]="auto",a.flexBasis=i.flexBasis||"auto",a.overflow="visible",a.boxSizing="border-box",a[Is]=Cd(t,xi)+ii,a[Os]=Cd(t,Ye)+ii,a[ke]=o[tr]=o[Cv]=o[Mv]="0",Na(n),o[Is]=o["max"+io]=i[Is],o[Os]=o["max"+kf]=i[Os],o[ke]=i[ke],t.parentNode!==e&&(t.parentNode.insertBefore(e,t),e.appendChild(t)),t._gsap.swappedIn=!0}},CE=/([A-Z])/g,Na=function(t){if(t){var e=t.t.style,i=t.length,n=0,s,a;for((t.t._gsap||$t.core.getCache(t.t)).uncache=1;n<i;n+=2)a=t[n+1],s=t[n],a?e[s]=a:e[s]&&e.removeProperty(s.replace(CE,"-$1").toLowerCase())}},Ul=function(t){for(var e=Oh.length,i=t.style,n=[],s=0;s<e;s++)n.push(Oh[s],i[Oh[s]]);return n.t=t,n},LE=function(t,e,i){for(var n=[],s=t.length,a=i?8:0,o;a<s;a+=2)o=t[a],n.push(o,o in e?e[o]:t[a+1]);return n.t=t.t,n},Fh={left:0,top:0},Bp=function(t,e,i,n,s,a,o,l,h,u,f,c,_){yi(t)&&(t=t(l)),yr(t)&&t.substr(0,3)==="max"&&(t=c+(t.charAt(4)==="="?Rh("0"+t.substr(3),i):0));var g=_?_.time():0,d,p,v;if(_&&_.seek(0),Co(t))o&&Ph(o,i,n,!0);else{yi(e)&&(e=e(l));var A=(t||"0").split(" "),E,S,L,T;v=bi(e)||Ie,E=ln(v)||{},(!E||!E.left&&!E.top)&&Or(v).display==="none"&&(T=v.style.display,v.style.display="block",E=ln(v),T?v.style.display=T:v.style.removeProperty("display")),S=Rh(A[0],E[n.d]),L=Rh(A[1]||"0",i),t=E[n.p]-h[n.p]-u+S+s-L,o&&Ph(o,L,n,i-L<20||o._isStart&&L>20),i-=i-L}if(a){var x=t+i,m=a._isStart;d="scroll"+n.d2,Ph(a,x,n,m&&x>20||!m&&(f?Math.max(Ie[d],Ir[d]):a.parentNode[d])<=x+1),f&&(h=ln(o),f&&(a.style[n.op.p]=h[n.op.p]-n.op.m-a._offset+ii))}return _&&v&&(d=ln(v),_.seek(c),p=ln(v),_._caScrollDist=d[n.p]-p[n.p],t=t/_._caScrollDist*c),_&&_.seek(g),_?t:Math.round(t)},DE=/(webkit|moz|length|cssText|inset)/i,kp=function(t,e,i,n){if(t.parentNode!==e){var s=t.style,a,o;if(e===Ie){t._stOrig=s.cssText,o=Or(t);for(a in o)!+a&&!DE.test(a)&&o[a]&&typeof s[a]=="string"&&a!=="0"&&(s[a]=o[a]);s.top=i,s.left=n}else s.cssText=t._stOrig;$t.core.getCache(t).uncache=1,e.appendChild(t)}},Up=function(t,e){var i=jn(t,e),n="_scroll"+e.p2,s,a,o=function l(h,u,f,c,_){var g=l.tween,d=u.onComplete,p={};return f=f||i(),_=c&&_||0,c=c||h-f,g&&g.kill(),s=Math.round(f),u[n]=h,u.modifiers=p,p[n]=function(v){return v=Math.round(i()),v!==s&&v!==a&&Math.abs(v-s)>3&&Math.abs(v-a)>3?(g.kill(),l.tween=0):v=f+c*g.ratio+_*g.ratio*g.ratio,a=s,s=Math.round(v)},u.onComplete=function(){l.tween=0,d&&d.call(g)},g=l.tween=$t.to(t,u),g};return t[n]=i,i.wheelHandler=function(){return o.tween&&o.tween.kill()&&(o.tween=0)},ri(t,"wheel",i.wheelHandler),o},de=function(){function r(e,i){Ta||r.register($t)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),this.init(e,i)}var t=r.prototype;return t.init=function(i,n){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),!Pl){this.update=this.refresh=this.kill=Lr;return}i=Rp(yr(i)||Co(i)||i.nodeType?{trigger:i}:i,Bl);var s=i,a=s.onUpdate,o=s.toggleClass,l=s.id,h=s.onToggle,u=s.onRefresh,f=s.scrub,c=s.trigger,_=s.pin,g=s.pinSpacing,d=s.invalidateOnRefresh,p=s.anticipatePin,v=s.onScrubComplete,A=s.onSnapComplete,E=s.once,S=s.snap,L=s.pinReparent,T=s.pinSpacer,x=s.containerAnimation,m=s.fastScrollEnd,w=s.preventOverlaps,R=i.horizontal||i.containerAnimation&&i.horizontal!==!1?xi:Ye,M=!f&&f!==0,C=bi(i.scroller||he),b=$t.core.getCache(C),D=zs(C),O=("pinType"in i?i.pinType:zn(C,"pinType")||D&&"fixed")==="fixed",B=[i.onEnter,i.onLeave,i.onEnterBack,i.onLeaveBack],P=M&&i.toggleActions.split(" "),F="markers"in i?i.markers:Bl.markers,I=D?0:parseFloat(Or(C)["border"+R.p2+io])||0,y=this,k=i.onRefreshInit&&function(){return i.onRefreshInit(y)},U=yE(C,D,R),N=EE(C,D),W=0,G=0,z=jn(C,R),X,K,$,q,J,Q,rt,mt,vt,_t,tt,Lt,dt,Tt,Ht,Y,V,it,at,ut,ct,St,gt,ht,wt,Nt,Mt,Ut,Vt,Ft,Z,Et,yt,lt,xt,Bt,ee,ie;if(Md(y),y._dir=R,p*=45,y.scroller=C,y.scroll=x?x.time.bind(x):z,q=z(),y.vars=i,n=n||i.animation,"refreshPriority"in i&&(xv=1,i.refreshPriority===-9999&&(Ts=y)),b.tweenScroll=b.tweenScroll||{top:Up(C,Ye),left:Up(C,xi)},y.tweenTo=X=b.tweenScroll[R.p],y.scrubDuration=function(pt){Z=Co(pt)&&pt,Z?Ft?Ft.duration(pt):Ft=$t.to(n,{ease:"expo",totalProgress:"+=0.001",duration:Z,paused:!0,onComplete:function(){return v&&v(y)}}):(Ft&&Ft.progress(1).kill(),Ft=0)},n&&(n.vars.lazy=!1,n._initted||n.vars.immediateRender!==!1&&i.immediateRender!==!1&&n.duration()&&n.render(0,!0,!0),y.animation=n.pause(),n.scrollTrigger=y,y.scrubDuration(f),Ut=0,l||(l=n.vars.id)),se.push(y),S&&((!Dh(S)||S.push)&&(S={snapTo:S}),"scrollBehavior"in Ie.style&&$t.set(D?[Ie,Ir]:C,{scrollBehavior:"auto"}),ue.forEach(function(pt){return yi(pt)&&pt.target===(D?Se.scrollingElement||Ir:C)&&(pt.smooth=!1)}),$=yi(S.snapTo)?S.snapTo:S.snapTo==="labels"?bE(n):S.snapTo==="labelsDirectional"?SE(n):S.directional!==!1?function(pt,Rt){return Uf(S.snapTo)(pt,vi()-G<500?0:Rt.direction)}:$t.utils.snap(S.snapTo),Et=S.duration||{min:.1,max:2},Et=Dh(Et)?La(Et.min,Et.max):La(Et,Et),yt=$t.delayedCall(S.delay||Z/2||.1,function(){var pt=z(),Rt=vi()-G<500,It=X.tween;if((Rt||Math.abs(y.getVelocity())<10)&&!It&&!yu&&W!==pt){var jt=(pt-Q)/dt,ye=n&&!M?n.totalProgress():jt,te=Rt?0:(ye-Vt)/(vi()-Lh)*1e3||0,Ee=$t.utils.clamp(-jt,1-jt,ra(te/2)*te/.185),j=jt+(S.inertia===!1?0:Ee),nt=La(0,1,$(j,y)),st=Math.round(Q+nt*dt),et=S,ft=et.onStart,Dt=et.onInterrupt,kt=et.onComplete;if(pt<=rt&&pt>=Q&&st!==pt){if(It&&!It._initted&&It.data<=ra(st-pt))return;S.inertia===!1&&(Ee=nt-jt),X(st,{duration:Et(ra(Math.max(ra(j-ye),ra(nt-ye))*.185/te/.05||0)),ease:S.ease||"power3",data:ra(st-pt),onInterrupt:function(){return yt.restart(!0)&&Dt&&Dt(y)},onComplete:function(){y.update(),W=z(),Ut=Vt=n&&!M?n.totalProgress():y.progress,A&&A(y),kt&&kt(y)}},pt,Ee*dt,st-pt-Ee*dt),ft&&ft(y,X.tween)}}else y.isActive&&W!==pt&&yt.restart(!0)}).pause()),l&&(Ld[l]=y),c=y.trigger=bi(c||_),ie=c&&c._gsap&&c._gsap.stRevert,ie&&(ie=ie(y)),_=_===!0?c:bi(_),yr(o)&&(o={targets:c,className:o}),_&&(g===!1||g===tr||(g=!g&&_.parentNode&&_.parentNode.style&&Or(_.parentNode).display==="flex"?!1:ke),y.pin=_,K=$t.core.getCache(_),K.spacer?Tt=K.pinState:(T&&(T=bi(T),T&&!T.nodeType&&(T=T.current||T.nativeElement),K.spacerIsNative=!!T,T&&(K.spacerState=Ul(T))),K.spacer=V=T||Se.createElement("div"),V.classList.add("pin-spacer"),l&&V.classList.add("pin-spacer-"+l),K.pinState=Tt=Ul(_)),i.force3D!==!1&&$t.set(_,{force3D:!0}),y.spacer=V=K.spacer,Mt=Or(_),gt=Mt[g+R.os2],at=$t.getProperty(_),ut=$t.quickSetter(_,R.a,ii),Qu(_,V,Mt),Y=Ul(_)),F){Lt=Dh(F)?Rp(F,Pp):Pp,_t=kl("scroller-start",l,C,R,Lt,0),tt=kl("scroller-end",l,C,R,Lt,0,_t),it=_t["offset"+R.op.d2];var Be=bi(zn(C,"content")||C);mt=this.markerStart=kl("start",l,Be,R,Lt,it,0,x),vt=this.markerEnd=kl("end",l,Be,R,Lt,it,0,x),x&&(ee=$t.quickSetter([mt,vt],R.a,ii)),!O&&!(zr.length&&zn(C,"fixedMarkers")===!0)&&(TE(D?Ie:C),$t.set([_t,tt],{force3D:!0}),wt=$t.quickSetter(_t,R.a,ii),Nt=$t.quickSetter(tt,R.a,ii))}if(x){var re=x.vars.onUpdate,Qt=x.vars.onUpdateParams;x.eventCallback("onUpdate",function(){y.update(0,0,1),re&&re.apply(Qt||[])})}y.previous=function(){return se[se.indexOf(y)-1]},y.next=function(){return se[se.indexOf(y)+1]},y.revert=function(pt,Rt){if(!Rt)return y.kill(!0);var It=pt!==!1||!y.enabled,jt=ui;It!==y.isReverted&&(It&&(xt=Math.max(z(),y.scroll.rec||0),lt=y.progress,Bt=n&&n.progress()),mt&&[mt,vt,_t,tt].forEach(function(ye){return ye.style.display=It?"none":"block"}),It&&(ui=1,y.update(It)),_&&(It?ME(_,V,Tt):(!L||!y.isActive)&&Qu(_,V,Or(_),ht)),It||y.update(It),ui=jt,y.isReverted=It)},y.refresh=function(pt,Rt){if(!((ui||!y.enabled)&&!Rt)){if(_&&pt&&lr){ri(r,"scrollEnd",Dv);return}!Er&&k&&k(y),ui=1,G=vi(),X.tween&&(X.tween.kill(),X.tween=0),Ft&&Ft.pause(),d&&n&&n.revert({kill:!1}).invalidate(),y.isReverted||y.revert(!0,!0),y._subPinOffset=!1;for(var It=U(),jt=N(),ye=x?x.duration():kn(C,R),te=0,Ee=0,j=i.end,nt=i.endTrigger||c,st=i.start||(i.start===0||!c?0:_?"0 0":"0 100%"),et=y.pinnedContainer=i.pinnedContainer&&bi(i.pinnedContainer),ft=c&&Math.max(0,se.indexOf(y))||0,Dt=ft,kt,zt,Zt,ne,Kt,Xt,fe,Ii,$r,Yi;Dt--;)Xt=se[Dt],Xt.end||Xt.refresh(0,1)||(ui=1),fe=Xt.pin,fe&&(fe===c||fe===_)&&!Xt.isReverted&&(Yi||(Yi=[]),Yi.unshift(Xt),Xt.revert(!0,!0)),Xt!==se[Dt]&&(ft--,Dt--);for(yi(st)&&(st=st(y)),Q=Bp(st,c,It,R,z(),mt,_t,y,jt,I,O,ye,x)||(_?-.001:0),yi(j)&&(j=j(y)),yr(j)&&!j.indexOf("+=")&&(~j.indexOf(" ")?j=(yr(st)?st.split(" ")[0]:"")+j:(te=Rh(j.substr(2),It),j=yr(st)?st:Q+te,nt=c)),rt=Math.max(Q,Bp(j||(nt?"100% 0":ye),nt,It,R,z()+te,vt,tt,y,jt,I,O,ye,x))||-.001,dt=rt-Q||(Q-=.01)&&.001,te=0,Dt=ft;Dt--;)Xt=se[Dt],fe=Xt.pin,fe&&Xt.start-Xt._pinPush<=Q&&!x&&Xt.end>0&&(kt=Xt.end-Xt.start,(fe===c&&Xt.start-Xt._pinPush<Q||fe===et)&&!Co(st)&&(te+=kt*(1-Xt.progress)),fe===_&&(Ee+=kt));if(Q+=te,rt+=te,y._pinPush=Ee,mt&&te&&(kt={},kt[R.a]="+="+te,et&&(kt[R.p]="-="+z()),$t.set([mt,vt],kt)),_)kt=Or(_),ne=R===Ye,Zt=z(),ct=parseFloat(at(R.a))+Ee,!ye&&rt>1&&((D?Ie:C).style["overflow-"+R.a]="scroll"),Qu(_,V,kt),Y=Ul(_),zt=ln(_,!0),Ii=O&&jn(C,ne?xi:Ye)(),g&&(ht=[g+R.os2,dt+Ee+ii],ht.t=V,Dt=g===ke?Cd(_,R)+dt+Ee:0,Dt&&ht.push(R.d,Dt+ii),Na(ht),et&&se.forEach(function(li){li.pin===et&&li.vars.pinSpacing!==!1&&(li._subPinOffset=!0)}),O&&z(xt)),O&&(Kt={top:zt.top+(ne?Zt-Q:Ii)+ii,left:zt.left+(ne?Ii:Zt-Q)+ii,boxSizing:"border-box",position:"fixed"},Kt[Is]=Kt["max"+io]=Math.ceil(zt.width)+ii,Kt[Os]=Kt["max"+kf]=Math.ceil(zt.height)+ii,Kt[tr]=Kt[tr+Vo]=Kt[tr+Wo]=Kt[tr+Xo]=Kt[tr+Ho]="0",Kt[ke]=kt[ke],Kt[ke+Vo]=kt[ke+Vo],Kt[ke+Wo]=kt[ke+Wo],Kt[ke+Xo]=kt[ke+Xo],Kt[ke+Ho]=kt[ke+Ho],Ht=LE(Tt,Kt,L),Er&&z(0)),n?($r=n._initted,Yu(1),n.render(n.duration(),!0,!0),St=at(R.a)-ct+dt+Ee,dt!==St&&O&&Ht.splice(Ht.length-2,2),n.render(0,!0,!0),$r||n.invalidate(!0),n.parent||n.totalTime(n.totalTime()),Yu(0)):St=dt;else if(c&&z()&&!x)for(zt=c.parentNode;zt&&zt!==Ie;)zt._pinOffset&&(Q-=zt._pinOffset,rt-=zt._pinOffset),zt=zt.parentNode;Yi&&Yi.forEach(function(li){return li.revert(!1,!0)}),y.start=Q,y.end=rt,q=J=Er?xt:z(),!x&&!Er&&(q<xt&&z(xt),y.scroll.rec=0),y.revert(!1,!0),yt&&(W=-1,y.isActive&&z(Q+dt*lt),yt.restart(!0)),ui=0,n&&M&&(n._initted||Bt)&&n.progress()!==Bt&&n.progress(Bt,!0).render(n.time(),!0,!0),(lt!==y.progress||x)&&(n&&!M&&n.totalProgress(lt,!0),y.progress=(q-Q)/dt===lt?0:lt),_&&g&&(V._pinOffset=Math.round(y.progress*St)),u&&!Er&&u(y)}},y.getVelocity=function(){return(z()-J)/(vi()-Lh)*1e3||0},y.endAnimation=function(){go(y.callbackAnimation),n&&(Ft?Ft.progress(1):n.paused()?M||go(n,y.direction<0,1):go(n,n.reversed()))},y.labelToScroll=function(pt){return n&&n.labels&&(Q||y.refresh()||Q)+n.labels[pt]/n.duration()*dt||0},y.getTrailing=function(pt){var Rt=se.indexOf(y),It=y.direction>0?se.slice(0,Rt).reverse():se.slice(Rt+1);return(yr(pt)?It.filter(function(jt){return jt.vars.preventOverlaps===pt}):It).filter(function(jt){return y.direction>0?jt.end<=Q:jt.start>=rt})},y.update=function(pt,Rt,It){if(!(x&&!It&&!pt)){var jt=Er?xt:y.scroll(),ye=pt?0:(jt-Q)/dt,te=ye<0?0:ye>1?1:ye||0,Ee=y.progress,j,nt,st,et,ft,Dt,kt,zt;if(Rt&&(J=q,q=x?z():jt,S&&(Vt=Ut,Ut=n&&!M?n.totalProgress():te)),p&&!te&&_&&!ui&&!Rl&&lr&&Q<jt+(jt-J)/(vi()-Lh)*p&&(te=1e-4),te!==Ee&&y.enabled){if(j=y.isActive=!!te&&te<1,nt=!!Ee&&Ee<1,Dt=j!==nt,ft=Dt||!!te!=!!Ee,y.direction=te>Ee?1:-1,y.progress=te,ft&&!ui&&(st=te&&!Ee?0:te===1?1:Ee===1?2:3,M&&(et=!Dt&&P[st+1]!=="none"&&P[st+1]||P[st],zt=n&&(et==="complete"||et==="reset"||et in n))),w&&(Dt||zt)&&(zt||f||!n)&&(yi(w)?w(y):y.getTrailing(w).forEach(function(Xt){return Xt.endAnimation()})),M||(Ft&&!ui&&!Rl?((x||Ts&&Ts!==y)&&Ft.render(Ft._dp._time-Ft._start),Ft.resetTo?Ft.resetTo("totalProgress",te,n._tTime/n._tDur):(Ft.vars.totalProgress=te,Ft.invalidate().restart())):n&&n.totalProgress(te,!!ui)),_){if(pt&&g&&(V.style[g+R.os2]=gt),!O)ut(Mo(ct+St*te));else if(ft){if(kt=!pt&&te>Ee&&rt+1>jt&&jt+1>=kn(C,R),L)if(!pt&&(j||kt)){var Zt=ln(_,!0),ne=jt-Q;kp(_,Ie,Zt.top+(R===Ye?ne:0)+ii,Zt.left+(R===Ye?0:ne)+ii)}else kp(_,V);Na(j||kt?Ht:Y),St!==dt&&te<1&&j||ut(ct+(te===1&&!kt?St:0))}}S&&!X.tween&&!ui&&!Rl&&yt.restart(!0),o&&(Dt||E&&te&&(te<1||!$u))&&eu(o.targets).forEach(function(Xt){return Xt.classList[j||E?"add":"remove"](o.className)}),a&&!M&&!pt&&a(y),ft&&!ui?(M&&(zt&&(et==="complete"?n.pause().totalProgress(1):et==="reset"?n.restart(!0).pause():et==="restart"?n.restart(!0):n[et]()),a&&a(y)),(Dt||!$u)&&(h&&Dt&&Zu(y,h),B[st]&&Zu(y,B[st]),E&&(te===1?y.kill(!1,1):B[st]=0),Dt||(st=te===1?1:3,B[st]&&Zu(y,B[st]))),m&&!j&&Math.abs(y.getVelocity())>(Co(m)?m:2500)&&(go(y.callbackAnimation),Ft?Ft.progress(1):go(n,et==="reverse"?1:!te,1))):M&&a&&!ui&&a(y)}if(Nt){var Kt=x?jt/x.duration()*(x._caScrollDist||0):jt;wt(Kt+(_t._isFlipped?1:0)),Nt(Kt)}ee&&ee(-jt/x.duration()*(x._caScrollDist||0))}},y.enable=function(pt,Rt){y.enabled||(y.enabled=!0,ri(C,"resize",Lo),ri(D?Se:C,"scroll",na),k&&ri(r,"refreshInit",k),pt!==!1&&(y.progress=lt=0,q=J=W=z()),Rt!==!1&&y.refresh())},y.getTween=function(pt){return pt&&X?X.tween:Ft},y.setPositions=function(pt,Rt){_&&(ct+=pt-Q,St+=Rt-pt-dt,g===ke&&y.adjustPinSpacing(Rt-pt-dt)),y.start=Q=pt,y.end=rt=Rt,dt=Rt-pt,y.update()},y.adjustPinSpacing=function(pt){if(ht){var Rt=ht.indexOf(R.d)+1;ht[Rt]=parseFloat(ht[Rt])+pt+ii,ht[1]=parseFloat(ht[1])+pt+ii,Na(ht)}},y.disable=function(pt,Rt){if(y.enabled&&(pt!==!1&&y.revert(!0,!0),y.enabled=y.isActive=!1,Rt||Ft&&Ft.pause(),xt=0,K&&(K.uncache=1),k&&Je(r,"refreshInit",k),yt&&(yt.pause(),X.tween&&X.tween.kill()&&(X.tween=0)),!D)){for(var It=se.length;It--;)if(se[It].scroller===C&&se[It]!==y)return;Je(C,"resize",Lo),Je(C,"scroll",na)}},y.kill=function(pt,Rt){y.disable(pt,Rt),Ft&&!Rt&&Ft.kill(),l&&delete Ld[l];var It=se.indexOf(y);It>=0&&se.splice(It,1),It===_i&&Ih>0&&_i--,It=0,se.forEach(function(jt){return jt.scroller===y.scroller&&(It=1)}),It||Er||(y.scroll.rec=0),n&&(n.scrollTrigger=null,pt&&n.revert({kill:!1}),Rt||n.kill()),mt&&[mt,vt,_t,tt].forEach(function(jt){return jt.parentNode&&jt.parentNode.removeChild(jt)}),Ts===y&&(Ts=0),_&&(K&&(K.uncache=1),It=0,se.forEach(function(jt){return jt.pin===_&&It++}),It||(K.spacer=0)),i.onKill&&i.onKill(y)},y.enable(!1,!1),ie&&ie(y),!n||!n.add||dt?y.refresh():$t.delayedCall(.01,function(){return Q||rt||y.refresh()})&&(dt=.01)&&(Q=rt=0),_&&AE()},r.register=function(i){return Ta||($t=i||wv(),Sv()&&window.document&&r.enable(),Ta=Pl),Ta},r.defaults=function(i){if(i)for(var n in i)Bl[n]=i[n];return Bl},r.disable=function(i,n){Pl=0,se.forEach(function(a){return a[n?"kill":"disable"](i)}),Je(he,"wheel",na),Je(Se,"scroll",na),clearInterval(Dl),Je(Se,"touchcancel",Lr),Je(Ie,"touchstart",Lr),Ol(Je,Se,"pointerdown,touchstart,mousedown",Lp),Ol(Je,Se,"pointerup,touchend,mouseup",Dp),tu.kill(),Il(Je);for(var s=0;s<ue.length;s+=3)Fl(Je,ue[s],ue[s+1]),Fl(Je,ue[s],ue[s+2])},r.enable=function(){if(he=window,Se=document,Ir=Se.documentElement,Ie=Se.body,$t&&(eu=$t.utils.toArray,La=$t.utils.clamp,Md=$t.core.context||Lr,Yu=$t.core.suppressOverwrites||Lr,Of=he.history.scrollRestoration||"auto",$t.core.globals("ScrollTrigger",r),Ie)){Pl=1,Ve.register($t),r.isTouch=Ve.isTouch,Dn=Ve.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),ri(he,"wheel",na),vv=[he,Se,Ir,Ie],$t.matchMedia?(r.matchMedia=function(l){var h=$t.matchMedia(),u;for(u in l)h.add(u,l[u]);return h},$t.addEventListener("matchMediaInit",function(){return Nf()}),$t.addEventListener("matchMediaRevert",function(){return Rv()}),$t.addEventListener("matchMedia",function(){ws(0,1),Hs("matchMedia")}),$t.matchMedia("(orientation: portrait)",function(){return Ju(),Ju})):console.warn("Requires GSAP 3.11.0 or later"),Ju(),ri(Se,"scroll",na);var i=Ie.style,n=i.borderTopStyle,s=$t.core.Animation.prototype,a,o;for(s.revert||Object.defineProperty(s,"revert",{value:function(){return this.time(-.01,!0)}}),i.borderTopStyle="solid",a=ln(Ie),Ye.m=Math.round(a.top+Ye.sc())||0,xi.m=Math.round(a.left+xi.sc())||0,n?i.borderTopStyle=n:i.removeProperty("border-top-style"),Dl=setInterval(Ip,250),$t.delayedCall(.5,function(){return Rl=0}),ri(Se,"touchcancel",Lr),ri(Ie,"touchstart",Lr),Ol(ri,Se,"pointerdown,touchstart,mousedown",Lp),Ol(ri,Se,"pointerup,touchend,mouseup",Dp),Ad=$t.utils.checkPrefix("transform"),Oh.push(Ad),Ta=vi(),tu=$t.delayedCall(.2,ws).pause(),ba=[Se,"visibilitychange",function(){var l=he.innerWidth,h=he.innerHeight;Se.hidden?(Mp=l,Cp=h):(Mp!==l||Cp!==h)&&Lo()},Se,"DOMContentLoaded",ws,he,"load",ws,he,"resize",Lo],Il(ri),se.forEach(function(l){return l.enable(0,1)}),o=0;o<ue.length;o+=3)Fl(Je,ue[o],ue[o+1]),Fl(Je,ue[o],ue[o+2])}},r.config=function(i){"limitCallbacks"in i&&($u=!!i.limitCallbacks);var n=i.syncInterval;n&&clearInterval(Dl)||(Dl=n)&&setInterval(Ip,n),"ignoreMobileResize"in i&&(Ev=r.isTouch===1&&i.ignoreMobileResize),"autoRefreshEvents"in i&&(Il(Je)||Il(ri,i.autoRefreshEvents||"none"),yv=(i.autoRefreshEvents+"").indexOf("resize")===-1)},r.scrollerProxy=function(i,n){var s=bi(i),a=ue.indexOf(s),o=zs(s);~a&&ue.splice(a,o?6:2),n&&(o?zr.unshift(he,n,Ie,n,Ir,n):zr.unshift(s,n))},r.clearMatchMedia=function(i){se.forEach(function(n){return n._ctx&&n._ctx.query===i&&n._ctx.kill(!0,!0)})},r.isInViewport=function(i,n,s){var a=(yr(i)?bi(i):i).getBoundingClientRect(),o=a[s?Is:Os]*n||0;return s?a.right-o>0&&a.left+o<he.innerWidth:a.bottom-o>0&&a.top+o<he.innerHeight},r.positionInViewport=function(i,n,s){yr(i)&&(i=bi(i));var a=i.getBoundingClientRect(),o=a[s?Is:Os],l=n==null?o/2:n in iu?iu[n]*o:~n.indexOf("%")?parseFloat(n)*o/100:parseFloat(n)||0;return s?(a.left+l)/he.innerWidth:(a.top+l)/he.innerHeight},r.killAll=function(i){if(se.forEach(function(s){return s.vars.id!=="ScrollSmoother"&&s.kill()}),i!==!0){var n=Ws.killAll||[];Ws={},n.forEach(function(s){return s()})}},r}();de.version="3.11.3";de.saveStyles=function(r){return r?eu(r).forEach(function(t){if(t&&t.style){var e=Ni.indexOf(t);e>=0&&Ni.splice(e,5),Ni.push(t,t.style.cssText,t.getBBox&&t.getAttribute("transform"),$t.core.getCache(t),Md())}}):Ni};de.revert=function(r,t){return Nf(!r,t)};de.create=function(r,t){return new de(r,t)};de.refresh=function(r){return r?Lo():(Ta||de.register())&&ws(!0)};de.update=Vs;de.clearScrollMemory=Pv;de.maxScroll=function(r,t){return kn(r,t?xi:Ye)};de.getScrollFunc=function(r,t){return jn(bi(r),t?xi:Ye)};de.getById=function(r){return Ld[r]};de.getAll=function(){return se.filter(function(r){return r.vars.id!=="ScrollSmoother"})};de.isScrolling=function(){return!!lr};de.snapDirectional=Uf;de.addEventListener=function(r,t){var e=Ws[r]||(Ws[r]=[]);~e.indexOf(t)||e.push(t)};de.removeEventListener=function(r,t){var e=Ws[r],i=e&&e.indexOf(t);i>=0&&e.splice(i,1)};de.batch=function(r,t){var e=[],i={},n=t.interval||.016,s=t.batchMax||1e9,a=function(h,u){var f=[],c=[],_=$t.delayedCall(n,function(){u(f,c),f=[],c=[]}).pause();return function(g){f.length||_.restart(!0),f.push(g.trigger),c.push(g),s<=f.length&&_.progress(1)}},o;for(o in t)i[o]=o.substr(0,2)==="on"&&yi(t[o])&&o!=="onRefreshInit"?a(o,t[o]):t[o];return yi(s)&&(s=s(),ri(de,"refresh",function(){return s=t.batchMax()})),eu(r).forEach(function(l){var h={};for(o in i)h[o]=i[o];h.trigger=l,e.push(de.create(h))}),e};var Np=function(t,e,i,n){return e>n?t(n):e<0&&t(0),i>n?(n-e)/(i-e):i<0?e/(e-i):1},tc=function r(t,e){e===!0?t.style.removeProperty("touch-action"):t.style.touchAction=e===!0?"auto":e?"pan-"+e+(Ve.isTouch?" pinch-zoom":""):"none",t===Ir&&r(Ie,e)},Gp={auto:1,scroll:1},RE=function(t){var e=t.event,i=t.target,n=t.axis,s=(e.changedTouches?e.changedTouches[0]:e).target,a=s._gsap||$t.core.getCache(s),o=vi(),l;if(!a._isScrollT||o-a._isScrollT>2e3){for(;s&&s.scrollHeight<=s.clientHeight;)s=s.parentNode;a._isScroll=s&&!zs(s)&&s!==i&&(Gp[(l=Or(s)).overflowY]||Gp[l.overflowX]),a._isScrollT=o}(a._isScroll||n==="x")&&(e.stopPropagation(),e._gsapAllow=!0)},Iv=function(t,e,i,n){return Ve.create({target:t,capture:!0,debounce:!1,lockAxis:!0,type:e,onWheel:n=n&&RE,onPress:n,onDrag:n,onScroll:n,onEnable:function(){return i&&ri(Se,Ve.eventTypes[0],Wp,!1,!0)},onDisable:function(){return Je(Se,Ve.eventTypes[0],Wp,!0)}})},PE=/(input|label|select|textarea)/i,zp,Wp=function(t){var e=PE.test(t.target.tagName);(e||zp)&&(t._gsapAllow=!0,zp=e)},IE=function(t){Dh(t)||(t={}),t.preventDefault=t.isNormalizer=t.allowClicks=!0,t.type||(t.type="wheel,touch"),t.debounce=!!t.debounce,t.id=t.id||"normalizer";var e=t,i=e.normalizeScrollX,n=e.momentum,s=e.allowNestedScroll,a,o,l=bi(t.target)||Ir,h=$t.core.globals().ScrollSmoother,u=h&&h.get(),f=Dn&&(t.content&&bi(t.content)||u&&t.content!==!1&&!u.smooth()&&u.content()),c=jn(l,Ye),_=jn(l,xi),g=1,d=(Ve.isTouch&&he.visualViewport?he.visualViewport.scale*he.visualViewport.width:he.outerWidth)/he.innerWidth,p=0,v=yi(n)?function(){return n(a)}:function(){return n||2.8},A,E,S=Iv(l,t.type,!0,s),L=function(){return E=!1},T=Lr,x=Lr,m=function(){o=kn(l,Ye),x=La(Dn?1:0,o),i&&(T=La(0,kn(l,xi))),A=Fs},w=function(){f._gsap.y=Mo(parseFloat(f._gsap.y)+c.offset)+"px",f.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(f._gsap.y)+", 0, 1)",c.offset=c.cacheID=0},R=function(){if(E){requestAnimationFrame(L);var P=Mo(a.deltaY/2),F=x(c.v-P);if(f&&F!==c.v+c.offset){c.offset=F-c.v;var I=Mo((parseFloat(f&&f._gsap.y)||0)-c.offset);f.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+I+", 0, 1)",f._gsap.y=I+"px",c.cacheID=ue.cache,Vs()}return!0}c.offset&&w(),E=!0},M,C,b,D,O=function(){m(),M.isActive()&&M.vars.scrollY>o&&(c()>o?M.progress(1)&&c(o):M.resetTo("scrollY",o))};return f&&$t.set(f,{y:"+=0"}),t.ignoreCheck=function(B){return Dn&&B.type==="touchmove"&&R()||g>1.05&&B.type!=="touchstart"||a.isGesturing||B.touches&&B.touches.length>1},t.onPress=function(){var B=g;g=Mo((he.visualViewport&&he.visualViewport.scale||1)/d),M.pause(),B!==g&&tc(l,g>1.01?!0:i?!1:"x"),C=_(),b=c(),m(),A=Fs},t.onRelease=t.onGestureStart=function(B,P){if(c.offset&&w(),!P)D.restart(!0);else{ue.cache++;var F=v(),I,y;i&&(I=_(),y=I+F*.05*-B.velocityX/.227,F*=Np(_,I,y,kn(l,xi)),M.vars.scrollX=T(y)),I=c(),y=I+F*.05*-B.velocityY/.227,F*=Np(c,I,y,kn(l,Ye)),M.vars.scrollY=x(y),M.invalidate().duration(F).play(.01),(Dn&&M.vars.scrollY>=o||I>=o-1)&&$t.to({},{onUpdate:O,duration:F})}},t.onWheel=function(){M._ts&&M.pause(),vi()-p>1e3&&(A=0,p=vi())},t.onChange=function(B,P,F,I,y){if(Fs!==A&&m(),P&&i&&_(T(I[2]===P?C+(B.startX-B.x):_()+P-I[1])),F){c.offset&&w();var k=y[2]===F,U=k?b+B.startY-B.y:c()+F-y[1],N=x(U);k&&U!==N&&(b+=N-U),c(N)}(F||P)&&Vs()},t.onEnable=function(){tc(l,i?!1:"x"),de.addEventListener("refresh",O),ri(he,"resize",O),c.smooth&&(c.target.style.scrollBehavior="auto",c.smooth=_.smooth=!1),S.enable()},t.onDisable=function(){tc(l,!0),Je(he,"resize",O),de.removeEventListener("refresh",O),S.kill()},t.lockAxis=t.lockAxis!==!1,a=new Ve(t),a.iOS=Dn,Dn&&!c()&&c(1),Dn&&$t.ticker.add(Lr),D=a._dc,M=$t.to(a,{ease:"power4",paused:!0,scrollX:i?"+=0.1":"+=0",scrollY:"+=0.1",onComplete:D.vars.onComplete}),a};de.sort=function(r){return se.sort(r||function(t,e){return(t.vars.refreshPriority||0)*-1e6+t.start-(e.start+(e.vars.refreshPriority||0)*-1e6)})};de.observe=function(r){return new Ve(r)};de.normalizeScroll=function(r){if(typeof r>"u")return Ui;if(r===!0&&Ui)return Ui.enable();if(r===!1)return Ui&&Ui.kill();var t=r instanceof Ve?r:IE(r);return Ui&&Ui.target===t.target&&Ui.kill(),zs(t.target)&&(Ui=t),t};de.core={_getVelocityProp:wd,_inputObserver:Iv,_scrollers:ue,_proxies:zr,bridge:{ss:function(){lr||Hs("scrollStart"),lr=vi()},ref:function(){return ui}}};wv()&&$t.registerPlugin(de);/*!
 * ScrollToPlugin 3.11.3
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Mi,Ov,pn,Fr,Wn,Fv,Bv,kv=function(){return typeof window<"u"},Uv=function(){return Mi||kv()&&(Mi=window.gsap)&&Mi.registerPlugin&&Mi},Nv=function(t){return typeof t=="string"},Hp=function(t){return typeof t=="function"},il=function(t,e){var i=e==="x"?"Width":"Height",n="scroll"+i,s="client"+i;return t===pn||t===Fr||t===Wn?Math.max(Fr[n],Wn[n])-(pn["inner"+i]||Fr[s]||Wn[s]):t[n]-t["offset"+i]},rl=function(t,e){var i="scroll"+(e==="x"?"Left":"Top");return t===pn&&(t.pageXOffset!=null?i="page"+e.toUpperCase()+"Offset":t=Fr[i]!=null?Fr:Wn),function(){return t[i]}},OE=function(t,e,i,n){if(Hp(t)&&(t=t(e,i,n)),typeof t!="object")return Nv(t)&&t!=="max"&&t.charAt(1)!=="="?{x:t,y:t}:{y:t};if(t.nodeType)return{y:t,x:t};var s={},a;for(a in t)s[a]=a!=="onAutoKill"&&Hp(t[a])?t[a](e,i,n):t[a];return s},Gv=function(t,e){if(t=Fv(t)[0],!t||!t.getBoundingClientRect)return console.warn("scrollTo target doesn't exist. Using 0")||{x:0,y:0};var i=t.getBoundingClientRect(),n=!e||e===pn||e===Wn,s=n?{top:Fr.clientTop-(pn.pageYOffset||Fr.scrollTop||Wn.scrollTop||0),left:Fr.clientLeft-(pn.pageXOffset||Fr.scrollLeft||Wn.scrollLeft||0)}:e.getBoundingClientRect(),a={x:i.left-s.left,y:i.top-s.top};return!n&&e&&(a.x+=rl(e,"x")(),a.y+=rl(e,"y")()),a},Vp=function(t,e,i,n,s){return!isNaN(t)&&typeof t!="object"?parseFloat(t)-s:Nv(t)&&t.charAt(1)==="="?parseFloat(t.substr(2))*(t.charAt(0)==="-"?-1:1)+n-s:t==="max"?il(e,i)-s:Math.min(il(e,i),Gv(t,e)[i]-s)},Xp=function(){Mi=Uv(),kv()&&Mi&&document.body&&(pn=window,Wn=document.body,Fr=document.documentElement,Fv=Mi.utils.toArray,Mi.config({autoKillThreshold:7}),Bv=Mi.config(),Ov=1)},_l={version:"3.11.3",name:"scrollTo",rawVars:1,register:function(t){Mi=t,Xp()},init:function(t,e,i,n,s){Ov||Xp();var a=this,o=Mi.getProperty(t,"scrollSnapType");a.isWin=t===pn,a.target=t,a.tween=i,e=OE(e,n,t,s),a.vars=e,a.autoKill=!!e.autoKill,a.getX=rl(t,"x"),a.getY=rl(t,"y"),a.x=a.xPrev=a.getX(),a.y=a.yPrev=a.getY(),Mi.getProperty(t,"scrollBehavior")==="smooth"&&Mi.set(t,{scrollBehavior:"auto"}),o&&o!=="none"&&(a.snap=1,a.snapInline=t.style.scrollSnapType,t.style.scrollSnapType="none"),e.x!=null?(a.add(a,"x",a.x,Vp(e.x,t,"x",a.x,e.offsetX||0),n,s),a._props.push("scrollTo_x")):a.skipX=1,e.y!=null?(a.add(a,"y",a.y,Vp(e.y,t,"y",a.y,e.offsetY||0),n,s),a._props.push("scrollTo_y")):a.skipY=1},render:function(t,e){for(var i=e._pt,n=e.target,s=e.tween,a=e.autoKill,o=e.xPrev,l=e.yPrev,h=e.isWin,u=e.snap,f=e.snapInline,c,_,g,d,p;i;)i.r(t,i.d),i=i._next;c=h||!e.skipX?e.getX():o,_=h||!e.skipY?e.getY():l,g=_-l,d=c-o,p=Bv.autoKillThreshold,e.x<0&&(e.x=0),e.y<0&&(e.y=0),a&&(!e.skipX&&(d>p||d<-p)&&c<il(n,"x")&&(e.skipX=1),!e.skipY&&(g>p||g<-p)&&_<il(n,"y")&&(e.skipY=1),e.skipX&&e.skipY&&(s.kill(),e.vars.onAutoKill&&e.vars.onAutoKill.apply(s,e.vars.onAutoKillParams||[]))),h?pn.scrollTo(e.skipX?c:e.x,e.skipY?_:e.y):(e.skipY||(n.scrollTop=e.y),e.skipX||(n.scrollLeft=e.x)),u&&(t===1||t===0)&&(_=n.scrollTop,c=n.scrollLeft,f?n.style.scrollSnapType=f:n.style.removeProperty("scroll-snap-type"),n.scrollTop=_+1,n.scrollLeft=c+1,n.scrollTop=_,n.scrollLeft=c),e.xPrev=e.x,e.yPrev=e.y},kill:function(t){var e=t==="scrollTo";(e||t==="scrollTo_x")&&(this.skipX=1),(e||t==="scrollTo_y")&&(this.skipY=1)}};_l.max=il;_l.getOffset=Gv;_l.buildGetter=rl;Uv()&&Mi.registerPlugin(_l);const Do=768,Ga=[30,40,100],nl=[[0,160,230],[200,220,180],[170,190,255],[245,230,192],[100,200,180],[255,160,160],[255,210,206]],FE=[[182,110,115],[80,186,126],[112,91,182],[255,146,155],[107,172,255],[76,198,240],[240,180,225]],fs=()=>Do<=window.innerWidth,Kp=()=>1,BE=()=>{const r=document.querySelectorAll(".js_smooth");r.length>0&&r.forEach(t=>{t.addEventListener("click",e=>{const i=e.currentTarget.getAttribute("href");i.substr(0,1)==="#"&&(e.preventDefault(),Ot.to(window,{scrollTo:{y:i==="#"?0:i},duration:.8,ease:"expo.out"}))})})},kE=(r,t,e,i)=>{var n=e-r,s=i-t;return Math.sqrt(Math.pow(n,2)+Math.pow(s,2))};/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Gf="145",UE=0,jp=1,NE=2,zv=1,GE=2,Ro=3,ro=0,hr=1,Br=2,Hn=0,za=1,Yp=2,$p=3,qp=4,zE=5,Sa=100,WE=101,HE=102,Zp=103,Jp=104,VE=200,XE=201,KE=202,jE=203,Wv=204,Hv=205,YE=206,$E=207,qE=208,ZE=209,JE=210,QE=0,tT=1,eT=2,Rd=3,iT=4,rT=5,nT=6,sT=7,Vv=0,aT=1,oT=2,mn=0,lT=1,hT=2,uT=3,cT=4,dT=5,Xv=300,no=301,so=302,Pd=303,Id=304,Eu=306,Od=1e3,Tr=1001,Fd=1002,wi=1003,Qp=1004,tm=1005,er=1006,fT=1007,Tu=1008,Xs=1009,pT=1010,mT=1011,Kv=1012,gT=1013,As=1014,Ms=1015,sl=1016,_T=1017,vT=1018,Wa=1020,xT=1021,yT=1022,kr=1023,ET=1024,TT=1025,Bs=1026,ao=1027,bT=1028,ST=1029,wT=1030,AT=1031,MT=1033,ec=33776,ic=33777,rc=33778,nc=33779,em=35840,im=35841,rm=35842,nm=35843,CT=36196,sm=37492,am=37496,om=37808,lm=37809,hm=37810,um=37811,cm=37812,dm=37813,fm=37814,pm=37815,mm=37816,gm=37817,_m=37818,vm=37819,xm=37820,ym=37821,Em=36492,Ks=3e3,Pe=3001,LT=3200,DT=3201,RT=0,PT=1,an="srgb",Cs="srgb-linear",sc=7680,IT=519,Tm=35044,bm="300 es",Bd=1035;class lo{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(e);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const i=this._listeners[t.type];if(i!==void 0){t.target=this;const n=i.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,t);t.target=null}}}const hi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],ac=Math.PI/180,Sm=180/Math.PI;function vl(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(hi[r&255]+hi[r>>8&255]+hi[r>>16&255]+hi[r>>24&255]+"-"+hi[t&255]+hi[t>>8&255]+"-"+hi[t>>16&15|64]+hi[t>>24&255]+"-"+hi[e&63|128]+hi[e>>8&255]+"-"+hi[e>>16&255]+hi[e>>24&255]+hi[i&255]+hi[i>>8&255]+hi[i>>16&255]+hi[i>>24&255]).toLowerCase()}function Wi(r,t,e){return Math.max(t,Math.min(e,r))}function OT(r,t){return(r%t+t)%t}function oc(r,t,e){return(1-e)*r+e*t}function wm(r){return(r&r-1)===0&&r!==0}function kd(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function Nl(r,t){switch(t.constructor){case Float32Array:return r;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function Fi(r,t){switch(t.constructor){case Float32Array:return r;case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}class ae{constructor(t=0,e=0){ae.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),s=this.x-t.x,a=this.y-t.y;return this.x=s*i-a*n+t.x,this.y=s*n+a*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ar{constructor(){ar.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,i,n,s,a,o,l,h){const u=this.elements;return u[0]=t,u[1]=n,u[2]=o,u[3]=e,u[4]=s,u[5]=l,u[6]=i,u[7]=a,u[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,a=i[0],o=i[3],l=i[6],h=i[1],u=i[4],f=i[7],c=i[2],_=i[5],g=i[8],d=n[0],p=n[3],v=n[6],A=n[1],E=n[4],S=n[7],L=n[2],T=n[5],x=n[8];return s[0]=a*d+o*A+l*L,s[3]=a*p+o*E+l*T,s[6]=a*v+o*S+l*x,s[1]=h*d+u*A+f*L,s[4]=h*p+u*E+f*T,s[7]=h*v+u*S+f*x,s[2]=c*d+_*A+g*L,s[5]=c*p+_*E+g*T,s[8]=c*v+_*S+g*x,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],u=t[8];return e*a*u-e*o*h-i*s*u+i*o*l+n*s*h-n*a*l}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],u=t[8],f=u*a-o*h,c=o*l-u*s,_=h*s-a*l,g=e*f+i*c+n*_;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const d=1/g;return t[0]=f*d,t[1]=(n*h-u*i)*d,t[2]=(o*i-n*a)*d,t[3]=c*d,t[4]=(u*e-n*l)*d,t[5]=(n*s-o*e)*d,t[6]=_*d,t[7]=(i*l-h*e)*d,t[8]=(a*e-i*s)*d,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,s,a,o){const l=Math.cos(s),h=Math.sin(s);return this.set(i*l,i*h,-i*(l*a+h*o)+a+t,-n*h,n*l,-n*(-h*a+l*o)+o+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],h=n[4],u=n[7];return n[0]=e*s+i*l,n[3]=e*a+i*h,n[6]=e*o+i*u,n[1]=-i*s+e*l,n[4]=-i*a+e*h,n[7]=-i*o+e*u,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let n=0;n<9;n++)if(e[n]!==i[n])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}function jv(r){for(let t=r.length-1;t>=0;--t)if(r[t]>=65535)return!0;return!1}function ru(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function ks(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function Bh(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}const lc={[an]:{[Cs]:ks},[Cs]:{[an]:Bh}},cr={legacyMode:!0,get workingColorSpace(){return Cs},set workingColorSpace(r){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(r,t,e){if(this.legacyMode||t===e||!t||!e)return r;if(lc[t]&&lc[t][e]!==void 0){const i=lc[t][e];return r.r=i(r.r),r.g=i(r.g),r.b=i(r.b),r}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(r,t){return this.convert(r,this.workingColorSpace,t)},toWorkingColorSpace:function(r,t){return this.convert(r,t,this.workingColorSpace)}},Yv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xe={r:0,g:0,b:0},dr={h:0,s:0,l:0},Gl={h:0,s:0,l:0};function hc(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*6*(2/3-e):r}function zl(r,t){return t.r=r.r,t.g=r.g,t.b=r.b,t}class Me{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,e===void 0&&i===void 0?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=an){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,cr.toWorkingColorSpace(this,e),this}setRGB(t,e,i,n=Cs){return this.r=t,this.g=e,this.b=i,cr.toWorkingColorSpace(this,n),this}setHSL(t,e,i,n=Cs){if(t=OT(t,1),e=Wi(e,0,1),i=Wi(i,0,1),e===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+e):i+e-i*e,a=2*i-s;this.r=hc(a,s,t+1/3),this.g=hc(a,s,t),this.b=hc(a,s,t-1/3)}return cr.toWorkingColorSpace(this,n),this}setStyle(t,e=an){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let s;const a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,cr.toWorkingColorSpace(this,e),i(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,cr.toWorkingColorSpace(this,e),i(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const l=parseFloat(s[1])/360,h=parseFloat(s[2])/100,u=parseFloat(s[3])/100;return i(s[4]),this.setHSL(l,h,u,e)}break}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=n[1],a=s.length;if(a===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,cr.toWorkingColorSpace(this,e),this;if(a===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,cr.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e=an){const i=Yv[t.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=ks(t.r),this.g=ks(t.g),this.b=ks(t.b),this}copyLinearToSRGB(t){return this.r=Bh(t.r),this.g=Bh(t.g),this.b=Bh(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=an){return cr.fromWorkingColorSpace(zl(this,Xe),t),Wi(Xe.r*255,0,255)<<16^Wi(Xe.g*255,0,255)<<8^Wi(Xe.b*255,0,255)<<0}getHexString(t=an){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Cs){cr.fromWorkingColorSpace(zl(this,Xe),e);const i=Xe.r,n=Xe.g,s=Xe.b,a=Math.max(i,n,s),o=Math.min(i,n,s);let l,h;const u=(o+a)/2;if(o===a)l=0,h=0;else{const f=a-o;switch(h=u<=.5?f/(a+o):f/(2-a-o),a){case i:l=(n-s)/f+(n<s?6:0);break;case n:l=(s-i)/f+2;break;case s:l=(i-n)/f+4;break}l/=6}return t.h=l,t.s=h,t.l=u,t}getRGB(t,e=Cs){return cr.fromWorkingColorSpace(zl(this,Xe),e),t.r=Xe.r,t.g=Xe.g,t.b=Xe.b,t}getStyle(t=an){return cr.fromWorkingColorSpace(zl(this,Xe),t),t!==an?`color(${t} ${Xe.r} ${Xe.g} ${Xe.b})`:`rgb(${Xe.r*255|0},${Xe.g*255|0},${Xe.b*255|0})`}offsetHSL(t,e,i){return this.getHSL(dr),dr.h+=t,dr.s+=e,dr.l+=i,this.setHSL(dr.h,dr.s,dr.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(dr),t.getHSL(Gl);const i=oc(dr.h,Gl.h,e),n=oc(dr.s,Gl.s,e),s=oc(dr.l,Gl.l,e);return this.setHSL(i,n,s),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}Me.NAMES=Yv;let sa;class $v{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{sa===void 0&&(sa=ru("canvas")),sa.width=t.width,sa.height=t.height;const i=sa.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=sa}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=ru("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),s=n.data;for(let a=0;a<s.length;a++)s[a]=ks(s[a]/255)*255;return i.putImageData(n,0,0),e}else if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(ks(e[i]/255)*255):e[i]=ks(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class qv{constructor(t=null){this.isSource=!0,this.uuid=vl(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push(uc(n[a].image)):s.push(uc(n[a]))}else s=uc(n);i.url=s}return e||(t.images[this.uuid]=i),i}}function uc(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?$v.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let FT=0;class Mr extends lo{constructor(t=Mr.DEFAULT_IMAGE,e=Mr.DEFAULT_MAPPING,i=Tr,n=Tr,s=er,a=Tu,o=kr,l=Xs,h=1,u=Ks){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:FT++}),this.uuid=vl(),this.name="",this.source=new qv(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=s,this.minFilter=a,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=l,this.offset=new ae(0,0),this.repeat=new ae(1,1),this.center=new ae(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ar,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Xv)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Od:t.x=t.x-Math.floor(t.x);break;case Tr:t.x=t.x<0?0:1;break;case Fd:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Od:t.y=t.y-Math.floor(t.y);break;case Tr:t.y=t.y<0?0:1;break;case Fd:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}}Mr.DEFAULT_IMAGE=null;Mr.DEFAULT_MAPPING=Xv;class Qe{constructor(t=0,e=0,i=0,n=1){Qe.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*n+a[12]*s,this.y=a[1]*e+a[5]*i+a[9]*n+a[13]*s,this.z=a[2]*e+a[6]*i+a[10]*n+a[14]*s,this.w=a[3]*e+a[7]*i+a[11]*n+a[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,s;const l=t.elements,h=l[0],u=l[4],f=l[8],c=l[1],_=l[5],g=l[9],d=l[2],p=l[6],v=l[10];if(Math.abs(u-c)<.01&&Math.abs(f-d)<.01&&Math.abs(g-p)<.01){if(Math.abs(u+c)<.1&&Math.abs(f+d)<.1&&Math.abs(g+p)<.1&&Math.abs(h+_+v-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const E=(h+1)/2,S=(_+1)/2,L=(v+1)/2,T=(u+c)/4,x=(f+d)/4,m=(g+p)/4;return E>S&&E>L?E<.01?(i=0,n=.707106781,s=.707106781):(i=Math.sqrt(E),n=T/i,s=x/i):S>L?S<.01?(i=.707106781,n=0,s=.707106781):(n=Math.sqrt(S),i=T/n,s=m/n):L<.01?(i=.707106781,n=.707106781,s=0):(s=Math.sqrt(L),i=x/s,n=m/s),this.set(i,n,s,e),this}let A=Math.sqrt((p-g)*(p-g)+(f-d)*(f-d)+(c-u)*(c-u));return Math.abs(A)<.001&&(A=1),this.x=(p-g)/A,this.y=(f-d)/A,this.z=(c-u)/A,this.w=Math.acos((h+_+v-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Yn extends lo{constructor(t,e,i={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Qe(0,0,t,e),this.scissorTest=!1,this.viewport=new Qe(0,0,t,e);const n={width:t,height:e,depth:1};this.texture=new Mr(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:er,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(t,e,i=1){(this.width!==t||this.height!==e||this.depth!==i)&&(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new qv(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Zv extends Mr{constructor(t=null,e=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=wi,this.minFilter=wi,this.wrapR=Tr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class BT extends Mr{constructor(t=null,e=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=wi,this.minFilter=wi,this.wrapR=Tr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class xl{constructor(t=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=n}static slerpFlat(t,e,i,n,s,a,o){let l=i[n+0],h=i[n+1],u=i[n+2],f=i[n+3];const c=s[a+0],_=s[a+1],g=s[a+2],d=s[a+3];if(o===0){t[e+0]=l,t[e+1]=h,t[e+2]=u,t[e+3]=f;return}if(o===1){t[e+0]=c,t[e+1]=_,t[e+2]=g,t[e+3]=d;return}if(f!==d||l!==c||h!==_||u!==g){let p=1-o;const v=l*c+h*_+u*g+f*d,A=v>=0?1:-1,E=1-v*v;if(E>Number.EPSILON){const L=Math.sqrt(E),T=Math.atan2(L,v*A);p=Math.sin(p*T)/L,o=Math.sin(o*T)/L}const S=o*A;if(l=l*p+c*S,h=h*p+_*S,u=u*p+g*S,f=f*p+d*S,p===1-o){const L=1/Math.sqrt(l*l+h*h+u*u+f*f);l*=L,h*=L,u*=L,f*=L}}t[e]=l,t[e+1]=h,t[e+2]=u,t[e+3]=f}static multiplyQuaternionsFlat(t,e,i,n,s,a){const o=i[n],l=i[n+1],h=i[n+2],u=i[n+3],f=s[a],c=s[a+1],_=s[a+2],g=s[a+3];return t[e]=o*g+u*f+l*_-h*c,t[e+1]=l*g+u*c+h*f-o*_,t[e+2]=h*g+u*_+o*c-l*f,t[e+3]=u*g-o*f-l*c-h*_,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const i=t._x,n=t._y,s=t._z,a=t._order,o=Math.cos,l=Math.sin,h=o(i/2),u=o(n/2),f=o(s/2),c=l(i/2),_=l(n/2),g=l(s/2);switch(a){case"XYZ":this._x=c*u*f+h*_*g,this._y=h*_*f-c*u*g,this._z=h*u*g+c*_*f,this._w=h*u*f-c*_*g;break;case"YXZ":this._x=c*u*f+h*_*g,this._y=h*_*f-c*u*g,this._z=h*u*g-c*_*f,this._w=h*u*f+c*_*g;break;case"ZXY":this._x=c*u*f-h*_*g,this._y=h*_*f+c*u*g,this._z=h*u*g+c*_*f,this._w=h*u*f-c*_*g;break;case"ZYX":this._x=c*u*f-h*_*g,this._y=h*_*f+c*u*g,this._z=h*u*g-c*_*f,this._w=h*u*f+c*_*g;break;case"YZX":this._x=c*u*f+h*_*g,this._y=h*_*f+c*u*g,this._z=h*u*g-c*_*f,this._w=h*u*f-c*_*g;break;case"XZY":this._x=c*u*f-h*_*g,this._y=h*_*f-c*u*g,this._z=h*u*g+c*_*f,this._w=h*u*f+c*_*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],s=e[8],a=e[1],o=e[5],l=e[9],h=e[2],u=e[6],f=e[10],c=i+o+f;if(c>0){const _=.5/Math.sqrt(c+1);this._w=.25/_,this._x=(u-l)*_,this._y=(s-h)*_,this._z=(a-n)*_}else if(i>o&&i>f){const _=2*Math.sqrt(1+i-o-f);this._w=(u-l)/_,this._x=.25*_,this._y=(n+a)/_,this._z=(s+h)/_}else if(o>f){const _=2*Math.sqrt(1+o-i-f);this._w=(s-h)/_,this._x=(n+a)/_,this._y=.25*_,this._z=(l+u)/_}else{const _=2*Math.sqrt(1+f-i-o);this._w=(a-n)/_,this._x=(s+h)/_,this._y=(l+u)/_,this._z=.25*_}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Wi(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,s=t._z,a=t._w,o=e._x,l=e._y,h=e._z,u=e._w;return this._x=i*u+a*o+n*h-s*l,this._y=n*u+a*l+s*o-i*h,this._z=s*u+a*h+i*l-n*o,this._w=a*u-i*o-n*l-s*h,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,n=this._y,s=this._z,a=this._w;let o=a*t._w+i*t._x+n*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=i,this._y=n,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const _=1-e;return this._w=_*a+e*this._w,this._x=_*i+e*this._x,this._y=_*n+e*this._y,this._z=_*s+e*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(l),u=Math.atan2(h,o),f=Math.sin((1-e)*u)/h,c=Math.sin(e*u)/h;return this._w=a*f+this._w*c,this._x=i*f+this._x*c,this._y=n*f+this._y*c,this._z=s*f+this._z*c,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(s),i*Math.cos(s),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ot{constructor(t=0,e=0,i=0){ot.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Am.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Am.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=t.elements,a=1/(s[3]*e+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*n+s[12])*a,this.y=(s[1]*e+s[5]*i+s[9]*n+s[13])*a,this.z=(s[2]*e+s[6]*i+s[10]*n+s[14])*a,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,s=t.x,a=t.y,o=t.z,l=t.w,h=l*e+a*n-o*i,u=l*i+o*e-s*n,f=l*n+s*i-a*e,c=-s*e-a*i-o*n;return this.x=h*l+c*-s+u*-o-f*-a,this.y=u*l+c*-a+f*-s-h*-o,this.z=f*l+c*-o+h*-a-u*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n,this.y=s[1]*e+s[5]*i+s[9]*n,this.z=s[2]*e+s[6]*i+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,s=t.z,a=e.x,o=e.y,l=e.z;return this.x=n*l-s*o,this.y=s*a-i*l,this.z=i*o-n*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return cc.copy(this).projectOnVector(t),this.sub(cc)}reflect(t){return this.sub(cc.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Wi(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const cc=new ot,Am=new xl;class yl{constructor(t=new ot(1/0,1/0,1/0),e=new ot(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,s=-1/0,a=-1/0,o=-1/0;for(let l=0,h=t.length;l<h;l+=3){const u=t[l],f=t[l+1],c=t[l+2];u<e&&(e=u),f<i&&(i=f),c<n&&(n=c),u>s&&(s=u),f>a&&(a=f),c>o&&(o=c)}return this.min.set(e,i,n),this.max.set(s,a,o),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,s=-1/0,a=-1/0,o=-1/0;for(let l=0,h=t.count;l<h;l++){const u=t.getX(l),f=t.getY(l),c=t.getZ(l);u<e&&(e=u),f<i&&(i=f),c<n&&(n=c),u>s&&(s=u),f>a&&(a=f),c>o&&(o=c)}return this.min.set(e,i,n),this.max.set(s,a,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=ss.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(i!==void 0)if(e&&i.attributes!=null&&i.attributes.position!==void 0){const s=i.attributes.position;for(let a=0,o=s.count;a<o;a++)ss.fromBufferAttribute(s,a).applyMatrix4(t.matrixWorld),this.expandByPoint(ss)}else i.boundingBox===null&&i.computeBoundingBox(),dc.copy(i.boundingBox),dc.applyMatrix4(t.matrixWorld),this.union(dc);const n=t.children;for(let s=0,a=n.length;s<a;s++)this.expandByObject(n[s],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,ss),ss.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(_o),Wl.subVectors(this.max,_o),aa.subVectors(t.a,_o),oa.subVectors(t.b,_o),la.subVectors(t.c,_o),bn.subVectors(oa,aa),Sn.subVectors(la,oa),as.subVectors(aa,la);let e=[0,-bn.z,bn.y,0,-Sn.z,Sn.y,0,-as.z,as.y,bn.z,0,-bn.x,Sn.z,0,-Sn.x,as.z,0,-as.x,-bn.y,bn.x,0,-Sn.y,Sn.x,0,-as.y,as.x,0];return!fc(e,aa,oa,la,Wl)||(e=[1,0,0,0,1,0,0,0,1],!fc(e,aa,oa,la,Wl))?!1:(Hl.crossVectors(bn,Sn),e=[Hl.x,Hl.y,Hl.z],fc(e,aa,oa,la,Wl))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return ss.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(ss).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(qr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),qr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),qr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),qr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),qr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),qr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),qr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),qr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(qr),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const qr=[new ot,new ot,new ot,new ot,new ot,new ot,new ot,new ot],ss=new ot,dc=new yl,aa=new ot,oa=new ot,la=new ot,bn=new ot,Sn=new ot,as=new ot,_o=new ot,Wl=new ot,Hl=new ot,os=new ot;function fc(r,t,e,i,n){for(let s=0,a=r.length-3;s<=a;s+=3){os.fromArray(r,s);const o=n.x*Math.abs(os.x)+n.y*Math.abs(os.y)+n.z*Math.abs(os.z),l=t.dot(os),h=e.dot(os),u=i.dot(os);if(Math.max(-Math.max(l,h,u),Math.min(l,h,u))>o)return!1}return!0}const kT=new yl,Mm=new ot,Vl=new ot,pc=new ot;class zf{constructor(t=new ot,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;e!==void 0?i.copy(e):kT.setFromPoints(t).getCenter(i);let n=0;for(let s=0,a=t.length;s<a;s++)n=Math.max(n,i.distanceToSquared(t[s]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;pc.subVectors(t,this.center);const e=pc.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),n=(i-this.radius)*.5;this.center.add(pc.multiplyScalar(n/i)),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?Vl.set(0,0,1).multiplyScalar(t.radius):Vl.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(Mm.copy(t.center).add(Vl)),this.expandByPoint(Mm.copy(t.center).sub(Vl)),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Zr=new ot,mc=new ot,Xl=new ot,wn=new ot,gc=new ot,Kl=new ot,_c=new ot;class UT{constructor(t=new ot,e=new ot(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Zr)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Zr.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Zr.copy(this.direction).multiplyScalar(e).add(this.origin),Zr.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){mc.copy(t).add(e).multiplyScalar(.5),Xl.copy(e).sub(t).normalize(),wn.copy(this.origin).sub(mc);const s=t.distanceTo(e)*.5,a=-this.direction.dot(Xl),o=wn.dot(this.direction),l=-wn.dot(Xl),h=wn.lengthSq(),u=Math.abs(1-a*a);let f,c,_,g;if(u>0)if(f=a*l-o,c=a*o-l,g=s*u,f>=0)if(c>=-g)if(c<=g){const d=1/u;f*=d,c*=d,_=f*(f+a*c+2*o)+c*(a*f+c+2*l)+h}else c=s,f=Math.max(0,-(a*c+o)),_=-f*f+c*(c+2*l)+h;else c=-s,f=Math.max(0,-(a*c+o)),_=-f*f+c*(c+2*l)+h;else c<=-g?(f=Math.max(0,-(-a*s+o)),c=f>0?-s:Math.min(Math.max(-s,-l),s),_=-f*f+c*(c+2*l)+h):c<=g?(f=0,c=Math.min(Math.max(-s,-l),s),_=c*(c+2*l)+h):(f=Math.max(0,-(a*s+o)),c=f>0?s:Math.min(Math.max(-s,-l),s),_=-f*f+c*(c+2*l)+h);else c=a>0?-s:s,f=Math.max(0,-(a*c+o)),_=-f*f+c*(c+2*l)+h;return i&&i.copy(this.direction).multiplyScalar(f).add(this.origin),n&&n.copy(Xl).multiplyScalar(c).add(mc),_}intersectSphere(t,e){Zr.subVectors(t.center,this.origin);const i=Zr.dot(this.direction),n=Zr.dot(Zr)-i*i,s=t.radius*t.radius;if(n>s)return null;const a=Math.sqrt(s-n),o=i-a,l=i+a;return o<0&&l<0?null:o<0?this.at(l,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,s,a,o,l;const h=1/this.direction.x,u=1/this.direction.y,f=1/this.direction.z,c=this.origin;return h>=0?(i=(t.min.x-c.x)*h,n=(t.max.x-c.x)*h):(i=(t.max.x-c.x)*h,n=(t.min.x-c.x)*h),u>=0?(s=(t.min.y-c.y)*u,a=(t.max.y-c.y)*u):(s=(t.max.y-c.y)*u,a=(t.min.y-c.y)*u),i>a||s>n||((s>i||i!==i)&&(i=s),(a<n||n!==n)&&(n=a),f>=0?(o=(t.min.z-c.z)*f,l=(t.max.z-c.z)*f):(o=(t.max.z-c.z)*f,l=(t.min.z-c.z)*f),i>l||o>n)||((o>i||i!==i)&&(i=o),(l<n||n!==n)&&(n=l),n<0)?null:this.at(i>=0?i:n,e)}intersectsBox(t){return this.intersectBox(t,Zr)!==null}intersectTriangle(t,e,i,n,s){gc.subVectors(e,t),Kl.subVectors(i,t),_c.crossVectors(gc,Kl);let a=this.direction.dot(_c),o;if(a>0){if(n)return null;o=1}else if(a<0)o=-1,a=-a;else return null;wn.subVectors(this.origin,t);const l=o*this.direction.dot(Kl.crossVectors(wn,Kl));if(l<0)return null;const h=o*this.direction.dot(gc.cross(wn));if(h<0||l+h>a)return null;const u=-o*wn.dot(_c);return u<0?null:this.at(u/a,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ai{constructor(){ai.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,n,s,a,o,l,h,u,f,c,_,g,d,p){const v=this.elements;return v[0]=t,v[4]=e,v[8]=i,v[12]=n,v[1]=s,v[5]=a,v[9]=o,v[13]=l,v[2]=h,v[6]=u,v[10]=f,v[14]=c,v[3]=_,v[7]=g,v[11]=d,v[15]=p,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ai().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/ha.setFromMatrixColumn(t,0).length(),s=1/ha.setFromMatrixColumn(t,1).length(),a=1/ha.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*s,e[5]=i[5]*s,e[6]=i[6]*s,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,n=t.y,s=t.z,a=Math.cos(i),o=Math.sin(i),l=Math.cos(n),h=Math.sin(n),u=Math.cos(s),f=Math.sin(s);if(t.order==="XYZ"){const c=a*u,_=a*f,g=o*u,d=o*f;e[0]=l*u,e[4]=-l*f,e[8]=h,e[1]=_+g*h,e[5]=c-d*h,e[9]=-o*l,e[2]=d-c*h,e[6]=g+_*h,e[10]=a*l}else if(t.order==="YXZ"){const c=l*u,_=l*f,g=h*u,d=h*f;e[0]=c+d*o,e[4]=g*o-_,e[8]=a*h,e[1]=a*f,e[5]=a*u,e[9]=-o,e[2]=_*o-g,e[6]=d+c*o,e[10]=a*l}else if(t.order==="ZXY"){const c=l*u,_=l*f,g=h*u,d=h*f;e[0]=c-d*o,e[4]=-a*f,e[8]=g+_*o,e[1]=_+g*o,e[5]=a*u,e[9]=d-c*o,e[2]=-a*h,e[6]=o,e[10]=a*l}else if(t.order==="ZYX"){const c=a*u,_=a*f,g=o*u,d=o*f;e[0]=l*u,e[4]=g*h-_,e[8]=c*h+d,e[1]=l*f,e[5]=d*h+c,e[9]=_*h-g,e[2]=-h,e[6]=o*l,e[10]=a*l}else if(t.order==="YZX"){const c=a*l,_=a*h,g=o*l,d=o*h;e[0]=l*u,e[4]=d-c*f,e[8]=g*f+_,e[1]=f,e[5]=a*u,e[9]=-o*u,e[2]=-h*u,e[6]=_*f+g,e[10]=c-d*f}else if(t.order==="XZY"){const c=a*l,_=a*h,g=o*l,d=o*h;e[0]=l*u,e[4]=-f,e[8]=h*u,e[1]=c*f+d,e[5]=a*u,e[9]=_*f-g,e[2]=g*f-_,e[6]=o*u,e[10]=d*f+c}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(NT,t,GT)}lookAt(t,e,i){const n=this.elements;return Bi.subVectors(t,e),Bi.lengthSq()===0&&(Bi.z=1),Bi.normalize(),An.crossVectors(i,Bi),An.lengthSq()===0&&(Math.abs(i.z)===1?Bi.x+=1e-4:Bi.z+=1e-4,Bi.normalize(),An.crossVectors(i,Bi)),An.normalize(),jl.crossVectors(Bi,An),n[0]=An.x,n[4]=jl.x,n[8]=Bi.x,n[1]=An.y,n[5]=jl.y,n[9]=Bi.y,n[2]=An.z,n[6]=jl.z,n[10]=Bi.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,a=i[0],o=i[4],l=i[8],h=i[12],u=i[1],f=i[5],c=i[9],_=i[13],g=i[2],d=i[6],p=i[10],v=i[14],A=i[3],E=i[7],S=i[11],L=i[15],T=n[0],x=n[4],m=n[8],w=n[12],R=n[1],M=n[5],C=n[9],b=n[13],D=n[2],O=n[6],B=n[10],P=n[14],F=n[3],I=n[7],y=n[11],k=n[15];return s[0]=a*T+o*R+l*D+h*F,s[4]=a*x+o*M+l*O+h*I,s[8]=a*m+o*C+l*B+h*y,s[12]=a*w+o*b+l*P+h*k,s[1]=u*T+f*R+c*D+_*F,s[5]=u*x+f*M+c*O+_*I,s[9]=u*m+f*C+c*B+_*y,s[13]=u*w+f*b+c*P+_*k,s[2]=g*T+d*R+p*D+v*F,s[6]=g*x+d*M+p*O+v*I,s[10]=g*m+d*C+p*B+v*y,s[14]=g*w+d*b+p*P+v*k,s[3]=A*T+E*R+S*D+L*F,s[7]=A*x+E*M+S*O+L*I,s[11]=A*m+E*C+S*B+L*y,s[15]=A*w+E*b+S*P+L*k,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],s=t[12],a=t[1],o=t[5],l=t[9],h=t[13],u=t[2],f=t[6],c=t[10],_=t[14],g=t[3],d=t[7],p=t[11],v=t[15];return g*(+s*l*f-n*h*f-s*o*c+i*h*c+n*o*_-i*l*_)+d*(+e*l*_-e*h*c+s*a*c-n*a*_+n*h*u-s*l*u)+p*(+e*h*f-e*o*_-s*a*f+i*a*_+s*o*u-i*h*u)+v*(-n*o*u-e*l*f+e*o*c+n*a*f-i*a*c+i*l*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],h=t[7],u=t[8],f=t[9],c=t[10],_=t[11],g=t[12],d=t[13],p=t[14],v=t[15],A=f*p*h-d*c*h+d*l*_-o*p*_-f*l*v+o*c*v,E=g*c*h-u*p*h-g*l*_+a*p*_+u*l*v-a*c*v,S=u*d*h-g*f*h+g*o*_-a*d*_-u*o*v+a*f*v,L=g*f*l-u*d*l-g*o*c+a*d*c+u*o*p-a*f*p,T=e*A+i*E+n*S+s*L;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const x=1/T;return t[0]=A*x,t[1]=(d*c*s-f*p*s-d*n*_+i*p*_+f*n*v-i*c*v)*x,t[2]=(o*p*s-d*l*s+d*n*h-i*p*h-o*n*v+i*l*v)*x,t[3]=(f*l*s-o*c*s-f*n*h+i*c*h+o*n*_-i*l*_)*x,t[4]=E*x,t[5]=(u*p*s-g*c*s+g*n*_-e*p*_-u*n*v+e*c*v)*x,t[6]=(g*l*s-a*p*s-g*n*h+e*p*h+a*n*v-e*l*v)*x,t[7]=(a*c*s-u*l*s+u*n*h-e*c*h-a*n*_+e*l*_)*x,t[8]=S*x,t[9]=(g*f*s-u*d*s-g*i*_+e*d*_+u*i*v-e*f*v)*x,t[10]=(a*d*s-g*o*s+g*i*h-e*d*h-a*i*v+e*o*v)*x,t[11]=(u*o*s-a*f*s-u*i*h+e*f*h+a*i*_-e*o*_)*x,t[12]=L*x,t[13]=(u*d*n-g*f*n+g*i*c-e*d*c-u*i*p+e*f*p)*x,t[14]=(g*o*n-a*d*n-g*i*l+e*d*l+a*i*p-e*o*p)*x,t[15]=(a*f*n-u*o*n+u*i*l-e*f*l-a*i*c+e*o*c)*x,this}scale(t){const e=this.elements,i=t.x,n=t.y,s=t.z;return e[0]*=i,e[4]*=n,e[8]*=s,e[1]*=i,e[5]*=n,e[9]*=s,e[2]*=i,e[6]*=n,e[10]*=s,e[3]*=i,e[7]*=n,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),s=1-i,a=t.x,o=t.y,l=t.z,h=s*a,u=s*o;return this.set(h*a+i,h*o-n*l,h*l+n*o,0,h*o+n*l,u*o+i,u*l-n*a,0,h*l-n*o,u*l+n*a,s*l*l+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,s,a){return this.set(1,i,s,0,t,1,a,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,s=e._x,a=e._y,o=e._z,l=e._w,h=s+s,u=a+a,f=o+o,c=s*h,_=s*u,g=s*f,d=a*u,p=a*f,v=o*f,A=l*h,E=l*u,S=l*f,L=i.x,T=i.y,x=i.z;return n[0]=(1-(d+v))*L,n[1]=(_+S)*L,n[2]=(g-E)*L,n[3]=0,n[4]=(_-S)*T,n[5]=(1-(c+v))*T,n[6]=(p+A)*T,n[7]=0,n[8]=(g+E)*x,n[9]=(p-A)*x,n[10]=(1-(c+d))*x,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let s=ha.set(n[0],n[1],n[2]).length();const a=ha.set(n[4],n[5],n[6]).length(),o=ha.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],fr.copy(this);const h=1/s,u=1/a,f=1/o;return fr.elements[0]*=h,fr.elements[1]*=h,fr.elements[2]*=h,fr.elements[4]*=u,fr.elements[5]*=u,fr.elements[6]*=u,fr.elements[8]*=f,fr.elements[9]*=f,fr.elements[10]*=f,e.setFromRotationMatrix(fr),i.x=s,i.y=a,i.z=o,this}makePerspective(t,e,i,n,s,a){const o=this.elements,l=2*s/(e-t),h=2*s/(i-n),u=(e+t)/(e-t),f=(i+n)/(i-n),c=-(a+s)/(a-s),_=-2*a*s/(a-s);return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=h,o[9]=f,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=_,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,i,n,s,a){const o=this.elements,l=1/(e-t),h=1/(i-n),u=1/(a-s),f=(e+t)*l,c=(i+n)*h,_=(a+s)*u;return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-f,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-_,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const ha=new ot,fr=new ai,NT=new ot(0,0,0),GT=new ot(1,1,1),An=new ot,jl=new ot,Bi=new ot,Cm=new ai,Lm=new xl;class El{constructor(t=0,e=0,i=0,n=El.DefaultOrder){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,s=n[0],a=n[4],o=n[8],l=n[1],h=n[5],u=n[9],f=n[2],c=n[6],_=n[10];switch(e){case"XYZ":this._y=Math.asin(Wi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,_),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(c,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Wi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,_),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-f,s),this._z=0);break;case"ZXY":this._x=Math.asin(Wi(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-f,_),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Wi(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(c,_),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(Wi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-f,s)):(this._x=0,this._y=Math.atan2(o,_));break;case"XZY":this._z=Math.asin(-Wi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(c,h),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,_),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return Cm.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Cm,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Lm.setFromEuler(this),this.setFromQuaternion(Lm,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}El.DefaultOrder="XYZ";El.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Jv{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let zT=0;const Dm=new ot,ua=new xl,Jr=new ai,Yl=new ot,vo=new ot,WT=new ot,HT=new xl,Rm=new ot(1,0,0),Pm=new ot(0,1,0),Im=new ot(0,0,1),VT={type:"added"},Om={type:"removed"};class Ki extends lo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:zT++}),this.uuid=vl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ki.DefaultUp.clone();const t=new ot,e=new El,i=new xl,n=new ot(1,1,1);function s(){i.setFromEuler(e,!1)}function a(){e.setFromQuaternion(i,void 0,!1)}e._onChange(s),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ai},normalMatrix:{value:new ar}}),this.matrix=new ai,this.matrixWorld=new ai,this.matrixAutoUpdate=Ki.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Ki.DefaultMatrixWorldAutoUpdate,this.layers=new Jv,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return ua.setFromAxisAngle(t,e),this.quaternion.multiply(ua),this}rotateOnWorldAxis(t,e){return ua.setFromAxisAngle(t,e),this.quaternion.premultiply(ua),this}rotateX(t){return this.rotateOnAxis(Rm,t)}rotateY(t){return this.rotateOnAxis(Pm,t)}rotateZ(t){return this.rotateOnAxis(Im,t)}translateOnAxis(t,e){return Dm.copy(t).applyQuaternion(this.quaternion),this.position.add(Dm.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Rm,t)}translateY(t){return this.translateOnAxis(Pm,t)}translateZ(t){return this.translateOnAxis(Im,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Jr.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?Yl.copy(t):Yl.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),vo.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Jr.lookAt(vo,Yl,this.up):Jr.lookAt(Yl,vo,this.up),this.quaternion.setFromRotationMatrix(Jr),n&&(Jr.extractRotation(n.matrixWorld),ua.setFromRotationMatrix(Jr),this.quaternion.premultiply(ua.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(VT)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Om)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(Om)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Jr.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Jr.multiply(t.parent.matrixWorld)),t.applyMatrix4(Jr),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const a=this.children[i].getObjectByProperty(t,e);if(a!==void 0)return a}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vo,t,WT),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vo,HT,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++){const s=e[i];(s.matrixWorldAutoUpdate===!0||t===!0)&&s.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const n=this.children;for(let s=0,a=n.length;s<a;s++){const o=n[s];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON()));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let h=0,u=l.length;h<u;h++){const f=l[h];s(t.shapes,f)}else s(t.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,h=this.material.length;l<h;l++)o.push(s(t.materials,this.material[l]));n.material=o}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];n.animations.push(s(t.animations,l))}}if(e){const o=a(t.geometries),l=a(t.materials),h=a(t.textures),u=a(t.images),f=a(t.shapes),c=a(t.skeletons),_=a(t.animations),g=a(t.nodes);o.length>0&&(i.geometries=o),l.length>0&&(i.materials=l),h.length>0&&(i.textures=h),u.length>0&&(i.images=u),f.length>0&&(i.shapes=f),c.length>0&&(i.skeletons=c),_.length>0&&(i.animations=_),g.length>0&&(i.nodes=g)}return i.object=n,i;function a(o){const l=[];for(const h in o){const u=o[h];delete u.metadata,l.push(u)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const n=t.children[i];this.add(n.clone())}return this}}Ki.DefaultUp=new ot(0,1,0);Ki.DefaultMatrixAutoUpdate=!0;Ki.DefaultMatrixWorldAutoUpdate=!0;const pr=new ot,Qr=new ot,vc=new ot,tn=new ot,ca=new ot,da=new ot,Fm=new ot,xc=new ot,yc=new ot,Ec=new ot;class hn{constructor(t=new ot,e=new ot,i=new ot){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),pr.subVectors(t,e),n.cross(pr);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,e,i,n,s){pr.subVectors(n,e),Qr.subVectors(i,e),vc.subVectors(t,e);const a=pr.dot(pr),o=pr.dot(Qr),l=pr.dot(vc),h=Qr.dot(Qr),u=Qr.dot(vc),f=a*h-o*o;if(f===0)return s.set(-2,-1,-1);const c=1/f,_=(h*l-o*u)*c,g=(a*u-o*l)*c;return s.set(1-_-g,g,_)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,tn),tn.x>=0&&tn.y>=0&&tn.x+tn.y<=1}static getUV(t,e,i,n,s,a,o,l){return this.getBarycoord(t,e,i,n,tn),l.set(0,0),l.addScaledVector(s,tn.x),l.addScaledVector(a,tn.y),l.addScaledVector(o,tn.z),l}static isFrontFacing(t,e,i,n){return pr.subVectors(i,e),Qr.subVectors(t,e),pr.cross(Qr).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return pr.subVectors(this.c,this.b),Qr.subVectors(this.a,this.b),pr.cross(Qr).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return hn.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return hn.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,s){return hn.getUV(t,this.a,this.b,this.c,e,i,n,s)}containsPoint(t){return hn.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return hn.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,s=this.c;let a,o;ca.subVectors(n,i),da.subVectors(s,i),xc.subVectors(t,i);const l=ca.dot(xc),h=da.dot(xc);if(l<=0&&h<=0)return e.copy(i);yc.subVectors(t,n);const u=ca.dot(yc),f=da.dot(yc);if(u>=0&&f<=u)return e.copy(n);const c=l*f-u*h;if(c<=0&&l>=0&&u<=0)return a=l/(l-u),e.copy(i).addScaledVector(ca,a);Ec.subVectors(t,s);const _=ca.dot(Ec),g=da.dot(Ec);if(g>=0&&_<=g)return e.copy(s);const d=_*h-l*g;if(d<=0&&h>=0&&g<=0)return o=h/(h-g),e.copy(i).addScaledVector(da,o);const p=u*g-_*f;if(p<=0&&f-u>=0&&_-g>=0)return Fm.subVectors(s,n),o=(f-u)/(f-u+(_-g)),e.copy(n).addScaledVector(Fm,o);const v=1/(p+d+c);return a=d*v,o=c*v,e.copy(i).addScaledVector(ca,a).addScaledVector(da,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let XT=0;class bu extends lo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:XT++}),this.uuid=vl(),this.name="",this.type="Material",this.blending=za,this.side=ro,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Wv,this.blendDst=Hv,this.blendEquation=Sa,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Rd,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=IT,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=sc,this.stencilZFail=sc,this.stencilZPass=sc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const i=t[e];if(i===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}const n=this[e];if(n===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==za&&(i.blending=this.blending),this.side!==ro&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function n(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(e){const s=n(t.textures),a=n(t.images);s.length>0&&(i.textures=s),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(e!==null){const n=e.length;i=new Array(n);for(let s=0;s!==n;++s)i[s]=e[s].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class Qv extends bu{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Me(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Vv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const ze=new ot,$l=new ae;class Wr{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i===!0,this.usage=Tm,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)$l.fromBufferAttribute(this,e),$l.applyMatrix3(t),this.setXY(e,$l.x,$l.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)ze.fromBufferAttribute(this,e),ze.applyMatrix3(t),this.setXYZ(e,ze.x,ze.y,ze.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)ze.fromBufferAttribute(this,e),ze.applyMatrix4(t),this.setXYZ(e,ze.x,ze.y,ze.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)ze.fromBufferAttribute(this,e),ze.applyNormalMatrix(t),this.setXYZ(e,ze.x,ze.y,ze.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)ze.fromBufferAttribute(this,e),ze.transformDirection(t),this.setXYZ(e,ze.x,ze.y,ze.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Nl(e,this.array)),e}setX(t,e){return this.normalized&&(e=Fi(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Nl(e,this.array)),e}setY(t,e){return this.normalized&&(e=Fi(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Nl(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Fi(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Nl(e,this.array)),e}setW(t,e){return this.normalized&&(e=Fi(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=Fi(e,this.array),i=Fi(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.normalized&&(e=Fi(e,this.array),i=Fi(i,this.array),n=Fi(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,s){return t*=this.itemSize,this.normalized&&(e=Fi(e,this.array),i=Fi(i,this.array),n=Fi(n,this.array),s=Fi(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Tm&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class t0 extends Wr{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class e0 extends Wr{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Us extends Wr{constructor(t,e,i){super(new Float32Array(t),e,i)}}let KT=0;const qi=new ai,Tc=new Ki,fa=new ot,ki=new yl,xo=new yl,Ze=new ot;class Js extends lo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:KT++}),this.uuid=vl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(jv(t)?e0:t0)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new ar().getNormalMatrix(t);i.applyNormalMatrix(s),i.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(t),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return qi.makeRotationFromQuaternion(t),this.applyMatrix4(qi),this}rotateX(t){return qi.makeRotationX(t),this.applyMatrix4(qi),this}rotateY(t){return qi.makeRotationY(t),this.applyMatrix4(qi),this}rotateZ(t){return qi.makeRotationZ(t),this.applyMatrix4(qi),this}translate(t,e,i){return qi.makeTranslation(t,e,i),this.applyMatrix4(qi),this}scale(t,e,i){return qi.makeScale(t,e,i),this.applyMatrix4(qi),this}lookAt(t){return Tc.lookAt(t),Tc.updateMatrix(),this.applyMatrix4(Tc.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(fa).negate(),this.translate(fa.x,fa.y,fa.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const s=t[i];e.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Us(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new yl);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new ot(-1/0,-1/0,-1/0),new ot(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,n=e.length;i<n;i++){const s=e[i];ki.setFromBufferAttribute(s),this.morphTargetsRelative?(Ze.addVectors(this.boundingBox.min,ki.min),this.boundingBox.expandByPoint(Ze),Ze.addVectors(this.boundingBox.max,ki.max),this.boundingBox.expandByPoint(Ze)):(this.boundingBox.expandByPoint(ki.min),this.boundingBox.expandByPoint(ki.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new zf);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new ot,1/0);return}if(t){const i=this.boundingSphere.center;if(ki.setFromBufferAttribute(t),e)for(let s=0,a=e.length;s<a;s++){const o=e[s];xo.setFromBufferAttribute(o),this.morphTargetsRelative?(Ze.addVectors(ki.min,xo.min),ki.expandByPoint(Ze),Ze.addVectors(ki.max,xo.max),ki.expandByPoint(Ze)):(ki.expandByPoint(xo.min),ki.expandByPoint(xo.max))}ki.getCenter(i);let n=0;for(let s=0,a=t.count;s<a;s++)Ze.fromBufferAttribute(t,s),n=Math.max(n,i.distanceToSquared(Ze));if(e)for(let s=0,a=e.length;s<a;s++){const o=e[s],l=this.morphTargetsRelative;for(let h=0,u=o.count;h<u;h++)Ze.fromBufferAttribute(o,h),l&&(fa.fromBufferAttribute(t,h),Ze.add(fa)),n=Math.max(n,i.distanceToSquared(Ze))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.array,n=e.position.array,s=e.normal.array,a=e.uv.array,o=n.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Wr(new Float32Array(4*o),4));const l=this.getAttribute("tangent").array,h=[],u=[];for(let R=0;R<o;R++)h[R]=new ot,u[R]=new ot;const f=new ot,c=new ot,_=new ot,g=new ae,d=new ae,p=new ae,v=new ot,A=new ot;function E(R,M,C){f.fromArray(n,R*3),c.fromArray(n,M*3),_.fromArray(n,C*3),g.fromArray(a,R*2),d.fromArray(a,M*2),p.fromArray(a,C*2),c.sub(f),_.sub(f),d.sub(g),p.sub(g);const b=1/(d.x*p.y-p.x*d.y);!isFinite(b)||(v.copy(c).multiplyScalar(p.y).addScaledVector(_,-d.y).multiplyScalar(b),A.copy(_).multiplyScalar(d.x).addScaledVector(c,-p.x).multiplyScalar(b),h[R].add(v),h[M].add(v),h[C].add(v),u[R].add(A),u[M].add(A),u[C].add(A))}let S=this.groups;S.length===0&&(S=[{start:0,count:i.length}]);for(let R=0,M=S.length;R<M;++R){const C=S[R],b=C.start,D=C.count;for(let O=b,B=b+D;O<B;O+=3)E(i[O+0],i[O+1],i[O+2])}const L=new ot,T=new ot,x=new ot,m=new ot;function w(R){x.fromArray(s,R*3),m.copy(x);const M=h[R];L.copy(M),L.sub(x.multiplyScalar(x.dot(M))).normalize(),T.crossVectors(m,M);const b=T.dot(u[R])<0?-1:1;l[R*4]=L.x,l[R*4+1]=L.y,l[R*4+2]=L.z,l[R*4+3]=b}for(let R=0,M=S.length;R<M;++R){const C=S[R],b=C.start,D=C.count;for(let O=b,B=b+D;O<B;O+=3)w(i[O+0]),w(i[O+1]),w(i[O+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Wr(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let c=0,_=i.count;c<_;c++)i.setXYZ(c,0,0,0);const n=new ot,s=new ot,a=new ot,o=new ot,l=new ot,h=new ot,u=new ot,f=new ot;if(t)for(let c=0,_=t.count;c<_;c+=3){const g=t.getX(c+0),d=t.getX(c+1),p=t.getX(c+2);n.fromBufferAttribute(e,g),s.fromBufferAttribute(e,d),a.fromBufferAttribute(e,p),u.subVectors(a,s),f.subVectors(n,s),u.cross(f),o.fromBufferAttribute(i,g),l.fromBufferAttribute(i,d),h.fromBufferAttribute(i,p),o.add(u),l.add(u),h.add(u),i.setXYZ(g,o.x,o.y,o.z),i.setXYZ(d,l.x,l.y,l.z),i.setXYZ(p,h.x,h.y,h.z)}else for(let c=0,_=e.count;c<_;c+=3)n.fromBufferAttribute(e,c+0),s.fromBufferAttribute(e,c+1),a.fromBufferAttribute(e,c+2),u.subVectors(a,s),f.subVectors(n,s),u.cross(f),i.setXYZ(c+0,u.x,u.y,u.z),i.setXYZ(c+1,u.x,u.y,u.z),i.setXYZ(c+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Ze.fromBufferAttribute(t,e),Ze.normalize(),t.setXYZ(e,Ze.x,Ze.y,Ze.z)}toNonIndexed(){function t(o,l){const h=o.array,u=o.itemSize,f=o.normalized,c=new h.constructor(l.length*u);let _=0,g=0;for(let d=0,p=l.length;d<p;d++){o.isInterleavedBufferAttribute?_=l[d]*o.data.stride+o.offset:_=l[d]*u;for(let v=0;v<u;v++)c[g++]=h[_++]}return new Wr(c,u,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Js,i=this.index.array,n=this.attributes;for(const o in n){const l=n[o],h=t(l,i);e.setAttribute(o,h)}const s=this.morphAttributes;for(const o in s){const l=[],h=s[o];for(let u=0,f=h.length;u<f;u++){const c=h[u],_=t(c,i);l.push(_)}e.morphAttributes[o]=l}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const h=a[o];e.addGroup(h.start,h.count,h.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const h in l)l[h]!==void 0&&(t[h]=l[h]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const l in i){const h=i[l];t.data.attributes[l]=h.toJSON(t.data)}const n={};let s=!1;for(const l in this.morphAttributes){const h=this.morphAttributes[l],u=[];for(let f=0,c=h.length;f<c;f++){const _=h[f];u.push(_.toJSON(t.data))}u.length>0&&(n[l]=u,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;i!==null&&this.setIndex(i.clone(e));const n=t.attributes;for(const h in n){const u=n[h];this.setAttribute(h,u.clone(e))}const s=t.morphAttributes;for(const h in s){const u=[],f=s[h];for(let c=0,_=f.length;c<_;c++)u.push(f[c].clone(e));this.morphAttributes[h]=u}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let h=0,u=a.length;h<u;h++){const f=a[h];this.addGroup(f.start,f.count,f.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,t.parameters!==void 0&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Bm=new ai,pa=new UT,bc=new zf,Mn=new ot,Cn=new ot,Ln=new ot,Sc=new ot,wc=new ot,Ac=new ot,ql=new ot,Zl=new ot,Jl=new ot,Ql=new ae,th=new ae,eh=new ae,Mc=new ot,ih=new ot;class Ur extends Ki{constructor(t=new Js,e=new Qv){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const n=e[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}raycast(t,e){const i=this.geometry,n=this.material,s=this.matrixWorld;if(n===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),bc.copy(i.boundingSphere),bc.applyMatrix4(s),t.ray.intersectsSphere(bc)===!1)||(Bm.copy(s).invert(),pa.copy(t.ray).applyMatrix4(Bm),i.boundingBox!==null&&pa.intersectsBox(i.boundingBox)===!1))return;let a;const o=i.index,l=i.attributes.position,h=i.morphAttributes.position,u=i.morphTargetsRelative,f=i.attributes.uv,c=i.attributes.uv2,_=i.groups,g=i.drawRange;if(o!==null)if(Array.isArray(n))for(let d=0,p=_.length;d<p;d++){const v=_[d],A=n[v.materialIndex],E=Math.max(v.start,g.start),S=Math.min(o.count,Math.min(v.start+v.count,g.start+g.count));for(let L=E,T=S;L<T;L+=3){const x=o.getX(L),m=o.getX(L+1),w=o.getX(L+2);a=rh(this,A,t,pa,l,h,u,f,c,x,m,w),a&&(a.faceIndex=Math.floor(L/3),a.face.materialIndex=v.materialIndex,e.push(a))}}else{const d=Math.max(0,g.start),p=Math.min(o.count,g.start+g.count);for(let v=d,A=p;v<A;v+=3){const E=o.getX(v),S=o.getX(v+1),L=o.getX(v+2);a=rh(this,n,t,pa,l,h,u,f,c,E,S,L),a&&(a.faceIndex=Math.floor(v/3),e.push(a))}}else if(l!==void 0)if(Array.isArray(n))for(let d=0,p=_.length;d<p;d++){const v=_[d],A=n[v.materialIndex],E=Math.max(v.start,g.start),S=Math.min(l.count,Math.min(v.start+v.count,g.start+g.count));for(let L=E,T=S;L<T;L+=3){const x=L,m=L+1,w=L+2;a=rh(this,A,t,pa,l,h,u,f,c,x,m,w),a&&(a.faceIndex=Math.floor(L/3),a.face.materialIndex=v.materialIndex,e.push(a))}}else{const d=Math.max(0,g.start),p=Math.min(l.count,g.start+g.count);for(let v=d,A=p;v<A;v+=3){const E=v,S=v+1,L=v+2;a=rh(this,n,t,pa,l,h,u,f,c,E,S,L),a&&(a.faceIndex=Math.floor(v/3),e.push(a))}}}}function jT(r,t,e,i,n,s,a,o){let l;if(t.side===hr?l=i.intersectTriangle(a,s,n,!0,o):l=i.intersectTriangle(n,s,a,t.side!==Br,o),l===null)return null;ih.copy(o),ih.applyMatrix4(r.matrixWorld);const h=e.ray.origin.distanceTo(ih);return h<e.near||h>e.far?null:{distance:h,point:ih.clone(),object:r}}function rh(r,t,e,i,n,s,a,o,l,h,u,f){Mn.fromBufferAttribute(n,h),Cn.fromBufferAttribute(n,u),Ln.fromBufferAttribute(n,f);const c=r.morphTargetInfluences;if(s&&c){ql.set(0,0,0),Zl.set(0,0,0),Jl.set(0,0,0);for(let g=0,d=s.length;g<d;g++){const p=c[g],v=s[g];p!==0&&(Sc.fromBufferAttribute(v,h),wc.fromBufferAttribute(v,u),Ac.fromBufferAttribute(v,f),a?(ql.addScaledVector(Sc,p),Zl.addScaledVector(wc,p),Jl.addScaledVector(Ac,p)):(ql.addScaledVector(Sc.sub(Mn),p),Zl.addScaledVector(wc.sub(Cn),p),Jl.addScaledVector(Ac.sub(Ln),p)))}Mn.add(ql),Cn.add(Zl),Ln.add(Jl)}r.isSkinnedMesh&&(r.boneTransform(h,Mn),r.boneTransform(u,Cn),r.boneTransform(f,Ln));const _=jT(r,t,e,i,Mn,Cn,Ln,Mc);if(_){o&&(Ql.fromBufferAttribute(o,h),th.fromBufferAttribute(o,u),eh.fromBufferAttribute(o,f),_.uv=hn.getUV(Mc,Mn,Cn,Ln,Ql,th,eh,new ae)),l&&(Ql.fromBufferAttribute(l,h),th.fromBufferAttribute(l,u),eh.fromBufferAttribute(l,f),_.uv2=hn.getUV(Mc,Mn,Cn,Ln,Ql,th,eh,new ae));const g={a:h,b:u,c:f,normal:new ot,materialIndex:0};hn.getNormal(Mn,Cn,Ln,g.normal),_.face=g}return _}class Tl extends Js{constructor(t=1,e=1,i=1,n=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:s,depthSegments:a};const o=this;n=Math.floor(n),s=Math.floor(s),a=Math.floor(a);const l=[],h=[],u=[],f=[];let c=0,_=0;g("z","y","x",-1,-1,i,e,t,a,s,0),g("z","y","x",1,-1,i,e,-t,a,s,1),g("x","z","y",1,1,t,i,e,n,a,2),g("x","z","y",1,-1,t,i,-e,n,a,3),g("x","y","z",1,-1,t,e,i,n,s,4),g("x","y","z",-1,-1,t,e,-i,n,s,5),this.setIndex(l),this.setAttribute("position",new Us(h,3)),this.setAttribute("normal",new Us(u,3)),this.setAttribute("uv",new Us(f,2));function g(d,p,v,A,E,S,L,T,x,m,w){const R=S/x,M=L/m,C=S/2,b=L/2,D=T/2,O=x+1,B=m+1;let P=0,F=0;const I=new ot;for(let y=0;y<B;y++){const k=y*M-b;for(let U=0;U<O;U++){const N=U*R-C;I[d]=N*A,I[p]=k*E,I[v]=D,h.push(I.x,I.y,I.z),I[d]=0,I[p]=0,I[v]=T>0?1:-1,u.push(I.x,I.y,I.z),f.push(U/x),f.push(1-y/m),P+=1}}for(let y=0;y<m;y++)for(let k=0;k<x;k++){const U=c+k+O*y,N=c+k+O*(y+1),W=c+(k+1)+O*(y+1),G=c+(k+1)+O*y;l.push(U,N,G),l.push(N,W,G),F+=6}o.addGroup(_,F,w),_+=F,c+=P}}static fromJSON(t){return new Tl(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function oo(r){const t={};for(const e in r){t[e]={};for(const i in r[e]){const n=r[e][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[e][i]=n.clone():Array.isArray(n)?t[e][i]=n.slice():t[e][i]=n}}return t}function ci(r){const t={};for(let e=0;e<r.length;e++){const i=oo(r[e]);for(const n in i)t[n]=i[n]}return t}function YT(r){const t=[];for(let e=0;e<r.length;e++)t.push(r[e].clone());return t}const $T={clone:oo,merge:ci};var qT=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,ZT=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class yn extends bu{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=qT,this.fragmentShader=ZT,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=oo(t.uniforms),this.uniformsGroups=YT(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const a=this.uniforms[n].value;a&&a.isTexture?e.uniforms[n]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?e.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?e.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?e.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?e.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?e.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?e.uniforms[n]={type:"m4",value:a.toArray()}:e.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const n in this.extensions)this.extensions[n]===!0&&(i[n]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class i0 extends Ki{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ai,this.projectionMatrix=new ai,this.projectionMatrixInverse=new ai}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class ir extends i0{constructor(t=50,e=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=Sm*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(ac*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return Sm*2*Math.atan(Math.tan(ac*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,s,a){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(ac*.5*this.fov)/this.zoom,i=2*e,n=this.aspect*i,s=-.5*n;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,h=a.fullHeight;s+=a.offsetX*n/l,e-=a.offsetY*i/h,n*=a.width/l,i*=a.height/h}const o=this.filmOffset;o!==0&&(s+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const ma=90,ga=1;class JT extends Ki{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i;const n=new ir(ma,ga,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new ot(1,0,0)),this.add(n);const s=new ir(ma,ga,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new ot(-1,0,0)),this.add(s);const a=new ir(ma,ga,t,e);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new ot(0,1,0)),this.add(a);const o=new ir(ma,ga,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new ot(0,-1,0)),this.add(o);const l=new ir(ma,ga,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new ot(0,0,1)),this.add(l);const h=new ir(ma,ga,t,e);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new ot(0,0,-1)),this.add(h)}update(t,e){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[n,s,a,o,l,h]=this.children,u=t.getRenderTarget(),f=t.toneMapping,c=t.xr.enabled;t.toneMapping=mn,t.xr.enabled=!1;const _=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,s),t.setRenderTarget(i,2),t.render(e,a),t.setRenderTarget(i,3),t.render(e,o),t.setRenderTarget(i,4),t.render(e,l),i.texture.generateMipmaps=_,t.setRenderTarget(i,5),t.render(e,h),t.setRenderTarget(u),t.toneMapping=f,t.xr.enabled=c,i.texture.needsPMREMUpdate=!0}}class r0 extends Mr{constructor(t,e,i,n,s,a,o,l,h,u){t=t!==void 0?t:[],e=e!==void 0?e:no,super(t,e,i,n,s,a,o,l,h,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class QT extends Yn{constructor(t,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];this.texture=new r0(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:er}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new Tl(5,5,5),s=new yn({name:"CubemapFromEquirect",uniforms:oo(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:hr,blending:Hn});s.uniforms.tEquirect.value=e;const a=new Ur(n,s),o=e.minFilter;return e.minFilter===Tu&&(e.minFilter=er),new JT(1,10,this).update(t,a),e.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(t,e,i,n){const s=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(e,i,n);t.setRenderTarget(s)}}const Cc=new ot,tb=new ot,eb=new ar;class ps{constructor(t=new ot(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=Cc.subVectors(i,e).cross(tb.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(Cc),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:e.copy(i).multiplyScalar(s).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||eb.getNormalMatrix(t),n=this.coplanarPoint(Cc).applyMatrix4(t),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _a=new zf,nh=new ot;class n0{constructor(t=new ps,e=new ps,i=new ps,n=new ps,s=new ps,a=new ps){this.planes=[t,e,i,n,s,a]}set(t,e,i,n,s,a){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(n),o[4].copy(s),o[5].copy(a),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],s=i[1],a=i[2],o=i[3],l=i[4],h=i[5],u=i[6],f=i[7],c=i[8],_=i[9],g=i[10],d=i[11],p=i[12],v=i[13],A=i[14],E=i[15];return e[0].setComponents(o-n,f-l,d-c,E-p).normalize(),e[1].setComponents(o+n,f+l,d+c,E+p).normalize(),e[2].setComponents(o+s,f+h,d+_,E+v).normalize(),e[3].setComponents(o-s,f-h,d-_,E-v).normalize(),e[4].setComponents(o-a,f-u,d-g,E-A).normalize(),e[5].setComponents(o+a,f+u,d+g,E+A).normalize(),this}intersectsObject(t){const e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),_a.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(_a)}intersectsSprite(t){return _a.center.set(0,0,0),_a.radius=.7071067811865476,_a.applyMatrix4(t.matrixWorld),this.intersectsSphere(_a)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(i)<n)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(nh.x=n.normal.x>0?t.max.x:t.min.x,nh.y=n.normal.y>0?t.max.y:t.min.y,nh.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(nh)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function s0(){let r=null,t=!1,e=null,i=null;function n(s,a){e(s,a),i=r.requestAnimationFrame(n)}return{start:function(){t!==!0&&e!==null&&(i=r.requestAnimationFrame(n),t=!0)},stop:function(){r.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(s){e=s},setContext:function(s){r=s}}}function ib(r,t){const e=t.isWebGL2,i=new WeakMap;function n(h,u){const f=h.array,c=h.usage,_=r.createBuffer();r.bindBuffer(u,_),r.bufferData(u,f,c),h.onUploadCallback();let g;if(f instanceof Float32Array)g=5126;else if(f instanceof Uint16Array)if(h.isFloat16BufferAttribute)if(e)g=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=5123;else if(f instanceof Int16Array)g=5122;else if(f instanceof Uint32Array)g=5125;else if(f instanceof Int32Array)g=5124;else if(f instanceof Int8Array)g=5120;else if(f instanceof Uint8Array)g=5121;else if(f instanceof Uint8ClampedArray)g=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+f);return{buffer:_,type:g,bytesPerElement:f.BYTES_PER_ELEMENT,version:h.version}}function s(h,u,f){const c=u.array,_=u.updateRange;r.bindBuffer(f,h),_.count===-1?r.bufferSubData(f,0,c):(e?r.bufferSubData(f,_.offset*c.BYTES_PER_ELEMENT,c,_.offset,_.count):r.bufferSubData(f,_.offset*c.BYTES_PER_ELEMENT,c.subarray(_.offset,_.offset+_.count)),_.count=-1)}function a(h){return h.isInterleavedBufferAttribute&&(h=h.data),i.get(h)}function o(h){h.isInterleavedBufferAttribute&&(h=h.data);const u=i.get(h);u&&(r.deleteBuffer(u.buffer),i.delete(h))}function l(h,u){if(h.isGLBufferAttribute){const c=i.get(h);(!c||c.version<h.version)&&i.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version});return}h.isInterleavedBufferAttribute&&(h=h.data);const f=i.get(h);f===void 0?i.set(h,n(h,u)):f.version<h.version&&(s(f.buffer,h,u),f.version=h.version)}return{get:a,remove:o,update:l}}class bl extends Js{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const s=t/2,a=e/2,o=Math.floor(i),l=Math.floor(n),h=o+1,u=l+1,f=t/o,c=e/l,_=[],g=[],d=[],p=[];for(let v=0;v<u;v++){const A=v*c-a;for(let E=0;E<h;E++){const S=E*f-s;g.push(S,-A,0),d.push(0,0,1),p.push(E/o),p.push(1-v/l)}}for(let v=0;v<l;v++)for(let A=0;A<o;A++){const E=A+h*v,S=A+h*(v+1),L=A+1+h*(v+1),T=A+1+h*v;_.push(E,S,T),_.push(S,L,T)}this.setIndex(_),this.setAttribute("position",new Us(g,3)),this.setAttribute("normal",new Us(d,3)),this.setAttribute("uv",new Us(p,2))}static fromJSON(t){return new bl(t.width,t.height,t.widthSegments,t.heightSegments)}}var rb=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,nb=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,sb=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,ab=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,ob=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,lb=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,hb="vec3 transformed = vec3( position );",ub=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,cb=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,db=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,fb=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,pb=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,mb=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,gb=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,_b=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,vb=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,xb=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,yb=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Eb=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Tb=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,bb=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Sb=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,wb=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Ab=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Mb=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Cb=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Lb="gl_FragColor = linearToOutputTexel( gl_FragColor );",Db=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Rb=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Pb=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Ib=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Ob=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Fb=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Bb=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,kb=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Ub=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Nb=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Gb=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,zb=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Wb=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Hb=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Vb=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,Xb=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Kb=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,jb=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Yb=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,$b=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,qb=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,Zb=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,Jb=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Qb=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,tS=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,eS=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,iS=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,rS=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,nS=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,sS=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,aS=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,oS=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,lS=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,hS=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,uS=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,cS=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,dS=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,fS=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,pS=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,mS=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,gS=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,_S=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,vS=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,xS=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,yS=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,ES=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,TS=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,bS=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,SS=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,wS=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,AS=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,MS=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,CS=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,LS=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,DS=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,RS=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,PS=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,IS=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,OS=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,FS=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,BS=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,kS=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,US=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,NS=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,GS=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,zS=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,WS=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,HS=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,VS=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,XS=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,KS=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,jS=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,YS=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,$S=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,qS=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,ZS=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,JS=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,QS=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,t1=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const e1=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,i1=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,r1=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,n1=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,s1=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,a1=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,o1=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,l1=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,h1=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,u1=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,c1=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,d1=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,f1=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,p1=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,m1=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,g1=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_1=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,v1=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,x1=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,y1=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,E1=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,T1=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,b1=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,S1=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,w1=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,A1=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,M1=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,C1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,L1=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,D1=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,R1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,P1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,oe={alphamap_fragment:rb,alphamap_pars_fragment:nb,alphatest_fragment:sb,alphatest_pars_fragment:ab,aomap_fragment:ob,aomap_pars_fragment:lb,begin_vertex:hb,beginnormal_vertex:ub,bsdfs:cb,iridescence_fragment:db,bumpmap_pars_fragment:fb,clipping_planes_fragment:pb,clipping_planes_pars_fragment:mb,clipping_planes_pars_vertex:gb,clipping_planes_vertex:_b,color_fragment:vb,color_pars_fragment:xb,color_pars_vertex:yb,color_vertex:Eb,common:Tb,cube_uv_reflection_fragment:bb,defaultnormal_vertex:Sb,displacementmap_pars_vertex:wb,displacementmap_vertex:Ab,emissivemap_fragment:Mb,emissivemap_pars_fragment:Cb,encodings_fragment:Lb,encodings_pars_fragment:Db,envmap_fragment:Rb,envmap_common_pars_fragment:Pb,envmap_pars_fragment:Ib,envmap_pars_vertex:Ob,envmap_physical_pars_fragment:Kb,envmap_vertex:Fb,fog_vertex:Bb,fog_pars_vertex:kb,fog_fragment:Ub,fog_pars_fragment:Nb,gradientmap_pars_fragment:Gb,lightmap_fragment:zb,lightmap_pars_fragment:Wb,lights_lambert_fragment:Hb,lights_lambert_pars_fragment:Vb,lights_pars_begin:Xb,lights_toon_fragment:jb,lights_toon_pars_fragment:Yb,lights_phong_fragment:$b,lights_phong_pars_fragment:qb,lights_physical_fragment:Zb,lights_physical_pars_fragment:Jb,lights_fragment_begin:Qb,lights_fragment_maps:tS,lights_fragment_end:eS,logdepthbuf_fragment:iS,logdepthbuf_pars_fragment:rS,logdepthbuf_pars_vertex:nS,logdepthbuf_vertex:sS,map_fragment:aS,map_pars_fragment:oS,map_particle_fragment:lS,map_particle_pars_fragment:hS,metalnessmap_fragment:uS,metalnessmap_pars_fragment:cS,morphcolor_vertex:dS,morphnormal_vertex:fS,morphtarget_pars_vertex:pS,morphtarget_vertex:mS,normal_fragment_begin:gS,normal_fragment_maps:_S,normal_pars_fragment:vS,normal_pars_vertex:xS,normal_vertex:yS,normalmap_pars_fragment:ES,clearcoat_normal_fragment_begin:TS,clearcoat_normal_fragment_maps:bS,clearcoat_pars_fragment:SS,iridescence_pars_fragment:wS,output_fragment:AS,packing:MS,premultiplied_alpha_fragment:CS,project_vertex:LS,dithering_fragment:DS,dithering_pars_fragment:RS,roughnessmap_fragment:PS,roughnessmap_pars_fragment:IS,shadowmap_pars_fragment:OS,shadowmap_pars_vertex:FS,shadowmap_vertex:BS,shadowmask_pars_fragment:kS,skinbase_vertex:US,skinning_pars_vertex:NS,skinning_vertex:GS,skinnormal_vertex:zS,specularmap_fragment:WS,specularmap_pars_fragment:HS,tonemapping_fragment:VS,tonemapping_pars_fragment:XS,transmission_fragment:KS,transmission_pars_fragment:jS,uv_pars_fragment:YS,uv_pars_vertex:$S,uv_vertex:qS,uv2_pars_fragment:ZS,uv2_pars_vertex:JS,uv2_vertex:QS,worldpos_vertex:t1,background_vert:e1,background_frag:i1,cube_vert:r1,cube_frag:n1,depth_vert:s1,depth_frag:a1,distanceRGBA_vert:o1,distanceRGBA_frag:l1,equirect_vert:h1,equirect_frag:u1,linedashed_vert:c1,linedashed_frag:d1,meshbasic_vert:f1,meshbasic_frag:p1,meshlambert_vert:m1,meshlambert_frag:g1,meshmatcap_vert:_1,meshmatcap_frag:v1,meshnormal_vert:x1,meshnormal_frag:y1,meshphong_vert:E1,meshphong_frag:T1,meshphysical_vert:b1,meshphysical_frag:S1,meshtoon_vert:w1,meshtoon_frag:A1,points_vert:M1,points_frag:C1,shadow_vert:L1,shadow_frag:D1,sprite_vert:R1,sprite_frag:P1},Ct={common:{diffuse:{value:new Me(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ar},uv2Transform:{value:new ar},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ae(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Me(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Me(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ar}},sprite:{diffuse:{value:new Me(16777215)},opacity:{value:1},center:{value:new ae(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ar}}},Dr={basic:{uniforms:ci([Ct.common,Ct.specularmap,Ct.envmap,Ct.aomap,Ct.lightmap,Ct.fog]),vertexShader:oe.meshbasic_vert,fragmentShader:oe.meshbasic_frag},lambert:{uniforms:ci([Ct.common,Ct.specularmap,Ct.envmap,Ct.aomap,Ct.lightmap,Ct.emissivemap,Ct.bumpmap,Ct.normalmap,Ct.displacementmap,Ct.fog,Ct.lights,{emissive:{value:new Me(0)}}]),vertexShader:oe.meshlambert_vert,fragmentShader:oe.meshlambert_frag},phong:{uniforms:ci([Ct.common,Ct.specularmap,Ct.envmap,Ct.aomap,Ct.lightmap,Ct.emissivemap,Ct.bumpmap,Ct.normalmap,Ct.displacementmap,Ct.fog,Ct.lights,{emissive:{value:new Me(0)},specular:{value:new Me(1118481)},shininess:{value:30}}]),vertexShader:oe.meshphong_vert,fragmentShader:oe.meshphong_frag},standard:{uniforms:ci([Ct.common,Ct.envmap,Ct.aomap,Ct.lightmap,Ct.emissivemap,Ct.bumpmap,Ct.normalmap,Ct.displacementmap,Ct.roughnessmap,Ct.metalnessmap,Ct.fog,Ct.lights,{emissive:{value:new Me(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:oe.meshphysical_vert,fragmentShader:oe.meshphysical_frag},toon:{uniforms:ci([Ct.common,Ct.aomap,Ct.lightmap,Ct.emissivemap,Ct.bumpmap,Ct.normalmap,Ct.displacementmap,Ct.gradientmap,Ct.fog,Ct.lights,{emissive:{value:new Me(0)}}]),vertexShader:oe.meshtoon_vert,fragmentShader:oe.meshtoon_frag},matcap:{uniforms:ci([Ct.common,Ct.bumpmap,Ct.normalmap,Ct.displacementmap,Ct.fog,{matcap:{value:null}}]),vertexShader:oe.meshmatcap_vert,fragmentShader:oe.meshmatcap_frag},points:{uniforms:ci([Ct.points,Ct.fog]),vertexShader:oe.points_vert,fragmentShader:oe.points_frag},dashed:{uniforms:ci([Ct.common,Ct.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:oe.linedashed_vert,fragmentShader:oe.linedashed_frag},depth:{uniforms:ci([Ct.common,Ct.displacementmap]),vertexShader:oe.depth_vert,fragmentShader:oe.depth_frag},normal:{uniforms:ci([Ct.common,Ct.bumpmap,Ct.normalmap,Ct.displacementmap,{opacity:{value:1}}]),vertexShader:oe.meshnormal_vert,fragmentShader:oe.meshnormal_frag},sprite:{uniforms:ci([Ct.sprite,Ct.fog]),vertexShader:oe.sprite_vert,fragmentShader:oe.sprite_frag},background:{uniforms:{uvTransform:{value:new ar},t2D:{value:null}},vertexShader:oe.background_vert,fragmentShader:oe.background_frag},cube:{uniforms:ci([Ct.envmap,{opacity:{value:1}}]),vertexShader:oe.cube_vert,fragmentShader:oe.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:oe.equirect_vert,fragmentShader:oe.equirect_frag},distanceRGBA:{uniforms:ci([Ct.common,Ct.displacementmap,{referencePosition:{value:new ot},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:oe.distanceRGBA_vert,fragmentShader:oe.distanceRGBA_frag},shadow:{uniforms:ci([Ct.lights,Ct.fog,{color:{value:new Me(0)},opacity:{value:1}}]),vertexShader:oe.shadow_vert,fragmentShader:oe.shadow_frag}};Dr.physical={uniforms:ci([Dr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ae(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Me(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ae},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Me(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Me(1,1,1)},specularColorMap:{value:null}}]),vertexShader:oe.meshphysical_vert,fragmentShader:oe.meshphysical_frag};function I1(r,t,e,i,n,s){const a=new Me(0);let o=n===!0?0:1,l,h,u=null,f=0,c=null;function _(d,p){let v=!1,A=p.isScene===!0?p.background:null;A&&A.isTexture&&(A=t.get(A));const E=r.xr,S=E.getSession&&E.getSession();S&&S.environmentBlendMode==="additive"&&(A=null),A===null?g(a,o):A&&A.isColor&&(g(A,1),v=!0),(r.autoClear||v)&&r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil),A&&(A.isCubeTexture||A.mapping===Eu)?(h===void 0&&(h=new Ur(new Tl(1,1,1),new yn({name:"BackgroundCubeMaterial",uniforms:oo(Dr.cube.uniforms),vertexShader:Dr.cube.vertexShader,fragmentShader:Dr.cube.fragmentShader,side:hr,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(L,T,x){this.matrixWorld.copyPosition(x.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(h)),h.material.uniforms.envMap.value=A,h.material.uniforms.flipEnvMap.value=A.isCubeTexture&&A.isRenderTargetTexture===!1?-1:1,(u!==A||f!==A.version||c!==r.toneMapping)&&(h.material.needsUpdate=!0,u=A,f=A.version,c=r.toneMapping),h.layers.enableAll(),d.unshift(h,h.geometry,h.material,0,0,null)):A&&A.isTexture&&(l===void 0&&(l=new Ur(new bl(2,2),new yn({name:"BackgroundMaterial",uniforms:oo(Dr.background.uniforms),vertexShader:Dr.background.vertexShader,fragmentShader:Dr.background.fragmentShader,side:ro,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=A,A.matrixAutoUpdate===!0&&A.updateMatrix(),l.material.uniforms.uvTransform.value.copy(A.matrix),(u!==A||f!==A.version||c!==r.toneMapping)&&(l.material.needsUpdate=!0,u=A,f=A.version,c=r.toneMapping),l.layers.enableAll(),d.unshift(l,l.geometry,l.material,0,0,null))}function g(d,p){e.buffers.color.setClear(d.r,d.g,d.b,p,s)}return{getClearColor:function(){return a},setClearColor:function(d,p=1){a.set(d),o=p,g(a,o)},getClearAlpha:function(){return o},setClearAlpha:function(d){o=d,g(a,o)},render:_}}function O1(r,t,e,i){const n=r.getParameter(34921),s=i.isWebGL2?null:t.get("OES_vertex_array_object"),a=i.isWebGL2||s!==null,o={},l=p(null);let h=l,u=!1;function f(D,O,B,P,F){let I=!1;if(a){const y=d(P,B,O);h!==y&&(h=y,_(h.object)),I=v(D,P,B,F),I&&A(D,P,B,F)}else{const y=O.wireframe===!0;(h.geometry!==P.id||h.program!==B.id||h.wireframe!==y)&&(h.geometry=P.id,h.program=B.id,h.wireframe=y,I=!0)}F!==null&&e.update(F,34963),(I||u)&&(u=!1,m(D,O,B,P),F!==null&&r.bindBuffer(34963,e.get(F).buffer))}function c(){return i.isWebGL2?r.createVertexArray():s.createVertexArrayOES()}function _(D){return i.isWebGL2?r.bindVertexArray(D):s.bindVertexArrayOES(D)}function g(D){return i.isWebGL2?r.deleteVertexArray(D):s.deleteVertexArrayOES(D)}function d(D,O,B){const P=B.wireframe===!0;let F=o[D.id];F===void 0&&(F={},o[D.id]=F);let I=F[O.id];I===void 0&&(I={},F[O.id]=I);let y=I[P];return y===void 0&&(y=p(c()),I[P]=y),y}function p(D){const O=[],B=[],P=[];for(let F=0;F<n;F++)O[F]=0,B[F]=0,P[F]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:O,enabledAttributes:B,attributeDivisors:P,object:D,attributes:{},index:null}}function v(D,O,B,P){const F=h.attributes,I=O.attributes;let y=0;const k=B.getAttributes();for(const U in k)if(k[U].location>=0){const W=F[U];let G=I[U];if(G===void 0&&(U==="instanceMatrix"&&D.instanceMatrix&&(G=D.instanceMatrix),U==="instanceColor"&&D.instanceColor&&(G=D.instanceColor)),W===void 0||W.attribute!==G||G&&W.data!==G.data)return!0;y++}return h.attributesNum!==y||h.index!==P}function A(D,O,B,P){const F={},I=O.attributes;let y=0;const k=B.getAttributes();for(const U in k)if(k[U].location>=0){let W=I[U];W===void 0&&(U==="instanceMatrix"&&D.instanceMatrix&&(W=D.instanceMatrix),U==="instanceColor"&&D.instanceColor&&(W=D.instanceColor));const G={};G.attribute=W,W&&W.data&&(G.data=W.data),F[U]=G,y++}h.attributes=F,h.attributesNum=y,h.index=P}function E(){const D=h.newAttributes;for(let O=0,B=D.length;O<B;O++)D[O]=0}function S(D){L(D,0)}function L(D,O){const B=h.newAttributes,P=h.enabledAttributes,F=h.attributeDivisors;B[D]=1,P[D]===0&&(r.enableVertexAttribArray(D),P[D]=1),F[D]!==O&&((i.isWebGL2?r:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](D,O),F[D]=O)}function T(){const D=h.newAttributes,O=h.enabledAttributes;for(let B=0,P=O.length;B<P;B++)O[B]!==D[B]&&(r.disableVertexAttribArray(B),O[B]=0)}function x(D,O,B,P,F,I){i.isWebGL2===!0&&(B===5124||B===5125)?r.vertexAttribIPointer(D,O,B,F,I):r.vertexAttribPointer(D,O,B,P,F,I)}function m(D,O,B,P){if(i.isWebGL2===!1&&(D.isInstancedMesh||P.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;E();const F=P.attributes,I=B.getAttributes(),y=O.defaultAttributeValues;for(const k in I){const U=I[k];if(U.location>=0){let N=F[k];if(N===void 0&&(k==="instanceMatrix"&&D.instanceMatrix&&(N=D.instanceMatrix),k==="instanceColor"&&D.instanceColor&&(N=D.instanceColor)),N!==void 0){const W=N.normalized,G=N.itemSize,z=e.get(N);if(z===void 0)continue;const X=z.buffer,K=z.type,$=z.bytesPerElement;if(N.isInterleavedBufferAttribute){const q=N.data,J=q.stride,Q=N.offset;if(q.isInstancedInterleavedBuffer){for(let rt=0;rt<U.locationSize;rt++)L(U.location+rt,q.meshPerAttribute);D.isInstancedMesh!==!0&&P._maxInstanceCount===void 0&&(P._maxInstanceCount=q.meshPerAttribute*q.count)}else for(let rt=0;rt<U.locationSize;rt++)S(U.location+rt);r.bindBuffer(34962,X);for(let rt=0;rt<U.locationSize;rt++)x(U.location+rt,G/U.locationSize,K,W,J*$,(Q+G/U.locationSize*rt)*$)}else{if(N.isInstancedBufferAttribute){for(let q=0;q<U.locationSize;q++)L(U.location+q,N.meshPerAttribute);D.isInstancedMesh!==!0&&P._maxInstanceCount===void 0&&(P._maxInstanceCount=N.meshPerAttribute*N.count)}else for(let q=0;q<U.locationSize;q++)S(U.location+q);r.bindBuffer(34962,X);for(let q=0;q<U.locationSize;q++)x(U.location+q,G/U.locationSize,K,W,G*$,G/U.locationSize*q*$)}}else if(y!==void 0){const W=y[k];if(W!==void 0)switch(W.length){case 2:r.vertexAttrib2fv(U.location,W);break;case 3:r.vertexAttrib3fv(U.location,W);break;case 4:r.vertexAttrib4fv(U.location,W);break;default:r.vertexAttrib1fv(U.location,W)}}}}T()}function w(){C();for(const D in o){const O=o[D];for(const B in O){const P=O[B];for(const F in P)g(P[F].object),delete P[F];delete O[B]}delete o[D]}}function R(D){if(o[D.id]===void 0)return;const O=o[D.id];for(const B in O){const P=O[B];for(const F in P)g(P[F].object),delete P[F];delete O[B]}delete o[D.id]}function M(D){for(const O in o){const B=o[O];if(B[D.id]===void 0)continue;const P=B[D.id];for(const F in P)g(P[F].object),delete P[F];delete B[D.id]}}function C(){b(),u=!0,h!==l&&(h=l,_(h.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:f,reset:C,resetDefaultState:b,dispose:w,releaseStatesOfGeometry:R,releaseStatesOfProgram:M,initAttributes:E,enableAttribute:S,disableUnusedAttributes:T}}function F1(r,t,e,i){const n=i.isWebGL2;let s;function a(h){s=h}function o(h,u){r.drawArrays(s,h,u),e.update(u,s,1)}function l(h,u,f){if(f===0)return;let c,_;if(n)c=r,_="drawArraysInstanced";else if(c=t.get("ANGLE_instanced_arrays"),_="drawArraysInstancedANGLE",c===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}c[_](s,h,u,f),e.update(u,s,f)}this.setMode=a,this.render=o,this.renderInstances=l}function B1(r,t,e){let i;function n(){if(i!==void 0)return i;if(t.has("EXT_texture_filter_anisotropic")===!0){const x=t.get("EXT_texture_filter_anisotropic");i=r.getParameter(x.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function s(x){if(x==="highp"){if(r.getShaderPrecisionFormat(35633,36338).precision>0&&r.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";x="mediump"}return x==="mediump"&&r.getShaderPrecisionFormat(35633,36337).precision>0&&r.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&r instanceof WebGL2ComputeRenderingContext;let o=e.precision!==void 0?e.precision:"highp";const l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);const h=a||t.has("WEBGL_draw_buffers"),u=e.logarithmicDepthBuffer===!0,f=r.getParameter(34930),c=r.getParameter(35660),_=r.getParameter(3379),g=r.getParameter(34076),d=r.getParameter(34921),p=r.getParameter(36347),v=r.getParameter(36348),A=r.getParameter(36349),E=c>0,S=a||t.has("OES_texture_float"),L=E&&S,T=a?r.getParameter(36183):0;return{isWebGL2:a,drawBuffers:h,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:f,maxVertexTextures:c,maxTextureSize:_,maxCubemapSize:g,maxAttributes:d,maxVertexUniforms:p,maxVaryings:v,maxFragmentUniforms:A,vertexTextures:E,floatFragmentTextures:S,floatVertexTextures:L,maxSamples:T}}function k1(r){const t=this;let e=null,i=0,n=!1,s=!1;const a=new ps,o=new ar,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(f,c,_){const g=f.length!==0||c||i!==0||n;return n=c,e=u(f,_,0),i=f.length,g},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1,h()},this.setState=function(f,c,_){const g=f.clippingPlanes,d=f.clipIntersection,p=f.clipShadows,v=r.get(f);if(!n||g===null||g.length===0||s&&!p)s?u(null):h();else{const A=s?0:i,E=A*4;let S=v.clippingState||null;l.value=S,S=u(g,c,E,_);for(let L=0;L!==E;++L)S[L]=e[L];v.clippingState=S,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=A}};function h(){l.value!==e&&(l.value=e,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function u(f,c,_,g){const d=f!==null?f.length:0;let p=null;if(d!==0){if(p=l.value,g!==!0||p===null){const v=_+d*4,A=c.matrixWorldInverse;o.getNormalMatrix(A),(p===null||p.length<v)&&(p=new Float32Array(v));for(let E=0,S=_;E!==d;++E,S+=4)a.copy(f[E]).applyMatrix4(A,o),a.normal.toArray(p,S),p[S+3]=a.constant}l.value=p,l.needsUpdate=!0}return t.numPlanes=d,t.numIntersection=0,p}}function U1(r){let t=new WeakMap;function e(a,o){return o===Pd?a.mapping=no:o===Id&&(a.mapping=so),a}function i(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){const o=a.mapping;if(o===Pd||o===Id)if(t.has(a)){const l=t.get(a).texture;return e(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const h=new QT(l.height/2);return h.fromEquirectangularTexture(r,a),t.set(a,h),a.addEventListener("dispose",n),e(h.texture,a.mapping)}else return null}}return a}function n(a){const o=a.target;o.removeEventListener("dispose",n);const l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:i,dispose:s}}class a0 extends i0{constructor(t=-1,e=1,i=1,n=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-t,a=i+t,o=n+e,l=n-e;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=h*this.view.offsetX,a=s+h*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}const Da=4,km=[.125,.215,.35,.446,.526,.582],bs=20,Lc=new a0,Um=new Me;let Dc=null;const ms=(1+Math.sqrt(5))/2,va=1/ms,Nm=[new ot(1,1,1),new ot(-1,1,1),new ot(1,1,-1),new ot(-1,1,-1),new ot(0,ms,va),new ot(0,ms,-va),new ot(va,0,ms),new ot(-va,0,ms),new ot(ms,va,0),new ot(-ms,va,0)];class Gm{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){Dc=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,i,n,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Hm(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Wm(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Dc),t.scissorTest=!1,sh(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===no||t.mapping===so?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Dc=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:er,minFilter:er,generateMipmaps:!1,type:sl,format:kr,encoding:Ks,depthBuffer:!1},n=zm(t,e,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=zm(t,e,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=N1(s)),this._blurMaterial=G1(s,t,e)}return n}_compileMaterial(t){const e=new Ur(this._lodPlanes[0],t);this._renderer.compile(e,Lc)}_sceneToCubeUV(t,e,i,n){const o=new ir(90,1,e,i),l=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],u=this._renderer,f=u.autoClear,c=u.toneMapping;u.getClearColor(Um),u.toneMapping=mn,u.autoClear=!1;const _=new Qv({name:"PMREM.Background",side:hr,depthWrite:!1,depthTest:!1}),g=new Ur(new Tl,_);let d=!1;const p=t.background;p?p.isColor&&(_.color.copy(p),t.background=null,d=!0):(_.color.copy(Um),d=!0);for(let v=0;v<6;v++){const A=v%3;A===0?(o.up.set(0,l[v],0),o.lookAt(h[v],0,0)):A===1?(o.up.set(0,0,l[v]),o.lookAt(0,h[v],0)):(o.up.set(0,l[v],0),o.lookAt(0,0,h[v]));const E=this._cubeSize;sh(n,A*E,v>2?E:0,E,E),u.setRenderTarget(n),d&&u.render(g,o),u.render(t,o)}g.geometry.dispose(),g.material.dispose(),u.toneMapping=c,u.autoClear=f,t.background=p}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===no||t.mapping===so;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=Hm()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Wm());const s=n?this._cubemapMaterial:this._equirectMaterial,a=new Ur(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=t;const l=this._cubeSize;sh(e,0,0,3*l,2*l),i.setRenderTarget(e),i.render(a,Lc)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){const s=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),a=Nm[(n-1)%Nm.length];this._blur(t,n-1,n,s,a)}e.autoClear=i}_blur(t,e,i,n,s){const a=this._pingPongRenderTarget;this._halfBlur(t,a,e,i,n,"latitudinal",s),this._halfBlur(a,t,i,i,n,"longitudinal",s)}_halfBlur(t,e,i,n,s,a,o){const l=this._renderer,h=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,f=new Ur(this._lodPlanes[n],h),c=h.uniforms,_=this._sizeLods[i]-1,g=isFinite(s)?Math.PI/(2*_):2*Math.PI/(2*bs-1),d=s/g,p=isFinite(s)?1+Math.floor(u*d):bs;p>bs&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${p} samples when the maximum is set to ${bs}`);const v=[];let A=0;for(let x=0;x<bs;++x){const m=x/d,w=Math.exp(-m*m/2);v.push(w),x===0?A+=w:x<p&&(A+=2*w)}for(let x=0;x<v.length;x++)v[x]=v[x]/A;c.envMap.value=t.texture,c.samples.value=p,c.weights.value=v,c.latitudinal.value=a==="latitudinal",o&&(c.poleAxis.value=o);const{_lodMax:E}=this;c.dTheta.value=g,c.mipInt.value=E-i;const S=this._sizeLods[n],L=3*S*(n>E-Da?n-E+Da:0),T=4*(this._cubeSize-S);sh(e,L,T,3*S,2*S),l.setRenderTarget(e),l.render(f,Lc)}}function N1(r){const t=[],e=[],i=[];let n=r;const s=r-Da+1+km.length;for(let a=0;a<s;a++){const o=Math.pow(2,n);e.push(o);let l=1/o;a>r-Da?l=km[a-r+Da-1]:a===0&&(l=0),i.push(l);const h=1/(o-2),u=-h,f=1+h,c=[u,u,f,u,f,f,u,u,f,f,u,f],_=6,g=6,d=3,p=2,v=1,A=new Float32Array(d*g*_),E=new Float32Array(p*g*_),S=new Float32Array(v*g*_);for(let T=0;T<_;T++){const x=T%3*2/3-1,m=T>2?0:-1,w=[x,m,0,x+2/3,m,0,x+2/3,m+1,0,x,m,0,x+2/3,m+1,0,x,m+1,0];A.set(w,d*g*T),E.set(c,p*g*T);const R=[T,T,T,T,T,T];S.set(R,v*g*T)}const L=new Js;L.setAttribute("position",new Wr(A,d)),L.setAttribute("uv",new Wr(E,p)),L.setAttribute("faceIndex",new Wr(S,v)),t.push(L),n>Da&&n--}return{lodPlanes:t,sizeLods:e,sigmas:i}}function zm(r,t,e){const i=new Yn(r,t,e);return i.texture.mapping=Eu,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function sh(r,t,e,i,n){r.viewport.set(t,e,i,n),r.scissor.set(t,e,i,n)}function G1(r,t,e){const i=new Float32Array(bs),n=new ot(0,1,0);return new yn({name:"SphericalGaussianBlur",defines:{n:bs,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:Wf(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Hn,depthTest:!1,depthWrite:!1})}function Wm(){return new yn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Wf(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Hn,depthTest:!1,depthWrite:!1})}function Hm(){return new yn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Wf(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Hn,depthTest:!1,depthWrite:!1})}function Wf(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function z1(r){let t=new WeakMap,e=null;function i(o){if(o&&o.isTexture){const l=o.mapping,h=l===Pd||l===Id,u=l===no||l===so;if(h||u)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let f=t.get(o);return e===null&&(e=new Gm(r)),f=h?e.fromEquirectangular(o,f):e.fromCubemap(o,f),t.set(o,f),f.texture}else{if(t.has(o))return t.get(o).texture;{const f=o.image;if(h&&f&&f.height>0||u&&f&&n(f)){e===null&&(e=new Gm(r));const c=h?e.fromEquirectangular(o):e.fromCubemap(o);return t.set(o,c),o.addEventListener("dispose",s),c.texture}else return null}}}return o}function n(o){let l=0;const h=6;for(let u=0;u<h;u++)o[u]!==void 0&&l++;return l===h}function s(o){const l=o.target;l.removeEventListener("dispose",s);const h=t.get(l);h!==void 0&&(t.delete(l),h.dispose())}function a(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:i,dispose:a}}function W1(r){const t={};function e(i){if(t[i]!==void 0)return t[i];let n;switch(i){case"WEBGL_depth_texture":n=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=r.getExtension(i)}return t[i]=n,n}return{has:function(i){return e(i)!==null},init:function(i){i.isWebGL2?e("EXT_color_buffer_float"):(e("WEBGL_depth_texture"),e("OES_texture_float"),e("OES_texture_half_float"),e("OES_texture_half_float_linear"),e("OES_standard_derivatives"),e("OES_element_index_uint"),e("OES_vertex_array_object"),e("ANGLE_instanced_arrays")),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture")},get:function(i){const n=e(i);return n===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),n}}}function H1(r,t,e,i){const n={},s=new WeakMap;function a(f){const c=f.target;c.index!==null&&t.remove(c.index);for(const g in c.attributes)t.remove(c.attributes[g]);c.removeEventListener("dispose",a),delete n[c.id];const _=s.get(c);_&&(t.remove(_),s.delete(c)),i.releaseStatesOfGeometry(c),c.isInstancedBufferGeometry===!0&&delete c._maxInstanceCount,e.memory.geometries--}function o(f,c){return n[c.id]===!0||(c.addEventListener("dispose",a),n[c.id]=!0,e.memory.geometries++),c}function l(f){const c=f.attributes;for(const g in c)t.update(c[g],34962);const _=f.morphAttributes;for(const g in _){const d=_[g];for(let p=0,v=d.length;p<v;p++)t.update(d[p],34962)}}function h(f){const c=[],_=f.index,g=f.attributes.position;let d=0;if(_!==null){const A=_.array;d=_.version;for(let E=0,S=A.length;E<S;E+=3){const L=A[E+0],T=A[E+1],x=A[E+2];c.push(L,T,T,x,x,L)}}else{const A=g.array;d=g.version;for(let E=0,S=A.length/3-1;E<S;E+=3){const L=E+0,T=E+1,x=E+2;c.push(L,T,T,x,x,L)}}const p=new(jv(c)?e0:t0)(c,1);p.version=d;const v=s.get(f);v&&t.remove(v),s.set(f,p)}function u(f){const c=s.get(f);if(c){const _=f.index;_!==null&&c.version<_.version&&h(f)}else h(f);return s.get(f)}return{get:o,update:l,getWireframeAttribute:u}}function V1(r,t,e,i){const n=i.isWebGL2;let s;function a(c){s=c}let o,l;function h(c){o=c.type,l=c.bytesPerElement}function u(c,_){r.drawElements(s,_,o,c*l),e.update(_,s,1)}function f(c,_,g){if(g===0)return;let d,p;if(n)d=r,p="drawElementsInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawElementsInstancedANGLE",d===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](s,_,o,c*l,g),e.update(_,s,g)}this.setMode=a,this.setIndex=h,this.render=u,this.renderInstances=f}function X1(r){const t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,a,o){switch(e.calls++,a){case 4:e.triangles+=o*(s/3);break;case 1:e.lines+=o*(s/2);break;case 3:e.lines+=o*(s-1);break;case 2:e.lines+=o*s;break;case 0:e.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:n,update:i}}function K1(r,t){return r[0]-t[0]}function j1(r,t){return Math.abs(t[1])-Math.abs(r[1])}function Y1(r,t,e){const i={},n=new Float32Array(8),s=new WeakMap,a=new Qe,o=[];for(let h=0;h<8;h++)o[h]=[h,0];function l(h,u,f,c){const _=h.morphTargetInfluences;if(t.isWebGL2===!0){const d=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,p=d!==void 0?d.length:0;let v=s.get(u);if(v===void 0||v.count!==p){let B=function(){D.dispose(),s.delete(u),u.removeEventListener("dispose",B)};var g=B;v!==void 0&&v.texture.dispose();const S=u.morphAttributes.position!==void 0,L=u.morphAttributes.normal!==void 0,T=u.morphAttributes.color!==void 0,x=u.morphAttributes.position||[],m=u.morphAttributes.normal||[],w=u.morphAttributes.color||[];let R=0;S===!0&&(R=1),L===!0&&(R=2),T===!0&&(R=3);let M=u.attributes.position.count*R,C=1;M>t.maxTextureSize&&(C=Math.ceil(M/t.maxTextureSize),M=t.maxTextureSize);const b=new Float32Array(M*C*4*p),D=new Zv(b,M,C,p);D.type=Ms,D.needsUpdate=!0;const O=R*4;for(let P=0;P<p;P++){const F=x[P],I=m[P],y=w[P],k=M*C*4*P;for(let U=0;U<F.count;U++){const N=U*O;S===!0&&(a.fromBufferAttribute(F,U),b[k+N+0]=a.x,b[k+N+1]=a.y,b[k+N+2]=a.z,b[k+N+3]=0),L===!0&&(a.fromBufferAttribute(I,U),b[k+N+4]=a.x,b[k+N+5]=a.y,b[k+N+6]=a.z,b[k+N+7]=0),T===!0&&(a.fromBufferAttribute(y,U),b[k+N+8]=a.x,b[k+N+9]=a.y,b[k+N+10]=a.z,b[k+N+11]=y.itemSize===4?a.w:1)}}v={count:p,texture:D,size:new ae(M,C)},s.set(u,v),u.addEventListener("dispose",B)}let A=0;for(let S=0;S<_.length;S++)A+=_[S];const E=u.morphTargetsRelative?1:1-A;c.getUniforms().setValue(r,"morphTargetBaseInfluence",E),c.getUniforms().setValue(r,"morphTargetInfluences",_),c.getUniforms().setValue(r,"morphTargetsTexture",v.texture,e),c.getUniforms().setValue(r,"morphTargetsTextureSize",v.size)}else{const d=_===void 0?0:_.length;let p=i[u.id];if(p===void 0||p.length!==d){p=[];for(let L=0;L<d;L++)p[L]=[L,0];i[u.id]=p}for(let L=0;L<d;L++){const T=p[L];T[0]=L,T[1]=_[L]}p.sort(j1);for(let L=0;L<8;L++)L<d&&p[L][1]?(o[L][0]=p[L][0],o[L][1]=p[L][1]):(o[L][0]=Number.MAX_SAFE_INTEGER,o[L][1]=0);o.sort(K1);const v=u.morphAttributes.position,A=u.morphAttributes.normal;let E=0;for(let L=0;L<8;L++){const T=o[L],x=T[0],m=T[1];x!==Number.MAX_SAFE_INTEGER&&m?(v&&u.getAttribute("morphTarget"+L)!==v[x]&&u.setAttribute("morphTarget"+L,v[x]),A&&u.getAttribute("morphNormal"+L)!==A[x]&&u.setAttribute("morphNormal"+L,A[x]),n[L]=m,E+=m):(v&&u.hasAttribute("morphTarget"+L)===!0&&u.deleteAttribute("morphTarget"+L),A&&u.hasAttribute("morphNormal"+L)===!0&&u.deleteAttribute("morphNormal"+L),n[L]=0)}const S=u.morphTargetsRelative?1:1-E;c.getUniforms().setValue(r,"morphTargetBaseInfluence",S),c.getUniforms().setValue(r,"morphTargetInfluences",n)}}return{update:l}}function $1(r,t,e,i){let n=new WeakMap;function s(l){const h=i.render.frame,u=l.geometry,f=t.get(l,u);return n.get(f)!==h&&(t.update(f),n.set(f,h)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),e.update(l.instanceMatrix,34962),l.instanceColor!==null&&e.update(l.instanceColor,34962)),f}function a(){n=new WeakMap}function o(l){const h=l.target;h.removeEventListener("dispose",o),e.remove(h.instanceMatrix),h.instanceColor!==null&&e.remove(h.instanceColor)}return{update:s,dispose:a}}const o0=new Mr,l0=new Zv,h0=new BT,u0=new r0,Vm=[],Xm=[],Km=new Float32Array(16),jm=new Float32Array(9),Ym=new Float32Array(4);function ho(r,t,e){const i=r[0];if(i<=0||i>0)return r;const n=t*e;let s=Vm[n];if(s===void 0&&(s=new Float32Array(n),Vm[n]=s),t!==0){i.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=e,r[a].toArray(s,o)}return s}function $e(r,t){if(r.length!==t.length)return!1;for(let e=0,i=r.length;e<i;e++)if(r[e]!==t[e])return!1;return!0}function qe(r,t){for(let e=0,i=t.length;e<i;e++)r[e]=t[e]}function Su(r,t){let e=Xm[t];e===void 0&&(e=new Int32Array(t),Xm[t]=e);for(let i=0;i!==t;++i)e[i]=r.allocateTextureUnit();return e}function q1(r,t){const e=this.cache;e[0]!==t&&(r.uniform1f(this.addr,t),e[0]=t)}function Z1(r,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(r.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if($e(e,t))return;r.uniform2fv(this.addr,t),qe(e,t)}}function J1(r,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(r.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(r.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if($e(e,t))return;r.uniform3fv(this.addr,t),qe(e,t)}}function Q1(r,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(r.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if($e(e,t))return;r.uniform4fv(this.addr,t),qe(e,t)}}function tw(r,t){const e=this.cache,i=t.elements;if(i===void 0){if($e(e,t))return;r.uniformMatrix2fv(this.addr,!1,t),qe(e,t)}else{if($e(e,i))return;Ym.set(i),r.uniformMatrix2fv(this.addr,!1,Ym),qe(e,i)}}function ew(r,t){const e=this.cache,i=t.elements;if(i===void 0){if($e(e,t))return;r.uniformMatrix3fv(this.addr,!1,t),qe(e,t)}else{if($e(e,i))return;jm.set(i),r.uniformMatrix3fv(this.addr,!1,jm),qe(e,i)}}function iw(r,t){const e=this.cache,i=t.elements;if(i===void 0){if($e(e,t))return;r.uniformMatrix4fv(this.addr,!1,t),qe(e,t)}else{if($e(e,i))return;Km.set(i),r.uniformMatrix4fv(this.addr,!1,Km),qe(e,i)}}function rw(r,t){const e=this.cache;e[0]!==t&&(r.uniform1i(this.addr,t),e[0]=t)}function nw(r,t){const e=this.cache;$e(e,t)||(r.uniform2iv(this.addr,t),qe(e,t))}function sw(r,t){const e=this.cache;$e(e,t)||(r.uniform3iv(this.addr,t),qe(e,t))}function aw(r,t){const e=this.cache;$e(e,t)||(r.uniform4iv(this.addr,t),qe(e,t))}function ow(r,t){const e=this.cache;e[0]!==t&&(r.uniform1ui(this.addr,t),e[0]=t)}function lw(r,t){const e=this.cache;$e(e,t)||(r.uniform2uiv(this.addr,t),qe(e,t))}function hw(r,t){const e=this.cache;$e(e,t)||(r.uniform3uiv(this.addr,t),qe(e,t))}function uw(r,t){const e=this.cache;$e(e,t)||(r.uniform4uiv(this.addr,t),qe(e,t))}function cw(r,t,e){const i=this.cache,n=e.allocateTextureUnit();i[0]!==n&&(r.uniform1i(this.addr,n),i[0]=n),e.setTexture2D(t||o0,n)}function dw(r,t,e){const i=this.cache,n=e.allocateTextureUnit();i[0]!==n&&(r.uniform1i(this.addr,n),i[0]=n),e.setTexture3D(t||h0,n)}function fw(r,t,e){const i=this.cache,n=e.allocateTextureUnit();i[0]!==n&&(r.uniform1i(this.addr,n),i[0]=n),e.setTextureCube(t||u0,n)}function pw(r,t,e){const i=this.cache,n=e.allocateTextureUnit();i[0]!==n&&(r.uniform1i(this.addr,n),i[0]=n),e.setTexture2DArray(t||l0,n)}function mw(r){switch(r){case 5126:return q1;case 35664:return Z1;case 35665:return J1;case 35666:return Q1;case 35674:return tw;case 35675:return ew;case 35676:return iw;case 5124:case 35670:return rw;case 35667:case 35671:return nw;case 35668:case 35672:return sw;case 35669:case 35673:return aw;case 5125:return ow;case 36294:return lw;case 36295:return hw;case 36296:return uw;case 35678:case 36198:case 36298:case 36306:case 35682:return cw;case 35679:case 36299:case 36307:return dw;case 35680:case 36300:case 36308:case 36293:return fw;case 36289:case 36303:case 36311:case 36292:return pw}}function gw(r,t){r.uniform1fv(this.addr,t)}function _w(r,t){const e=ho(t,this.size,2);r.uniform2fv(this.addr,e)}function vw(r,t){const e=ho(t,this.size,3);r.uniform3fv(this.addr,e)}function xw(r,t){const e=ho(t,this.size,4);r.uniform4fv(this.addr,e)}function yw(r,t){const e=ho(t,this.size,4);r.uniformMatrix2fv(this.addr,!1,e)}function Ew(r,t){const e=ho(t,this.size,9);r.uniformMatrix3fv(this.addr,!1,e)}function Tw(r,t){const e=ho(t,this.size,16);r.uniformMatrix4fv(this.addr,!1,e)}function bw(r,t){r.uniform1iv(this.addr,t)}function Sw(r,t){r.uniform2iv(this.addr,t)}function ww(r,t){r.uniform3iv(this.addr,t)}function Aw(r,t){r.uniform4iv(this.addr,t)}function Mw(r,t){r.uniform1uiv(this.addr,t)}function Cw(r,t){r.uniform2uiv(this.addr,t)}function Lw(r,t){r.uniform3uiv(this.addr,t)}function Dw(r,t){r.uniform4uiv(this.addr,t)}function Rw(r,t,e){const i=this.cache,n=t.length,s=Su(e,n);$e(i,s)||(r.uniform1iv(this.addr,s),qe(i,s));for(let a=0;a!==n;++a)e.setTexture2D(t[a]||o0,s[a])}function Pw(r,t,e){const i=this.cache,n=t.length,s=Su(e,n);$e(i,s)||(r.uniform1iv(this.addr,s),qe(i,s));for(let a=0;a!==n;++a)e.setTexture3D(t[a]||h0,s[a])}function Iw(r,t,e){const i=this.cache,n=t.length,s=Su(e,n);$e(i,s)||(r.uniform1iv(this.addr,s),qe(i,s));for(let a=0;a!==n;++a)e.setTextureCube(t[a]||u0,s[a])}function Ow(r,t,e){const i=this.cache,n=t.length,s=Su(e,n);$e(i,s)||(r.uniform1iv(this.addr,s),qe(i,s));for(let a=0;a!==n;++a)e.setTexture2DArray(t[a]||l0,s[a])}function Fw(r){switch(r){case 5126:return gw;case 35664:return _w;case 35665:return vw;case 35666:return xw;case 35674:return yw;case 35675:return Ew;case 35676:return Tw;case 5124:case 35670:return bw;case 35667:case 35671:return Sw;case 35668:case 35672:return ww;case 35669:case 35673:return Aw;case 5125:return Mw;case 36294:return Cw;case 36295:return Lw;case 36296:return Dw;case 35678:case 36198:case 36298:case 36306:case 35682:return Rw;case 35679:case 36299:case 36307:return Pw;case 35680:case 36300:case 36308:case 36293:return Iw;case 36289:case 36303:case 36311:case 36292:return Ow}}class Bw{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=mw(e.type)}}class kw{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=Fw(e.type)}}class Uw{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){const n=this.seq;for(let s=0,a=n.length;s!==a;++s){const o=n[s];o.setValue(t,e[o.id],i)}}}const Rc=/(\w+)(\])?(\[|\.)?/g;function $m(r,t){r.seq.push(t),r.map[t.id]=t}function Nw(r,t,e){const i=r.name,n=i.length;for(Rc.lastIndex=0;;){const s=Rc.exec(i),a=Rc.lastIndex;let o=s[1];const l=s[2]==="]",h=s[3];if(l&&(o=o|0),h===void 0||h==="["&&a+2===n){$m(e,h===void 0?new Bw(o,r,t):new kw(o,r,t));break}else{let f=e.map[o];f===void 0&&(f=new Uw(o),$m(e,f)),e=f}}}class kh{constructor(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,35718);for(let n=0;n<i;++n){const s=t.getActiveUniform(e,n),a=t.getUniformLocation(e,s.name);Nw(s,a,this)}}setValue(t,e,i,n){const s=this.map[e];s!==void 0&&s.setValue(t,i,n)}setOptional(t,e,i){const n=e[i];n!==void 0&&this.setValue(t,i,n)}static upload(t,e,i,n){for(let s=0,a=e.length;s!==a;++s){const o=e[s],l=i[o.id];l.needsUpdate!==!1&&o.setValue(t,l.value,n)}}static seqWithValue(t,e){const i=[];for(let n=0,s=t.length;n!==s;++n){const a=t[n];a.id in e&&i.push(a)}return i}}function qm(r,t,e){const i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}let Gw=0;function zw(r,t){const e=r.split(`
`),i=[],n=Math.max(t-6,0),s=Math.min(t+6,e.length);for(let a=n;a<s;a++){const o=a+1;i.push(`${o===t?">":" "} ${o}: ${e[a]}`)}return i.join(`
`)}function Ww(r){switch(r){case Ks:return["Linear","( value )"];case Pe:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",r),["Linear","( value )"]}}function Zm(r,t,e){const i=r.getShaderParameter(t,35713),n=r.getShaderInfoLog(t).trim();if(i&&n==="")return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const a=parseInt(s[1]);return e.toUpperCase()+`

`+n+`

`+zw(r.getShaderSource(t),a)}else return n}function Hw(r,t){const e=Ww(t);return"vec4 "+r+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function Vw(r,t){let e;switch(t){case lT:e="Linear";break;case hT:e="Reinhard";break;case uT:e="OptimizedCineon";break;case cT:e="ACESFilmic";break;case dT:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+r+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function Xw(r){return[r.extensionDerivatives||!!r.envMapCubeUVHeight||r.bumpMap||r.tangentSpaceNormalMap||r.clearcoatNormalMap||r.flatShading||r.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(r.extensionFragDepth||r.logarithmicDepthBuffer)&&r.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",r.extensionDrawBuffers&&r.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(r.extensionShaderTextureLOD||r.envMap||r.transmission)&&r.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Po).join(`
`)}function Kw(r){const t=[];for(const e in r){const i=r[e];i!==!1&&t.push("#define "+e+" "+i)}return t.join(`
`)}function jw(r,t){const e={},i=r.getProgramParameter(t,35721);for(let n=0;n<i;n++){const s=r.getActiveAttrib(t,n),a=s.name;let o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),e[a]={type:s.type,location:r.getAttribLocation(t,a),locationSize:o}}return e}function Po(r){return r!==""}function Jm(r,t){const e=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,e).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Qm(r,t){return r.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Yw=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ud(r){return r.replace(Yw,$w)}function $w(r,t){const e=oe[t];if(e===void 0)throw new Error("Can not resolve #include <"+t+">");return Ud(e)}const qw=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function tg(r){return r.replace(qw,Zw)}function Zw(r,t,e,i){let n="";for(let s=parseInt(t);s<parseInt(e);s++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function eg(r){let t="precision "+r.precision+` float;
precision `+r.precision+" int;";return r.precision==="highp"?t+=`
#define HIGH_PRECISION`:r.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function Jw(r){let t="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===zv?t="SHADOWMAP_TYPE_PCF":r.shadowMapType===GE?t="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===Ro&&(t="SHADOWMAP_TYPE_VSM"),t}function Qw(r){let t="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case no:case so:t="ENVMAP_TYPE_CUBE";break;case Eu:t="ENVMAP_TYPE_CUBE_UV";break}return t}function tA(r){let t="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case so:t="ENVMAP_MODE_REFRACTION";break}return t}function eA(r){let t="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case Vv:t="ENVMAP_BLENDING_MULTIPLY";break;case aT:t="ENVMAP_BLENDING_MIX";break;case oT:t="ENVMAP_BLENDING_ADD";break}return t}function iA(r){const t=r.envMapCubeUVHeight;if(t===null)return null;const e=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:i,maxMip:e}}function rA(r,t,e,i){const n=r.getContext(),s=e.defines;let a=e.vertexShader,o=e.fragmentShader;const l=Jw(e),h=Qw(e),u=tA(e),f=eA(e),c=iA(e),_=e.isWebGL2?"":Xw(e),g=Kw(s),d=n.createProgram();let p,v,A=e.glslVersion?"#version "+e.glslVersion+`
`:"";e.isRawShaderMaterial?(p=[g].filter(Po).join(`
`),p.length>0&&(p+=`
`),v=[_,g].filter(Po).join(`
`),v.length>0&&(v+=`
`)):(p=[eg(e),"#define SHADER_NAME "+e.shaderName,g,e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.supportsVertexTextures?"#define VERTEX_TEXTURES":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+u:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.displacementMap&&e.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularColorMap?"#define USE_SPECULARCOLORMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEENCOLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.morphColors&&e.isWebGL2?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Po).join(`
`),v=[_,eg(e),"#define SHADER_NAME "+e.shaderName,g,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+h:"",e.envMap?"#define "+u:"",e.envMap?"#define "+f:"",c?"#define CUBEUV_TEXEL_WIDTH "+c.texelWidth:"",c?"#define CUBEUV_TEXEL_HEIGHT "+c.texelHeight:"",c?"#define CUBEUV_MAX_MIP "+c.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescence?"#define USE_IRIDESCENCE":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularColorMap?"#define USE_SPECULARCOLORMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEENCOLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==mn?"#define TONE_MAPPING":"",e.toneMapping!==mn?oe.tonemapping_pars_fragment:"",e.toneMapping!==mn?Vw("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",oe.encodings_pars_fragment,Hw("linearToOutputTexel",e.outputEncoding),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`
`].filter(Po).join(`
`)),a=Ud(a),a=Jm(a,e),a=Qm(a,e),o=Ud(o),o=Jm(o,e),o=Qm(o,e),a=tg(a),o=tg(o),e.isWebGL2&&e.isRawShaderMaterial!==!0&&(A=`#version 300 es
`,p=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+p,v=["#define varying in",e.glslVersion===bm?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===bm?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const E=A+p+a,S=A+v+o,L=qm(n,35633,E),T=qm(n,35632,S);if(n.attachShader(d,L),n.attachShader(d,T),e.index0AttributeName!==void 0?n.bindAttribLocation(d,0,e.index0AttributeName):e.morphTargets===!0&&n.bindAttribLocation(d,0,"position"),n.linkProgram(d),r.debug.checkShaderErrors){const w=n.getProgramInfoLog(d).trim(),R=n.getShaderInfoLog(L).trim(),M=n.getShaderInfoLog(T).trim();let C=!0,b=!0;if(n.getProgramParameter(d,35714)===!1){C=!1;const D=Zm(n,L,"vertex"),O=Zm(n,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(d,35715)+`

Program Info Log: `+w+`
`+D+`
`+O)}else w!==""?console.warn("THREE.WebGLProgram: Program Info Log:",w):(R===""||M==="")&&(b=!1);b&&(this.diagnostics={runnable:C,programLog:w,vertexShader:{log:R,prefix:p},fragmentShader:{log:M,prefix:v}})}n.deleteShader(L),n.deleteShader(T);let x;this.getUniforms=function(){return x===void 0&&(x=new kh(n,d)),x};let m;return this.getAttributes=function(){return m===void 0&&(m=jw(n,d)),m},this.destroy=function(){i.releaseStatesOfProgram(this),n.deleteProgram(d),this.program=void 0},this.name=e.shaderName,this.id=Gw++,this.cacheKey=t,this.usedTimes=1,this.program=d,this.vertexShader=L,this.fragmentShader=T,this}let nA=0;class sA{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),s=this._getShaderStage(i),a=this._getShaderCacheForMaterial(t);return a.has(n)===!1&&(a.add(n),n.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const i of e)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let i=e.get(t);return i===void 0&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){const e=this.shaderCache;let i=e.get(t);return i===void 0&&(i=new aA(t),e.set(t,i)),i}}class aA{constructor(t){this.id=nA++,this.code=t,this.usedTimes=0}}function oA(r,t,e,i,n,s,a){const o=new Jv,l=new sA,h=[],u=n.isWebGL2,f=n.logarithmicDepthBuffer,c=n.vertexTextures;let _=n.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function d(m,w,R,M,C){const b=M.fog,D=C.geometry,O=m.isMeshStandardMaterial?M.environment:null,B=(m.isMeshStandardMaterial?e:t).get(m.envMap||O),P=!!B&&B.mapping===Eu?B.image.height:null,F=g[m.type];m.precision!==null&&(_=n.getMaxPrecision(m.precision),_!==m.precision&&console.warn("THREE.WebGLProgram.getParameters:",m.precision,"not supported, using",_,"instead."));const I=D.morphAttributes.position||D.morphAttributes.normal||D.morphAttributes.color,y=I!==void 0?I.length:0;let k=0;D.morphAttributes.position!==void 0&&(k=1),D.morphAttributes.normal!==void 0&&(k=2),D.morphAttributes.color!==void 0&&(k=3);let U,N,W,G;if(F){const J=Dr[F];U=J.vertexShader,N=J.fragmentShader}else U=m.vertexShader,N=m.fragmentShader,l.update(m),W=l.getVertexShaderID(m),G=l.getFragmentShaderID(m);const z=r.getRenderTarget(),X=m.alphaTest>0,K=m.clearcoat>0,$=m.iridescence>0;return{isWebGL2:u,shaderID:F,shaderName:m.type,vertexShader:U,fragmentShader:N,defines:m.defines,customVertexShaderID:W,customFragmentShaderID:G,isRawShaderMaterial:m.isRawShaderMaterial===!0,glslVersion:m.glslVersion,precision:_,instancing:C.isInstancedMesh===!0,instancingColor:C.isInstancedMesh===!0&&C.instanceColor!==null,supportsVertexTextures:c,outputEncoding:z===null?r.outputEncoding:z.isXRRenderTarget===!0?z.texture.encoding:Ks,map:!!m.map,matcap:!!m.matcap,envMap:!!B,envMapMode:B&&B.mapping,envMapCubeUVHeight:P,lightMap:!!m.lightMap,aoMap:!!m.aoMap,emissiveMap:!!m.emissiveMap,bumpMap:!!m.bumpMap,normalMap:!!m.normalMap,objectSpaceNormalMap:m.normalMapType===PT,tangentSpaceNormalMap:m.normalMapType===RT,decodeVideoTexture:!!m.map&&m.map.isVideoTexture===!0&&m.map.encoding===Pe,clearcoat:K,clearcoatMap:K&&!!m.clearcoatMap,clearcoatRoughnessMap:K&&!!m.clearcoatRoughnessMap,clearcoatNormalMap:K&&!!m.clearcoatNormalMap,iridescence:$,iridescenceMap:$&&!!m.iridescenceMap,iridescenceThicknessMap:$&&!!m.iridescenceThicknessMap,displacementMap:!!m.displacementMap,roughnessMap:!!m.roughnessMap,metalnessMap:!!m.metalnessMap,specularMap:!!m.specularMap,specularIntensityMap:!!m.specularIntensityMap,specularColorMap:!!m.specularColorMap,opaque:m.transparent===!1&&m.blending===za,alphaMap:!!m.alphaMap,alphaTest:X,gradientMap:!!m.gradientMap,sheen:m.sheen>0,sheenColorMap:!!m.sheenColorMap,sheenRoughnessMap:!!m.sheenRoughnessMap,transmission:m.transmission>0,transmissionMap:!!m.transmissionMap,thicknessMap:!!m.thicknessMap,combine:m.combine,vertexTangents:!!m.normalMap&&!!D.attributes.tangent,vertexColors:m.vertexColors,vertexAlphas:m.vertexColors===!0&&!!D.attributes.color&&D.attributes.color.itemSize===4,vertexUvs:!!m.map||!!m.bumpMap||!!m.normalMap||!!m.specularMap||!!m.alphaMap||!!m.emissiveMap||!!m.roughnessMap||!!m.metalnessMap||!!m.clearcoatMap||!!m.clearcoatRoughnessMap||!!m.clearcoatNormalMap||!!m.iridescenceMap||!!m.iridescenceThicknessMap||!!m.displacementMap||!!m.transmissionMap||!!m.thicknessMap||!!m.specularIntensityMap||!!m.specularColorMap||!!m.sheenColorMap||!!m.sheenRoughnessMap,uvsVertexOnly:!(!!m.map||!!m.bumpMap||!!m.normalMap||!!m.specularMap||!!m.alphaMap||!!m.emissiveMap||!!m.roughnessMap||!!m.metalnessMap||!!m.clearcoatNormalMap||!!m.iridescenceMap||!!m.iridescenceThicknessMap||m.transmission>0||!!m.transmissionMap||!!m.thicknessMap||!!m.specularIntensityMap||!!m.specularColorMap||m.sheen>0||!!m.sheenColorMap||!!m.sheenRoughnessMap)&&!!m.displacementMap,fog:!!b,useFog:m.fog===!0,fogExp2:b&&b.isFogExp2,flatShading:!!m.flatShading,sizeAttenuation:m.sizeAttenuation,logarithmicDepthBuffer:f,skinning:C.isSkinnedMesh===!0,morphTargets:D.morphAttributes.position!==void 0,morphNormals:D.morphAttributes.normal!==void 0,morphColors:D.morphAttributes.color!==void 0,morphTargetsCount:y,morphTextureStride:k,numDirLights:w.directional.length,numPointLights:w.point.length,numSpotLights:w.spot.length,numSpotLightMaps:w.spotLightMap.length,numRectAreaLights:w.rectArea.length,numHemiLights:w.hemi.length,numDirLightShadows:w.directionalShadowMap.length,numPointLightShadows:w.pointShadowMap.length,numSpotLightShadows:w.spotShadowMap.length,numSpotLightShadowsWithMaps:w.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:m.dithering,shadowMapEnabled:r.shadowMap.enabled&&R.length>0,shadowMapType:r.shadowMap.type,toneMapping:m.toneMapped?r.toneMapping:mn,physicallyCorrectLights:r.physicallyCorrectLights,premultipliedAlpha:m.premultipliedAlpha,doubleSided:m.side===Br,flipSided:m.side===hr,useDepthPacking:!!m.depthPacking,depthPacking:m.depthPacking||0,index0AttributeName:m.index0AttributeName,extensionDerivatives:m.extensions&&m.extensions.derivatives,extensionFragDepth:m.extensions&&m.extensions.fragDepth,extensionDrawBuffers:m.extensions&&m.extensions.drawBuffers,extensionShaderTextureLOD:m.extensions&&m.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:m.customProgramCacheKey()}}function p(m){const w=[];if(m.shaderID?w.push(m.shaderID):(w.push(m.customVertexShaderID),w.push(m.customFragmentShaderID)),m.defines!==void 0)for(const R in m.defines)w.push(R),w.push(m.defines[R]);return m.isRawShaderMaterial===!1&&(v(w,m),A(w,m),w.push(r.outputEncoding)),w.push(m.customProgramCacheKey),w.join()}function v(m,w){m.push(w.precision),m.push(w.outputEncoding),m.push(w.envMapMode),m.push(w.envMapCubeUVHeight),m.push(w.combine),m.push(w.vertexUvs),m.push(w.fogExp2),m.push(w.sizeAttenuation),m.push(w.morphTargetsCount),m.push(w.morphAttributeCount),m.push(w.numDirLights),m.push(w.numPointLights),m.push(w.numSpotLights),m.push(w.numSpotLightMaps),m.push(w.numHemiLights),m.push(w.numRectAreaLights),m.push(w.numDirLightShadows),m.push(w.numPointLightShadows),m.push(w.numSpotLightShadows),m.push(w.numSpotLightShadowsWithMaps),m.push(w.shadowMapType),m.push(w.toneMapping),m.push(w.numClippingPlanes),m.push(w.numClipIntersection),m.push(w.depthPacking)}function A(m,w){o.disableAll(),w.isWebGL2&&o.enable(0),w.supportsVertexTextures&&o.enable(1),w.instancing&&o.enable(2),w.instancingColor&&o.enable(3),w.map&&o.enable(4),w.matcap&&o.enable(5),w.envMap&&o.enable(6),w.lightMap&&o.enable(7),w.aoMap&&o.enable(8),w.emissiveMap&&o.enable(9),w.bumpMap&&o.enable(10),w.normalMap&&o.enable(11),w.objectSpaceNormalMap&&o.enable(12),w.tangentSpaceNormalMap&&o.enable(13),w.clearcoat&&o.enable(14),w.clearcoatMap&&o.enable(15),w.clearcoatRoughnessMap&&o.enable(16),w.clearcoatNormalMap&&o.enable(17),w.iridescence&&o.enable(18),w.iridescenceMap&&o.enable(19),w.iridescenceThicknessMap&&o.enable(20),w.displacementMap&&o.enable(21),w.specularMap&&o.enable(22),w.roughnessMap&&o.enable(23),w.metalnessMap&&o.enable(24),w.gradientMap&&o.enable(25),w.alphaMap&&o.enable(26),w.alphaTest&&o.enable(27),w.vertexColors&&o.enable(28),w.vertexAlphas&&o.enable(29),w.vertexUvs&&o.enable(30),w.vertexTangents&&o.enable(31),w.uvsVertexOnly&&o.enable(32),m.push(o.mask),o.disableAll(),w.fog&&o.enable(0),w.useFog&&o.enable(1),w.flatShading&&o.enable(2),w.logarithmicDepthBuffer&&o.enable(3),w.skinning&&o.enable(4),w.morphTargets&&o.enable(5),w.morphNormals&&o.enable(6),w.morphColors&&o.enable(7),w.premultipliedAlpha&&o.enable(8),w.shadowMapEnabled&&o.enable(9),w.physicallyCorrectLights&&o.enable(10),w.doubleSided&&o.enable(11),w.flipSided&&o.enable(12),w.useDepthPacking&&o.enable(13),w.dithering&&o.enable(14),w.specularIntensityMap&&o.enable(15),w.specularColorMap&&o.enable(16),w.transmission&&o.enable(17),w.transmissionMap&&o.enable(18),w.thicknessMap&&o.enable(19),w.sheen&&o.enable(20),w.sheenColorMap&&o.enable(21),w.sheenRoughnessMap&&o.enable(22),w.decodeVideoTexture&&o.enable(23),w.opaque&&o.enable(24),m.push(o.mask)}function E(m){const w=g[m.type];let R;if(w){const M=Dr[w];R=$T.clone(M.uniforms)}else R=m.uniforms;return R}function S(m,w){let R;for(let M=0,C=h.length;M<C;M++){const b=h[M];if(b.cacheKey===w){R=b,++R.usedTimes;break}}return R===void 0&&(R=new rA(r,w,m,s),h.push(R)),R}function L(m){if(--m.usedTimes===0){const w=h.indexOf(m);h[w]=h[h.length-1],h.pop(),m.destroy()}}function T(m){l.remove(m)}function x(){l.dispose()}return{getParameters:d,getProgramCacheKey:p,getUniforms:E,acquireProgram:S,releaseProgram:L,releaseShaderCache:T,programs:h,dispose:x}}function lA(){let r=new WeakMap;function t(s){let a=r.get(s);return a===void 0&&(a={},r.set(s,a)),a}function e(s){r.delete(s)}function i(s,a,o){r.get(s)[a]=o}function n(){r=new WeakMap}return{get:t,remove:e,update:i,dispose:n}}function hA(r,t){return r.groupOrder!==t.groupOrder?r.groupOrder-t.groupOrder:r.renderOrder!==t.renderOrder?r.renderOrder-t.renderOrder:r.material.id!==t.material.id?r.material.id-t.material.id:r.z!==t.z?r.z-t.z:r.id-t.id}function ig(r,t){return r.groupOrder!==t.groupOrder?r.groupOrder-t.groupOrder:r.renderOrder!==t.renderOrder?r.renderOrder-t.renderOrder:r.z!==t.z?t.z-r.z:r.id-t.id}function rg(){const r=[];let t=0;const e=[],i=[],n=[];function s(){t=0,e.length=0,i.length=0,n.length=0}function a(f,c,_,g,d,p){let v=r[t];return v===void 0?(v={id:f.id,object:f,geometry:c,material:_,groupOrder:g,renderOrder:f.renderOrder,z:d,group:p},r[t]=v):(v.id=f.id,v.object=f,v.geometry=c,v.material=_,v.groupOrder=g,v.renderOrder=f.renderOrder,v.z=d,v.group=p),t++,v}function o(f,c,_,g,d,p){const v=a(f,c,_,g,d,p);_.transmission>0?i.push(v):_.transparent===!0?n.push(v):e.push(v)}function l(f,c,_,g,d,p){const v=a(f,c,_,g,d,p);_.transmission>0?i.unshift(v):_.transparent===!0?n.unshift(v):e.unshift(v)}function h(f,c){e.length>1&&e.sort(f||hA),i.length>1&&i.sort(c||ig),n.length>1&&n.sort(c||ig)}function u(){for(let f=t,c=r.length;f<c;f++){const _=r[f];if(_.id===null)break;_.id=null,_.object=null,_.geometry=null,_.material=null,_.group=null}}return{opaque:e,transmissive:i,transparent:n,init:s,push:o,unshift:l,finish:u,sort:h}}function uA(){let r=new WeakMap;function t(i,n){const s=r.get(i);let a;return s===void 0?(a=new rg,r.set(i,[a])):n>=s.length?(a=new rg,s.push(a)):a=s[n],a}function e(){r=new WeakMap}return{get:t,dispose:e}}function cA(){const r={};return{get:function(t){if(r[t.id]!==void 0)return r[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new ot,color:new Me};break;case"SpotLight":e={position:new ot,direction:new ot,color:new Me,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new ot,color:new Me,distance:0,decay:0};break;case"HemisphereLight":e={direction:new ot,skyColor:new Me,groundColor:new Me};break;case"RectAreaLight":e={color:new Me,position:new ot,halfWidth:new ot,halfHeight:new ot};break}return r[t.id]=e,e}}}function dA(){const r={};return{get:function(t){if(r[t.id]!==void 0)return r[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ae};break;case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ae};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ae,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[t.id]=e,e}}}let fA=0;function pA(r,t){return(t.castShadow?2:0)-(r.castShadow?2:0)+(t.map?1:0)-(r.map?1:0)}function mA(r,t){const e=new cA,i=dA(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)n.probe.push(new ot);const s=new ot,a=new ai,o=new ai;function l(u,f){let c=0,_=0,g=0;for(let M=0;M<9;M++)n.probe[M].set(0,0,0);let d=0,p=0,v=0,A=0,E=0,S=0,L=0,T=0,x=0,m=0;u.sort(pA);const w=f!==!0?Math.PI:1;for(let M=0,C=u.length;M<C;M++){const b=u[M],D=b.color,O=b.intensity,B=b.distance,P=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)c+=D.r*O*w,_+=D.g*O*w,g+=D.b*O*w;else if(b.isLightProbe)for(let F=0;F<9;F++)n.probe[F].addScaledVector(b.sh.coefficients[F],O);else if(b.isDirectionalLight){const F=e.get(b);if(F.color.copy(b.color).multiplyScalar(b.intensity*w),b.castShadow){const I=b.shadow,y=i.get(b);y.shadowBias=I.bias,y.shadowNormalBias=I.normalBias,y.shadowRadius=I.radius,y.shadowMapSize=I.mapSize,n.directionalShadow[d]=y,n.directionalShadowMap[d]=P,n.directionalShadowMatrix[d]=b.shadow.matrix,S++}n.directional[d]=F,d++}else if(b.isSpotLight){const F=e.get(b);F.position.setFromMatrixPosition(b.matrixWorld),F.color.copy(D).multiplyScalar(O*w),F.distance=B,F.coneCos=Math.cos(b.angle),F.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),F.decay=b.decay,n.spot[v]=F;const I=b.shadow;if(b.map&&(n.spotLightMap[x]=b.map,x++,I.updateMatrices(b),b.castShadow&&m++),n.spotLightMatrix[v]=I.matrix,b.castShadow){const y=i.get(b);y.shadowBias=I.bias,y.shadowNormalBias=I.normalBias,y.shadowRadius=I.radius,y.shadowMapSize=I.mapSize,n.spotShadow[v]=y,n.spotShadowMap[v]=P,T++}v++}else if(b.isRectAreaLight){const F=e.get(b);F.color.copy(D).multiplyScalar(O),F.halfWidth.set(b.width*.5,0,0),F.halfHeight.set(0,b.height*.5,0),n.rectArea[A]=F,A++}else if(b.isPointLight){const F=e.get(b);if(F.color.copy(b.color).multiplyScalar(b.intensity*w),F.distance=b.distance,F.decay=b.decay,b.castShadow){const I=b.shadow,y=i.get(b);y.shadowBias=I.bias,y.shadowNormalBias=I.normalBias,y.shadowRadius=I.radius,y.shadowMapSize=I.mapSize,y.shadowCameraNear=I.camera.near,y.shadowCameraFar=I.camera.far,n.pointShadow[p]=y,n.pointShadowMap[p]=P,n.pointShadowMatrix[p]=b.shadow.matrix,L++}n.point[p]=F,p++}else if(b.isHemisphereLight){const F=e.get(b);F.skyColor.copy(b.color).multiplyScalar(O*w),F.groundColor.copy(b.groundColor).multiplyScalar(O*w),n.hemi[E]=F,E++}}A>0&&(t.isWebGL2||r.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Ct.LTC_FLOAT_1,n.rectAreaLTC2=Ct.LTC_FLOAT_2):r.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=Ct.LTC_HALF_1,n.rectAreaLTC2=Ct.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=c,n.ambient[1]=_,n.ambient[2]=g;const R=n.hash;(R.directionalLength!==d||R.pointLength!==p||R.spotLength!==v||R.rectAreaLength!==A||R.hemiLength!==E||R.numDirectionalShadows!==S||R.numPointShadows!==L||R.numSpotShadows!==T||R.numSpotMaps!==x)&&(n.directional.length=d,n.spot.length=v,n.rectArea.length=A,n.point.length=p,n.hemi.length=E,n.directionalShadow.length=S,n.directionalShadowMap.length=S,n.pointShadow.length=L,n.pointShadowMap.length=L,n.spotShadow.length=T,n.spotShadowMap.length=T,n.directionalShadowMatrix.length=S,n.pointShadowMatrix.length=L,n.spotLightMatrix.length=T+x-m,n.spotLightMap.length=x,n.numSpotLightShadowsWithMaps=m,R.directionalLength=d,R.pointLength=p,R.spotLength=v,R.rectAreaLength=A,R.hemiLength=E,R.numDirectionalShadows=S,R.numPointShadows=L,R.numSpotShadows=T,R.numSpotMaps=x,n.version=fA++)}function h(u,f){let c=0,_=0,g=0,d=0,p=0;const v=f.matrixWorldInverse;for(let A=0,E=u.length;A<E;A++){const S=u[A];if(S.isDirectionalLight){const L=n.directional[c];L.direction.setFromMatrixPosition(S.matrixWorld),s.setFromMatrixPosition(S.target.matrixWorld),L.direction.sub(s),L.direction.transformDirection(v),c++}else if(S.isSpotLight){const L=n.spot[g];L.position.setFromMatrixPosition(S.matrixWorld),L.position.applyMatrix4(v),L.direction.setFromMatrixPosition(S.matrixWorld),s.setFromMatrixPosition(S.target.matrixWorld),L.direction.sub(s),L.direction.transformDirection(v),g++}else if(S.isRectAreaLight){const L=n.rectArea[d];L.position.setFromMatrixPosition(S.matrixWorld),L.position.applyMatrix4(v),o.identity(),a.copy(S.matrixWorld),a.premultiply(v),o.extractRotation(a),L.halfWidth.set(S.width*.5,0,0),L.halfHeight.set(0,S.height*.5,0),L.halfWidth.applyMatrix4(o),L.halfHeight.applyMatrix4(o),d++}else if(S.isPointLight){const L=n.point[_];L.position.setFromMatrixPosition(S.matrixWorld),L.position.applyMatrix4(v),_++}else if(S.isHemisphereLight){const L=n.hemi[p];L.direction.setFromMatrixPosition(S.matrixWorld),L.direction.transformDirection(v),p++}}}return{setup:l,setupView:h,state:n}}function ng(r,t){const e=new mA(r,t),i=[],n=[];function s(){i.length=0,n.length=0}function a(f){i.push(f)}function o(f){n.push(f)}function l(f){e.setup(i,f)}function h(f){e.setupView(i,f)}return{init:s,state:{lightsArray:i,shadowsArray:n,lights:e},setupLights:l,setupLightsView:h,pushLight:a,pushShadow:o}}function gA(r,t){let e=new WeakMap;function i(s,a=0){const o=e.get(s);let l;return o===void 0?(l=new ng(r,t),e.set(s,[l])):a>=o.length?(l=new ng(r,t),o.push(l)):l=o[a],l}function n(){e=new WeakMap}return{get:i,dispose:n}}class _A extends bu{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=LT,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class vA extends bu{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new ot,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const xA=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,yA=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function EA(r,t,e){let i=new n0;const n=new ae,s=new ae,a=new Qe,o=new _A({depthPacking:DT}),l=new vA,h={},u=e.maxTextureSize,f={0:hr,1:ro,2:Br},c=new yn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ae},radius:{value:4}},vertexShader:xA,fragmentShader:yA}),_=c.clone();_.defines.HORIZONTAL_PASS=1;const g=new Js;g.setAttribute("position",new Wr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const d=new Ur(g,c),p=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=zv,this.render=function(S,L,T){if(p.enabled===!1||p.autoUpdate===!1&&p.needsUpdate===!1||S.length===0)return;const x=r.getRenderTarget(),m=r.getActiveCubeFace(),w=r.getActiveMipmapLevel(),R=r.state;R.setBlending(Hn),R.buffers.color.setClear(1,1,1,1),R.buffers.depth.setTest(!0),R.setScissorTest(!1);for(let M=0,C=S.length;M<C;M++){const b=S[M],D=b.shadow;if(D===void 0){console.warn("THREE.WebGLShadowMap:",b,"has no shadow.");continue}if(D.autoUpdate===!1&&D.needsUpdate===!1)continue;n.copy(D.mapSize);const O=D.getFrameExtents();if(n.multiply(O),s.copy(D.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/O.x),n.x=s.x*O.x,D.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/O.y),n.y=s.y*O.y,D.mapSize.y=s.y)),D.map===null){const P=this.type!==Ro?{minFilter:wi,magFilter:wi}:{};D.map=new Yn(n.x,n.y,P),D.map.texture.name=b.name+".shadowMap",D.camera.updateProjectionMatrix()}r.setRenderTarget(D.map),r.clear();const B=D.getViewportCount();for(let P=0;P<B;P++){const F=D.getViewport(P);a.set(s.x*F.x,s.y*F.y,s.x*F.z,s.y*F.w),R.viewport(a),D.updateMatrices(b,P),i=D.getFrustum(),E(L,T,D.camera,b,this.type)}D.isPointLightShadow!==!0&&this.type===Ro&&v(D,T),D.needsUpdate=!1}p.needsUpdate=!1,r.setRenderTarget(x,m,w)};function v(S,L){const T=t.update(d);c.defines.VSM_SAMPLES!==S.blurSamples&&(c.defines.VSM_SAMPLES=S.blurSamples,_.defines.VSM_SAMPLES=S.blurSamples,c.needsUpdate=!0,_.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new Yn(n.x,n.y)),c.uniforms.shadow_pass.value=S.map.texture,c.uniforms.resolution.value=S.mapSize,c.uniforms.radius.value=S.radius,r.setRenderTarget(S.mapPass),r.clear(),r.renderBufferDirect(L,null,T,c,d,null),_.uniforms.shadow_pass.value=S.mapPass.texture,_.uniforms.resolution.value=S.mapSize,_.uniforms.radius.value=S.radius,r.setRenderTarget(S.map),r.clear(),r.renderBufferDirect(L,null,T,_,d,null)}function A(S,L,T,x,m,w){let R=null;const M=T.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(M!==void 0?R=M:R=T.isPointLight===!0?l:o,r.localClippingEnabled&&L.clipShadows===!0&&Array.isArray(L.clippingPlanes)&&L.clippingPlanes.length!==0||L.displacementMap&&L.displacementScale!==0||L.alphaMap&&L.alphaTest>0){const C=R.uuid,b=L.uuid;let D=h[C];D===void 0&&(D={},h[C]=D);let O=D[b];O===void 0&&(O=R.clone(),D[b]=O),R=O}return R.visible=L.visible,R.wireframe=L.wireframe,w===Ro?R.side=L.shadowSide!==null?L.shadowSide:L.side:R.side=L.shadowSide!==null?L.shadowSide:f[L.side],R.alphaMap=L.alphaMap,R.alphaTest=L.alphaTest,R.clipShadows=L.clipShadows,R.clippingPlanes=L.clippingPlanes,R.clipIntersection=L.clipIntersection,R.displacementMap=L.displacementMap,R.displacementScale=L.displacementScale,R.displacementBias=L.displacementBias,R.wireframeLinewidth=L.wireframeLinewidth,R.linewidth=L.linewidth,T.isPointLight===!0&&R.isMeshDistanceMaterial===!0&&(R.referencePosition.setFromMatrixPosition(T.matrixWorld),R.nearDistance=x,R.farDistance=m),R}function E(S,L,T,x,m){if(S.visible===!1)return;if(S.layers.test(L.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&m===Ro)&&(!S.frustumCulled||i.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,S.matrixWorld);const M=t.update(S),C=S.material;if(Array.isArray(C)){const b=M.groups;for(let D=0,O=b.length;D<O;D++){const B=b[D],P=C[B.materialIndex];if(P&&P.visible){const F=A(S,P,x,T.near,T.far,m);r.renderBufferDirect(T,null,M,F,S,B)}}}else if(C.visible){const b=A(S,C,x,T.near,T.far,m);r.renderBufferDirect(T,null,M,b,S,null)}}const R=S.children;for(let M=0,C=R.length;M<C;M++)E(R[M],L,T,x,m)}}function TA(r,t,e){const i=e.isWebGL2;function n(){let Z=!1;const Et=new Qe;let yt=null;const lt=new Qe(0,0,0,0);return{setMask:function(xt){yt!==xt&&!Z&&(r.colorMask(xt,xt,xt,xt),yt=xt)},setLocked:function(xt){Z=xt},setClear:function(xt,Bt,ee,ie,Be){Be===!0&&(xt*=ie,Bt*=ie,ee*=ie),Et.set(xt,Bt,ee,ie),lt.equals(Et)===!1&&(r.clearColor(xt,Bt,ee,ie),lt.copy(Et))},reset:function(){Z=!1,yt=null,lt.set(-1,0,0,0)}}}function s(){let Z=!1,Et=null,yt=null,lt=null;return{setTest:function(xt){xt?X(2929):K(2929)},setMask:function(xt){Et!==xt&&!Z&&(r.depthMask(xt),Et=xt)},setFunc:function(xt){if(yt!==xt){switch(xt){case QE:r.depthFunc(512);break;case tT:r.depthFunc(519);break;case eT:r.depthFunc(513);break;case Rd:r.depthFunc(515);break;case iT:r.depthFunc(514);break;case rT:r.depthFunc(518);break;case nT:r.depthFunc(516);break;case sT:r.depthFunc(517);break;default:r.depthFunc(515)}yt=xt}},setLocked:function(xt){Z=xt},setClear:function(xt){lt!==xt&&(r.clearDepth(xt),lt=xt)},reset:function(){Z=!1,Et=null,yt=null,lt=null}}}function a(){let Z=!1,Et=null,yt=null,lt=null,xt=null,Bt=null,ee=null,ie=null,Be=null;return{setTest:function(re){Z||(re?X(2960):K(2960))},setMask:function(re){Et!==re&&!Z&&(r.stencilMask(re),Et=re)},setFunc:function(re,Qt,pt){(yt!==re||lt!==Qt||xt!==pt)&&(r.stencilFunc(re,Qt,pt),yt=re,lt=Qt,xt=pt)},setOp:function(re,Qt,pt){(Bt!==re||ee!==Qt||ie!==pt)&&(r.stencilOp(re,Qt,pt),Bt=re,ee=Qt,ie=pt)},setLocked:function(re){Z=re},setClear:function(re){Be!==re&&(r.clearStencil(re),Be=re)},reset:function(){Z=!1,Et=null,yt=null,lt=null,xt=null,Bt=null,ee=null,ie=null,Be=null}}}const o=new n,l=new s,h=new a,u=new WeakMap,f=new WeakMap;let c={},_={},g=new WeakMap,d=[],p=null,v=!1,A=null,E=null,S=null,L=null,T=null,x=null,m=null,w=!1,R=null,M=null,C=null,b=null,D=null;const O=r.getParameter(35661);let B=!1,P=0;const F=r.getParameter(7938);F.indexOf("WebGL")!==-1?(P=parseFloat(/^WebGL (\d)/.exec(F)[1]),B=P>=1):F.indexOf("OpenGL ES")!==-1&&(P=parseFloat(/^OpenGL ES (\d)/.exec(F)[1]),B=P>=2);let I=null,y={};const k=r.getParameter(3088),U=r.getParameter(2978),N=new Qe().fromArray(k),W=new Qe().fromArray(U);function G(Z,Et,yt){const lt=new Uint8Array(4),xt=r.createTexture();r.bindTexture(Z,xt),r.texParameteri(Z,10241,9728),r.texParameteri(Z,10240,9728);for(let Bt=0;Bt<yt;Bt++)r.texImage2D(Et+Bt,0,6408,1,1,0,6408,5121,lt);return xt}const z={};z[3553]=G(3553,3553,1),z[34067]=G(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),h.setClear(0),X(2929),l.setFunc(Rd),_t(!1),tt(jp),X(2884),mt(Hn);function X(Z){c[Z]!==!0&&(r.enable(Z),c[Z]=!0)}function K(Z){c[Z]!==!1&&(r.disable(Z),c[Z]=!1)}function $(Z,Et){return _[Z]!==Et?(r.bindFramebuffer(Z,Et),_[Z]=Et,i&&(Z===36009&&(_[36160]=Et),Z===36160&&(_[36009]=Et)),!0):!1}function q(Z,Et){let yt=d,lt=!1;if(Z)if(yt=g.get(Et),yt===void 0&&(yt=[],g.set(Et,yt)),Z.isWebGLMultipleRenderTargets){const xt=Z.texture;if(yt.length!==xt.length||yt[0]!==36064){for(let Bt=0,ee=xt.length;Bt<ee;Bt++)yt[Bt]=36064+Bt;yt.length=xt.length,lt=!0}}else yt[0]!==36064&&(yt[0]=36064,lt=!0);else yt[0]!==1029&&(yt[0]=1029,lt=!0);lt&&(e.isWebGL2?r.drawBuffers(yt):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(yt))}function J(Z){return p!==Z?(r.useProgram(Z),p=Z,!0):!1}const Q={[Sa]:32774,[WE]:32778,[HE]:32779};if(i)Q[Zp]=32775,Q[Jp]=32776;else{const Z=t.get("EXT_blend_minmax");Z!==null&&(Q[Zp]=Z.MIN_EXT,Q[Jp]=Z.MAX_EXT)}const rt={[VE]:0,[XE]:1,[KE]:768,[Wv]:770,[JE]:776,[qE]:774,[YE]:772,[jE]:769,[Hv]:771,[ZE]:775,[$E]:773};function mt(Z,Et,yt,lt,xt,Bt,ee,ie){if(Z===Hn){v===!0&&(K(3042),v=!1);return}if(v===!1&&(X(3042),v=!0),Z!==zE){if(Z!==A||ie!==w){if((E!==Sa||T!==Sa)&&(r.blendEquation(32774),E=Sa,T=Sa),ie)switch(Z){case za:r.blendFuncSeparate(1,771,1,771);break;case Yp:r.blendFunc(1,1);break;case $p:r.blendFuncSeparate(0,769,0,1);break;case qp:r.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Z);break}else switch(Z){case za:r.blendFuncSeparate(770,771,1,771);break;case Yp:r.blendFunc(770,1);break;case $p:r.blendFuncSeparate(0,769,0,1);break;case qp:r.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Z);break}S=null,L=null,x=null,m=null,A=Z,w=ie}return}xt=xt||Et,Bt=Bt||yt,ee=ee||lt,(Et!==E||xt!==T)&&(r.blendEquationSeparate(Q[Et],Q[xt]),E=Et,T=xt),(yt!==S||lt!==L||Bt!==x||ee!==m)&&(r.blendFuncSeparate(rt[yt],rt[lt],rt[Bt],rt[ee]),S=yt,L=lt,x=Bt,m=ee),A=Z,w=null}function vt(Z,Et){Z.side===Br?K(2884):X(2884);let yt=Z.side===hr;Et&&(yt=!yt),_t(yt),Z.blending===za&&Z.transparent===!1?mt(Hn):mt(Z.blending,Z.blendEquation,Z.blendSrc,Z.blendDst,Z.blendEquationAlpha,Z.blendSrcAlpha,Z.blendDstAlpha,Z.premultipliedAlpha),l.setFunc(Z.depthFunc),l.setTest(Z.depthTest),l.setMask(Z.depthWrite),o.setMask(Z.colorWrite);const lt=Z.stencilWrite;h.setTest(lt),lt&&(h.setMask(Z.stencilWriteMask),h.setFunc(Z.stencilFunc,Z.stencilRef,Z.stencilFuncMask),h.setOp(Z.stencilFail,Z.stencilZFail,Z.stencilZPass)),dt(Z.polygonOffset,Z.polygonOffsetFactor,Z.polygonOffsetUnits),Z.alphaToCoverage===!0?X(32926):K(32926)}function _t(Z){R!==Z&&(Z?r.frontFace(2304):r.frontFace(2305),R=Z)}function tt(Z){Z!==UE?(X(2884),Z!==M&&(Z===jp?r.cullFace(1029):Z===NE?r.cullFace(1028):r.cullFace(1032))):K(2884),M=Z}function Lt(Z){Z!==C&&(B&&r.lineWidth(Z),C=Z)}function dt(Z,Et,yt){Z?(X(32823),(b!==Et||D!==yt)&&(r.polygonOffset(Et,yt),b=Et,D=yt)):K(32823)}function Tt(Z){Z?X(3089):K(3089)}function Ht(Z){Z===void 0&&(Z=33984+O-1),I!==Z&&(r.activeTexture(Z),I=Z)}function Y(Z,Et,yt){yt===void 0&&(I===null?yt=33984+O-1:yt=I);let lt=y[yt];lt===void 0&&(lt={type:void 0,texture:void 0},y[yt]=lt),(lt.type!==Z||lt.texture!==Et)&&(I!==yt&&(r.activeTexture(yt),I=yt),r.bindTexture(Z,Et||z[Z]),lt.type=Z,lt.texture=Et)}function V(){const Z=y[I];Z!==void 0&&Z.type!==void 0&&(r.bindTexture(Z.type,null),Z.type=void 0,Z.texture=void 0)}function it(){try{r.compressedTexImage2D.apply(r,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function at(){try{r.texSubImage2D.apply(r,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function ut(){try{r.texSubImage3D.apply(r,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function ct(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function St(){try{r.texStorage2D.apply(r,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function gt(){try{r.texStorage3D.apply(r,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function ht(){try{r.texImage2D.apply(r,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function wt(){try{r.texImage3D.apply(r,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Nt(Z){N.equals(Z)===!1&&(r.scissor(Z.x,Z.y,Z.z,Z.w),N.copy(Z))}function Mt(Z){W.equals(Z)===!1&&(r.viewport(Z.x,Z.y,Z.z,Z.w),W.copy(Z))}function Ut(Z,Et){let yt=f.get(Et);yt===void 0&&(yt=new WeakMap,f.set(Et,yt));let lt=yt.get(Z);lt===void 0&&(lt=r.getUniformBlockIndex(Et,Z.name),yt.set(Z,lt))}function Vt(Z,Et){const lt=f.get(Et).get(Z);u.get(Z)!==lt&&(r.uniformBlockBinding(Et,lt,Z.__bindingPointIndex),u.set(Z,lt))}function Ft(){r.disable(3042),r.disable(2884),r.disable(2929),r.disable(32823),r.disable(3089),r.disable(2960),r.disable(32926),r.blendEquation(32774),r.blendFunc(1,0),r.blendFuncSeparate(1,0,1,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(513),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(519,0,4294967295),r.stencilOp(7680,7680,7680),r.clearStencil(0),r.cullFace(1029),r.frontFace(2305),r.polygonOffset(0,0),r.activeTexture(33984),r.bindFramebuffer(36160,null),i===!0&&(r.bindFramebuffer(36009,null),r.bindFramebuffer(36008,null)),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),c={},I=null,y={},_={},g=new WeakMap,d=[],p=null,v=!1,A=null,E=null,S=null,L=null,T=null,x=null,m=null,w=!1,R=null,M=null,C=null,b=null,D=null,N.set(0,0,r.canvas.width,r.canvas.height),W.set(0,0,r.canvas.width,r.canvas.height),o.reset(),l.reset(),h.reset()}return{buffers:{color:o,depth:l,stencil:h},enable:X,disable:K,bindFramebuffer:$,drawBuffers:q,useProgram:J,setBlending:mt,setMaterial:vt,setFlipSided:_t,setCullFace:tt,setLineWidth:Lt,setPolygonOffset:dt,setScissorTest:Tt,activeTexture:Ht,bindTexture:Y,unbindTexture:V,compressedTexImage2D:it,texImage2D:ht,texImage3D:wt,updateUBOMapping:Ut,uniformBlockBinding:Vt,texStorage2D:St,texStorage3D:gt,texSubImage2D:at,texSubImage3D:ut,compressedTexSubImage2D:ct,scissor:Nt,viewport:Mt,reset:Ft}}function bA(r,t,e,i,n,s,a){const o=n.isWebGL2,l=n.maxTextures,h=n.maxCubemapSize,u=n.maxTextureSize,f=n.maxSamples,c=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,_=/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap;let d;const p=new WeakMap;let v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function A(Y,V){return v?new OffscreenCanvas(Y,V):ru("canvas")}function E(Y,V,it,at){let ut=1;if((Y.width>at||Y.height>at)&&(ut=at/Math.max(Y.width,Y.height)),ut<1||V===!0)if(typeof HTMLImageElement<"u"&&Y instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Y instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Y instanceof ImageBitmap){const ct=V?kd:Math.floor,St=ct(ut*Y.width),gt=ct(ut*Y.height);d===void 0&&(d=A(St,gt));const ht=it?A(St,gt):d;return ht.width=St,ht.height=gt,ht.getContext("2d").drawImage(Y,0,0,St,gt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Y.width+"x"+Y.height+") to ("+St+"x"+gt+")."),ht}else return"data"in Y&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Y.width+"x"+Y.height+")."),Y;return Y}function S(Y){return wm(Y.width)&&wm(Y.height)}function L(Y){return o?!1:Y.wrapS!==Tr||Y.wrapT!==Tr||Y.minFilter!==wi&&Y.minFilter!==er}function T(Y,V){return Y.generateMipmaps&&V&&Y.minFilter!==wi&&Y.minFilter!==er}function x(Y){r.generateMipmap(Y)}function m(Y,V,it,at,ut=!1){if(o===!1)return V;if(Y!==null){if(r[Y]!==void 0)return r[Y];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Y+"'")}let ct=V;return V===6403&&(it===5126&&(ct=33326),it===5131&&(ct=33325),it===5121&&(ct=33321)),V===33319&&(it===5126&&(ct=33328),it===5131&&(ct=33327),it===5121&&(ct=33323)),V===6408&&(it===5126&&(ct=34836),it===5131&&(ct=34842),it===5121&&(ct=at===Pe&&ut===!1?35907:32856),it===32819&&(ct=32854),it===32820&&(ct=32855)),(ct===33325||ct===33326||ct===33327||ct===33328||ct===34842||ct===34836)&&t.get("EXT_color_buffer_float"),ct}function w(Y,V,it){return T(Y,it)===!0||Y.isFramebufferTexture&&Y.minFilter!==wi&&Y.minFilter!==er?Math.log2(Math.max(V.width,V.height))+1:Y.mipmaps!==void 0&&Y.mipmaps.length>0?Y.mipmaps.length:Y.isCompressedTexture&&Array.isArray(Y.image)?V.mipmaps.length:1}function R(Y){return Y===wi||Y===Qp||Y===tm?9728:9729}function M(Y){const V=Y.target;V.removeEventListener("dispose",M),b(V),V.isVideoTexture&&g.delete(V)}function C(Y){const V=Y.target;V.removeEventListener("dispose",C),O(V)}function b(Y){const V=i.get(Y);if(V.__webglInit===void 0)return;const it=Y.source,at=p.get(it);if(at){const ut=at[V.__cacheKey];ut.usedTimes--,ut.usedTimes===0&&D(Y),Object.keys(at).length===0&&p.delete(it)}i.remove(Y)}function D(Y){const V=i.get(Y);r.deleteTexture(V.__webglTexture);const it=Y.source,at=p.get(it);delete at[V.__cacheKey],a.memory.textures--}function O(Y){const V=Y.texture,it=i.get(Y),at=i.get(V);if(at.__webglTexture!==void 0&&(r.deleteTexture(at.__webglTexture),a.memory.textures--),Y.depthTexture&&Y.depthTexture.dispose(),Y.isWebGLCubeRenderTarget)for(let ut=0;ut<6;ut++)r.deleteFramebuffer(it.__webglFramebuffer[ut]),it.__webglDepthbuffer&&r.deleteRenderbuffer(it.__webglDepthbuffer[ut]);else{if(r.deleteFramebuffer(it.__webglFramebuffer),it.__webglDepthbuffer&&r.deleteRenderbuffer(it.__webglDepthbuffer),it.__webglMultisampledFramebuffer&&r.deleteFramebuffer(it.__webglMultisampledFramebuffer),it.__webglColorRenderbuffer)for(let ut=0;ut<it.__webglColorRenderbuffer.length;ut++)it.__webglColorRenderbuffer[ut]&&r.deleteRenderbuffer(it.__webglColorRenderbuffer[ut]);it.__webglDepthRenderbuffer&&r.deleteRenderbuffer(it.__webglDepthRenderbuffer)}if(Y.isWebGLMultipleRenderTargets)for(let ut=0,ct=V.length;ut<ct;ut++){const St=i.get(V[ut]);St.__webglTexture&&(r.deleteTexture(St.__webglTexture),a.memory.textures--),i.remove(V[ut])}i.remove(V),i.remove(Y)}let B=0;function P(){B=0}function F(){const Y=B;return Y>=l&&console.warn("THREE.WebGLTextures: Trying to use "+Y+" texture units while this GPU supports only "+l),B+=1,Y}function I(Y){const V=[];return V.push(Y.wrapS),V.push(Y.wrapT),V.push(Y.magFilter),V.push(Y.minFilter),V.push(Y.anisotropy),V.push(Y.internalFormat),V.push(Y.format),V.push(Y.type),V.push(Y.generateMipmaps),V.push(Y.premultiplyAlpha),V.push(Y.flipY),V.push(Y.unpackAlignment),V.push(Y.encoding),V.join()}function y(Y,V){const it=i.get(Y);if(Y.isVideoTexture&&Tt(Y),Y.isRenderTargetTexture===!1&&Y.version>0&&it.__version!==Y.version){const at=Y.image;if(at===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(at.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{K(it,Y,V);return}}e.bindTexture(3553,it.__webglTexture,33984+V)}function k(Y,V){const it=i.get(Y);if(Y.version>0&&it.__version!==Y.version){K(it,Y,V);return}e.bindTexture(35866,it.__webglTexture,33984+V)}function U(Y,V){const it=i.get(Y);if(Y.version>0&&it.__version!==Y.version){K(it,Y,V);return}e.bindTexture(32879,it.__webglTexture,33984+V)}function N(Y,V){const it=i.get(Y);if(Y.version>0&&it.__version!==Y.version){$(it,Y,V);return}e.bindTexture(34067,it.__webglTexture,33984+V)}const W={[Od]:10497,[Tr]:33071,[Fd]:33648},G={[wi]:9728,[Qp]:9984,[tm]:9986,[er]:9729,[fT]:9985,[Tu]:9987};function z(Y,V,it){if(it?(r.texParameteri(Y,10242,W[V.wrapS]),r.texParameteri(Y,10243,W[V.wrapT]),(Y===32879||Y===35866)&&r.texParameteri(Y,32882,W[V.wrapR]),r.texParameteri(Y,10240,G[V.magFilter]),r.texParameteri(Y,10241,G[V.minFilter])):(r.texParameteri(Y,10242,33071),r.texParameteri(Y,10243,33071),(Y===32879||Y===35866)&&r.texParameteri(Y,32882,33071),(V.wrapS!==Tr||V.wrapT!==Tr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),r.texParameteri(Y,10240,R(V.magFilter)),r.texParameteri(Y,10241,R(V.minFilter)),V.minFilter!==wi&&V.minFilter!==er&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){const at=t.get("EXT_texture_filter_anisotropic");if(V.type===Ms&&t.has("OES_texture_float_linear")===!1||o===!1&&V.type===sl&&t.has("OES_texture_half_float_linear")===!1)return;(V.anisotropy>1||i.get(V).__currentAnisotropy)&&(r.texParameterf(Y,at.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(V.anisotropy,n.getMaxAnisotropy())),i.get(V).__currentAnisotropy=V.anisotropy)}}function X(Y,V){let it=!1;Y.__webglInit===void 0&&(Y.__webglInit=!0,V.addEventListener("dispose",M));const at=V.source;let ut=p.get(at);ut===void 0&&(ut={},p.set(at,ut));const ct=I(V);if(ct!==Y.__cacheKey){ut[ct]===void 0&&(ut[ct]={texture:r.createTexture(),usedTimes:0},a.memory.textures++,it=!0),ut[ct].usedTimes++;const St=ut[Y.__cacheKey];St!==void 0&&(ut[Y.__cacheKey].usedTimes--,St.usedTimes===0&&D(V)),Y.__cacheKey=ct,Y.__webglTexture=ut[ct].texture}return it}function K(Y,V,it){let at=3553;V.isDataArrayTexture&&(at=35866),V.isData3DTexture&&(at=32879);const ut=X(Y,V),ct=V.source;e.bindTexture(at,Y.__webglTexture,33984+it);const St=i.get(ct);if(ct.version!==St.__version||ut===!0){e.activeTexture(33984+it),r.pixelStorei(37440,V.flipY),r.pixelStorei(37441,V.premultiplyAlpha),r.pixelStorei(3317,V.unpackAlignment),r.pixelStorei(37443,0);const gt=L(V)&&S(V.image)===!1;let ht=E(V.image,gt,!1,u);ht=Ht(V,ht);const wt=S(ht)||o,Nt=s.convert(V.format,V.encoding);let Mt=s.convert(V.type),Ut=m(V.internalFormat,Nt,Mt,V.encoding,V.isVideoTexture);z(at,V,wt);let Vt;const Ft=V.mipmaps,Z=o&&V.isVideoTexture!==!0,Et=St.__version===void 0||ut===!0,yt=w(V,ht,wt);if(V.isDepthTexture)Ut=6402,o?V.type===Ms?Ut=36012:V.type===As?Ut=33190:V.type===Wa?Ut=35056:Ut=33189:V.type===Ms&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),V.format===Bs&&Ut===6402&&V.type!==Kv&&V.type!==As&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),V.type=As,Mt=s.convert(V.type)),V.format===ao&&Ut===6402&&(Ut=34041,V.type!==Wa&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),V.type=Wa,Mt=s.convert(V.type))),Et&&(Z?e.texStorage2D(3553,1,Ut,ht.width,ht.height):e.texImage2D(3553,0,Ut,ht.width,ht.height,0,Nt,Mt,null));else if(V.isDataTexture)if(Ft.length>0&&wt){Z&&Et&&e.texStorage2D(3553,yt,Ut,Ft[0].width,Ft[0].height);for(let lt=0,xt=Ft.length;lt<xt;lt++)Vt=Ft[lt],Z?e.texSubImage2D(3553,lt,0,0,Vt.width,Vt.height,Nt,Mt,Vt.data):e.texImage2D(3553,lt,Ut,Vt.width,Vt.height,0,Nt,Mt,Vt.data);V.generateMipmaps=!1}else Z?(Et&&e.texStorage2D(3553,yt,Ut,ht.width,ht.height),e.texSubImage2D(3553,0,0,0,ht.width,ht.height,Nt,Mt,ht.data)):e.texImage2D(3553,0,Ut,ht.width,ht.height,0,Nt,Mt,ht.data);else if(V.isCompressedTexture){Z&&Et&&e.texStorage2D(3553,yt,Ut,Ft[0].width,Ft[0].height);for(let lt=0,xt=Ft.length;lt<xt;lt++)Vt=Ft[lt],V.format!==kr?Nt!==null?Z?e.compressedTexSubImage2D(3553,lt,0,0,Vt.width,Vt.height,Nt,Vt.data):e.compressedTexImage2D(3553,lt,Ut,Vt.width,Vt.height,0,Vt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Z?e.texSubImage2D(3553,lt,0,0,Vt.width,Vt.height,Nt,Mt,Vt.data):e.texImage2D(3553,lt,Ut,Vt.width,Vt.height,0,Nt,Mt,Vt.data)}else if(V.isDataArrayTexture)Z?(Et&&e.texStorage3D(35866,yt,Ut,ht.width,ht.height,ht.depth),e.texSubImage3D(35866,0,0,0,0,ht.width,ht.height,ht.depth,Nt,Mt,ht.data)):e.texImage3D(35866,0,Ut,ht.width,ht.height,ht.depth,0,Nt,Mt,ht.data);else if(V.isData3DTexture)Z?(Et&&e.texStorage3D(32879,yt,Ut,ht.width,ht.height,ht.depth),e.texSubImage3D(32879,0,0,0,0,ht.width,ht.height,ht.depth,Nt,Mt,ht.data)):e.texImage3D(32879,0,Ut,ht.width,ht.height,ht.depth,0,Nt,Mt,ht.data);else if(V.isFramebufferTexture){if(Et)if(Z)e.texStorage2D(3553,yt,Ut,ht.width,ht.height);else{let lt=ht.width,xt=ht.height;for(let Bt=0;Bt<yt;Bt++)e.texImage2D(3553,Bt,Ut,lt,xt,0,Nt,Mt,null),lt>>=1,xt>>=1}}else if(Ft.length>0&&wt){Z&&Et&&e.texStorage2D(3553,yt,Ut,Ft[0].width,Ft[0].height);for(let lt=0,xt=Ft.length;lt<xt;lt++)Vt=Ft[lt],Z?e.texSubImage2D(3553,lt,0,0,Nt,Mt,Vt):e.texImage2D(3553,lt,Ut,Nt,Mt,Vt);V.generateMipmaps=!1}else Z?(Et&&e.texStorage2D(3553,yt,Ut,ht.width,ht.height),e.texSubImage2D(3553,0,0,0,Nt,Mt,ht)):e.texImage2D(3553,0,Ut,Nt,Mt,ht);T(V,wt)&&x(at),St.__version=ct.version,V.onUpdate&&V.onUpdate(V)}Y.__version=V.version}function $(Y,V,it){if(V.image.length!==6)return;const at=X(Y,V),ut=V.source;e.bindTexture(34067,Y.__webglTexture,33984+it);const ct=i.get(ut);if(ut.version!==ct.__version||at===!0){e.activeTexture(33984+it),r.pixelStorei(37440,V.flipY),r.pixelStorei(37441,V.premultiplyAlpha),r.pixelStorei(3317,V.unpackAlignment),r.pixelStorei(37443,0);const St=V.isCompressedTexture||V.image[0].isCompressedTexture,gt=V.image[0]&&V.image[0].isDataTexture,ht=[];for(let lt=0;lt<6;lt++)!St&&!gt?ht[lt]=E(V.image[lt],!1,!0,h):ht[lt]=gt?V.image[lt].image:V.image[lt],ht[lt]=Ht(V,ht[lt]);const wt=ht[0],Nt=S(wt)||o,Mt=s.convert(V.format,V.encoding),Ut=s.convert(V.type),Vt=m(V.internalFormat,Mt,Ut,V.encoding),Ft=o&&V.isVideoTexture!==!0,Z=ct.__version===void 0||at===!0;let Et=w(V,wt,Nt);z(34067,V,Nt);let yt;if(St){Ft&&Z&&e.texStorage2D(34067,Et,Vt,wt.width,wt.height);for(let lt=0;lt<6;lt++){yt=ht[lt].mipmaps;for(let xt=0;xt<yt.length;xt++){const Bt=yt[xt];V.format!==kr?Mt!==null?Ft?e.compressedTexSubImage2D(34069+lt,xt,0,0,Bt.width,Bt.height,Mt,Bt.data):e.compressedTexImage2D(34069+lt,xt,Vt,Bt.width,Bt.height,0,Bt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ft?e.texSubImage2D(34069+lt,xt,0,0,Bt.width,Bt.height,Mt,Ut,Bt.data):e.texImage2D(34069+lt,xt,Vt,Bt.width,Bt.height,0,Mt,Ut,Bt.data)}}}else{yt=V.mipmaps,Ft&&Z&&(yt.length>0&&Et++,e.texStorage2D(34067,Et,Vt,ht[0].width,ht[0].height));for(let lt=0;lt<6;lt++)if(gt){Ft?e.texSubImage2D(34069+lt,0,0,0,ht[lt].width,ht[lt].height,Mt,Ut,ht[lt].data):e.texImage2D(34069+lt,0,Vt,ht[lt].width,ht[lt].height,0,Mt,Ut,ht[lt].data);for(let xt=0;xt<yt.length;xt++){const ee=yt[xt].image[lt].image;Ft?e.texSubImage2D(34069+lt,xt+1,0,0,ee.width,ee.height,Mt,Ut,ee.data):e.texImage2D(34069+lt,xt+1,Vt,ee.width,ee.height,0,Mt,Ut,ee.data)}}else{Ft?e.texSubImage2D(34069+lt,0,0,0,Mt,Ut,ht[lt]):e.texImage2D(34069+lt,0,Vt,Mt,Ut,ht[lt]);for(let xt=0;xt<yt.length;xt++){const Bt=yt[xt];Ft?e.texSubImage2D(34069+lt,xt+1,0,0,Mt,Ut,Bt.image[lt]):e.texImage2D(34069+lt,xt+1,Vt,Mt,Ut,Bt.image[lt])}}}T(V,Nt)&&x(34067),ct.__version=ut.version,V.onUpdate&&V.onUpdate(V)}Y.__version=V.version}function q(Y,V,it,at,ut){const ct=s.convert(it.format,it.encoding),St=s.convert(it.type),gt=m(it.internalFormat,ct,St,it.encoding);i.get(V).__hasExternalTextures||(ut===32879||ut===35866?e.texImage3D(ut,0,gt,V.width,V.height,V.depth,0,ct,St,null):e.texImage2D(ut,0,gt,V.width,V.height,0,ct,St,null)),e.bindFramebuffer(36160,Y),dt(V)?c.framebufferTexture2DMultisampleEXT(36160,at,ut,i.get(it).__webglTexture,0,Lt(V)):r.framebufferTexture2D(36160,at,ut,i.get(it).__webglTexture,0),e.bindFramebuffer(36160,null)}function J(Y,V,it){if(r.bindRenderbuffer(36161,Y),V.depthBuffer&&!V.stencilBuffer){let at=33189;if(it||dt(V)){const ut=V.depthTexture;ut&&ut.isDepthTexture&&(ut.type===Ms?at=36012:ut.type===As&&(at=33190));const ct=Lt(V);dt(V)?c.renderbufferStorageMultisampleEXT(36161,ct,at,V.width,V.height):r.renderbufferStorageMultisample(36161,ct,at,V.width,V.height)}else r.renderbufferStorage(36161,at,V.width,V.height);r.framebufferRenderbuffer(36160,36096,36161,Y)}else if(V.depthBuffer&&V.stencilBuffer){const at=Lt(V);it&&dt(V)===!1?r.renderbufferStorageMultisample(36161,at,35056,V.width,V.height):dt(V)?c.renderbufferStorageMultisampleEXT(36161,at,35056,V.width,V.height):r.renderbufferStorage(36161,34041,V.width,V.height),r.framebufferRenderbuffer(36160,33306,36161,Y)}else{const at=V.isWebGLMultipleRenderTargets===!0?V.texture:[V.texture];for(let ut=0;ut<at.length;ut++){const ct=at[ut],St=s.convert(ct.format,ct.encoding),gt=s.convert(ct.type),ht=m(ct.internalFormat,St,gt,ct.encoding),wt=Lt(V);it&&dt(V)===!1?r.renderbufferStorageMultisample(36161,wt,ht,V.width,V.height):dt(V)?c.renderbufferStorageMultisampleEXT(36161,wt,ht,V.width,V.height):r.renderbufferStorage(36161,ht,V.width,V.height)}}r.bindRenderbuffer(36161,null)}function Q(Y,V){if(V&&V.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,Y),!(V.depthTexture&&V.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(V.depthTexture).__webglTexture||V.depthTexture.image.width!==V.width||V.depthTexture.image.height!==V.height)&&(V.depthTexture.image.width=V.width,V.depthTexture.image.height=V.height,V.depthTexture.needsUpdate=!0),y(V.depthTexture,0);const at=i.get(V.depthTexture).__webglTexture,ut=Lt(V);if(V.depthTexture.format===Bs)dt(V)?c.framebufferTexture2DMultisampleEXT(36160,36096,3553,at,0,ut):r.framebufferTexture2D(36160,36096,3553,at,0);else if(V.depthTexture.format===ao)dt(V)?c.framebufferTexture2DMultisampleEXT(36160,33306,3553,at,0,ut):r.framebufferTexture2D(36160,33306,3553,at,0);else throw new Error("Unknown depthTexture format")}function rt(Y){const V=i.get(Y),it=Y.isWebGLCubeRenderTarget===!0;if(Y.depthTexture&&!V.__autoAllocateDepthBuffer){if(it)throw new Error("target.depthTexture not supported in Cube render targets");Q(V.__webglFramebuffer,Y)}else if(it){V.__webglDepthbuffer=[];for(let at=0;at<6;at++)e.bindFramebuffer(36160,V.__webglFramebuffer[at]),V.__webglDepthbuffer[at]=r.createRenderbuffer(),J(V.__webglDepthbuffer[at],Y,!1)}else e.bindFramebuffer(36160,V.__webglFramebuffer),V.__webglDepthbuffer=r.createRenderbuffer(),J(V.__webglDepthbuffer,Y,!1);e.bindFramebuffer(36160,null)}function mt(Y,V,it){const at=i.get(Y);V!==void 0&&q(at.__webglFramebuffer,Y,Y.texture,36064,3553),it!==void 0&&rt(Y)}function vt(Y){const V=Y.texture,it=i.get(Y),at=i.get(V);Y.addEventListener("dispose",C),Y.isWebGLMultipleRenderTargets!==!0&&(at.__webglTexture===void 0&&(at.__webglTexture=r.createTexture()),at.__version=V.version,a.memory.textures++);const ut=Y.isWebGLCubeRenderTarget===!0,ct=Y.isWebGLMultipleRenderTargets===!0,St=S(Y)||o;if(ut){it.__webglFramebuffer=[];for(let gt=0;gt<6;gt++)it.__webglFramebuffer[gt]=r.createFramebuffer()}else{if(it.__webglFramebuffer=r.createFramebuffer(),ct)if(n.drawBuffers){const gt=Y.texture;for(let ht=0,wt=gt.length;ht<wt;ht++){const Nt=i.get(gt[ht]);Nt.__webglTexture===void 0&&(Nt.__webglTexture=r.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&Y.samples>0&&dt(Y)===!1){const gt=ct?V:[V];it.__webglMultisampledFramebuffer=r.createFramebuffer(),it.__webglColorRenderbuffer=[],e.bindFramebuffer(36160,it.__webglMultisampledFramebuffer);for(let ht=0;ht<gt.length;ht++){const wt=gt[ht];it.__webglColorRenderbuffer[ht]=r.createRenderbuffer(),r.bindRenderbuffer(36161,it.__webglColorRenderbuffer[ht]);const Nt=s.convert(wt.format,wt.encoding),Mt=s.convert(wt.type),Ut=m(wt.internalFormat,Nt,Mt,wt.encoding,Y.isXRRenderTarget===!0),Vt=Lt(Y);r.renderbufferStorageMultisample(36161,Vt,Ut,Y.width,Y.height),r.framebufferRenderbuffer(36160,36064+ht,36161,it.__webglColorRenderbuffer[ht])}r.bindRenderbuffer(36161,null),Y.depthBuffer&&(it.__webglDepthRenderbuffer=r.createRenderbuffer(),J(it.__webglDepthRenderbuffer,Y,!0)),e.bindFramebuffer(36160,null)}}if(ut){e.bindTexture(34067,at.__webglTexture),z(34067,V,St);for(let gt=0;gt<6;gt++)q(it.__webglFramebuffer[gt],Y,V,36064,34069+gt);T(V,St)&&x(34067),e.unbindTexture()}else if(ct){const gt=Y.texture;for(let ht=0,wt=gt.length;ht<wt;ht++){const Nt=gt[ht],Mt=i.get(Nt);e.bindTexture(3553,Mt.__webglTexture),z(3553,Nt,St),q(it.__webglFramebuffer,Y,Nt,36064+ht,3553),T(Nt,St)&&x(3553)}e.unbindTexture()}else{let gt=3553;(Y.isWebGL3DRenderTarget||Y.isWebGLArrayRenderTarget)&&(o?gt=Y.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),e.bindTexture(gt,at.__webglTexture),z(gt,V,St),q(it.__webglFramebuffer,Y,V,36064,gt),T(V,St)&&x(gt),e.unbindTexture()}Y.depthBuffer&&rt(Y)}function _t(Y){const V=S(Y)||o,it=Y.isWebGLMultipleRenderTargets===!0?Y.texture:[Y.texture];for(let at=0,ut=it.length;at<ut;at++){const ct=it[at];if(T(ct,V)){const St=Y.isWebGLCubeRenderTarget?34067:3553,gt=i.get(ct).__webglTexture;e.bindTexture(St,gt),x(St),e.unbindTexture()}}}function tt(Y){if(o&&Y.samples>0&&dt(Y)===!1){const V=Y.isWebGLMultipleRenderTargets?Y.texture:[Y.texture],it=Y.width,at=Y.height;let ut=16384;const ct=[],St=Y.stencilBuffer?33306:36096,gt=i.get(Y),ht=Y.isWebGLMultipleRenderTargets===!0;if(ht)for(let wt=0;wt<V.length;wt++)e.bindFramebuffer(36160,gt.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(36160,36064+wt,36161,null),e.bindFramebuffer(36160,gt.__webglFramebuffer),r.framebufferTexture2D(36009,36064+wt,3553,null,0);e.bindFramebuffer(36008,gt.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,gt.__webglFramebuffer);for(let wt=0;wt<V.length;wt++){ct.push(36064+wt),Y.depthBuffer&&ct.push(St);const Nt=gt.__ignoreDepthValues!==void 0?gt.__ignoreDepthValues:!1;if(Nt===!1&&(Y.depthBuffer&&(ut|=256),Y.stencilBuffer&&(ut|=1024)),ht&&r.framebufferRenderbuffer(36008,36064,36161,gt.__webglColorRenderbuffer[wt]),Nt===!0&&(r.invalidateFramebuffer(36008,[St]),r.invalidateFramebuffer(36009,[St])),ht){const Mt=i.get(V[wt]).__webglTexture;r.framebufferTexture2D(36009,36064,3553,Mt,0)}r.blitFramebuffer(0,0,it,at,0,0,it,at,ut,9728),_&&r.invalidateFramebuffer(36008,ct)}if(e.bindFramebuffer(36008,null),e.bindFramebuffer(36009,null),ht)for(let wt=0;wt<V.length;wt++){e.bindFramebuffer(36160,gt.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(36160,36064+wt,36161,gt.__webglColorRenderbuffer[wt]);const Nt=i.get(V[wt]).__webglTexture;e.bindFramebuffer(36160,gt.__webglFramebuffer),r.framebufferTexture2D(36009,36064+wt,3553,Nt,0)}e.bindFramebuffer(36009,gt.__webglMultisampledFramebuffer)}}function Lt(Y){return Math.min(f,Y.samples)}function dt(Y){const V=i.get(Y);return o&&Y.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&V.__useRenderToTexture!==!1}function Tt(Y){const V=a.render.frame;g.get(Y)!==V&&(g.set(Y,V),Y.update())}function Ht(Y,V){const it=Y.encoding,at=Y.format,ut=Y.type;return Y.isCompressedTexture===!0||Y.isVideoTexture===!0||Y.format===Bd||it!==Ks&&(it===Pe?o===!1?t.has("EXT_sRGB")===!0&&at===kr?(Y.format=Bd,Y.minFilter=er,Y.generateMipmaps=!1):V=$v.sRGBToLinear(V):(at!==kr||ut!==Xs)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",it)),V}this.allocateTextureUnit=F,this.resetTextureUnits=P,this.setTexture2D=y,this.setTexture2DArray=k,this.setTexture3D=U,this.setTextureCube=N,this.rebindTextures=mt,this.setupRenderTarget=vt,this.updateRenderTargetMipmap=_t,this.updateMultisampleRenderTarget=tt,this.setupDepthRenderbuffer=rt,this.setupFrameBufferTexture=q,this.useMultisampledRTT=dt}function SA(r,t,e){const i=e.isWebGL2;function n(s,a=null){let o;if(s===Xs)return 5121;if(s===_T)return 32819;if(s===vT)return 32820;if(s===pT)return 5120;if(s===mT)return 5122;if(s===Kv)return 5123;if(s===gT)return 5124;if(s===As)return 5125;if(s===Ms)return 5126;if(s===sl)return i?5131:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===xT)return 6406;if(s===kr)return 6408;if(s===ET)return 6409;if(s===TT)return 6410;if(s===Bs)return 6402;if(s===ao)return 34041;if(s===bT)return 6403;if(s===yT)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(s===Bd)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===ST)return 36244;if(s===wT)return 33319;if(s===AT)return 33320;if(s===MT)return 36249;if(s===ec||s===ic||s===rc||s===nc)if(a===Pe)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===ec)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===ic)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===rc)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===nc)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===ec)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===ic)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===rc)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===nc)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===em||s===im||s===rm||s===nm)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===em)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===im)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===rm)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===nm)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===CT)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===sm||s===am)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===sm)return a===Pe?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===am)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===om||s===lm||s===hm||s===um||s===cm||s===dm||s===fm||s===pm||s===mm||s===gm||s===_m||s===vm||s===xm||s===ym)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===om)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===lm)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===hm)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===um)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===cm)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===dm)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===fm)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===pm)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===mm)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===gm)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===_m)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===vm)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===xm)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===ym)return a===Pe?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===Em)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===Em)return a===Pe?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return s===Wa?i?34042:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):r[s]!==void 0?r[s]:null}return{convert:n}}class wA extends ir{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class ah extends Ki{constructor(){super(),this.isGroup=!0,this.type="Group"}}const AA={type:"move"};class Pc{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ah,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ah,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ot,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ot),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ah,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ot,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ot),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,i){let n=null,s=null,a=null;const o=this._targetRay,l=this._grip,h=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(h&&t.hand){a=!0;for(const d of t.hand.values()){const p=e.getJointPose(d,i);if(h.joints[d.jointName]===void 0){const A=new ah;A.matrixAutoUpdate=!1,A.visible=!1,h.joints[d.jointName]=A,h.add(A)}const v=h.joints[d.jointName];p!==null&&(v.matrix.fromArray(p.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.jointRadius=p.radius),v.visible=p!==null}const u=h.joints["index-finger-tip"],f=h.joints["thumb-tip"],c=u.position.distanceTo(f.position),_=.02,g=.005;h.inputState.pinching&&c>_+g?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!h.inputState.pinching&&c<=_-g&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else l!==null&&t.gripSpace&&(s=e.getPose(t.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(n=e.getPose(t.targetRaySpace,i),n===null&&s!==null&&(n=s),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(AA)))}return o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),h!==null&&(h.visible=a!==null),this}}class MA extends Mr{constructor(t,e,i,n,s,a,o,l,h,u){if(u=u!==void 0?u:Bs,u!==Bs&&u!==ao)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===Bs&&(i=As),i===void 0&&u===ao&&(i=Wa),super(null,n,s,a,o,l,u,i,h),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=o!==void 0?o:wi,this.minFilter=l!==void 0?l:wi,this.flipY=!1,this.generateMipmaps=!1}}class CA extends lo{constructor(t,e){super();const i=this;let n=null,s=1,a=null,o="local-floor",l=null,h=null,u=null,f=null,c=null,_=null;const g=e.getContextAttributes();let d=null,p=null;const v=[],A=[],E=new ir;E.layers.enable(1),E.viewport=new Qe;const S=new ir;S.layers.enable(2),S.viewport=new Qe;const L=[E,S],T=new wA;T.layers.enable(1),T.layers.enable(2);let x=null,m=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(I){let y=v[I];return y===void 0&&(y=new Pc,v[I]=y),y.getTargetRaySpace()},this.getControllerGrip=function(I){let y=v[I];return y===void 0&&(y=new Pc,v[I]=y),y.getGripSpace()},this.getHand=function(I){let y=v[I];return y===void 0&&(y=new Pc,v[I]=y),y.getHandSpace()};function w(I){const y=A.indexOf(I.inputSource);if(y===-1)return;const k=v[y];k!==void 0&&k.dispatchEvent({type:I.type,data:I.inputSource})}function R(){n.removeEventListener("select",w),n.removeEventListener("selectstart",w),n.removeEventListener("selectend",w),n.removeEventListener("squeeze",w),n.removeEventListener("squeezestart",w),n.removeEventListener("squeezeend",w),n.removeEventListener("end",R),n.removeEventListener("inputsourceschange",M);for(let I=0;I<v.length;I++){const y=A[I];y!==null&&(A[I]=null,v[I].disconnect(y))}x=null,m=null,t.setRenderTarget(d),c=null,f=null,u=null,n=null,p=null,F.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(I){s=I,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(I){o=I,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(I){l=I},this.getBaseLayer=function(){return f!==null?f:c},this.getBinding=function(){return u},this.getFrame=function(){return _},this.getSession=function(){return n},this.setSession=async function(I){if(n=I,n!==null){if(d=t.getRenderTarget(),n.addEventListener("select",w),n.addEventListener("selectstart",w),n.addEventListener("selectend",w),n.addEventListener("squeeze",w),n.addEventListener("squeezestart",w),n.addEventListener("squeezeend",w),n.addEventListener("end",R),n.addEventListener("inputsourceschange",M),g.xrCompatible!==!0&&await e.makeXRCompatible(),n.renderState.layers===void 0||t.capabilities.isWebGL2===!1){const y={antialias:n.renderState.layers===void 0?g.antialias:!0,alpha:g.alpha,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s};c=new XRWebGLLayer(n,e,y),n.updateRenderState({baseLayer:c}),p=new Yn(c.framebufferWidth,c.framebufferHeight,{format:kr,type:Xs,encoding:t.outputEncoding,stencilBuffer:g.stencil})}else{let y=null,k=null,U=null;g.depth&&(U=g.stencil?35056:33190,y=g.stencil?ao:Bs,k=g.stencil?Wa:As);const N={colorFormat:32856,depthFormat:U,scaleFactor:s};u=new XRWebGLBinding(n,e),f=u.createProjectionLayer(N),n.updateRenderState({layers:[f]}),p=new Yn(f.textureWidth,f.textureHeight,{format:kr,type:Xs,depthTexture:new MA(f.textureWidth,f.textureHeight,k,void 0,void 0,void 0,void 0,void 0,void 0,y),stencilBuffer:g.stencil,encoding:t.outputEncoding,samples:g.antialias?4:0});const W=t.properties.get(p);W.__ignoreDepthValues=f.ignoreDepthValues}p.isXRRenderTarget=!0,this.setFoveation(1),l=null,a=await n.requestReferenceSpace(o),F.setContext(n),F.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function M(I){for(let y=0;y<I.removed.length;y++){const k=I.removed[y],U=A.indexOf(k);U>=0&&(A[U]=null,v[U].dispatchEvent({type:"disconnected",data:k}))}for(let y=0;y<I.added.length;y++){const k=I.added[y];let U=A.indexOf(k);if(U===-1){for(let W=0;W<v.length;W++)if(W>=A.length){A.push(k),U=W;break}else if(A[W]===null){A[W]=k,U=W;break}if(U===-1)break}const N=v[U];N&&N.dispatchEvent({type:"connected",data:k})}}const C=new ot,b=new ot;function D(I,y,k){C.setFromMatrixPosition(y.matrixWorld),b.setFromMatrixPosition(k.matrixWorld);const U=C.distanceTo(b),N=y.projectionMatrix.elements,W=k.projectionMatrix.elements,G=N[14]/(N[10]-1),z=N[14]/(N[10]+1),X=(N[9]+1)/N[5],K=(N[9]-1)/N[5],$=(N[8]-1)/N[0],q=(W[8]+1)/W[0],J=G*$,Q=G*q,rt=U/(-$+q),mt=rt*-$;y.matrixWorld.decompose(I.position,I.quaternion,I.scale),I.translateX(mt),I.translateZ(rt),I.matrixWorld.compose(I.position,I.quaternion,I.scale),I.matrixWorldInverse.copy(I.matrixWorld).invert();const vt=G+rt,_t=z+rt,tt=J-mt,Lt=Q+(U-mt),dt=X*z/_t*vt,Tt=K*z/_t*vt;I.projectionMatrix.makePerspective(tt,Lt,dt,Tt,vt,_t)}function O(I,y){y===null?I.matrixWorld.copy(I.matrix):I.matrixWorld.multiplyMatrices(y.matrixWorld,I.matrix),I.matrixWorldInverse.copy(I.matrixWorld).invert()}this.updateCamera=function(I){if(n===null)return;T.near=S.near=E.near=I.near,T.far=S.far=E.far=I.far,(x!==T.near||m!==T.far)&&(n.updateRenderState({depthNear:T.near,depthFar:T.far}),x=T.near,m=T.far);const y=I.parent,k=T.cameras;O(T,y);for(let N=0;N<k.length;N++)O(k[N],y);T.matrixWorld.decompose(T.position,T.quaternion,T.scale),I.matrix.copy(T.matrix),I.matrix.decompose(I.position,I.quaternion,I.scale);const U=I.children;for(let N=0,W=U.length;N<W;N++)U[N].updateMatrixWorld(!0);k.length===2?D(T,E,S):T.projectionMatrix.copy(E.projectionMatrix)},this.getCamera=function(){return T},this.getFoveation=function(){if(f!==null)return f.fixedFoveation;if(c!==null)return c.fixedFoveation},this.setFoveation=function(I){f!==null&&(f.fixedFoveation=I),c!==null&&c.fixedFoveation!==void 0&&(c.fixedFoveation=I)};let B=null;function P(I,y){if(h=y.getViewerPose(l||a),_=y,h!==null){const k=h.views;c!==null&&(t.setRenderTargetFramebuffer(p,c.framebuffer),t.setRenderTarget(p));let U=!1;k.length!==T.cameras.length&&(T.cameras.length=0,U=!0);for(let N=0;N<k.length;N++){const W=k[N];let G=null;if(c!==null)G=c.getViewport(W);else{const X=u.getViewSubImage(f,W);G=X.viewport,N===0&&(t.setRenderTargetTextures(p,X.colorTexture,f.ignoreDepthValues?void 0:X.depthStencilTexture),t.setRenderTarget(p))}let z=L[N];z===void 0&&(z=new ir,z.layers.enable(N),z.viewport=new Qe,L[N]=z),z.matrix.fromArray(W.transform.matrix),z.projectionMatrix.fromArray(W.projectionMatrix),z.viewport.set(G.x,G.y,G.width,G.height),N===0&&T.matrix.copy(z.matrix),U===!0&&T.cameras.push(z)}}for(let k=0;k<v.length;k++){const U=A[k],N=v[k];U!==null&&N!==void 0&&N.update(U,y,l||a)}B&&B(I,y),_=null}const F=new s0;F.setAnimationLoop(P),this.setAnimationLoop=function(I){B=I},this.dispose=function(){}}}function LA(r,t){function e(d,p){d.fogColor.value.copy(p.color),p.isFog?(d.fogNear.value=p.near,d.fogFar.value=p.far):p.isFogExp2&&(d.fogDensity.value=p.density)}function i(d,p,v,A,E){p.isMeshBasicMaterial||p.isMeshLambertMaterial?n(d,p):p.isMeshToonMaterial?(n(d,p),u(d,p)):p.isMeshPhongMaterial?(n(d,p),h(d,p)):p.isMeshStandardMaterial?(n(d,p),f(d,p),p.isMeshPhysicalMaterial&&c(d,p,E)):p.isMeshMatcapMaterial?(n(d,p),_(d,p)):p.isMeshDepthMaterial?n(d,p):p.isMeshDistanceMaterial?(n(d,p),g(d,p)):p.isMeshNormalMaterial?n(d,p):p.isLineBasicMaterial?(s(d,p),p.isLineDashedMaterial&&a(d,p)):p.isPointsMaterial?o(d,p,v,A):p.isSpriteMaterial?l(d,p):p.isShadowMaterial?(d.color.value.copy(p.color),d.opacity.value=p.opacity):p.isShaderMaterial&&(p.uniformsNeedUpdate=!1)}function n(d,p){d.opacity.value=p.opacity,p.color&&d.diffuse.value.copy(p.color),p.emissive&&d.emissive.value.copy(p.emissive).multiplyScalar(p.emissiveIntensity),p.map&&(d.map.value=p.map),p.alphaMap&&(d.alphaMap.value=p.alphaMap),p.bumpMap&&(d.bumpMap.value=p.bumpMap,d.bumpScale.value=p.bumpScale,p.side===hr&&(d.bumpScale.value*=-1)),p.displacementMap&&(d.displacementMap.value=p.displacementMap,d.displacementScale.value=p.displacementScale,d.displacementBias.value=p.displacementBias),p.emissiveMap&&(d.emissiveMap.value=p.emissiveMap),p.normalMap&&(d.normalMap.value=p.normalMap,d.normalScale.value.copy(p.normalScale),p.side===hr&&d.normalScale.value.negate()),p.specularMap&&(d.specularMap.value=p.specularMap),p.alphaTest>0&&(d.alphaTest.value=p.alphaTest);const v=t.get(p).envMap;if(v&&(d.envMap.value=v,d.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,d.reflectivity.value=p.reflectivity,d.ior.value=p.ior,d.refractionRatio.value=p.refractionRatio),p.lightMap){d.lightMap.value=p.lightMap;const S=r.physicallyCorrectLights!==!0?Math.PI:1;d.lightMapIntensity.value=p.lightMapIntensity*S}p.aoMap&&(d.aoMap.value=p.aoMap,d.aoMapIntensity.value=p.aoMapIntensity);let A;p.map?A=p.map:p.specularMap?A=p.specularMap:p.displacementMap?A=p.displacementMap:p.normalMap?A=p.normalMap:p.bumpMap?A=p.bumpMap:p.roughnessMap?A=p.roughnessMap:p.metalnessMap?A=p.metalnessMap:p.alphaMap?A=p.alphaMap:p.emissiveMap?A=p.emissiveMap:p.clearcoatMap?A=p.clearcoatMap:p.clearcoatNormalMap?A=p.clearcoatNormalMap:p.clearcoatRoughnessMap?A=p.clearcoatRoughnessMap:p.iridescenceMap?A=p.iridescenceMap:p.iridescenceThicknessMap?A=p.iridescenceThicknessMap:p.specularIntensityMap?A=p.specularIntensityMap:p.specularColorMap?A=p.specularColorMap:p.transmissionMap?A=p.transmissionMap:p.thicknessMap?A=p.thicknessMap:p.sheenColorMap?A=p.sheenColorMap:p.sheenRoughnessMap&&(A=p.sheenRoughnessMap),A!==void 0&&(A.isWebGLRenderTarget&&(A=A.texture),A.matrixAutoUpdate===!0&&A.updateMatrix(),d.uvTransform.value.copy(A.matrix));let E;p.aoMap?E=p.aoMap:p.lightMap&&(E=p.lightMap),E!==void 0&&(E.isWebGLRenderTarget&&(E=E.texture),E.matrixAutoUpdate===!0&&E.updateMatrix(),d.uv2Transform.value.copy(E.matrix))}function s(d,p){d.diffuse.value.copy(p.color),d.opacity.value=p.opacity}function a(d,p){d.dashSize.value=p.dashSize,d.totalSize.value=p.dashSize+p.gapSize,d.scale.value=p.scale}function o(d,p,v,A){d.diffuse.value.copy(p.color),d.opacity.value=p.opacity,d.size.value=p.size*v,d.scale.value=A*.5,p.map&&(d.map.value=p.map),p.alphaMap&&(d.alphaMap.value=p.alphaMap),p.alphaTest>0&&(d.alphaTest.value=p.alphaTest);let E;p.map?E=p.map:p.alphaMap&&(E=p.alphaMap),E!==void 0&&(E.matrixAutoUpdate===!0&&E.updateMatrix(),d.uvTransform.value.copy(E.matrix))}function l(d,p){d.diffuse.value.copy(p.color),d.opacity.value=p.opacity,d.rotation.value=p.rotation,p.map&&(d.map.value=p.map),p.alphaMap&&(d.alphaMap.value=p.alphaMap),p.alphaTest>0&&(d.alphaTest.value=p.alphaTest);let v;p.map?v=p.map:p.alphaMap&&(v=p.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),d.uvTransform.value.copy(v.matrix))}function h(d,p){d.specular.value.copy(p.specular),d.shininess.value=Math.max(p.shininess,1e-4)}function u(d,p){p.gradientMap&&(d.gradientMap.value=p.gradientMap)}function f(d,p){d.roughness.value=p.roughness,d.metalness.value=p.metalness,p.roughnessMap&&(d.roughnessMap.value=p.roughnessMap),p.metalnessMap&&(d.metalnessMap.value=p.metalnessMap),t.get(p).envMap&&(d.envMapIntensity.value=p.envMapIntensity)}function c(d,p,v){d.ior.value=p.ior,p.sheen>0&&(d.sheenColor.value.copy(p.sheenColor).multiplyScalar(p.sheen),d.sheenRoughness.value=p.sheenRoughness,p.sheenColorMap&&(d.sheenColorMap.value=p.sheenColorMap),p.sheenRoughnessMap&&(d.sheenRoughnessMap.value=p.sheenRoughnessMap)),p.clearcoat>0&&(d.clearcoat.value=p.clearcoat,d.clearcoatRoughness.value=p.clearcoatRoughness,p.clearcoatMap&&(d.clearcoatMap.value=p.clearcoatMap),p.clearcoatRoughnessMap&&(d.clearcoatRoughnessMap.value=p.clearcoatRoughnessMap),p.clearcoatNormalMap&&(d.clearcoatNormalScale.value.copy(p.clearcoatNormalScale),d.clearcoatNormalMap.value=p.clearcoatNormalMap,p.side===hr&&d.clearcoatNormalScale.value.negate())),p.iridescence>0&&(d.iridescence.value=p.iridescence,d.iridescenceIOR.value=p.iridescenceIOR,d.iridescenceThicknessMinimum.value=p.iridescenceThicknessRange[0],d.iridescenceThicknessMaximum.value=p.iridescenceThicknessRange[1],p.iridescenceMap&&(d.iridescenceMap.value=p.iridescenceMap),p.iridescenceThicknessMap&&(d.iridescenceThicknessMap.value=p.iridescenceThicknessMap)),p.transmission>0&&(d.transmission.value=p.transmission,d.transmissionSamplerMap.value=v.texture,d.transmissionSamplerSize.value.set(v.width,v.height),p.transmissionMap&&(d.transmissionMap.value=p.transmissionMap),d.thickness.value=p.thickness,p.thicknessMap&&(d.thicknessMap.value=p.thicknessMap),d.attenuationDistance.value=p.attenuationDistance,d.attenuationColor.value.copy(p.attenuationColor)),d.specularIntensity.value=p.specularIntensity,d.specularColor.value.copy(p.specularColor),p.specularIntensityMap&&(d.specularIntensityMap.value=p.specularIntensityMap),p.specularColorMap&&(d.specularColorMap.value=p.specularColorMap)}function _(d,p){p.matcap&&(d.matcap.value=p.matcap)}function g(d,p){d.referencePosition.value.copy(p.referencePosition),d.nearDistance.value=p.nearDistance,d.farDistance.value=p.farDistance}return{refreshFogUniforms:e,refreshMaterialUniforms:i}}function DA(r,t,e,i){let n={},s={},a=[];const o=e.isWebGL2?r.getParameter(35375):0;function l(A,E){const S=E.program;i.uniformBlockBinding(A,S)}function h(A,E){let S=n[A.id];S===void 0&&(g(A),S=u(A),n[A.id]=S,A.addEventListener("dispose",p));const L=E.program;i.updateUBOMapping(A,L);const T=t.render.frame;s[A.id]!==T&&(c(A),s[A.id]=T)}function u(A){const E=f();A.__bindingPointIndex=E;const S=r.createBuffer(),L=A.__size,T=A.usage;return r.bindBuffer(35345,S),r.bufferData(35345,L,T),r.bindBuffer(35345,null),r.bindBufferBase(35345,E,S),S}function f(){for(let A=0;A<o;A++)if(a.indexOf(A)===-1)return a.push(A),A;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function c(A){const E=n[A.id],S=A.uniforms,L=A.__cache;r.bindBuffer(35345,E);for(let T=0,x=S.length;T<x;T++){const m=S[T];if(_(m,T,L)===!0){const w=m.value,R=m.__offset;typeof w=="number"?(m.__data[0]=w,r.bufferSubData(35345,R,m.__data)):(m.value.isMatrix3?(m.__data[0]=m.value.elements[0],m.__data[1]=m.value.elements[1],m.__data[2]=m.value.elements[2],m.__data[3]=m.value.elements[0],m.__data[4]=m.value.elements[3],m.__data[5]=m.value.elements[4],m.__data[6]=m.value.elements[5],m.__data[7]=m.value.elements[0],m.__data[8]=m.value.elements[6],m.__data[9]=m.value.elements[7],m.__data[10]=m.value.elements[8],m.__data[11]=m.value.elements[0]):w.toArray(m.__data),r.bufferSubData(35345,R,m.__data))}}r.bindBuffer(35345,null)}function _(A,E,S){const L=A.value;if(S[E]===void 0)return typeof L=="number"?S[E]=L:S[E]=L.clone(),!0;if(typeof L=="number"){if(S[E]!==L)return S[E]=L,!0}else{const T=S[E];if(T.equals(L)===!1)return T.copy(L),!0}return!1}function g(A){const E=A.uniforms;let S=0;const L=16;let T=0;for(let x=0,m=E.length;x<m;x++){const w=E[x],R=d(w);if(w.__data=new Float32Array(R.storage/Float32Array.BYTES_PER_ELEMENT),w.__offset=S,x>0){T=S%L;const M=L-T;T!==0&&M-R.boundary<0&&(S+=L-T,w.__offset=S)}S+=R.storage}return T=S%L,T>0&&(S+=L-T),A.__size=S,A.__cache={},this}function d(A){const E=A.value,S={boundary:0,storage:0};return typeof E=="number"?(S.boundary=4,S.storage=4):E.isVector2?(S.boundary=8,S.storage=8):E.isVector3||E.isColor?(S.boundary=16,S.storage=12):E.isVector4?(S.boundary=16,S.storage=16):E.isMatrix3?(S.boundary=48,S.storage=48):E.isMatrix4?(S.boundary=64,S.storage=64):E.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",E),S}function p(A){const E=A.target;E.removeEventListener("dispose",p);const S=a.indexOf(E.__bindingPointIndex);a.splice(S,1),r.deleteBuffer(n[E.id]),delete n[E.id],delete s[E.id]}function v(){for(const A in n)r.deleteBuffer(n[A]);a=[],n={},s={}}return{bind:l,update:h,dispose:v}}function RA(){const r=ru("canvas");return r.style.display="block",r}function c0(r={}){this.isWebGLRenderer=!0;const t=r.canvas!==void 0?r.canvas:RA(),e=r.context!==void 0?r.context:null,i=r.depth!==void 0?r.depth:!0,n=r.stencil!==void 0?r.stencil:!0,s=r.antialias!==void 0?r.antialias:!1,a=r.premultipliedAlpha!==void 0?r.premultipliedAlpha:!0,o=r.preserveDrawingBuffer!==void 0?r.preserveDrawingBuffer:!1,l=r.powerPreference!==void 0?r.powerPreference:"default",h=r.failIfMajorPerformanceCaveat!==void 0?r.failIfMajorPerformanceCaveat:!1;let u;e!==null?u=e.getContextAttributes().alpha:u=r.alpha!==void 0?r.alpha:!1;let f=null,c=null;const _=[],g=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Ks,this.physicallyCorrectLights=!1,this.toneMapping=mn,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const d=this;let p=!1,v=0,A=0,E=null,S=-1,L=null;const T=new Qe,x=new Qe;let m=null,w=t.width,R=t.height,M=1,C=null,b=null;const D=new Qe(0,0,w,R),O=new Qe(0,0,w,R);let B=!1;const P=new n0;let F=!1,I=!1,y=null;const k=new ai,U=new ae,N=new ot,W={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function G(){return E===null?M:1}let z=e;function X(j,nt){for(let st=0;st<j.length;st++){const et=j[st],ft=t.getContext(et,nt);if(ft!==null)return ft}return null}try{const j={alpha:!0,depth:i,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Gf}`),t.addEventListener("webglcontextlost",Ut,!1),t.addEventListener("webglcontextrestored",Vt,!1),t.addEventListener("webglcontextcreationerror",Ft,!1),z===null){const nt=["webgl2","webgl","experimental-webgl"];if(d.isWebGL1Renderer===!0&&nt.shift(),z=X(nt,j),z===null)throw X(nt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}z.getShaderPrecisionFormat===void 0&&(z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(j){throw console.error("THREE.WebGLRenderer: "+j.message),j}let K,$,q,J,Q,rt,mt,vt,_t,tt,Lt,dt,Tt,Ht,Y,V,it,at,ut,ct,St,gt,ht,wt;function Nt(){K=new W1(z),$=new B1(z,K,r),K.init($),gt=new SA(z,K,$),q=new TA(z,K,$),J=new X1,Q=new lA,rt=new bA(z,K,q,Q,$,gt,J),mt=new U1(d),vt=new z1(d),_t=new ib(z,$),ht=new O1(z,K,_t,$),tt=new H1(z,_t,J,ht),Lt=new $1(z,tt,_t,J),ut=new Y1(z,$,rt),V=new k1(Q),dt=new oA(d,mt,vt,K,$,ht,V),Tt=new LA(d,Q),Ht=new uA,Y=new gA(K,$),at=new I1(d,mt,q,Lt,u,a),it=new EA(d,Lt,$),wt=new DA(z,J,$,q),ct=new F1(z,K,J,$),St=new V1(z,K,J,$),J.programs=dt.programs,d.capabilities=$,d.extensions=K,d.properties=Q,d.renderLists=Ht,d.shadowMap=it,d.state=q,d.info=J}Nt();const Mt=new CA(d,z);this.xr=Mt,this.getContext=function(){return z},this.getContextAttributes=function(){return z.getContextAttributes()},this.forceContextLoss=function(){const j=K.get("WEBGL_lose_context");j&&j.loseContext()},this.forceContextRestore=function(){const j=K.get("WEBGL_lose_context");j&&j.restoreContext()},this.getPixelRatio=function(){return M},this.setPixelRatio=function(j){j!==void 0&&(M=j,this.setSize(w,R,!1))},this.getSize=function(j){return j.set(w,R)},this.setSize=function(j,nt,st){if(Mt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}w=j,R=nt,t.width=Math.floor(j*M),t.height=Math.floor(nt*M),st!==!1&&(t.style.width=j+"px",t.style.height=nt+"px"),this.setViewport(0,0,j,nt)},this.getDrawingBufferSize=function(j){return j.set(w*M,R*M).floor()},this.setDrawingBufferSize=function(j,nt,st){w=j,R=nt,M=st,t.width=Math.floor(j*st),t.height=Math.floor(nt*st),this.setViewport(0,0,j,nt)},this.getCurrentViewport=function(j){return j.copy(T)},this.getViewport=function(j){return j.copy(D)},this.setViewport=function(j,nt,st,et){j.isVector4?D.set(j.x,j.y,j.z,j.w):D.set(j,nt,st,et),q.viewport(T.copy(D).multiplyScalar(M).floor())},this.getScissor=function(j){return j.copy(O)},this.setScissor=function(j,nt,st,et){j.isVector4?O.set(j.x,j.y,j.z,j.w):O.set(j,nt,st,et),q.scissor(x.copy(O).multiplyScalar(M).floor())},this.getScissorTest=function(){return B},this.setScissorTest=function(j){q.setScissorTest(B=j)},this.setOpaqueSort=function(j){C=j},this.setTransparentSort=function(j){b=j},this.getClearColor=function(j){return j.copy(at.getClearColor())},this.setClearColor=function(){at.setClearColor.apply(at,arguments)},this.getClearAlpha=function(){return at.getClearAlpha()},this.setClearAlpha=function(){at.setClearAlpha.apply(at,arguments)},this.clear=function(j=!0,nt=!0,st=!0){let et=0;j&&(et|=16384),nt&&(et|=256),st&&(et|=1024),z.clear(et)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ut,!1),t.removeEventListener("webglcontextrestored",Vt,!1),t.removeEventListener("webglcontextcreationerror",Ft,!1),Ht.dispose(),Y.dispose(),Q.dispose(),mt.dispose(),vt.dispose(),Lt.dispose(),ht.dispose(),wt.dispose(),dt.dispose(),Mt.dispose(),Mt.removeEventListener("sessionstart",Bt),Mt.removeEventListener("sessionend",ee),y&&(y.dispose(),y=null),ie.stop()};function Ut(j){j.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),p=!0}function Vt(){console.log("THREE.WebGLRenderer: Context Restored."),p=!1;const j=J.autoReset,nt=it.enabled,st=it.autoUpdate,et=it.needsUpdate,ft=it.type;Nt(),J.autoReset=j,it.enabled=nt,it.autoUpdate=st,it.needsUpdate=et,it.type=ft}function Ft(j){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",j.statusMessage)}function Z(j){const nt=j.target;nt.removeEventListener("dispose",Z),Et(nt)}function Et(j){yt(j),Q.remove(j)}function yt(j){const nt=Q.get(j).programs;nt!==void 0&&(nt.forEach(function(st){dt.releaseProgram(st)}),j.isShaderMaterial&&dt.releaseShaderCache(j))}this.renderBufferDirect=function(j,nt,st,et,ft,Dt){nt===null&&(nt=W);const kt=ft.isMesh&&ft.matrixWorld.determinant()<0,zt=ye(j,nt,st,et,ft);q.setMaterial(et,kt);let Zt=st.index;const ne=st.attributes.position;if(Zt===null){if(ne===void 0||ne.count===0)return}else if(Zt.count===0)return;let Kt=1;et.wireframe===!0&&(Zt=tt.getWireframeAttribute(st),Kt=2),ht.setup(ft,et,zt,st,Zt);let Xt,fe=ct;Zt!==null&&(Xt=_t.get(Zt),fe=St,fe.setIndex(Xt));const Ii=Zt!==null?Zt.count:ne.count,$r=st.drawRange.start*Kt,Yi=st.drawRange.count*Kt,li=Dt!==null?Dt.start*Kt:0,ge=Dt!==null?Dt.count*Kt:1/0,ea=Math.max($r,li),Ge=Math.min(Ii,$r+Yi,li+ge)-1,$i=Math.max(0,Ge-ea+1);if($i!==0){if(ft.isMesh)et.wireframe===!0?(q.setLineWidth(et.wireframeLinewidth*G()),fe.setMode(1)):fe.setMode(4);else if(ft.isLine){let Tn=et.linewidth;Tn===void 0&&(Tn=1),q.setLineWidth(Tn*G()),ft.isLineSegments?fe.setMode(1):ft.isLineLoop?fe.setMode(2):fe.setMode(3)}else ft.isPoints?fe.setMode(0):ft.isSprite&&fe.setMode(4);if(ft.isInstancedMesh)fe.renderInstances(ea,$i,ft.count);else if(st.isInstancedBufferGeometry){const Tn=Math.min(st.instanceCount,st._maxInstanceCount);fe.renderInstances(ea,$i,Tn)}else fe.render(ea,$i)}},this.compile=function(j,nt){function st(et,ft,Dt){et.transparent===!0&&et.side===Br?(et.side=hr,et.needsUpdate=!0,It(et,ft,Dt),et.side=ro,et.needsUpdate=!0,It(et,ft,Dt),et.side=Br):It(et,ft,Dt)}c=Y.get(j),c.init(),g.push(c),j.traverseVisible(function(et){et.isLight&&et.layers.test(nt.layers)&&(c.pushLight(et),et.castShadow&&c.pushShadow(et))}),c.setupLights(d.physicallyCorrectLights),j.traverse(function(et){const ft=et.material;if(ft)if(Array.isArray(ft))for(let Dt=0;Dt<ft.length;Dt++){const kt=ft[Dt];st(kt,j,et)}else st(ft,j,et)}),g.pop(),c=null};let lt=null;function xt(j){lt&&lt(j)}function Bt(){ie.stop()}function ee(){ie.start()}const ie=new s0;ie.setAnimationLoop(xt),typeof self<"u"&&ie.setContext(self),this.setAnimationLoop=function(j){lt=j,Mt.setAnimationLoop(j),j===null?ie.stop():ie.start()},Mt.addEventListener("sessionstart",Bt),Mt.addEventListener("sessionend",ee),this.render=function(j,nt){if(nt!==void 0&&nt.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(p===!0)return;j.matrixWorldAutoUpdate===!0&&j.updateMatrixWorld(),nt.parent===null&&nt.matrixWorldAutoUpdate===!0&&nt.updateMatrixWorld(),Mt.enabled===!0&&Mt.isPresenting===!0&&(Mt.cameraAutoUpdate===!0&&Mt.updateCamera(nt),nt=Mt.getCamera()),j.isScene===!0&&j.onBeforeRender(d,j,nt,E),c=Y.get(j,g.length),c.init(),g.push(c),k.multiplyMatrices(nt.projectionMatrix,nt.matrixWorldInverse),P.setFromProjectionMatrix(k),I=this.localClippingEnabled,F=V.init(this.clippingPlanes,I,nt),f=Ht.get(j,_.length),f.init(),_.push(f),Be(j,nt,0,d.sortObjects),f.finish(),d.sortObjects===!0&&f.sort(C,b),F===!0&&V.beginShadows();const st=c.state.shadowsArray;if(it.render(st,j,nt),F===!0&&V.endShadows(),this.info.autoReset===!0&&this.info.reset(),at.render(f,j),c.setupLights(d.physicallyCorrectLights),nt.isArrayCamera){const et=nt.cameras;for(let ft=0,Dt=et.length;ft<Dt;ft++){const kt=et[ft];re(f,j,kt,kt.viewport)}}else re(f,j,nt);E!==null&&(rt.updateMultisampleRenderTarget(E),rt.updateRenderTargetMipmap(E)),j.isScene===!0&&j.onAfterRender(d,j,nt),ht.resetDefaultState(),S=-1,L=null,g.pop(),g.length>0?c=g[g.length-1]:c=null,_.pop(),_.length>0?f=_[_.length-1]:f=null};function Be(j,nt,st,et){if(j.visible===!1)return;if(j.layers.test(nt.layers)){if(j.isGroup)st=j.renderOrder;else if(j.isLOD)j.autoUpdate===!0&&j.update(nt);else if(j.isLight)c.pushLight(j),j.castShadow&&c.pushShadow(j);else if(j.isSprite){if(!j.frustumCulled||P.intersectsSprite(j)){et&&N.setFromMatrixPosition(j.matrixWorld).applyMatrix4(k);const kt=Lt.update(j),zt=j.material;zt.visible&&f.push(j,kt,zt,st,N.z,null)}}else if((j.isMesh||j.isLine||j.isPoints)&&(j.isSkinnedMesh&&j.skeleton.frame!==J.render.frame&&(j.skeleton.update(),j.skeleton.frame=J.render.frame),!j.frustumCulled||P.intersectsObject(j))){et&&N.setFromMatrixPosition(j.matrixWorld).applyMatrix4(k);const kt=Lt.update(j),zt=j.material;if(Array.isArray(zt)){const Zt=kt.groups;for(let ne=0,Kt=Zt.length;ne<Kt;ne++){const Xt=Zt[ne],fe=zt[Xt.materialIndex];fe&&fe.visible&&f.push(j,kt,fe,st,N.z,Xt)}}else zt.visible&&f.push(j,kt,zt,st,N.z,null)}}const Dt=j.children;for(let kt=0,zt=Dt.length;kt<zt;kt++)Be(Dt[kt],nt,st,et)}function re(j,nt,st,et){const ft=j.opaque,Dt=j.transmissive,kt=j.transparent;c.setupLightsView(st),Dt.length>0&&Qt(ft,nt,st),et&&q.viewport(T.copy(et)),ft.length>0&&pt(ft,nt,st),Dt.length>0&&pt(Dt,nt,st),kt.length>0&&pt(kt,nt,st),q.buffers.depth.setTest(!0),q.buffers.depth.setMask(!0),q.buffers.color.setMask(!0),q.setPolygonOffset(!1)}function Qt(j,nt,st){const et=$.isWebGL2;y===null&&(y=new Yn(1,1,{generateMipmaps:!0,type:K.has("EXT_color_buffer_half_float")?sl:Xs,minFilter:Tu,samples:et&&s===!0?4:0})),d.getDrawingBufferSize(U),et?y.setSize(U.x,U.y):y.setSize(kd(U.x),kd(U.y));const ft=d.getRenderTarget();d.setRenderTarget(y),d.clear();const Dt=d.toneMapping;d.toneMapping=mn,pt(j,nt,st),d.toneMapping=Dt,rt.updateMultisampleRenderTarget(y),rt.updateRenderTargetMipmap(y),d.setRenderTarget(ft)}function pt(j,nt,st){const et=nt.isScene===!0?nt.overrideMaterial:null;for(let ft=0,Dt=j.length;ft<Dt;ft++){const kt=j[ft],zt=kt.object,Zt=kt.geometry,ne=et===null?kt.material:et,Kt=kt.group;zt.layers.test(st.layers)&&Rt(zt,nt,st,Zt,ne,Kt)}}function Rt(j,nt,st,et,ft,Dt){j.onBeforeRender(d,nt,st,et,ft,Dt),j.modelViewMatrix.multiplyMatrices(st.matrixWorldInverse,j.matrixWorld),j.normalMatrix.getNormalMatrix(j.modelViewMatrix),ft.onBeforeRender(d,nt,st,et,j,Dt),ft.transparent===!0&&ft.side===Br?(ft.side=hr,ft.needsUpdate=!0,d.renderBufferDirect(st,nt,et,ft,j,Dt),ft.side=ro,ft.needsUpdate=!0,d.renderBufferDirect(st,nt,et,ft,j,Dt),ft.side=Br):d.renderBufferDirect(st,nt,et,ft,j,Dt),j.onAfterRender(d,nt,st,et,ft,Dt)}function It(j,nt,st){nt.isScene!==!0&&(nt=W);const et=Q.get(j),ft=c.state.lights,Dt=c.state.shadowsArray,kt=ft.state.version,zt=dt.getParameters(j,ft.state,Dt,nt,st),Zt=dt.getProgramCacheKey(zt);let ne=et.programs;et.environment=j.isMeshStandardMaterial?nt.environment:null,et.fog=nt.fog,et.envMap=(j.isMeshStandardMaterial?vt:mt).get(j.envMap||et.environment),ne===void 0&&(j.addEventListener("dispose",Z),ne=new Map,et.programs=ne);let Kt=ne.get(Zt);if(Kt!==void 0){if(et.currentProgram===Kt&&et.lightsStateVersion===kt)return jt(j,zt),Kt}else zt.uniforms=dt.getUniforms(j),j.onBuild(st,zt,d),j.onBeforeCompile(zt,d),Kt=dt.acquireProgram(zt,Zt),ne.set(Zt,Kt),et.uniforms=zt.uniforms;const Xt=et.uniforms;(!j.isShaderMaterial&&!j.isRawShaderMaterial||j.clipping===!0)&&(Xt.clippingPlanes=V.uniform),jt(j,zt),et.needsLights=Ee(j),et.lightsStateVersion=kt,et.needsLights&&(Xt.ambientLightColor.value=ft.state.ambient,Xt.lightProbe.value=ft.state.probe,Xt.directionalLights.value=ft.state.directional,Xt.directionalLightShadows.value=ft.state.directionalShadow,Xt.spotLights.value=ft.state.spot,Xt.spotLightShadows.value=ft.state.spotShadow,Xt.rectAreaLights.value=ft.state.rectArea,Xt.ltc_1.value=ft.state.rectAreaLTC1,Xt.ltc_2.value=ft.state.rectAreaLTC2,Xt.pointLights.value=ft.state.point,Xt.pointLightShadows.value=ft.state.pointShadow,Xt.hemisphereLights.value=ft.state.hemi,Xt.directionalShadowMap.value=ft.state.directionalShadowMap,Xt.directionalShadowMatrix.value=ft.state.directionalShadowMatrix,Xt.spotShadowMap.value=ft.state.spotShadowMap,Xt.spotLightMatrix.value=ft.state.spotLightMatrix,Xt.spotLightMap.value=ft.state.spotLightMap,Xt.pointShadowMap.value=ft.state.pointShadowMap,Xt.pointShadowMatrix.value=ft.state.pointShadowMatrix);const fe=Kt.getUniforms(),Ii=kh.seqWithValue(fe.seq,Xt);return et.currentProgram=Kt,et.uniformsList=Ii,Kt}function jt(j,nt){const st=Q.get(j);st.outputEncoding=nt.outputEncoding,st.instancing=nt.instancing,st.skinning=nt.skinning,st.morphTargets=nt.morphTargets,st.morphNormals=nt.morphNormals,st.morphColors=nt.morphColors,st.morphTargetsCount=nt.morphTargetsCount,st.numClippingPlanes=nt.numClippingPlanes,st.numIntersection=nt.numClipIntersection,st.vertexAlphas=nt.vertexAlphas,st.vertexTangents=nt.vertexTangents,st.toneMapping=nt.toneMapping}function ye(j,nt,st,et,ft){nt.isScene!==!0&&(nt=W),rt.resetTextureUnits();const Dt=nt.fog,kt=et.isMeshStandardMaterial?nt.environment:null,zt=E===null?d.outputEncoding:E.isXRRenderTarget===!0?E.texture.encoding:Ks,Zt=(et.isMeshStandardMaterial?vt:mt).get(et.envMap||kt),ne=et.vertexColors===!0&&!!st.attributes.color&&st.attributes.color.itemSize===4,Kt=!!et.normalMap&&!!st.attributes.tangent,Xt=!!st.morphAttributes.position,fe=!!st.morphAttributes.normal,Ii=!!st.morphAttributes.color,$r=et.toneMapped?d.toneMapping:mn,Yi=st.morphAttributes.position||st.morphAttributes.normal||st.morphAttributes.color,li=Yi!==void 0?Yi.length:0,ge=Q.get(et),ea=c.state.lights;if(F===!0&&(I===!0||j!==L)){const Oi=j===L&&et.id===S;V.setState(et,j,Oi)}let Ge=!1;et.version===ge.__version?(ge.needsLights&&ge.lightsStateVersion!==ea.state.version||ge.outputEncoding!==zt||ft.isInstancedMesh&&ge.instancing===!1||!ft.isInstancedMesh&&ge.instancing===!0||ft.isSkinnedMesh&&ge.skinning===!1||!ft.isSkinnedMesh&&ge.skinning===!0||ge.envMap!==Zt||et.fog===!0&&ge.fog!==Dt||ge.numClippingPlanes!==void 0&&(ge.numClippingPlanes!==V.numPlanes||ge.numIntersection!==V.numIntersection)||ge.vertexAlphas!==ne||ge.vertexTangents!==Kt||ge.morphTargets!==Xt||ge.morphNormals!==fe||ge.morphColors!==Ii||ge.toneMapping!==$r||$.isWebGL2===!0&&ge.morphTargetsCount!==li)&&(Ge=!0):(Ge=!0,ge.__version=et.version);let $i=ge.currentProgram;Ge===!0&&($i=It(et,nt,ft));let Tn=!1,fo=!1,Bu=!1;const mi=$i.getUniforms(),is=ge.uniforms;if(q.useProgram($i.program)&&(Tn=!0,fo=!0,Bu=!0),et.id!==S&&(S=et.id,fo=!0),Tn||L!==j){if(mi.setValue(z,"projectionMatrix",j.projectionMatrix),$.logarithmicDepthBuffer&&mi.setValue(z,"logDepthBufFC",2/(Math.log(j.far+1)/Math.LN2)),L!==j&&(L=j,fo=!0,Bu=!0),et.isShaderMaterial||et.isMeshPhongMaterial||et.isMeshToonMaterial||et.isMeshStandardMaterial||et.envMap){const Oi=mi.map.cameraPosition;Oi!==void 0&&Oi.setValue(z,N.setFromMatrixPosition(j.matrixWorld))}(et.isMeshPhongMaterial||et.isMeshToonMaterial||et.isMeshLambertMaterial||et.isMeshBasicMaterial||et.isMeshStandardMaterial||et.isShaderMaterial)&&mi.setValue(z,"isOrthographic",j.isOrthographicCamera===!0),(et.isMeshPhongMaterial||et.isMeshToonMaterial||et.isMeshLambertMaterial||et.isMeshBasicMaterial||et.isMeshStandardMaterial||et.isShaderMaterial||et.isShadowMaterial||ft.isSkinnedMesh)&&mi.setValue(z,"viewMatrix",j.matrixWorldInverse)}if(ft.isSkinnedMesh){mi.setOptional(z,ft,"bindMatrix"),mi.setOptional(z,ft,"bindMatrixInverse");const Oi=ft.skeleton;Oi&&($.floatVertexTextures?(Oi.boneTexture===null&&Oi.computeBoneTexture(),mi.setValue(z,"boneTexture",Oi.boneTexture,rt),mi.setValue(z,"boneTextureSize",Oi.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const ku=st.morphAttributes;if((ku.position!==void 0||ku.normal!==void 0||ku.color!==void 0&&$.isWebGL2===!0)&&ut.update(ft,st,et,$i),(fo||ge.receiveShadow!==ft.receiveShadow)&&(ge.receiveShadow=ft.receiveShadow,mi.setValue(z,"receiveShadow",ft.receiveShadow)),et.isMeshGouraudMaterial&&et.envMap!==null&&(is.envMap.value=Zt,is.flipEnvMap.value=Zt.isCubeTexture&&Zt.isRenderTargetTexture===!1?-1:1),fo&&(mi.setValue(z,"toneMappingExposure",d.toneMappingExposure),ge.needsLights&&te(is,Bu),Dt&&et.fog===!0&&Tt.refreshFogUniforms(is,Dt),Tt.refreshMaterialUniforms(is,et,M,R,y),kh.upload(z,ge.uniformsList,is,rt)),et.isShaderMaterial&&et.uniformsNeedUpdate===!0&&(kh.upload(z,ge.uniformsList,is,rt),et.uniformsNeedUpdate=!1),et.isSpriteMaterial&&mi.setValue(z,"center",ft.center),mi.setValue(z,"modelViewMatrix",ft.modelViewMatrix),mi.setValue(z,"normalMatrix",ft.normalMatrix),mi.setValue(z,"modelMatrix",ft.matrixWorld),et.isShaderMaterial||et.isRawShaderMaterial){const Oi=et.uniformsGroups;for(let Uu=0,ey=Oi.length;Uu<ey;Uu++)if($.isWebGL2){const lp=Oi[Uu];wt.update(lp,$i),wt.bind(lp,$i)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return $i}function te(j,nt){j.ambientLightColor.needsUpdate=nt,j.lightProbe.needsUpdate=nt,j.directionalLights.needsUpdate=nt,j.directionalLightShadows.needsUpdate=nt,j.pointLights.needsUpdate=nt,j.pointLightShadows.needsUpdate=nt,j.spotLights.needsUpdate=nt,j.spotLightShadows.needsUpdate=nt,j.rectAreaLights.needsUpdate=nt,j.hemisphereLights.needsUpdate=nt}function Ee(j){return j.isMeshLambertMaterial||j.isMeshToonMaterial||j.isMeshPhongMaterial||j.isMeshStandardMaterial||j.isShadowMaterial||j.isShaderMaterial&&j.lights===!0}this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return A},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(j,nt,st){Q.get(j.texture).__webglTexture=nt,Q.get(j.depthTexture).__webglTexture=st;const et=Q.get(j);et.__hasExternalTextures=!0,et.__hasExternalTextures&&(et.__autoAllocateDepthBuffer=st===void 0,et.__autoAllocateDepthBuffer||K.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),et.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(j,nt){const st=Q.get(j);st.__webglFramebuffer=nt,st.__useDefaultFramebuffer=nt===void 0},this.setRenderTarget=function(j,nt=0,st=0){E=j,v=nt,A=st;let et=!0;if(j){const Zt=Q.get(j);Zt.__useDefaultFramebuffer!==void 0?(q.bindFramebuffer(36160,null),et=!1):Zt.__webglFramebuffer===void 0?rt.setupRenderTarget(j):Zt.__hasExternalTextures&&rt.rebindTextures(j,Q.get(j.texture).__webglTexture,Q.get(j.depthTexture).__webglTexture)}let ft=null,Dt=!1,kt=!1;if(j){const Zt=j.texture;(Zt.isData3DTexture||Zt.isDataArrayTexture)&&(kt=!0);const ne=Q.get(j).__webglFramebuffer;j.isWebGLCubeRenderTarget?(ft=ne[nt],Dt=!0):$.isWebGL2&&j.samples>0&&rt.useMultisampledRTT(j)===!1?ft=Q.get(j).__webglMultisampledFramebuffer:ft=ne,T.copy(j.viewport),x.copy(j.scissor),m=j.scissorTest}else T.copy(D).multiplyScalar(M).floor(),x.copy(O).multiplyScalar(M).floor(),m=B;if(q.bindFramebuffer(36160,ft)&&$.drawBuffers&&et&&q.drawBuffers(j,ft),q.viewport(T),q.scissor(x),q.setScissorTest(m),Dt){const Zt=Q.get(j.texture);z.framebufferTexture2D(36160,36064,34069+nt,Zt.__webglTexture,st)}else if(kt){const Zt=Q.get(j.texture),ne=nt||0;z.framebufferTextureLayer(36160,36064,Zt.__webglTexture,st||0,ne)}S=-1},this.readRenderTargetPixels=function(j,nt,st,et,ft,Dt,kt){if(!(j&&j.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let zt=Q.get(j).__webglFramebuffer;if(j.isWebGLCubeRenderTarget&&kt!==void 0&&(zt=zt[kt]),zt){q.bindFramebuffer(36160,zt);try{const Zt=j.texture,ne=Zt.format,Kt=Zt.type;if(ne!==kr&&gt.convert(ne)!==z.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Xt=Kt===sl&&(K.has("EXT_color_buffer_half_float")||$.isWebGL2&&K.has("EXT_color_buffer_float"));if(Kt!==Xs&&gt.convert(Kt)!==z.getParameter(35738)&&!(Kt===Ms&&($.isWebGL2||K.has("OES_texture_float")||K.has("WEBGL_color_buffer_float")))&&!Xt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}nt>=0&&nt<=j.width-et&&st>=0&&st<=j.height-ft&&z.readPixels(nt,st,et,ft,gt.convert(ne),gt.convert(Kt),Dt)}finally{const Zt=E!==null?Q.get(E).__webglFramebuffer:null;q.bindFramebuffer(36160,Zt)}}},this.copyFramebufferToTexture=function(j,nt,st=0){const et=Math.pow(2,-st),ft=Math.floor(nt.image.width*et),Dt=Math.floor(nt.image.height*et);rt.setTexture2D(nt,0),z.copyTexSubImage2D(3553,st,0,0,j.x,j.y,ft,Dt),q.unbindTexture()},this.copyTextureToTexture=function(j,nt,st,et=0){const ft=nt.image.width,Dt=nt.image.height,kt=gt.convert(st.format),zt=gt.convert(st.type);rt.setTexture2D(st,0),z.pixelStorei(37440,st.flipY),z.pixelStorei(37441,st.premultiplyAlpha),z.pixelStorei(3317,st.unpackAlignment),nt.isDataTexture?z.texSubImage2D(3553,et,j.x,j.y,ft,Dt,kt,zt,nt.image.data):nt.isCompressedTexture?z.compressedTexSubImage2D(3553,et,j.x,j.y,nt.mipmaps[0].width,nt.mipmaps[0].height,kt,nt.mipmaps[0].data):z.texSubImage2D(3553,et,j.x,j.y,kt,zt,nt.image),et===0&&st.generateMipmaps&&z.generateMipmap(3553),q.unbindTexture()},this.copyTextureToTexture3D=function(j,nt,st,et,ft=0){if(d.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Dt=j.max.x-j.min.x+1,kt=j.max.y-j.min.y+1,zt=j.max.z-j.min.z+1,Zt=gt.convert(et.format),ne=gt.convert(et.type);let Kt;if(et.isData3DTexture)rt.setTexture3D(et,0),Kt=32879;else if(et.isDataArrayTexture)rt.setTexture2DArray(et,0),Kt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}z.pixelStorei(37440,et.flipY),z.pixelStorei(37441,et.premultiplyAlpha),z.pixelStorei(3317,et.unpackAlignment);const Xt=z.getParameter(3314),fe=z.getParameter(32878),Ii=z.getParameter(3316),$r=z.getParameter(3315),Yi=z.getParameter(32877),li=st.isCompressedTexture?st.mipmaps[0]:st.image;z.pixelStorei(3314,li.width),z.pixelStorei(32878,li.height),z.pixelStorei(3316,j.min.x),z.pixelStorei(3315,j.min.y),z.pixelStorei(32877,j.min.z),st.isDataTexture||st.isData3DTexture?z.texSubImage3D(Kt,ft,nt.x,nt.y,nt.z,Dt,kt,zt,Zt,ne,li.data):st.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),z.compressedTexSubImage3D(Kt,ft,nt.x,nt.y,nt.z,Dt,kt,zt,Zt,li.data)):z.texSubImage3D(Kt,ft,nt.x,nt.y,nt.z,Dt,kt,zt,Zt,ne,li),z.pixelStorei(3314,Xt),z.pixelStorei(32878,fe),z.pixelStorei(3316,Ii),z.pixelStorei(3315,$r),z.pixelStorei(32877,Yi),ft===0&&et.generateMipmaps&&z.generateMipmap(Kt),q.unbindTexture()},this.initTexture=function(j){j.isCubeTexture?rt.setTextureCube(j,0):j.isData3DTexture?rt.setTexture3D(j,0):j.isDataArrayTexture?rt.setTexture2DArray(j,0):rt.setTexture2D(j,0),q.unbindTexture()},this.resetState=function(){v=0,A=0,E=null,q.reset(),ht.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class PA extends c0{}PA.prototype.isWebGL1Renderer=!0;class Hf extends Ki{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),e}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Gf}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Gf);const d0=120,sg=d0/2*(Math.PI/180),IA=.1,OA=1e3;class FA extends ir{constructor(e,i){super(d0,e/i,IA,OA);H(this,"resize",(e,i)=>{const n=i/2/Math.tan(sg);this.aspect=e/i,this.position.z=n,this.updateProjectionMatrix()});const n=i/2/Math.tan(sg);this.position.z=n}}const BA=`#define GLSLIFY 1
vec4 alphaBlend(vec4 bg,vec4 fg){float a=(fg.a+bg.a)-fg.a*bg.a;vec3 rgb=(fg.rgb*fg.a+bg.rgb*(1.0-fg.a)*bg.a)/a;return vec4(rgb,a);}varying vec2 vUv;uniform vec2 uResolution;uniform vec4 uGradation1;uniform vec4 uGradation2;uniform vec4 uGradation3;uniform vec3 uMove1;uniform vec3 uMove2;uniform vec3 uMove3;uniform bool uDebug;vec4 rgb(vec4 rgba){return vec4(rgba.r/255.0,rgba.g/255.0,rgba.b/255.0,rgba.a);}float circle(float radius,vec2 center,vec2 uv){vec2 px=uResolution*uv;vec2 centerPx=center*uResolution;float radiusPx=uResolution.x*radius;float thresholdDistance=distance(centerPx,vec2(centerPx.x,centerPx.y-radiusPx));float d=distance(centerPx,px);float ratio=1.0-(d/thresholdDistance);if(uDebug){return mix(1.0,0.0,step(thresholdDistance,d));}return smoothstep(0.0,1.0,ratio+0.3);}void main(){vec2 uv=vUv;vec2 resolution=uResolution;vec4 baseColor=vec4(rgb(vec4(30.0,40.0,100.0,1.0)));vec4 gradation1=rgb(uGradation1);vec4 gradation2=rgb(uGradation2);vec4 gradation3=rgb(uGradation3);vec3 move1=uMove1;vec3 move2=uMove2;vec3 move3=uMove3;vec4 color=baseColor;float radius1=move1.z;float alpha1=circle(radius1,move1.xy,uv);vec4 circle1=vec4(gradation1.rgb,alpha1*gradation1.a);color=alphaBlend(color,circle1);float radius2=move2.z;float alpha2=circle(radius2,move2.xy,uv);vec4 circle2=vec4(gradation2.rgb,alpha2*gradation2.a);color=alphaBlend(color,circle2);float radius3=move3.z;float alpha3=circle(radius3,move3.xy,uv);vec4 circle3=vec4(gradation3.rgb,alpha3*gradation3.a);color=alphaBlend(color,circle3);gl_FragColor=color;}`,kA=`#define GLSLIFY 1
varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}`;class UA extends a0{constructor(t,e){super(t*-.5,t*.5,e*.5,e*-.5,0,1e4)}resize(t,e){this.left=t*-.5,this.right=t*.5,this.top=e*.5,this.bottom=e*-.5,this.updateProjectionMatrix()}}var Ko=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function NA(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Re={exports:{}},Ha=typeof Reflect=="object"?Reflect:null,ag=Ha&&typeof Ha.apply=="function"?Ha.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)},Uh;Ha&&typeof Ha.ownKeys=="function"?Uh=Ha.ownKeys:Object.getOwnPropertySymbols?Uh=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Uh=function(t){return Object.getOwnPropertyNames(t)};function GA(r){console&&console.warn&&console.warn(r)}var f0=Number.isNaN||function(t){return t!==t};function ve(){ve.init.call(this)}Re.exports=ve;Re.exports.once=VA;ve.EventEmitter=ve;ve.prototype._events=void 0;ve.prototype._eventsCount=0;ve.prototype._maxListeners=void 0;var og=10;function wu(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(ve,"defaultMaxListeners",{enumerable:!0,get:function(){return og},set:function(r){if(typeof r!="number"||r<0||f0(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");og=r}});ve.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ve.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||f0(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function p0(r){return r._maxListeners===void 0?ve.defaultMaxListeners:r._maxListeners}ve.prototype.getMaxListeners=function(){return p0(this)};ve.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var n=t==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var l=s[t];if(l===void 0)return!1;if(typeof l=="function")ag(l,this,e);else for(var h=l.length,u=x0(l,h),i=0;i<h;++i)ag(u[i],this,e);return!0};function m0(r,t,e,i){var n,s,a;if(wu(e),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",t,e.listener?e.listener:e),s=r._events),a=s[t]),a===void 0)a=s[t]=e,++r._eventsCount;else if(typeof a=="function"?a=s[t]=i?[e,a]:[a,e]:i?a.unshift(e):a.push(e),n=p0(r),n>0&&a.length>n&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=r,o.type=t,o.count=a.length,GA(o)}return r}ve.prototype.addListener=function(t,e){return m0(this,t,e,!1)};ve.prototype.on=ve.prototype.addListener;ve.prototype.prependListener=function(t,e){return m0(this,t,e,!0)};function zA(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g0(r,t,e){var i={fired:!1,wrapFn:void 0,target:r,type:t,listener:e},n=zA.bind(i);return n.listener=e,i.wrapFn=n,n}ve.prototype.once=function(t,e){return wu(e),this.on(t,g0(this,t,e)),this};ve.prototype.prependOnceListener=function(t,e){return wu(e),this.prependListener(t,g0(this,t,e)),this};ve.prototype.removeListener=function(t,e){var i,n,s,a,o;if(wu(e),n=this._events,n===void 0)return this;if(i=n[t],i===void 0)return this;if(i===e||i.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if(typeof i!="function"){for(s=-1,a=i.length-1;a>=0;a--)if(i[a]===e||i[a].listener===e){o=i[a].listener,s=a;break}if(s<0)return this;s===0?i.shift():WA(i,s),i.length===1&&(n[t]=i[0]),n.removeListener!==void 0&&this.emit("removeListener",t,o||e)}return this};ve.prototype.off=ve.prototype.removeListener;ve.prototype.removeAllListeners=function(t){var e,i,n;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[t]),this;if(arguments.length===0){var s=Object.keys(i),a;for(n=0;n<s.length;++n)a=s[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=i[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this};function _0(r,t,e){var i=r._events;if(i===void 0)return[];var n=i[t];return n===void 0?[]:typeof n=="function"?e?[n.listener||n]:[n]:e?HA(n):x0(n,n.length)}ve.prototype.listeners=function(t){return _0(this,t,!0)};ve.prototype.rawListeners=function(t){return _0(this,t,!1)};ve.listenerCount=function(r,t){return typeof r.listenerCount=="function"?r.listenerCount(t):v0.call(r,t)};ve.prototype.listenerCount=v0;function v0(r){var t=this._events;if(t!==void 0){var e=t[r];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}ve.prototype.eventNames=function(){return this._eventsCount>0?Uh(this._events):[]};function x0(r,t){for(var e=new Array(t),i=0;i<t;++i)e[i]=r[i];return e}function WA(r,t){for(;t+1<r.length;t++)r[t]=r[t+1];r.pop()}function HA(r){for(var t=new Array(r.length),e=0;e<t.length;++e)t[e]=r[e].listener||r[e];return t}function VA(r,t){return new Promise(function(e,i){function n(a){r.removeListener(t,s),i(a)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",n),e([].slice.call(arguments))}y0(r,t,s,{once:!0}),t!=="error"&&XA(r,n,{once:!0})})}function XA(r,t,e){typeof r.on=="function"&&y0(r,"error",t,e)}function y0(r,t,e,i){if(typeof r.on=="function")i.once?r.once(t,e):r.on(t,e);else if(typeof r.addEventListener=="function")r.addEventListener(t,function n(s){i.once&&r.removeEventListener(t,n),e(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.17.0
 * @author George Michael Brower
 * @license MIT
 */class Hr{constructor(t,e,i,n,s="div"){this.parent=t,this.object=e,this.property=i,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(n),this.$name=document.createElement("div"),this.$name.classList.add("name"),Hr.nextNameID=Hr.nextNameID||0,this.$name.id=`lil-gui-name-${++Hr.nextNameID}`,this.$widget=document.createElement(s),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(i)}name(t){return this._name=t,this.$name.innerHTML=t,this}onChange(t){return this._onChange=t,this}_callOnChange(){this.parent._callOnChange(this),this._onChange!==void 0&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(t=!0){return this.disable(!t)}disable(t=!0){return t===this._disabled?this:(this._disabled=t,this.domElement.classList.toggle("disabled",t),this.$disable.toggleAttribute("disabled",t),this)}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(t){const e=this.parent.add(this.object,this.property,t);return e.name(this._name),this.destroy(),e}min(t){return this}max(t){return this}step(t){return this}decimals(t){return this}listen(t=!0){return this._listening=t,this._listenCallbackID!==void 0&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const t=this.save();t!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=t}getValue(){return this.object[this.property]}setValue(t){return this.object[this.property]=t,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(t){return this.setValue(t),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class KA extends Hr{constructor(t,e,i){super(t,e,i,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function Nd(r){let t,e;return(t=r.match(/(#|0x)?([a-f0-9]{6})/i))?e=t[2]:(t=r.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?e=parseInt(t[1]).toString(16).padStart(2,0)+parseInt(t[2]).toString(16).padStart(2,0)+parseInt(t[3]).toString(16).padStart(2,0):(t=r.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(e=t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),e?"#"+e:!1}const jA={isPrimitive:!0,match:r=>typeof r=="string",fromHexString:Nd,toHexString:Nd},al={isPrimitive:!0,match:r=>typeof r=="number",fromHexString:r=>parseInt(r.substring(1),16),toHexString:r=>"#"+r.toString(16).padStart(6,0)},YA={isPrimitive:!1,match:Array.isArray,fromHexString(r,t,e=1){const i=al.fromHexString(r);t[0]=(i>>16&255)/255*e,t[1]=(i>>8&255)/255*e,t[2]=(i&255)/255*e},toHexString([r,t,e],i=1){i=255/i;const n=r*i<<16^t*i<<8^e*i<<0;return al.toHexString(n)}},$A={isPrimitive:!1,match:r=>Object(r)===r,fromHexString(r,t,e=1){const i=al.fromHexString(r);t.r=(i>>16&255)/255*e,t.g=(i>>8&255)/255*e,t.b=(i&255)/255*e},toHexString({r,g:t,b:e},i=1){i=255/i;const n=r*i<<16^t*i<<8^e*i<<0;return al.toHexString(n)}},qA=[jA,al,YA,$A];function ZA(r){return qA.find(t=>t.match(r))}class JA extends Hr{constructor(t,e,i,n){super(t,e,i,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=ZA(this.initialValue),this._rgbScale=n,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const s=Nd(this.$text.value);s&&this._setValueFromHexString(s)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(t){if(this._format.isPrimitive){const e=this._format.fromHexString(t);this.setValue(e)}else this._format.fromHexString(t,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(t){return this._setValueFromHexString(t),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class Ic extends Hr{constructor(t,e,i){super(t,e,i,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",n=>{n.preventDefault(),this.getValue().call(this.object)}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class QA extends Hr{constructor(t,e,i,n,s,a){super(t,e,i,"number"),this._initInput(),this.min(n),this.max(s);const o=a!==void 0;this.step(o?a:this._getImplicitStep(),o),this.updateDisplay()}decimals(t){return this._decimals=t,this.updateDisplay(),this}min(t){return this._min=t,this._onUpdateMinMax(),this}max(t){return this._max=t,this._onUpdateMinMax(),this}step(t,e=!0){return this._step=t,this._stepExplicit=e,this}updateDisplay(){const t=this.getValue();if(this._hasSlider){let e=(t-this._min)/(this._max-this._min);e=Math.max(0,Math.min(e,1)),this.$fill.style.width=e*100+"%"}return this._inputFocused||(this.$input.value=this._decimals===void 0?t:t.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$disable=this.$input;const t=()=>{let v=parseFloat(this.$input.value);isNaN(v)||(this._stepExplicit&&(v=this._snap(v)),this.setValue(this._clamp(v)))},e=v=>{const A=parseFloat(this.$input.value);isNaN(A)||(this._snapClampSetValue(A+v),this.$input.value=this.getValue())},i=v=>{v.code==="Enter"&&this.$input.blur(),v.code==="ArrowUp"&&(v.preventDefault(),e(this._step*this._arrowKeyMultiplier(v))),v.code==="ArrowDown"&&(v.preventDefault(),e(this._step*this._arrowKeyMultiplier(v)*-1))},n=v=>{this._inputFocused&&(v.preventDefault(),e(this._step*this._normalizeMouseWheel(v)))};let s=!1,a,o,l,h,u;const f=5,c=v=>{a=v.clientX,o=l=v.clientY,s=!0,h=this.getValue(),u=0,window.addEventListener("mousemove",_),window.addEventListener("mouseup",g)},_=v=>{if(s){const A=v.clientX-a,E=v.clientY-o;Math.abs(E)>f?(v.preventDefault(),this.$input.blur(),s=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(A)>f&&g()}if(!s){const A=v.clientY-l;u-=A*this._step*this._arrowKeyMultiplier(v),h+u>this._max?u=this._max-h:h+u<this._min&&(u=this._min-h),this._snapClampSetValue(h+u)}l=v.clientY},g=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",g)},d=()=>{this._inputFocused=!0},p=()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()};this.$input.addEventListener("input",t),this.$input.addEventListener("keydown",i),this.$input.addEventListener("wheel",n,{passive:!1}),this.$input.addEventListener("mousedown",c),this.$input.addEventListener("focus",d),this.$input.addEventListener("blur",p)}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const t=(v,A,E,S,L)=>(v-A)/(E-A)*(L-S)+S,e=v=>{const A=this.$slider.getBoundingClientRect();let E=t(v,A.left,A.right,this._min,this._max);this._snapClampSetValue(E)},i=v=>{this._setDraggingStyle(!0),e(v.clientX),window.addEventListener("mousemove",n),window.addEventListener("mouseup",s)},n=v=>{e(v.clientX)},s=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",s)};let a=!1,o,l;const h=v=>{v.preventDefault(),this._setDraggingStyle(!0),e(v.touches[0].clientX),a=!1},u=v=>{v.touches.length>1||(this._hasScrollBar?(o=v.touches[0].clientX,l=v.touches[0].clientY,a=!0):h(v),window.addEventListener("touchmove",f,{passive:!1}),window.addEventListener("touchend",c))},f=v=>{if(a){const A=v.touches[0].clientX-o,E=v.touches[0].clientY-l;Math.abs(A)>Math.abs(E)?h(v):(window.removeEventListener("touchmove",f),window.removeEventListener("touchend",c))}else v.preventDefault(),e(v.touches[0].clientX)},c=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",f),window.removeEventListener("touchend",c)},_=this._callOnFinishChange.bind(this),g=400;let d;const p=v=>{if(Math.abs(v.deltaX)<Math.abs(v.deltaY)&&this._hasScrollBar)return;v.preventDefault();const E=this._normalizeMouseWheel(v)*this._step;this._snapClampSetValue(this.getValue()+E),this.$input.value=this.getValue(),clearTimeout(d),d=setTimeout(_,g)};this.$slider.addEventListener("mousedown",i),this.$slider.addEventListener("touchstart",u,{passive:!1}),this.$slider.addEventListener("wheel",p,{passive:!1})}_setDraggingStyle(t,e="horizontal"){this.$slider&&this.$slider.classList.toggle("active",t),document.body.classList.toggle("lil-gui-dragging",t),document.body.classList.toggle(`lil-gui-${e}`,t)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(t){let{deltaX:e,deltaY:i}=t;return Math.floor(t.deltaY)!==t.deltaY&&t.wheelDelta&&(e=0,i=-t.wheelDelta/120,i*=this._stepExplicit?1:10),e+-i}_arrowKeyMultiplier(t){let e=this._stepExplicit?1:10;return t.shiftKey?e*=10:t.altKey&&(e/=10),e}_snap(t){const e=Math.round(t/this._step)*this._step;return parseFloat(e.toPrecision(15))}_clamp(t){return t<this._min&&(t=this._min),t>this._max&&(t=this._max),t}_snapClampSetValue(t){this.setValue(this._clamp(this._snap(t)))}get _hasScrollBar(){const t=this.parent.root.$children;return t.scrollHeight>t.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class tM extends Hr{constructor(t,e,i,n){super(t,e,i,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(n)?n:Object.values(n),this._names=Array.isArray(n)?n:Object.keys(n),this._names.forEach(s=>{const a=document.createElement("option");a.innerHTML=s,this.$select.appendChild(a)}),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const t=this.getValue(),e=this._values.indexOf(t);return this.$select.selectedIndex=e,this.$display.innerHTML=e===-1?t:this._names[e],this}}class eM extends Hr{constructor(t,e,i){super(t,e,i,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",n=>{n.code==="Enter"&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}const iM=`.lil-gui {
  font-family: var(--font-family);
  font-size: var(--font-size);
  line-height: 1;
  font-weight: normal;
  font-style: normal;
  text-align: left;
  background-color: var(--background-color);
  color: var(--text-color);
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  --background-color: #1f1f1f;
  --text-color: #ebebeb;
  --title-background-color: #111111;
  --title-text-color: #ebebeb;
  --widget-color: #424242;
  --hover-color: #4f4f4f;
  --focus-color: #595959;
  --number-color: #2cc9ff;
  --string-color: #a2db3c;
  --font-size: 11px;
  --input-font-size: 11px;
  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;
  --padding: 4px;
  --spacing: 4px;
  --widget-height: 20px;
  --name-width: 45%;
  --slider-knob-width: 2px;
  --slider-input-width: 27%;
  --color-input-width: 27%;
  --slider-input-min-width: 45px;
  --color-input-min-width: 45px;
  --folder-indent: 7px;
  --widget-padding: 0 0 0 3px;
  --widget-border-radius: 2px;
  --checkbox-size: calc(0.75 * var(--widget-height));
  --scrollbar-width: 5px;
}
.lil-gui, .lil-gui * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
.lil-gui.root {
  width: var(--width, 245px);
  display: flex;
  flex-direction: column;
}
.lil-gui.root > .title {
  background: var(--title-background-color);
  color: var(--title-text-color);
}
.lil-gui.root > .children {
  overflow-x: hidden;
  overflow-y: auto;
}
.lil-gui.root > .children::-webkit-scrollbar {
  width: var(--scrollbar-width);
  height: var(--scrollbar-width);
  background: var(--background-color);
}
.lil-gui.root > .children::-webkit-scrollbar-thumb {
  border-radius: var(--scrollbar-width);
  background: var(--focus-color);
}
@media (pointer: coarse) {
  .lil-gui.allow-touch-styles {
    --widget-height: 28px;
    --padding: 6px;
    --spacing: 6px;
    --font-size: 13px;
    --input-font-size: 16px;
    --folder-indent: 10px;
    --scrollbar-width: 7px;
    --slider-input-min-width: 50px;
    --color-input-min-width: 65px;
  }
}
.lil-gui.force-touch-styles {
  --widget-height: 28px;
  --padding: 6px;
  --spacing: 6px;
  --font-size: 13px;
  --input-font-size: 16px;
  --folder-indent: 10px;
  --scrollbar-width: 7px;
  --slider-input-min-width: 50px;
  --color-input-min-width: 65px;
}
.lil-gui.autoPlace {
  max-height: 100%;
  position: fixed;
  top: 0;
  right: 15px;
  z-index: 1001;
}

.lil-gui .controller {
  display: flex;
  align-items: center;
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
}
.lil-gui .controller.disabled {
  opacity: 0.5;
}
.lil-gui .controller.disabled, .lil-gui .controller.disabled * {
  pointer-events: none !important;
}
.lil-gui .controller > .name {
  min-width: var(--name-width);
  flex-shrink: 0;
  white-space: pre;
  padding-right: var(--spacing);
  line-height: var(--widget-height);
}
.lil-gui .controller .widget {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  min-height: var(--widget-height);
}
.lil-gui .controller.string input {
  color: var(--string-color);
}
.lil-gui .controller.boolean .widget {
  cursor: pointer;
}
.lil-gui .controller.color .display {
  width: 100%;
  height: var(--widget-height);
  border-radius: var(--widget-border-radius);
  position: relative;
}
@media (hover: hover) {
  .lil-gui .controller.color .display:hover:before {
    content: " ";
    display: block;
    position: absolute;
    border-radius: var(--widget-border-radius);
    border: 1px solid #fff9;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
.lil-gui .controller.color input[type=color] {
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.lil-gui .controller.color input[type=text] {
  margin-left: var(--spacing);
  font-family: var(--font-family-mono);
  min-width: var(--color-input-min-width);
  width: var(--color-input-width);
  flex-shrink: 0;
}
.lil-gui .controller.option select {
  opacity: 0;
  position: absolute;
  width: 100%;
  max-width: 100%;
}
.lil-gui .controller.option .display {
  position: relative;
  pointer-events: none;
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  line-height: var(--widget-height);
  max-width: 100%;
  overflow: hidden;
  word-break: break-all;
  padding-left: 0.55em;
  padding-right: 1.75em;
  background: var(--widget-color);
}
@media (hover: hover) {
  .lil-gui .controller.option .display.focus {
    background: var(--focus-color);
  }
}
.lil-gui .controller.option .display.active {
  background: var(--focus-color);
}
.lil-gui .controller.option .display:after {
  font-family: "lil-gui";
  content: "\u2195";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  padding-right: 0.375em;
}
.lil-gui .controller.option .widget,
.lil-gui .controller.option select {
  cursor: pointer;
}
@media (hover: hover) {
  .lil-gui .controller.option .widget:hover .display {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number input {
  color: var(--number-color);
}
.lil-gui .controller.number.hasSlider input {
  margin-left: var(--spacing);
  width: var(--slider-input-width);
  min-width: var(--slider-input-min-width);
  flex-shrink: 0;
}
.lil-gui .controller.number .slider {
  width: 100%;
  height: var(--widget-height);
  background-color: var(--widget-color);
  border-radius: var(--widget-border-radius);
  padding-right: var(--slider-knob-width);
  overflow: hidden;
  cursor: ew-resize;
  touch-action: pan-y;
}
@media (hover: hover) {
  .lil-gui .controller.number .slider:hover {
    background-color: var(--hover-color);
  }
}
.lil-gui .controller.number .slider.active {
  background-color: var(--focus-color);
}
.lil-gui .controller.number .slider.active .fill {
  opacity: 0.95;
}
.lil-gui .controller.number .fill {
  height: 100%;
  border-right: var(--slider-knob-width) solid var(--number-color);
  box-sizing: content-box;
}

.lil-gui-dragging .lil-gui {
  --hover-color: var(--widget-color);
}
.lil-gui-dragging * {
  cursor: ew-resize !important;
}

.lil-gui-dragging.lil-gui-vertical * {
  cursor: ns-resize !important;
}

.lil-gui .title {
  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);
  height: var(--title-height);
  line-height: calc(var(--title-height) - 4px);
  font-weight: 600;
  padding: 0 var(--padding);
  -webkit-tap-highlight-color: transparent;
  cursor: pointer;
  outline: none;
  text-decoration-skip: objects;
}
.lil-gui .title:before {
  font-family: "lil-gui";
  content: "\u25BE";
  padding-right: 2px;
  display: inline-block;
}
.lil-gui .title:active {
  background: var(--title-background-color);
  opacity: 0.75;
}
@media (hover: hover) {
  body:not(.lil-gui-dragging) .lil-gui .title:hover {
    background: var(--title-background-color);
    opacity: 0.85;
  }
  .lil-gui .title:focus {
    text-decoration: underline var(--focus-color);
  }
}
.lil-gui.root > .title:focus {
  text-decoration: none !important;
}
.lil-gui.closed > .title:before {
  content: "\u25B8";
}
.lil-gui.closed > .children {
  transform: translateY(-7px);
  opacity: 0;
}
.lil-gui.closed:not(.transition) > .children {
  display: none;
}
.lil-gui.transition > .children {
  transition-duration: 300ms;
  transition-property: height, opacity, transform;
  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);
  overflow: hidden;
  pointer-events: none;
}
.lil-gui .children:empty:before {
  content: "Empty";
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
  display: block;
  height: var(--widget-height);
  font-style: italic;
  line-height: var(--widget-height);
  opacity: 0.5;
}
.lil-gui.root > .children > .lil-gui > .title {
  border: 0 solid var(--widget-color);
  border-width: 1px 0;
  transition: border-color 300ms;
}
.lil-gui.root > .children > .lil-gui.closed > .title {
  border-bottom-color: transparent;
}
.lil-gui + .controller {
  border-top: 1px solid var(--widget-color);
  margin-top: 0;
  padding-top: var(--spacing);
}
.lil-gui .lil-gui .lil-gui > .title {
  border: none;
}
.lil-gui .lil-gui .lil-gui > .children {
  border: none;
  margin-left: var(--folder-indent);
  border-left: 2px solid var(--widget-color);
}
.lil-gui .lil-gui .controller {
  border: none;
}

.lil-gui input {
  -webkit-tap-highlight-color: transparent;
  border: 0;
  outline: none;
  font-family: var(--font-family);
  font-size: var(--input-font-size);
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  background: var(--widget-color);
  color: var(--text-color);
  width: 100%;
}
@media (hover: hover) {
  .lil-gui input:hover {
    background: var(--hover-color);
  }
  .lil-gui input:active {
    background: var(--focus-color);
  }
}
.lil-gui input:disabled {
  opacity: 1;
}
.lil-gui input[type=text],
.lil-gui input[type=number] {
  padding: var(--widget-padding);
}
.lil-gui input[type=text]:focus,
.lil-gui input[type=number]:focus {
  background: var(--focus-color);
}
.lil-gui input::-webkit-outer-spin-button,
.lil-gui input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
.lil-gui input[type=number] {
  -moz-appearance: textfield;
}
.lil-gui input[type=checkbox] {
  appearance: none;
  -webkit-appearance: none;
  height: var(--checkbox-size);
  width: var(--checkbox-size);
  border-radius: var(--widget-border-radius);
  text-align: center;
  cursor: pointer;
}
.lil-gui input[type=checkbox]:checked:before {
  font-family: "lil-gui";
  content: "\u2713";
  font-size: var(--checkbox-size);
  line-height: var(--checkbox-size);
}
@media (hover: hover) {
  .lil-gui input[type=checkbox]:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui button {
  -webkit-tap-highlight-color: transparent;
  outline: none;
  cursor: pointer;
  font-family: var(--font-family);
  font-size: var(--font-size);
  color: var(--text-color);
  width: 100%;
  height: var(--widget-height);
  text-transform: none;
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
  border: 1px solid var(--widget-color);
  text-align: center;
  line-height: calc(var(--widget-height) - 4px);
}
@media (hover: hover) {
  .lil-gui button:hover {
    background: var(--hover-color);
    border-color: var(--hover-color);
  }
  .lil-gui button:focus {
    border-color: var(--focus-color);
  }
}
.lil-gui button:active {
  background: var(--focus-color);
}

@font-face {
  font-family: "lil-gui";
  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");
}`;function rM(r){const t=document.createElement("style");t.innerHTML=r;const e=document.querySelector("head link[rel=stylesheet], head style");e?document.head.insertBefore(t,e):document.head.appendChild(t)}let lg=!1;class Vf{constructor({parent:t,autoPlace:e=t===void 0,container:i,width:n,title:s="Controls",injectStyles:a=!0,touchStyles:o=!0}={}){if(this.parent=t,this.root=t?t.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",l=>{(l.code==="Enter"||l.code==="Space")&&(l.preventDefault(),this.$title.click())}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(s),o&&this.domElement.classList.add("allow-touch-styles"),this.parent){this.parent.children.push(this),this.parent.folders.push(this),this.parent.$children.appendChild(this.domElement);return}this.domElement.classList.add("root"),!lg&&a&&(rM(iM),lg=!0),i?i.appendChild(this.domElement):e&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),n&&this.domElement.style.setProperty("--width",n+"px"),this.domElement.addEventListener("keydown",l=>l.stopPropagation()),this.domElement.addEventListener("keyup",l=>l.stopPropagation())}add(t,e,i,n,s){if(Object(i)===i)return new tM(this,t,e,i);const a=t[e];switch(typeof a){case"number":return new QA(this,t,e,i,n,s);case"boolean":return new KA(this,t,e);case"string":return new eM(this,t,e);case"function":return new Ic(this,t,e)}console.error(`gui.add failed
	property:`,e,`
	object:`,t,`
	value:`,a)}addColor(t,e,i=1){return new JA(this,t,e,i)}addFolder(t){return new Vf({parent:this,title:t})}load(t,e=!0){return t.controllers&&this.controllers.forEach(i=>{i instanceof Ic||i._name in t.controllers&&i.load(t.controllers[i._name])}),e&&t.folders&&this.folders.forEach(i=>{i._title in t.folders&&i.load(t.folders[i._title])}),this}save(t=!0){const e={controllers:{},folders:{}};return this.controllers.forEach(i=>{if(!(i instanceof Ic)){if(i._name in e.controllers)throw new Error(`Cannot save GUI with duplicate property "${i._name}"`);e.controllers[i._name]=i.save()}}),t&&this.folders.forEach(i=>{if(i._title in e.folders)throw new Error(`Cannot save GUI with duplicate folder "${i._title}"`);e.folders[i._title]=i.save()}),e}open(t=!0){return this._closed=!t,this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(t=!0){return this._closed=!t,this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const e=this.$children.clientHeight;this.$children.style.height=e+"px",this.domElement.classList.add("transition");const i=s=>{s.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",i))};this.$children.addEventListener("transitionend",i);const n=t?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!t),requestAnimationFrame(()=>{this.$children.style.height=n+"px"})}),this}title(t){return this._title=t,this.$title.innerHTML=t,this}reset(t=!0){return(t?this.controllersRecursive():this.controllers).forEach(i=>i.reset()),this}onChange(t){return this._onChange=t,this}_callOnChange(t){this.parent&&this.parent._callOnChange(t),this._onChange!==void 0&&this._onChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(t){this.parent&&this.parent._callOnFinishChange(t),this._onFinishChange!==void 0&&this._onFinishChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(t=>t.destroy())}controllersRecursive(){let t=Array.from(this.controllers);return this.folders.forEach(e=>{t=t.concat(e.controllersRecursive())}),t}foldersRecursive(){let t=Array.from(this.folders);return this.folders.forEach(e=>{t=t.concat(e.foldersRecursive())}),t}}const gu=class extends Re.exports.EventEmitter{constructor(){super();H(this,"_gui");H(this,"hide",()=>{this._gui.hide()});if(!gu._instance)gu._instance=this;else throw Error("AppVisualGui class is singleton class.")}get gui(){return this._gui}async setup(){this._gui==null&&(this._gui=new Vf({title:"App Visual"}))}};let Nh=gu;H(Nh,"_instance");const nu=new Nh,jo={Group1:"Group1",Group2:"Group2"},hg={[jo.Group1]:nl,[jo.Group2]:FE};class Oc{constructor({type:t,move:e,mouseOffset:i,speed:n,scaleRange:s,alphaRange:a,disable:o=!1,colorIndex:l=0}){H(this,"_type");H(this,"color");H(this,"move");H(this,"_mouseOffset");H(this,"_colorStartedTime");H(this,"_colorDuration",2*1e3);H(this,"_colorDelay",5*1e3);H(this,"_colorIndex",0);H(this,"_speed");H(this,"_scaleRange");H(this,"_alphaRange");H(this,"disabled");this._colorIndex=l,this._type=t;const h=hg[this._type];this.color=new Qe(h[this._colorIndex][0],h[this._colorIndex][1],h[this._colorIndex][2],1),this.move=e,this._mouseOffset=i,this._speed=n,this._scaleRange=s,this._alphaRange=a,this._colorStartedTime=new Date().getTime(),this.disabled=o,this.disabled&&(this.color.w=0)}changeMouseOffset(t){this._mouseOffset.set(t[0],t[1])}show(){const t=(new Date().getTime()+4e3)/(this._alphaRange.speed*1e3)+this._alphaRange.offset*1e3,e=(Math.cos(t)+1)/2,i=(this._alphaRange.max-this._alphaRange.min)*e+this._alphaRange.min;Ot.to(this.color,{w:i,duration:4,ease:"power2.out",onComplete:()=>{this.disabled=!1}})}hide(){Ot.to(this.color,{w:0,duration:5,ease:"power2.out",onStart:()=>{this.disabled=!0}})}update(t,e){this._moveUpdate(t,e),this._colorUpdate(e),this._scaleUpdate(e),this.disabled||this._alphaUpdate(e)}_moveUpdate(t,e){const i=t.x+this._mouseOffset.x-this.move.x,n=t.y+this._mouseOffset.y-this.move.y,s=this.move.x+i*this._speed.x,a=this.move.y+n*this._speed.y,o=this.move.z;this.move.set(s,a,o)}_colorUpdate(t){const e=new Date().getTime()-this._colorStartedTime-this._colorDelay;if(e<0)return;let i=e/this._colorDuration;i>1&&(i=1);const n=hg[this._type],s=this._colorIndex!=n.length-1?this._colorIndex+1:0,a=n[this._colorIndex],o=n[s],l=a[0]+(o[0]-a[0])*i,h=a[1]+(o[1]-a[1])*i,u=a[2]+(o[2]-a[2])*i;this.color.set(l,h,u,this.color.w),i==1&&(this._colorStartedTime=new Date().getTime(),this._colorIndex++,this._colorIndex==n.length&&(this._colorIndex=0))}_scaleUpdate(t){const e=new Date().getTime()/(this._scaleRange.speed*1e3)+this._scaleRange.offset*1e3,i=(Math.cos(e)+1)/2,n=(this._scaleRange.max-this._scaleRange.min)*i+this._scaleRange.min;this.move.z=n}_alphaUpdate(t){const e=new Date().getTime()/(this._alphaRange.speed*1e3)+this._alphaRange.offset*1e3,i=(Math.cos(e)+1)/2,n=(this._alphaRange.max-this._alphaRange.min)*i+this._alphaRange.min;this.color.w=n}}const ug=[[.2,.2],[.8,.8],[.8,.2],[.2,.8]];class nM{constructor(t,e){H(this,"position");H(this,"_timerId",-1);H(this,"_width");H(this,"_height");H(this,"_index",0);H(this,"_onMouseMove",t=>{this._resetTime(),this._setPosition(t.pageX,t.pageY)});H(this,"_onTouchMove",t=>{this._resetTime(),this._setPosition(t.touches[0].pageX,t.touches[0].pageY)});H(this,"_onTouchEnd",()=>{this._setRandomPosition(),this._setTimer()});H(this,"_setPosition",(t,e)=>{this.position.set((t-window.scrollX)/this._width,1-(e-window.scrollY)/this._height)});H(this,"_setRandomPosition",()=>{const t=this._getPresetPosition();this.position.set(t[0],t[1])});H(this,"_resetTime",()=>{this._timerId&&window.clearTimeout(this._timerId)});H(this,"resize",(t,e)=>{this._width=t,this._height=e});this._width=t,this._height=e;const i=this._getPresetPosition();this.position=new ae(i[0],i[1]),this._setTimer(),window.addEventListener("mousemove",this._onMouseMove),document.addEventListener("touchmove",this._onTouchMove),document.addEventListener("touchend",this._onTouchEnd)}_getPresetPosition(){const t=ug[this._index];return this._index++,this._index==ug.length&&(this._index=0),t}_setTimer(){this._resetTime(),this._timerId=window.setTimeout(()=>{this._setRandomPosition(),this._setTimer()},4*1e3)}}const Zi=.3;class sM extends Hf{constructor(e,i,n){super();H(this,"_uniforms");H(this,"_geometry");H(this,"_material");H(this,"_mesh");H(this,"_renderTarget");H(this,"_renderCamera");H(this,"_bgColors",[]);H(this,"_mouse");H(this,"_offsetMouseTimer",-1);H(this,"_changeBgTimer",-1);H(this,"render",e=>(this._bgColors.forEach((i,n)=>i.update(this._mouse.position,n)),e.setRenderTarget(this._renderTarget),e.render(this,this._renderCamera),e.setRenderTarget(null),this._renderTarget.texture));H(this,"resize",(e,i,n)=>{this._uniforms.uResolution.value=new ae(e*n,i*n),this._mouse.resize(e,i),this._mesh.scale.set(e,i,1),this._renderTarget.setSize(e*n,i*n),this._renderCamera.resize(e,i)});const s=fs()?1:1.85;this._bgColors=[new Oc({type:jo.Group1,move:new ot(.8,.5,.35),mouseOffset:new ae(0,0),speed:new ae(.01,.01),scaleRange:{min:.35*s,max:.4*s,speed:3,offset:0},alphaRange:{min:.7,max:.98,speed:3,offset:0}}),new Oc({type:jo.Group2,move:new ot(.7,.8,.3),mouseOffset:new ae(-Zi,-Zi),speed:new ae(.003,.003),scaleRange:{min:.32*s,max:.42*s,speed:5,offset:1},alphaRange:{min:.65,max:.96,speed:3,offset:2}}),new Oc({type:jo.Group2,move:new ot(0,.9,.4),mouseOffset:new ae(Zi,Zi),speed:new ae(.003,.002),scaleRange:{min:.34*s,max:.38*s,speed:4,offset:.5},alphaRange:{min:.6,max:.8,speed:1,offset:1},colorIndex:1,disable:!0})],this._uniforms={uResolution:{value:new ae(e*n,i*n)},uGradation1:{value:this._bgColors[0].color},uGradation2:{value:this._bgColors[1].color},uGradation3:{value:this._bgColors[2].color},uMove1:{value:this._bgColors[0].move},uMove2:{value:this._bgColors[1].move},uMove3:{value:this._bgColors[2].move},uDebug:{value:!1}},this._geometry=new bl(1,1,20,20),this._material=new yn({uniforms:this._uniforms,fragmentShader:BA,vertexShader:kA,side:Br}),this._mesh=new Ur(this._geometry,this._material),this._mesh.scale.set(e,i,1),this._renderCamera=new UA(e,i),this._renderTarget=new Yn(e*n,i*n),this.add(this._mesh),this._mouse=new nM(e,i),nu.gui.addFolder("Gradation").add(this._uniforms.uDebug,"value").name("Debug"),this._changeMouseOffset(),this._changeBg()}_changeMouseOffset(){const e=[[-Zi,-Zi],[Zi,-Zi],[Zi,Zi],[-Zi,Zi]];window.clearTimeout(this._offsetMouseTimer),this._offsetMouseTimer=window.setTimeout(()=>{this._bgColors[1].changeMouseOffset(e[Math.floor(Math.random()*(e.length-.001))]),this._bgColors[2].changeMouseOffset(e[Math.floor(Math.random()*(e.length-.001))]),this._changeMouseOffset()},10*1e3)}_changeBg(){window.clearTimeout(this._changeBgTimer),this._changeBgTimer=window.setTimeout(()=>{this._bgColors[2].disabled?(this._bgColors[1].hide(),this._bgColors[2].show()):(this._bgColors[1].show(),this._bgColors[2].hide()),this._changeBg()},8*1e3)}}const aM=`#define GLSLIFY 1
float rand(vec2 co){return fract(sin(dot(co.xy,vec2(12.9898,78.233)))*43758.5453);}float hermite(float t){return t*t*(3.0-2.0*t);}float dot3(vec3 a,vec3 b){return a.x*b.x+a.y*b.y+a.z*b.z;}float rand(vec3 co){return fract(sin(dot3(co.xyz,vec3(12.9898,78.233,33.87637)))*43758.5453);}float noise_0(vec3 co,float freq){vec3 v=co*vec3(freq,freq,freq);float ix1=floor(v.x);float iy1=floor(v.y);float iz1=floor(v.z);float ix2=floor(v.x+1.0);float iy2=floor(v.y+1.0);float iz2=floor(v.z+1.0);float fx=hermite(fract(v.x));float fy=hermite(fract(v.y));float fz=hermite(fract(v.z));float mix1=mix(mix(rand(vec3(ix1,iy1,iz1)),rand(vec3(ix2,iy1,iz1)),fx),mix(rand(vec3(ix1,iy2,iz1)),rand(vec3(ix2,iy2,iz1)),fx),fy);float mix2=mix(mix(rand(vec3(ix1,iy1,iz2)),rand(vec3(ix2,iy1,iz2)),fx),mix(rand(vec3(ix1,iy2,iz2)),rand(vec3(ix2,iy2,iz2)),fx),fy);return mix(mix1,mix2,fz);}float pnoise(vec3 co,float freq,int steps,float persistence){float value=0.0;float ampl=1.0;float sum=0.0;for(int i=0;i<steps;i++){sum+=ampl;value+=noise_0(co,freq)*ampl;freq*=2.0;ampl*=persistence;}return value/sum;}float noise_0(vec2 co,float frequency){vec2 v=vec2(co.x*frequency,co.y*frequency);float ix1=floor(v.x);float iy1=floor(v.y);float ix2=floor(v.x+1.0);float iy2=floor(v.y+1.0);float fx=hermite(fract(v.x));float fy=hermite(fract(v.y));float fade1=mix(rand(vec2(ix1,iy1)),rand(vec2(ix2,iy1)),fx);float fade2=mix(rand(vec2(ix1,iy2)),rand(vec2(ix2,iy2)),fx);return mix(fade1,fade2,fy);}float pnoise(vec2 co,float freq,int steps,float persistence){float value=0.0;float ampl=1.0;float sum=0.0;for(int i=0;i<steps;i++){sum+=ampl;value+=noise_0(co,freq)*ampl;freq*=2.0;ampl*=persistence;}return value/sum;}varying vec2 vUv;uniform vec2 uResolution;uniform float uOffset;uniform vec2 uScale;uniform sampler2D uTexture;uniform float uTime;void main(){vec2 uv=vUv;vec2 scale=uScale;float noise=pnoise(vec3(uv,uTime*0.0005),10.0,15,0.5);vec4 map=vec4(vec3(noise),1.0);map-=uOffset;map.xyz*=vec3(scale,scale.x)/vec3(1.0);vec2 pos=clamp(vec2(uv.x+map.x,uv.y+map.y),vec2(0,0),vec2(1.0,1.0));vec4 color=texture2D(uTexture,pos);gl_FragColor=color;}`,oM=`#define GLSLIFY 1
varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}`;class lM extends Hf{constructor(e,i,n){super();H(this,"_uniforms");H(this,"_geometry");H(this,"_material");H(this,"_mesh");H(this,"resize",(e,i,n)=>{this._mesh.scale.set(e,i,1),this._uniforms.uResolution.value=new ae(e*n,i*n)});this._uniforms={uResolution:{value:new ae(e*n,i*n)},uOffset:{value:.5},uScale:{value:new ae(.03,.05)},uTime:{value:0},uTexture:{value:void 0}},this._geometry=new bl(1,1,20,20),this._material=new yn({uniforms:this._uniforms,fragmentShader:aM,vertexShader:oM,side:Br}),this._mesh=new Ur(this._geometry,this._material),this._mesh.scale.set(e,i,1);const s=nu.gui.addFolder("Displacement");s.add(this._uniforms.uScale.value,"x",0,.3,.01).name("scale x"),s.add(this._uniforms.uScale.value,"y",0,.3,.01).name("scale y"),this.add(this._mesh)}render(e){this._uniforms.uTexture.value=e,this._uniforms.uTime.value+=1}}class hM{constructor(t){H(this,"_canvas");H(this,"_renderer");H(this,"_tickId");H(this,"_camera");H(this,"_baseScene");H(this,"_gradation");H(this,"_displacement");H(this,"_tick",()=>{this._render(),this._tickId=window.requestAnimationFrame(this._tick)});H(this,"_render",()=>{const t=this._gradation.render(this._renderer);this._displacement.render(t),this._renderer.render(this._baseScene,this._camera)});H(this,"_tickStop",()=>{window.cancelAnimationFrame(this._tickId)});H(this,"resize",()=>{this._canvas.removeAttribute("style");const t=this._canvas.clientWidth,e=this._canvas.clientHeight,i=Kp();this._renderer.setSize(t,e),this._camera.resize(t,e),this._gradation.resize(t,e,i),this._displacement.resize(t,e,i)});this._canvas=t;const e=this._canvas.clientWidth,i=this._canvas.clientHeight,n=Kp();nu.setup(),this._baseScene=new Hf,this._camera=new FA(e,i),this._renderer=new c0({antialias:!0,alpha:!0,canvas:this._canvas}),this._renderer.setSize(e,i),this._renderer.setPixelRatio(n),this._gradation=new sM(e,i,n),this._displacement=new lM(e,i,n),this._baseScene.add(this._displacement),nu.hide(),this._render(),this._tick()}}class uM{constructor(){H(this,"_footer");H(this,"_message");H(this,"_canvas");H(this,"_ctx");H(this,"_setup",()=>{this._message=this._footer.querySelector(".message img"),this._canvas.width=this._canvas.clientWidth*2,this._canvas.height=this._canvas.clientHeight*2,this._ctx.drawImage(this._message,this._message.offsetLeft*2,this._message.offsetTop*2,this._message.clientWidth*2,this._message.clientHeight*2),this._ctx.globalCompositeOperation="source-out",this._ctx.fillStyle="rgba(255, 255, 255, 0.75)",this._ctx.fillRect(0,0,this._canvas.clientWidth*2,this._canvas.clientHeight*2)});H(this,"resize",()=>{this._setup()});this._footer=document.querySelector(".page_footer"),this._canvas=this._footer.querySelector(".footer_canvas"),this._ctx=this._canvas.getContext("2d"),this._setup()}}var Gd={exports:{}};(function(r,t){(function(e,i){var n="1.0.32",s="",a="?",o="function",l="undefined",h="object",u="string",f="major",c="model",_="name",g="type",d="vendor",p="version",v="architecture",A="console",E="mobile",S="tablet",L="smarttv",T="wearable",x="embedded",m=350,w="Amazon",R="Apple",M="ASUS",C="BlackBerry",b="Browser",D="Chrome",O="Edge",B="Firefox",P="Google",F="Huawei",I="LG",y="Microsoft",k="Motorola",U="Opera",N="Samsung",W="Sharp",G="Sony",z="Xiaomi",X="Zebra",K="Facebook",$=function(V,it){var at={};for(var ut in V)it[ut]&&it[ut].length%2===0?at[ut]=it[ut].concat(V[ut]):at[ut]=V[ut];return at},q=function(V){for(var it={},at=0;at<V.length;at++)it[V[at].toUpperCase()]=V[at];return it},J=function(V,it){return typeof V===u?Q(it).indexOf(Q(V))!==-1:!1},Q=function(V){return V.toLowerCase()},rt=function(V){return typeof V===u?V.replace(/[^\d\.]/g,s).split(".")[0]:i},mt=function(V,it){if(typeof V===u)return V=V.replace(/^\s\s*/,s).replace(/\s\s*$/,s),typeof it===l?V:V.substring(0,m)},vt=function(V,it){for(var at=0,ut,ct,St,gt,ht,wt;at<it.length&&!ht;){var Nt=it[at],Mt=it[at+1];for(ut=ct=0;ut<Nt.length&&!ht;)if(ht=Nt[ut++].exec(V),ht)for(St=0;St<Mt.length;St++)wt=ht[++ct],gt=Mt[St],typeof gt===h&&gt.length>0?gt.length===2?typeof gt[1]==o?this[gt[0]]=gt[1].call(this,wt):this[gt[0]]=gt[1]:gt.length===3?typeof gt[1]===o&&!(gt[1].exec&&gt[1].test)?this[gt[0]]=wt?gt[1].call(this,wt,gt[2]):i:this[gt[0]]=wt?wt.replace(gt[1],gt[2]):i:gt.length===4&&(this[gt[0]]=wt?gt[3].call(this,wt.replace(gt[1],gt[2])):i):this[gt]=wt||i;at+=2}},_t=function(V,it){for(var at in it)if(typeof it[at]===h&&it[at].length>0){for(var ut=0;ut<it[at].length;ut++)if(J(it[at][ut],V))return at===a?i:at}else if(J(it[at],V))return at===a?i:at;return V},tt={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Lt={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},dt={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[_,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[_,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_,p],[/opios[\/ ]+([\w\.]+)/i],[p,[_,U+" Mini"]],[/\bopr\/([\w\.]+)/i],[p,[_,U]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[_,p],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[_,"UC"+b]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[p,[_,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[p,[_,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[_,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[_,"IE"]],[/yabrowser\/([\w\.]+)/i],[p,[_,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[_,/(.+)/,"$1 Secure "+b],p],[/\bfocus\/([\w\.]+)/i],[p,[_,B+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[_,U+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[_,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[_,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[_,U+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[_,"MIUI "+b]],[/fxios\/([-\w\.]+)/i],[p,[_,B]],[/\bqihu|(qi?ho?o?|360)browser/i],[[_,"360 "+b]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[_,/(.+)/,"$1 "+b],p],[/(comodo_dragon)\/([\w\.]+)/i],[[_,/_/g," "],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[_,p],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[_],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_,K],p],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[_,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[_,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[_,D+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_,D+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[_,"Android "+b]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[_,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,_],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_,[p,_t,tt]],[/(webkit|khtml)\/([\w\.]+)/i],[_,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_,"Netscape"],p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[_,B+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[_,p]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[v,"amd64"]],[/(ia32(?=;))/i],[[v,Q]],[/((?:i[346]|x)86)[;\)]/i],[[v,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[v,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[v,"armhf"]],[/windows (ce|mobile); ppc;/i],[[v,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[v,/ower/,s,Q]],[/(sun4\w)[;\)]/i],[[v,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[v,Q]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[c,[d,N],[g,S]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[c,[d,N],[g,E]],[/\((ip(?:hone|od)[\w ]*);/i],[c,[d,R],[g,E]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[c,[d,R],[g,S]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[c,[d,F],[g,S]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[c,[d,F],[g,E]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[c,/_/g," "],[d,z],[g,E]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[c,/_/g," "],[d,z],[g,S]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[c,[d,"OPPO"],[g,E]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[c,[d,"Vivo"],[g,E]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[c,[d,"Realme"],[g,E]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[c,[d,k],[g,E]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[c,[d,k],[g,S]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[c,[d,I],[g,S]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[c,[d,I],[g,E]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[c,[d,"Lenovo"],[g,S]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[c,/_/g," "],[d,"Nokia"],[g,E]],[/(pixel c)\b/i],[c,[d,P],[g,S]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[c,[d,P],[g,E]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[d,G],[g,E]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[c,"Xperia Tablet"],[d,G],[g,S]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[c,[d,"OnePlus"],[g,E]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[c,[d,w],[g,S]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[c,/(.+)/g,"Fire Phone $1"],[d,w],[g,E]],[/(playbook);[-\w\),; ]+(rim)/i],[c,d,[g,S]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[c,[d,C],[g,E]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[c,[d,M],[g,S]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[c,[d,M],[g,E]],[/(nexus 9)/i],[c,[d,"HTC"],[g,S]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony(?!-bra))[-_ ]?([-\w]*)/i],[d,[c,/_/g," "],[g,E]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[c,[d,"Acer"],[g,S]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[c,[d,"Meizu"],[g,E]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[c,[d,W],[g,E]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[d,c,[g,E]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[d,c,[g,S]],[/(surface duo)/i],[c,[d,y],[g,S]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[c,[d,"Fairphone"],[g,E]],[/(u304aa)/i],[c,[d,"AT&T"],[g,E]],[/\bsie-(\w*)/i],[c,[d,"Siemens"],[g,E]],[/\b(rct\w+) b/i],[c,[d,"RCA"],[g,S]],[/\b(venue[\d ]{2,7}) b/i],[c,[d,"Dell"],[g,S]],[/\b(q(?:mv|ta)\w+) b/i],[c,[d,"Verizon"],[g,S]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[c,[d,"Barnes & Noble"],[g,S]],[/\b(tm\d{3}\w+) b/i],[c,[d,"NuVision"],[g,S]],[/\b(k88) b/i],[c,[d,"ZTE"],[g,S]],[/\b(nx\d{3}j) b/i],[c,[d,"ZTE"],[g,E]],[/\b(gen\d{3}) b.+49h/i],[c,[d,"Swiss"],[g,E]],[/\b(zur\d{3}) b/i],[c,[d,"Swiss"],[g,S]],[/\b((zeki)?tb.*\b) b/i],[c,[d,"Zeki"],[g,S]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[d,"Dragon Touch"],c,[g,S]],[/\b(ns-?\w{0,9}) b/i],[c,[d,"Insignia"],[g,S]],[/\b((nxa|next)-?\w{0,9}) b/i],[c,[d,"NextBook"],[g,S]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[d,"Voice"],c,[g,E]],[/\b(lvtel\-)?(v1[12]) b/i],[[d,"LvTel"],c,[g,E]],[/\b(ph-1) /i],[c,[d,"Essential"],[g,E]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[c,[d,"Envizen"],[g,S]],[/\b(trio[-\w\. ]+) b/i],[c,[d,"MachSpeed"],[g,S]],[/\btu_(1491) b/i],[c,[d,"Rotor"],[g,S]],[/(shield[\w ]+) b/i],[c,[d,"Nvidia"],[g,S]],[/(sprint) (\w+)/i],[d,c,[g,E]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[d,y],[g,E]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[c,[d,X],[g,S]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[c,[d,X],[g,E]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[d,c,[g,A]],[/droid.+; (shield) bui/i],[c,[d,"Nvidia"],[g,A]],[/(playstation [345portablevi]+)/i],[c,[d,G],[g,A]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[c,[d,y],[g,A]],[/smart-tv.+(samsung)/i],[d,[g,L]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[d,N],[g,L]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[d,I],[g,L]],[/(apple) ?tv/i],[d,[c,R+" TV"],[g,L]],[/crkey/i],[[c,D+"cast"],[d,P],[g,L]],[/droid.+aft(\w)( bui|\))/i],[c,[d,w],[g,L]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[c,[d,W],[g,L]],[/(bravia[\w ]+)( bui|\))/i],[c,[d,G],[g,L]],[/(mitv-\w{5}) bui/i],[c,[d,z],[g,L]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[d,mt],[c,mt],[g,L]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,L]],[/((pebble))app/i],[d,c,[g,T]],[/droid.+; (glass) \d/i],[c,[d,P],[g,T]],[/droid.+; (wt63?0{2,3})\)/i],[c,[d,X],[g,T]],[/(quest( 2)?)/i],[c,[d,K],[g,T]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[d,[g,x]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[c,[g,E]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[c,[g,S]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,S]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[g,E]],[/(android[-\w\. ]{0,9});.+buil/i],[c,[d,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[_,O+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[_,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[_,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,_]],os:[[/microsoft (windows) (vista|xp)/i],[_,p],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[_,[p,_t,Lt]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[_,"Windows"],[p,_t,Lt]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[_,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_,"Mac OS"],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,_],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[_,p],[/\(bb(10);/i],[p,[_,C]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[_,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[_,B+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[_,"webOS"]],[/crkey\/([\d\.]+)/i],[p,[_,D+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[_,"Chromium OS"],p],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_,p],[/(sunos) ?([\w\.\d]*)/i],[[_,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[_,p]]},Tt=function(V,it){if(typeof V===h&&(it=V,V=i),!(this instanceof Tt))return new Tt(V,it).getResult();var at=V||(typeof e!==l&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:s),ut=it?$(dt,it):dt;return this.getBrowser=function(){var ct={};return ct[_]=i,ct[p]=i,vt.call(ct,at,ut.browser),ct.major=rt(ct.version),ct},this.getCPU=function(){var ct={};return ct[v]=i,vt.call(ct,at,ut.cpu),ct},this.getDevice=function(){var ct={};return ct[d]=i,ct[c]=i,ct[g]=i,vt.call(ct,at,ut.device),ct},this.getEngine=function(){var ct={};return ct[_]=i,ct[p]=i,vt.call(ct,at,ut.engine),ct},this.getOS=function(){var ct={};return ct[_]=i,ct[p]=i,vt.call(ct,at,ut.os),ct},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return at},this.setUA=function(ct){return at=typeof ct===u&&ct.length>m?mt(ct,m):ct,this},this.setUA(at),this};Tt.VERSION=n,Tt.BROWSER=q([_,p,f]),Tt.CPU=q([v]),Tt.DEVICE=q([c,d,g,A,E,L,S,T,x]),Tt.ENGINE=Tt.OS=q([_,p]),r.exports&&(t=r.exports=Tt),t.UAParser=Tt;var Ht=typeof e!==l&&(e.jQuery||e.Zepto);if(Ht&&!Ht.ua){var Y=new Tt;Ht.ua=Y.getResult(),Ht.ua.get=function(){return Y.getUA()},Ht.ua.set=function(V){Y.setUA(V);var it=Y.getResult();for(var at in it)Ht.ua[at]=it[at]}}})(typeof window=="object"?window:Ko)})(Gd,Gd.exports);const js="IMAGE_GRADIENT_COMPLETE";class be extends Re.exports.EventEmitter{constructor(e,i){super();H(this,"_triggerContent");H(this,"_target");H(this,"_image");H(this,"_canvas");H(this,"_ctx");H(this,"_ratio",1.5);H(this,"_endR",255);H(this,"_endG",255);H(this,"_endB",255);H(this,"_startR");H(this,"_startG");H(this,"_startB");H(this,"_tl");H(this,"_param",{delay:0,start:"0% 70%",x:0,y:20,alive:!1});H(this,"_isDebugConfirm",!1);H(this,"changeEndColor",(e,i,n)=>{this._endR=e,this._endG=i,this._endB=n});H(this,"_setup",(e=!1)=>{this._tl&&this._tl.kill(),this._canvas.style.width=`${this._image.clientWidth}px`,this._canvas.style.height=`${this._image.clientHeight}px`,this._canvas.width=this._image.clientWidth*this._ratio,this._canvas.height=this._image.clientHeight*this._ratio;const i=nl[Math.floor(Math.random()*(nl.length-.001))];this._startR=i[0],this._startG=i[1],this._startB=i[2],Ot.isTweening(this._target)||this._drawGradImage(),e&&!this._isDebugConfirm&&(Ot.set(this._image,{opacity:0}),Ot.set(this._target,{opacity:0,x:this._param.x,y:this._param.y}))});H(this,"setTrigger",()=>{Ot.to(this._target,{scrollTrigger:{trigger:this._triggerContent,once:!0,markers:!1,start:this._param.start,onEnter:()=>this.animate()}})});H(this,"_drawGradImage",(e=1)=>{this._clear();const i=0,n=0,s=this._image.clientWidth*this._ratio,a=this._image.clientHeight*this._ratio,o=this._ctx.createLinearGradient(0,0,s,a),l=Ga[0],h=Ga[1],u=Ga[2],f=l+(this._endR-l)*(1-e),c=h+(this._endG-h)*(1-e),_=u+(this._endB-u)*(1-e),g=this._startR+(this._endR-this._startR)*(1-e),d=this._startG+(this._endG-this._startG)*(1-e),p=this._startB+(this._endB-this._startB)*(1-e);o.addColorStop(0,`rgba(${f}, ${c}, ${_}, 1)`),o.addColorStop(1,`rgba(${g}, ${d}, ${p}, 1)`),this._ctx.fillStyle=o,this._ctx.fillRect(i,n,s,a),this._isDebugConfirm||(this._ctx.globalCompositeOperation="destination-in",this._ctx.drawImage(this._image,i,n,s,a)),this._ctx.globalCompositeOperation="source-over"});H(this,"animate",()=>{if(this._isDebugConfirm)return;const e={gradation:1};this._tl=Ot.timeline({onComplete:()=>{this._param.alive||(this._canvas.remove(),this._target.classList.remove("js_grad_image_self","js_grad_image"),this._image.classList.remove("js_grad_img"),this._image.removeAttribute("style"),this._target.removeAttribute("style")),this.emit(js,this)}}),this._tl.to(this._target,{opacity:1,x:0,y:0,duration:.8,delay:this._param.delay,ease:"expo.out"}),this._tl.to(e,{gradation:0,duration:1.2,ease:"quad.inOut",onUpdate:()=>this._drawGradImage(e.gradation)},"<0.3")});H(this,"_clear",()=>{const e=this._canvas.clientWidth*this._ratio,i=this._canvas.clientHeight*this._ratio;this._ctx.clearRect(0,0,e,i)});H(this,"resize",()=>{this._setup()});H(this,"reset",(e=!0)=>{e?Ot.to(this._target,{opacity:0,duration:1,onComplete:()=>this._setup(!0)}):this._setup(!0)});this._target=e,i&&(this._param=Object.assign({},this._param,i)),this._image=this._target.querySelector(".js_grad_img"),this._canvas=this._target.querySelector(".js_grad_canvas"),this._ctx=this._canvas.getContext("2d"),this._triggerContent=this._param.trigger?this._param.trigger:this._target,this._target.dataset.trigger&&(this._triggerContent=this._target.closest(this._target.dataset.trigger)),this._target.dataset.start&&(this._param.start=this._target.dataset.start),this._target.dataset.delay&&(this._param.delay=parseFloat(this._target.dataset.delay)),this._target.dataset.x&&(this._param.x=parseFloat(this._target.dataset.delay)),this._target.dataset.y&&(this._param.y=parseFloat(this._target.dataset.delay)),this._setup(!0)}}const es="TEXT_GRADIENT_COMPLETE";class ti extends Re.exports.EventEmitter{constructor(e,i){super();H(this,"triggerContent");H(this,"target");H(this,"_ratio",1.5);H(this,"endR",255);H(this,"endG",255);H(this,"endB",255);H(this,"endA",1);H(this,"_startR");H(this,"_startG");H(this,"_startB");H(this,"param",{delay:0,start:"0% 70%",x:0,y:20,isMove:!0});H(this,"isDebugConfirm",!1);H(this,"_setup",(e=!1)=>{const i=nl[Math.floor(Math.random()*(nl.length-.001))];this._startR=i[0],this._startG=i[1],this._startB=i[2];const n=Ga[0],s=Ga[1],a=Ga[2],o=`rgba(${this._startR}, ${this._startG}, ${this._startB}, 1)`,l=`rgba(${n}, ${s}, ${a}, 1)`;Ot.killTweensOf(this.target),Ot.set(this.target,{backgroundImage:`linear-gradient(-45deg, ${o} 5%, ${l}  80%)`}),e&&!this.isDebugConfirm&&this.setInitStyle(),this.isDebugConfirm&&this.target.classList.add("is_debug")});H(this,"changeEndColor",(e,i,n,s=1)=>{this.endR=e,this.endG=i,this.endB=n,this.endA=s});H(this,"setInitStyle",()=>{this.isDebugConfirm||!this.param.isMove||Ot.set(this.target,{opacity:0,x:this.param.x,y:this.param.y})});H(this,"setTrigger",()=>{Ot.to(this.target,{scrollTrigger:{trigger:this.triggerContent,once:!0,markers:!1,start:this.param.start,onEnter:()=>this.animate()}})});H(this,"animate",()=>{if(this.isDebugConfirm)return;const e=Ot.timeline({onComplete:()=>{this.param.alive||(this.target.classList.remove("js_grad_text","js_grad_text_self"),this.target.removeAttribute("style")),this.emit(es,this)}});this.param.isMove&&e.to(this.target,{opacity:1,x:0,y:0,duration:.8,delay:this.param.delay,ease:"expo.out"});const i=`rgba(${this.endR}, ${this.endG}, ${this.endB}, ${this.endA})`;e.to(this.target,{backgroundImage:`linear-gradient(-45deg, ${i} 5%, ${i} 80%)`,duration:.8,ease:"quad.inOut"},"<0.3")});H(this,"reset",()=>{this.param.isMove?Ot.to(this.target,{opacity:0,duration:1,onComplete:()=>this._setup(!0)}):this._setup(!0)});this.target=e,i&&(this.param=Object.assign({},this.param,i)),this.triggerContent=this.param.trigger?this.param.trigger:this.target,this.target.dataset.trigger&&(this.triggerContent=this.target.closest(this.target.dataset.trigger)),this.target.dataset.start&&(this.param.start=this.target.dataset.start),this.target.dataset.delay&&(this.param.delay=parseFloat(this.target.dataset.delay)),this.target.dataset.x&&(this.param.x=parseFloat(this.target.dataset.delay)),this.target.dataset.y&&(this.param.y=parseFloat(this.target.dataset.delay)),this._setup(!0)}}class uo extends ti{constructor(e,i){super(e,i);H(this,"setInitStyle",()=>{this.isDebugConfirm||!this.param.isMove||Ot.set(this.target,{opacity:0,scaleX:0,x:0,y:0})});H(this,"animate",()=>{if(this.isDebugConfirm)return;const e=Ot.timeline({onComplete:()=>{this.param.alive||(this.target.classList.remove("js_grad_line"),this.target.removeAttribute("style")),this.emit(es,this)}});this.param.isMove&&e.to(this.target,{opacity:1,scaleX:1,duration:.6,delay:this.param.delay,ease:"expo.out"});const i=`rgba(${this.endR}, ${this.endG}, ${this.endB}, ${this.endA})`;e.to(this.target,{backgroundImage:`linear-gradient(-45deg, ${i} 5%, ${i} 80%)`,duration:.8,ease:"quad.inOut"},"<0.3")});this.setInitStyle()}}const zd="MENU_Click";class E0 extends Re.exports.EventEmitter{constructor(e,i=!1){super();H(this,"button");H(this,"text");H(this,"lines",[]);H(this,"showCls","show");H(this,"hideCls","hide");H(this,"onClick",e=>{e.preventDefault(),this.emit(zd)});H(this,"show",()=>{this.button.classList.add(this.showCls),this.button.classList.remove(this.hideCls),this.text.animate(),this.lines.forEach(e=>e.animate())});H(this,"hide",()=>{this.button.classList.add(this.hideCls),this.button.classList.remove(this.showCls),this.text.reset(!1),this.lines.forEach(e=>e.reset())});this.button=e,this.text=new be(this.button.querySelector(".text .js_grad_image_self"),{x:0,y:0,alive:!0}),this.button.querySelectorAll(".line").forEach(n=>{const s=new uo(n,{alive:!0,isMove:!1});this.lines.push(s)}),this.button.addEventListener("click",this.onClick)}}class cM extends E0{}class dM{constructor(t){H(this,"_links",[]);H(this,"show",()=>{this._links.forEach(t=>{t.animate()})});H(this,"reset",()=>{this._links.forEach(t=>{t.reset(!1)})});t.querySelectorAll(".js_grad_image_self").forEach((e,i)=>{const n=new be(e,{delay:i*.05,alive:!0});this._links.push(n)})}}class fM extends E0{constructor(){super(...arguments);H(this,"start",()=>{Ot.delayedCall(.5,()=>{this.button.classList.add(this.showCls),this.text.animate(),this.lines.forEach(e=>e.animate())})})}}class pM{constructor(){H(this,"_body");H(this,"_openBtn");H(this,"_closeBtn");H(this,"_menu");H(this,"_menuBg");H(this,"_menuContents");H(this,"_links");H(this,"_openCls","js_menu_open");H(this,"_setup",()=>{Ot.set(this._menuContents,{x:20})});H(this,"start",()=>{this._openBtn.start()});H(this,"_show",()=>{this._body.classList.add(this._openCls),this._openBtn.hide(),this._closeBtn.show(),this._links.reset();const t=Ot.timeline();Ot.killTweensOf(this._menu),Ot.killTweensOf(this._menuContents),t.to(this._menu,{pointerEvents:"auto",userSelect:"auto",opacity:1,duration:.6,ease:"expo.out"}),t.to(this._menuContents,{x:0,duration:.3,ease:"cubic.out"},"<"),t.call(()=>{this._links.show()},null,"<0.15")});H(this,"_onCloseClick",t=>{t.preventDefault(),this._hide()});H(this,"_hide",()=>{this._body.classList.remove(this._openCls),this._openBtn.show(),this._closeBtn.hide();const t=Ot.timeline();Ot.killTweensOf(this._menu),Ot.killTweensOf(this._menuContents),t.to(this._menuContents,{x:20,duration:.3,ease:"cubic.out"}),t.to(this._menu,{pointerEvents:"none",userSelect:"none",opacity:0,duration:.4,ease:"expo.out"},"<")});this._body=document.querySelector("body");const t=document.querySelector(".site_menu_open"),e=document.querySelector(".site_menu_close");this._openBtn=new fM(t,!1),this._closeBtn=new cM(e,!1),this._menu=document.querySelector(".site_menu"),this._menuBg=this._menu.querySelector(".bg"),this._menuContents=this._menu.querySelector(".scroll"),this._links=new dM(this._menu),this._setup(),this._openBtn.on(zd,this._show),this._closeBtn.on(zd,this._hide),this._menuBg.addEventListener("click",this._onCloseClick),this._menuContents.querySelectorAll("a").forEach(i=>{i.addEventListener("click",n=>{n.currentTarget.classList.contains("external")||n.preventDefault(),this._hide()})})}}class mM{constructor(){H(this,"_target");H(this,"_logo");H(this,"_scroll");H(this,"_scrollText");H(this,"_scrollArrow");H(this,"_news");H(this,"_scrollEnabled",!1);H(this,"_newsDate");H(this,"_newsText");H(this,"_newsLine");H(this,"_setup",()=>{this._logo.style.opacity="0",this._scroll.style.opacity="0",this._news.style.opacity="0"});H(this,"show",()=>{this._logo.removeAttribute("style"),this._scroll.removeAttribute("style"),this._news.removeAttribute("style"),this._scrollEnabled&&(this._scrollArrow.on(js,()=>{this._scroll.classList.add("animate")}),this._scrollText.animate(),this._scrollArrow.animate()),this._newsLine.animate(),this._newsDate.animate(),this._newsText.animate()});this._target=document.querySelector(".kv_area"),this._logo=this._target.querySelector(".logo"),this._scroll=this._target.querySelector(".scroll"),this._news=this._target.querySelector(".recommend_news");let t=.1;window.getComputedStyle(this._scroll).display!=="none"&&(this._scrollEnabled=!0,this._scrollText=new be(this._scroll.querySelector(".text"),{delay:.1}),this._scrollArrow=new be(this._scroll.querySelector(".arrow"),{delay:.2}),t=.8),this._newsLine=new uo(this._news.querySelector(".js_grad_line"),{delay:t,x:-20,y:0}),this._newsLine.changeEndColor(255,255,255,.5),this._newsDate=new ti(this._news.querySelector(".date.js_grad_text_self"),{delay:t+.1,x:-20,y:0}),this._newsText=new ti(this._news.querySelector(".summary .js_grad_text_self"),{delay:t+.1,x:-20,y:0}),this._setup()}}class gM{constructor(t,e,i){H(this,"_target");H(this,"_canvas");H(this,"_logo");H(this,"_ctx");H(this,"_ratio");H(this,"_setup",()=>{this._canvas.style.width=`${this._logo.clientWidth}px`,this._canvas.style.height=`${this._logo.clientHeight}px`,this._canvas.width=this._logo.clientWidth*this._ratio,this._canvas.height=this._logo.clientHeight*this._ratio});H(this,"showLogo",t=>{this._clear();const e=0,i=0,n=this._logo.clientWidth*this._ratio,s=this._logo.clientHeight*this._ratio,a=s*-2*(1-t),o=s*2*t,l=this._ctx.createLinearGradient(0,a,0,o);l.addColorStop(0,"rgba(255, 255, 255, 1)"),l.addColorStop(.5,"rgba(255, 255, 255, 1)"),l.addColorStop(1,"rgba(255, 255, 255, 0)"),this._ctx.fillStyle=l,this._ctx.fillRect(e,i,n,s),this._ctx.globalCompositeOperation="destination-in",this._ctx.drawImage(this._logo,e,i,n,s),this._ctx.globalCompositeOperation="source-over"});H(this,"_clear",()=>{const t=this._canvas.clientWidth*this._ratio,e=this._canvas.clientHeight*this._ratio;this._ctx.clearRect(0,0,t,e)});H(this,"resize",()=>{this._setup()});this._target=t,this._logo=e,this._ratio=i,this._canvas=this._target.querySelector(".loading_logo_canvas"),this._ctx=this._canvas.getContext("2d"),this._setup()}}const T0="LOAD_COMPLETE";class _M extends Re.exports.EventEmitter{constructor(){super();H(this,"_body");H(this,"_contentsWrapper");H(this,"_target");H(this,"_logo");H(this,"_message");H(this,"_canvas");H(this,"_ctx");H(this,"_logoCanvas");H(this,"_kvView");H(this,"_ratio",2);H(this,"_setup",()=>{this._body.classList.add("js_loading_lock"),this._contentsWrapper.removeAttribute("style"),this._target.classList.remove("standby"),this._canvas.width=this._canvas.clientWidth*this._ratio,this._canvas.height=this._canvas.clientHeight*this._ratio,this._drawBg()});H(this,"_end",()=>{this._kvView.show(),delete this._logoCanvas,delete this._kvView,this._target.remove(),this._body.classList.remove("js_loading_lock"),this.emit(T0)});H(this,"shortcut",()=>this._end());H(this,"start",()=>{const e=Ot.timeline({onComplete:()=>this._end()}),i={alpha:0,bgGradient:1,logoGradient:0,progress:0,progressAlpha:1};e.to(i,{alpha:1,duration:1,delay:.4,ease:"circ.out",onUpdate:()=>this._showMessage(i.alpha)}),e.to(i,{alpha:0,duration:1,delay:.6,ease:"expo.out",onUpdate:()=>this._showMessage(i.alpha,!1)}),e.to(i,{alpha:1,duration:.4,ease:"circ.out",onUpdate:()=>this._showLogo(i.alpha)}),e.to(i,{progress:1,duration:1,ease:"circ.inOut",onUpdate:()=>this._showLogo(i.alpha,i.bgGradient,i.progress)}),e.to(i,{progressAlpha:0,duration:.4,delay:.2,ease:"circ.out",onUpdate:()=>this._showLogo(i.alpha,i.bgGradient,i.progress,i.progressAlpha)}),e.to(i,{alpha:0,bgGradient:0,duration:1,delay:.5,ease:"circ.out",onUpdate:()=>this._showLogo(i.alpha,i.bgGradient)}),e.to(i,{logoGradient:1,duration:.6,ease:"expo.out",onUpdate:()=>this._logoCanvas.showLogo(i.logoGradient)},"<0.1")});H(this,"_showMessage",(e,i=!0)=>{this._clear(),this._ctx.globalAlpha=e,this._ctx.imageSmoothingEnabled=!0,this._ctx.drawImage(this._message,this._message.offsetLeft*this._ratio,this._message.offsetTop*this._ratio,this._message.clientWidth*this._ratio,this._message.clientHeight*this._ratio),this._ctx.globalAlpha=1,this._ctx.globalCompositeOperation="source-out",this._drawBg()});H(this,"_showLogo",(e,i=1,n=0,s=1)=>{this._clear();const a=this._logo.offsetLeft*this._ratio,o=this._logo.offsetTop*this._ratio,l=this._logo.clientWidth*this._ratio,h=this._logo.clientHeight*this._ratio;this._ctx.globalAlpha=e,this._ctx.drawImage(this._logo,a,o,l,h),this._ctx.globalAlpha=1,n>0&&(this._ctx.fillStyle=`rgba(255, 255, 0, ${s})`,this._ctx.fillRect(a,o+h+80,l*n,1)),this._ctx.globalCompositeOperation="source-out",this._drawBg(i)});H(this,"_clear",()=>{const e=this._canvas.clientWidth*this._ratio,i=this._canvas.clientHeight*this._ratio;this._ctx.clearRect(0,0,e,i)});H(this,"_drawBg",(e=1)=>{const i=this._canvas.clientWidth*this._ratio,n=this._canvas.clientHeight*this._ratio;if(e==1)this._ctx.fillStyle="rgba(255, 255, 255, 1)";else{const s=this._ctx.createLinearGradient(0,0,0,n);s.addColorStop(0,"rgba(255, 255, 255, 1)"),s.addColorStop(e,"rgba(255, 255, 255, 0.7)"),s.addColorStop(1,"rgba(255, 255, 255, 0.2)"),this._ctx.fillStyle=s,this._ctx.globalAlpha=e}this._ctx.fillRect(0,0,i,n),this._ctx.globalCompositeOperation="source-over",this._ctx.globalAlpha=1});H(this,"resize",()=>{this._setup(),this._logoCanvas.resize()});this._body=document.querySelector("body"),this._contentsWrapper=document.querySelector(".contents_wrapper"),this._target=document.querySelector(".loading"),this._canvas=this._target.querySelector(".loading_canvas"),this._ctx=this._canvas.getContext("2d"),this._logo=this._target.querySelector(".logo"),this._message=this._target.querySelector(".message"),this._logoCanvas=new gM(this._target,this._logo,this._ratio),this._kvView=new mM,this._setup()}}const b0="GRADIENT_IMAGES_COMPLETE";class vM extends Re.exports.EventEmitter{constructor(){super();H(this,"_images",[]);H(this,"_end",e=>{const i=this._images.indexOf(e);i!==-1&&(delete this._images[i],this._images.splice(i,1),this._images.length==0&&this.emit(b0))});H(this,"resize",()=>{this._images.forEach(e=>e.resize())});document.querySelectorAll(".js_grad_image").forEach(i=>{const n=new be(i);n.once(js,this._end),n.setTrigger(),this._images.push(n)})}}const S0="GRADIENT_TEXTS_COMPLETE";class xM extends Re.exports.EventEmitter{constructor(){super();H(this,"_texts",[]);H(this,"_end",e=>{const i=this._texts.indexOf(e);i!==-1&&(delete this._texts[i],this._texts.splice(i,1),this._texts.length==0&&this.emit(S0))});document.querySelectorAll(".js_grad_text").forEach(i=>{const n=new ti(i);n.once(es,this._end),n.setTrigger(),this._texts.push(n)})}}const w0="TOPIC_COMPLETE";class yM extends Re.exports.EventEmitter{constructor(e){super();H(this,"_target");H(this,"_line");H(this,"_date");H(this,"_summary");H(this,"_arrow");H(this,"setup",(e,i)=>{this._line.changeEndColor(255,255,255,.5),Ot.to(this._target,{scrollTrigger:{trigger:e,start:"0% 70%",once:!0,markers:!1,onEnter:()=>{Ot.delayedCall(i,()=>this._animate())}}})});H(this,"_animate",()=>{this._arrow.once(js,()=>{this._end()}),this._line.animate(),this._date.animate(),this._summary.animate(),this._arrow.animate()});H(this,"_end",()=>{delete this._line,delete this._date,delete this._summary,delete this._arrow,this.emit(w0,this)});this._target=e,this._line=new uo(this._target.querySelector(".line")),this._date=new ti(this._target.querySelector(".date")),this._summary=new ti(this._target.querySelector(".text")),this._arrow=new be(this._target.querySelector(".icon"))}}const A0="TOPICS_COMPLETE";class EM extends Re.exports.EventEmitter{constructor(){super();H(this,"_topics",[]);H(this,"_delete",e=>{const i=this._topics.indexOf(e);i!==-1&&(delete this._topics[i],this._topics.splice(i,1),this._topics.length==0&&this.emit(A0))});document.querySelectorAll(".section_topics .link").forEach(e=>{const i=new yM(e);this._topics.push(i)}),this._setup()}_setup(){const e=document.querySelector(".section_topics .contents");this._topics.forEach((i,n)=>{i.once(w0,this._delete),i.setup(e,n*.2)})}}const M0="SECTION_TITLE_COMPLETE";class TM extends Re.exports.EventEmitter{constructor(e){super();H(this,"_target");H(this,"_en");H(this,"_ja");H(this,"_line");H(this,"setTrigger",()=>{Ot.to(this._target,{scrollTrigger:{trigger:this._target,start:"0% 70%",once:!0,markers:!1,onEnter:()=>this._animate()}})});H(this,"_animate",()=>{this._en.once(js,()=>{delete this._en,this._end()}),this._ja.once(js,()=>{delete this._ja,this._end()}),this._line.once(es,()=>{delete this._line,this._end()}),this._en.animate(),this._ja.animate(),this._line.animate()});H(this,"_end",()=>{!this._en&&!this._ja&&!this._line&&this.emit(M0,this)});this._target=e,this._en=new be(this._target.querySelector(".en .js_grad_image_self"),{x:-10,y:0}),this._ja=new be(this._target.querySelector(".ja .js_grad_image_self"),{x:-10,y:0,delay:.15}),this._line=new uo(this._target.querySelector(".line"),{delay:.4})}}const C0="SECTION_TITLES_COMPLETE";class bM extends Re.exports.EventEmitter{constructor(){super();H(this,"_titles",[]);H(this,"_end",e=>{const i=this._titles.indexOf(e);i!==-1&&(delete this._titles[i],this._titles.splice(i,1),this._titles.length==0&&this.emit(C0))});document.querySelectorAll(".js_section_title").forEach(i=>{const n=new TM(i);n.once(M0,this._end),n.setTrigger(),this._titles.push(n)})}}class SM{constructor(t){H(this,"_contents");H(this,"_img1");H(this,"_img2");H(this,"_img3");H(this,"_text");H(this,"_setup",()=>{this._img1=new be(this._contents.querySelector(".carrier"),{delay:0}),this._img2=new be(this._contents.querySelector(".asset"),{delay:.1}),this._img3=new be(this._contents.querySelector(".management"),{delay:.2}),this._text=new ti(this._contents.querySelector(".summary .js_grad_text_self"),{delay:.3})});H(this,"animate",()=>{this._img1.animate(),this._img2.animate(),this._img3.animate(),this._text.animate()});this._contents=t.querySelector(".cam_contents"),this._setup()}}const Wd="LOGO_COMPLETE";class wM extends Re.exports.EventEmitter{constructor(){super();H(this,"_area");H(this,"_enLeft");H(this,"_enLeftGrad");H(this,"_enRight");H(this,"_enRightGrad");H(this,"_ja");H(this,"_jaGrad");H(this,"_setup",()=>{const e=this._area.querySelector(".section_title");this._enLeftGrad=new be(this._enLeft.querySelector(".js_grad_image_self"),{trigger:e,delay:.4}),this._enRightGrad=new be(this._enRight.querySelector(".js_grad_image_self"),{trigger:e,delay:.4}),this._jaGrad=new be(this._ja.querySelector(".js_grad_image_self"),{trigger:e,delay:.5}),this._enLeftGrad.setTrigger(),this._enRightGrad.setTrigger(),this._jaGrad.setTrigger(),Ot.to(this._enLeft,{scrollTrigger:{trigger:this._enLeft,markers:!1,once:!0,start:fs()?"0% 60%":"0% 30%",onEnter:()=>this._animate()}})});H(this,"_animate",()=>{const e=Ot.timeline({onComplete:()=>{fs()&&(this._enLeft.removeAttribute("style"),this._enRight.removeAttribute("style"),this._enLeft.parentElement.classList.add("complete"),this._enRight.parentElement.classList.add("complete"),this.emit(Wd))}});fs()||(e.to(this._enLeft,{opacity:0,duration:.4,ease:"expo.out"}),e.to(this._enRight,{opacity:0,duration:.4,ease:"expo.out"},"<")),e.to(this._ja,{opacity:0,duration:.4,ease:"expo.out",onComplete:()=>{if(!fs()){this._enLeft.parentElement.classList.add("complete"),this._enRight.parentElement.classList.add("complete");const i=Ot.getProperty(this._enLeft,"y"),n=Ot.getProperty(this._enRight,"y");Ot.fromTo(this._enLeft,{y:i+10},{y:i,opacity:1,duration:.4,ease:"quad.out"}),Ot.fromTo(this._enRight,{y:n+10},{y:n,opacity:1,duration:.4,ease:"quad.out",onComplete:()=>{this._enLeft.removeAttribute("style"),this._enRight.removeAttribute("style"),this.emit(Wd)}})}}},fs()?void 0:"<"),fs()&&(e.to(this._enLeft,{x:0,duration:.6,ease:"circ.inOut"},"<0.3"),e.to(this._enRight,{x:0,duration:.6,ease:"circ.inOut"},"<"))});const e=".section_name";this._area=document.querySelector(e),this._enLeft=this._area.querySelector(".cam"),this._enRight=this._area.querySelector(".com"),this._ja=this._area.querySelector(".logo .ja"),this._setup()}}const L0="RIGHT_CONTENTS_COMPLETE";class AM extends Re.exports.EventEmitter{constructor(e){super();H(this,"_contents");H(this,"_img1");H(this,"_text1");H(this,"_img2");H(this,"_text2");H(this,"_img3");H(this,"_text3");H(this,"_setup",()=>{this._img1=new be(this._contents.querySelector(".company"),{delay:0}),this._text1=new ti(this._contents.querySelector(".company_summary"),{delay:.1}),this._img2=new be(this._contents.querySelector(".community"),{delay:.3}),this._text2=new ti(this._contents.querySelector(".community_summary"),{delay:.4}),this._img3=new be(this._contents.querySelector(".communication"),{delay:.6}),this._text3=new ti(this._contents.querySelector(".communication_summary"),{delay:.7})});H(this,"animate",()=>{this._text3.once(es,()=>{this.emit(L0)}),this._img1.animate(),this._text1.animate(),this._img2.animate(),this._text2.animate(),this._img3.animate(),this._text3.animate()});this._contents=e.querySelector(".com_contents"),this._setup()}}const D0="NAME_SECTION_COMPLETE";class MM extends Re.exports.EventEmitter{constructor(){super();H(this,"_logo");H(this,"_leftContents");H(this,"_rightContents");H(this,"_showContents",()=>{this._rightContents.once(L0,()=>this._end()),this._leftContents.animate(),Ot.delayedCall(.3,()=>this._rightContents.animate())});H(this,"_end",()=>{delete this._logo,delete this._leftContents,delete this._rightContents,this.emit(D0)});const e=document.querySelector("#sec4 .contents");this._logo=new wM,this._logo.once(Wd,()=>this._showContents()),this._leftContents=new SM(e),this._rightContents=new AM(e)}}class CM extends Re.exports.EventEmitter{constructor(e){super();H(this,"_contents");H(this,"_img");H(this,"_title");H(this,"_summary");H(this,"_setup",()=>{Ot.set(this._img,{opacity:0}),Ot.to(this._contents,{scrollTrigger:{trigger:this._contents,once:!0,markers:!1,start:"0% 70%",onEnter:()=>this._animate()}})});H(this,"_animate",()=>{Ot.to(this._img,{opacity:1,duration:.8,ease:"circ.out",onComplete:()=>{this._img.removeAttribute("style")}}),this._title.animate(),this._summary.animate()});this._contents=e,this._img=this._contents.querySelector(".logo_image img"),this._title=new be(this._contents.querySelector(".js_grad_image_self"),{delay:.1}),this._summary=new ti(this._contents.querySelector(".js_grad_text_self"),{delay:.2}),this._setup()}}const R0="SUB_CONTENTS_COMPLETE";class cg extends Re.exports.EventEmitter{constructor(e,i=0){super();H(this,"_contents");H(this,"_img");H(this,"_title");H(this,"_summary");H(this,"_delay");H(this,"_setup",()=>{Ot.set(this._img,{opacity:0,y:20}),Ot.to(this._contents,{scrollTrigger:{trigger:this._contents,once:!0,markers:!1,start:"0% 70%",onEnter:()=>this._animate()}})});H(this,"_animate",()=>{this._summary.once(es,this._end),Ot.to(this._img,{opacity:1,y:0,duration:.8,delay:this._delay,ease:"circ.out",onComplete:()=>{this._img.removeAttribute("style")}}),this._title.animate(),this._summary.animate()});H(this,"_end",()=>{this.emit(R0)});this._contents=e,this._delay=i,this._img=this._contents.querySelector(".logo_image img"),this._title=new ti(this._contents.querySelector(".title .js_grad_text_self"),{delay:this._delay+.1}),this._summary=new ti(this._contents.querySelector(".summary .js_grad_text_self"),{delay:this._delay+.2}),this._setup()}}const P0="BRAND_SECTION_COMPLETE";class LM extends Re.exports.EventEmitter{constructor(){super();H(this,"_main");H(this,"_structure");H(this,"_pattern");H(this,"_end",()=>{delete this._main,delete this._structure,delete this._pattern,this.emit(P0)});const e=document.querySelector("#sec5 .contents"),i=e.querySelector(".main_summary"),n=e.querySelector(".structure_summary"),s=e.querySelector(".pattern_summary");this._main=new CM(i),this._structure=new cg(n),this._pattern=new cg(s,.3),this._pattern.once(R0,this._end)}}class DM{constructor(t){H(this,"_contents");H(this,"_num");H(this,"_label");H(this,"_line");H(this,"animate",()=>{this._num.animate(),this._line.animate(),this._label.animate()});this._contents=t,this._num=new be(this._contents.querySelector(".num .js_grad_image_self"),{delay:0,x:-10,y:0}),this._line=new uo(this._contents.querySelector(".line"),{delay:.1}),this._label=new be(this._contents.querySelector(".title .js_grad_image_self"),{delay:.2,x:-10,y:0})}}const I0="STEP_SEC_COMPLETE";class Au extends Re.exports.EventEmitter{constructor(e){super();H(this,"contents");H(this,"title");H(this,"message");H(this,"delay",.4);H(this,"setup",()=>{Ot.to(this.contents,{scrollTrigger:{trigger:this.contents,once:!0,markers:!1,start:"0% 70%",onEnter:()=>this._commonAnimate()}})});H(this,"_commonAnimate",()=>{this.title.animate(),this.message.animate(),this.animate()});const i=e.querySelector(".title_area"),n=e.querySelector(".message .js_grad_text_self");this.contents=e,this.title=new DM(i),this.message=new ti(n,{delay:this.delay})}}class RM{constructor(t,e){H(this,"_contents");H(this,"_num");H(this,"_title");H(this,"_summary");H(this,"animate",()=>{this._num.animate(),this._title.animate(),this._summary.animate()});this._contents=t,this._num=new be(this._contents.querySelector(".num .js_grad_image_self"),{delay:e+.1}),this._title=new ti(this._contents.querySelector(".title .js_grad_text_self"),{delay:e+.1}),this._summary=new ti(this._contents.querySelector(".summary .js_grad_text_self"),{delay:e+.3})}}class PM extends Au{constructor(e){super(e);H(this,"_listItem",[]);H(this,"animate",()=>{this._listItem.forEach(e=>{e.animate()})});e.querySelectorAll(".list .item").forEach((i,n)=>{const s=new RM(i,n*.25);this._listItem.push(s)})}}class IM extends Au{constructor(e){super(e);H(this,"animate",()=>{})}}class OM extends Au{constructor(e){super(e);H(this,"animate",()=>{})}}class FM extends Au{constructor(e){super(e);H(this,"_summary");H(this,"animate",()=>{this._summary.once(es,()=>this.emit(I0)),this._summary.animate()});const i=e.querySelector(".summary .js_grad_text_self");this._summary=new ti(i,{delay:this.delay+.1})}}const O0="PHILOSOPHY_SECTION_COMPLETE";class BM extends Re.exports.EventEmitter{constructor(){super();H(this,"_step1");H(this,"_step2");H(this,"_step3");H(this,"_step4");H(this,"_end",()=>{delete this._step1,delete this._step2,delete this._step3,delete this._step4,this.emit(O0)});const e=document.querySelector("#sec2 .contents"),i=e.querySelector(".step1"),n=e.querySelector(".step2"),s=e.querySelector(".step3"),a=e.querySelector(".step4");this._step1=new PM(i),this._step2=new IM(n),this._step3=new OM(s),this._step4=new FM(a),this._step1.setup(),this._step2.setup(),this._step3.setup(),this._step4.setup(),this._step4.once(I0,()=>this._end())}}var F0={exports:{}};(function(r,t){typeof window<"u"&&function(i,n){r.exports=n()}(Ko,()=>(()=>{var e={"./src/config.ts":(a,o,l)=>{l.r(o),l.d(o,{enableStreamingMode:()=>B,hlsDefaultConfig:()=>b,mergeConfig:()=>O});var h=l("./src/controller/abr-controller.ts"),u=l("./src/controller/audio-stream-controller.ts"),f=l("./src/controller/audio-track-controller.ts"),c=l("./src/controller/subtitle-stream-controller.ts"),_=l("./src/controller/subtitle-track-controller.ts"),g=l("./src/controller/buffer-controller.ts"),d=l("./src/controller/timeline-controller.ts"),p=l("./src/controller/cap-level-controller.ts"),v=l("./src/controller/fps-controller.ts"),A=l("./src/controller/eme-controller.ts"),E=l("./src/controller/cmcd-controller.ts"),S=l("./src/utils/xhr-loader.ts"),L=l("./src/utils/fetch-loader.ts"),T=l("./src/utils/cues.ts"),x=l("./src/utils/mediakeys-helper.ts"),m=l("./src/utils/logger.ts");function w(){return w=Object.assign?Object.assign.bind():function(P){for(var F=1;F<arguments.length;F++){var I=arguments[F];for(var y in I)Object.prototype.hasOwnProperty.call(I,y)&&(P[y]=I[y])}return P},w.apply(this,arguments)}function R(P,F){var I=Object.keys(P);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(P);F&&(y=y.filter(function(k){return Object.getOwnPropertyDescriptor(P,k).enumerable})),I.push.apply(I,y)}return I}function M(P){for(var F=1;F<arguments.length;F++){var I=arguments[F]!=null?arguments[F]:{};F%2?R(Object(I),!0).forEach(function(y){C(P,y,I[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(I)):R(Object(I)).forEach(function(y){Object.defineProperty(P,y,Object.getOwnPropertyDescriptor(I,y))})}return P}function C(P,F,I){return F in P?Object.defineProperty(P,F,{value:I,enumerable:!0,configurable:!0,writable:!0}):P[F]=I,P}var b=M(M({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:S.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:h.default,bufferController:g.default,capLevelController:p.default,fpsController:v.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:x.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},D()),{},{subtitleStreamController:c.SubtitleStreamController,subtitleTrackController:_.default,timelineController:d.TimelineController,audioStreamController:u.default,audioTrackController:f.default,emeController:A.default,cmcdController:E.default});function D(){return{cueHandler:T.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function O(P,F){if((F.liveSyncDurationCount||F.liveMaxLatencyDurationCount)&&(F.liveSyncDuration||F.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(F.liveMaxLatencyDurationCount!==void 0&&(F.liveSyncDurationCount===void 0||F.liveMaxLatencyDurationCount<=F.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(F.liveMaxLatencyDuration!==void 0&&(F.liveSyncDuration===void 0||F.liveMaxLatencyDuration<=F.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return w({},P,F)}function B(P){var F=P.loader;if(F!==L.default&&F!==S.default)m.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),P.progressive=!1;else{var I=(0,L.fetchSupported)();I&&(P.loader=L.default,P.progressive=!0,P.enableSoftwareAES=!0,m.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>A});var h=l("./src/polyfills/number.ts"),u=l("./src/utils/ewma-bandwidth-estimator.ts"),f=l("./src/events.ts"),c=l("./src/errors.ts"),_=l("./src/types/loader.ts"),g=l("./src/utils/logger.ts");function d(E,S){for(var L=0;L<S.length;L++){var T=S[L];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(E,T.key,T)}}function p(E,S,L){return S&&d(E.prototype,S),L&&d(E,L),Object.defineProperty(E,"prototype",{writable:!1}),E}var v=function(){function E(L){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=L;var T=L.config;this.bwEstimator=new u.default(T.abrEwmaSlowVoD,T.abrEwmaFastVoD,T.abrEwmaDefaultEstimate),this.registerListeners()}var S=E.prototype;return S.registerListeners=function(){var T=this.hls;T.on(f.Events.FRAG_LOADING,this.onFragLoading,this),T.on(f.Events.FRAG_LOADED,this.onFragLoaded,this),T.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),T.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),T.on(f.Events.ERROR,this.onError,this)},S.unregisterListeners=function(){var T=this.hls;T.off(f.Events.FRAG_LOADING,this.onFragLoading,this),T.off(f.Events.FRAG_LOADED,this.onFragLoaded,this),T.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this),T.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),T.off(f.Events.ERROR,this.onError,this)},S.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},S.onFragLoading=function(T,x){var m=x.frag;if(m.type===_.PlaylistLevelType.MAIN&&!this.timer){var w;this.fragCurrent=m,this.partCurrent=(w=x.part)!=null?w:null,this.timer=self.setInterval(this.onCheck,100)}},S.onLevelLoaded=function(T,x){var m=this.hls.config;x.details.live?this.bwEstimator.update(m.abrEwmaSlowLive,m.abrEwmaFastLive):this.bwEstimator.update(m.abrEwmaSlowVoD,m.abrEwmaFastVoD)},S._abandonRulesCheck=function(){var T=this.fragCurrent,x=this.partCurrent,m=this.hls,w=m.autoLevelEnabled;m.config;var R=m.media;if(!(!T||!R)){var M=x?x.stats:T.stats,C=x?x.duration:T.duration;if(M.aborted||M.loaded&&M.loaded===M.total||T.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!w||R.paused||!R.playbackRate||!R.readyState)){var b=m.mainForwardBufferInfo;if(b!==null){var D=performance.now()-M.loading.start,O=Math.abs(R.playbackRate);if(!(D<=500*C/O)){var B=M.loaded&&M.loading.first,P=this.bwEstimator.getEstimate(),F=m.levels,I=m.minAutoLevel,y=F[T.level],k=M.total||Math.max(M.loaded,Math.round(C*y.maxBitrate/8)),U=B?M.loaded*1e3/D:0,N=U?(k-M.loaded)/U:k*8/P,W=b.len/O;if(!(N<=W)){var G=Number.POSITIVE_INFINITY,z;for(z=T.level-1;z>I;z--){var X=F[z].maxBitrate;if(G=U?C*X/(8*.8*U):C*X/P,G<W)break}G>=N||(g.logger.warn("Fragment "+T.sn+(x?" part "+x.index:"")+" of level "+T.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+z+`
      Current BW estimate: `+((0,h.isFiniteNumber)(P)?(P/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+N.toFixed(3)+` s
      Estimated load time for the next fragment: `+G.toFixed(3)+` s
      Time to underbuffer: `+W.toFixed(3)+" s"),m.nextLoadLevel=z,B&&this.bwEstimator.sample(D,M.loaded),this.clearTimer(),T.loader&&(this.fragCurrent=this.partCurrent=null,T.loader.abort()),m.trigger(f.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:T,part:x,stats:M}))}}}}}},S.onFragLoaded=function(T,x){var m=x.frag,w=x.part;if(m.type===_.PlaylistLevelType.MAIN&&(0,h.isFiniteNumber)(m.sn)){var R=w?w.stats:m.stats,M=w?w.duration:m.duration;if(this.clearTimer(),this.lastLoadedFragLevel=m.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var C=this.hls.levels[m.level],b=(C.loaded?C.loaded.bytes:0)+R.loaded,D=(C.loaded?C.loaded.duration:0)+M;C.loaded={bytes:b,duration:D},C.realBitrate=Math.round(8*b/D)}if(m.bitrateTest){var O={stats:R,frag:m,part:w,id:m.type};this.onFragBuffered(f.Events.FRAG_BUFFERED,O)}}},S.onFragBuffered=function(T,x){var m=x.frag,w=x.part,R=w?w.stats:m.stats;if(!R.aborted&&!(m.type!==_.PlaylistLevelType.MAIN||m.sn==="initSegment")){var M=R.parsing.end-R.loading.start;this.bwEstimator.sample(M,R.loaded),R.bwEstimate=this.bwEstimator.getEstimate(),m.bitrateTest?this.bitrateTestDelay=M/1e3:this.bitrateTestDelay=0}},S.onError=function(T,x){switch(x.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},S.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},S.getNextABRAutoLevel=function(){var T=this.fragCurrent,x=this.partCurrent,m=this.hls,w=m.maxAutoLevel,R=m.config,M=m.minAutoLevel,C=m.media,b=x?x.duration:T?T.duration:0;C&&C.currentTime;var D=C&&C.playbackRate!==0?Math.abs(C.playbackRate):1,O=this.bwEstimator?this.bwEstimator.getEstimate():R.abrEwmaDefaultEstimate,B=m.mainForwardBufferInfo,P=(B?B.len:0)/D,F=this.findBestLevel(O,M,w,P,R.abrBandWidthFactor,R.abrBandWidthUpFactor);if(F>=0)return F;g.logger.trace((P?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var I=b?Math.min(b,R.maxStarvationDelay):R.maxStarvationDelay,y=R.abrBandWidthFactor,k=R.abrBandWidthUpFactor;if(!P){var U=this.bitrateTestDelay;if(U){var N=b?Math.min(b,R.maxLoadingDelay):R.maxLoadingDelay;I=N-U,g.logger.trace("bitrate test took "+Math.round(1e3*U)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*I)+" ms"),y=k=1}}return F=this.findBestLevel(O,M,w,P+I,y,k),Math.max(F,0)},S.findBestLevel=function(T,x,m,w,R,M){for(var C,b=this.fragCurrent,D=this.partCurrent,O=this.lastLoadedFragLevel,B=this.hls.levels,P=B[O],F=!!(P!=null&&(C=P.details)!==null&&C!==void 0&&C.live),I=P==null?void 0:P.codecSet,y=D?D.duration:b?b.duration:0,k=m;k>=x;k--){var U=B[k];if(!(!U||I&&U.codecSet!==I)){var N=U.details,W=(D?N==null?void 0:N.partTarget:N==null?void 0:N.averagetargetduration)||y,G=void 0;k<=O?G=R*T:G=M*T;var z=B[k].maxBitrate,X=z*W/G;if(g.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+k+"/"+Math.round(G)+"/"+z+"/"+W+"/"+w+"/"+X),G>z&&(X===0||!(0,h.isFiniteNumber)(X)||F&&!this.bitrateTestDelay||X<w))return k}}return-1},p(E,[{key:"nextAutoLevel",get:function(){var T=this._nextAutoLevel,x=this.bwEstimator;if(T!==-1&&!x.canEstimate())return T;var m=this.getNextABRAutoLevel();return T!==-1&&this.hls.levels[m].loadError?T:(T!==-1&&(m=Math.min(T,m)),m)},set:function(T){this._nextAutoLevel=T}}]),E}();const A=v},"./src/controller/audio-stream-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>C});var h=l("./src/polyfills/number.ts"),u=l("./src/controller/base-stream-controller.ts"),f=l("./src/events.ts"),c=l("./src/utils/buffer-helper.ts"),_=l("./src/controller/fragment-tracker.ts"),g=l("./src/types/level.ts"),d=l("./src/types/loader.ts"),p=l("./src/loader/fragment.ts"),v=l("./src/demux/chunk-cache.ts"),A=l("./src/demux/transmuxer-interface.ts"),E=l("./src/types/transmuxer.ts"),S=l("./src/controller/fragment-finders.ts"),L=l("./src/utils/discontinuities.ts"),T=l("./src/errors.ts");function x(){return x=Object.assign?Object.assign.bind():function(b){for(var D=1;D<arguments.length;D++){var O=arguments[D];for(var B in O)Object.prototype.hasOwnProperty.call(O,B)&&(b[B]=O[B])}return b},x.apply(this,arguments)}function m(b,D){b.prototype=Object.create(D.prototype),b.prototype.constructor=b,w(b,D)}function w(b,D){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(B,P){return B.__proto__=P,B},w(b,D)}var R=100,M=function(b){m(D,b);function D(B,P){var F;return F=b.call(this,B,P,"[audio-stream-controller]")||this,F.videoBuffer=null,F.videoTrackCC=-1,F.waitingVideoCC=-1,F.audioSwitch=!1,F.trackId=-1,F.waitingData=null,F.mainDetails=null,F.bufferFlushed=!1,F.cachedTrackLoadedData=null,F._registerListeners(),F}var O=D.prototype;return O.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},O._registerListeners=function(){var P=this.hls;P.on(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),P.on(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),P.on(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),P.on(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),P.on(f.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),P.on(f.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),P.on(f.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),P.on(f.Events.ERROR,this.onError,this),P.on(f.Events.BUFFER_RESET,this.onBufferReset,this),P.on(f.Events.BUFFER_CREATED,this.onBufferCreated,this),P.on(f.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),P.on(f.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),P.on(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},O._unregisterListeners=function(){var P=this.hls;P.off(f.Events.MEDIA_ATTACHED,this.onMediaAttached,this),P.off(f.Events.MEDIA_DETACHING,this.onMediaDetaching,this),P.off(f.Events.MANIFEST_LOADING,this.onManifestLoading,this),P.off(f.Events.LEVEL_LOADED,this.onLevelLoaded,this),P.off(f.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),P.off(f.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),P.off(f.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),P.off(f.Events.ERROR,this.onError,this),P.off(f.Events.BUFFER_RESET,this.onBufferReset,this),P.off(f.Events.BUFFER_CREATED,this.onBufferCreated,this),P.off(f.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),P.off(f.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),P.off(f.Events.FRAG_BUFFERED,this.onFragBuffered,this)},O.onInitPtsFound=function(P,F){var I=F.frag,y=F.id,k=F.initPTS;if(y==="main"){var U=I.cc;this.initPTS[I.cc]=k,this.log("InitPTS for cc: "+U+" found from main: "+k),this.videoTrackCC=U,this.state===u.State.WAITING_INIT_PTS&&this.tick()}},O.startLoad=function(P){if(!this.levels){this.startPosition=P,this.state=u.State.STOPPED;return}var F=this.lastCurrentTime;this.stopLoad(),this.setInterval(R),this.fragLoadError=0,F>0&&P===-1?(this.log("Override startPosition with lastCurrentTime @"+F.toFixed(3)),P=F,this.state=u.State.IDLE):(this.loadedmetadata=!1,this.state=u.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=P,this.tick()},O.doTick=function(){switch(this.state){case u.State.IDLE:this.doTickIdle();break;case u.State.WAITING_TRACK:{var P,F=this.levels,I=this.trackId,y=F==null||(P=F[I])===null||P===void 0?void 0:P.details;if(y){if(this.waitForCdnTuneIn(y))break;this.state=u.State.WAITING_INIT_PTS}break}case u.State.FRAG_LOADING_WAITING_RETRY:{var k,U=performance.now(),N=this.retryDate;(!N||U>=N||(k=this.media)!==null&&k!==void 0&&k.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=u.State.IDLE);break}case u.State.WAITING_INIT_PTS:{var W=this.waitingData;if(W){var G=W.frag,z=W.part,X=W.cache,K=W.complete;if(this.initPTS[G.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=u.State.FRAG_LOADING;var $=X.flush(),q={frag:G,part:z,payload:$,networkDetails:null};this._handleFragmentLoadProgress(q),K&&b.prototype._handleFragmentLoadComplete.call(this,q)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+G.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var J=this.getLoadPosition(),Q=c.BufferHelper.bufferInfo(this.mediaBuffer,J,this.config.maxBufferHole),rt=(0,S.fragmentWithinToleranceTest)(Q.end,this.config.maxFragLookUpTolerance,G);rt<0&&(this.log("Waiting fragment cc ("+G.cc+") @ "+G.start+" cancelled because another fragment at "+Q.end+" is needed"),this.clearWaitingFragment())}}else this.state=u.State.IDLE}}this.onTickEnd()},O.clearWaitingFragment=function(){var P=this.waitingData;P&&(this.fragmentTracker.removeFragment(P.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=u.State.IDLE)},O.resetLoadingState=function(){this.clearWaitingFragment(),b.prototype.resetLoadingState.call(this)},O.onTickEnd=function(){var P=this.media;if(!(!P||!P.readyState)){var F=this.mediaBuffer?this.mediaBuffer:P,I=F.buffered;!this.loadedmetadata&&I.length&&(this.loadedmetadata=!0),this.lastCurrentTime=P.currentTime}},O.doTickIdle=function(){var P,F,I=this.hls,y=this.levels,k=this.media,U=this.trackId,N=I.config;if(!(!y||!y[U])&&!(!k&&(this.startFragRequested||!N.startFragPrefetch))){var W=y[U],G=W.details;if(!G||G.live&&this.levelLastLoaded!==U||this.waitForCdnTuneIn(G)){this.state=u.State.WAITING_TRACK;return}var z=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&z&&(this.bufferFlushed=!1,this.afterBufferFlushed(z,p.ElementaryStreamTypes.AUDIO,d.PlaylistLevelType.AUDIO));var X=this.getFwdBufferInfo(z,d.PlaylistLevelType.AUDIO);if(X!==null){var K=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,d.PlaylistLevelType.MAIN),$=X.len,q=this.getMaxBufferLength(K==null?void 0:K.len),J=this.audioSwitch;if(!($>=q&&!J)){if(!J&&this._streamEnded(X,G)){I.trigger(f.Events.BUFFER_EOS,{type:"audio"}),this.state=u.State.ENDED;return}var Q=G.fragments,rt=Q[0].start,mt=X.end;if(J&&k){var vt=this.getLoadPosition();mt=vt,G.PTSKnown&&vt<rt&&(X.end>rt||X.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),k.currentTime=rt+.05)}if(!(K&&mt>K.end+G.targetduration)&&!((!K||!K.len)&&X.len)){var _t=this.getNextFragment(mt,G);if(!_t){this.bufferFlushed=!0;return}((P=_t.decryptdata)===null||P===void 0?void 0:P.keyFormat)==="identity"&&!((F=_t.decryptdata)!==null&&F!==void 0&&F.key)?this.loadKey(_t,G):this.loadFragment(_t,G,mt)}}}}},O.getMaxBufferLength=function(P){var F=b.prototype.getMaxBufferLength.call(this);return P?Math.max(F,P):F},O.onMediaDetaching=function(){this.videoBuffer=null,b.prototype.onMediaDetaching.call(this)},O.onAudioTracksUpdated=function(P,F){var I=F.audioTracks;this.resetTransmuxer(),this.levels=I.map(function(y){return new g.Level(y)})},O.onAudioTrackSwitching=function(P,F){var I=!!F.url;this.trackId=F.id;var y=this.fragCurrent;y!=null&&y.loader&&y.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),I?this.setInterval(R):this.resetTransmuxer(),I?(this.audioSwitch=!0,this.state=u.State.IDLE):this.state=u.State.STOPPED,this.tick()},O.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},O.onLevelLoaded=function(P,F){this.mainDetails=F.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(f.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},O.onAudioTrackLoaded=function(P,F){var I;if(this.mainDetails==null){this.cachedTrackLoadedData=F;return}var y=this.levels,k=F.details,U=F.id;if(!y){this.warn("Audio tracks were reset while loading level "+U);return}this.log("Track "+U+" loaded ["+k.startSN+","+k.endSN+"],duration:"+k.totalduration);var N=y[U],W=0;if(k.live||(I=N.details)!==null&&I!==void 0&&I.live){var G=this.mainDetails;if(k.fragments[0]||(k.deltaUpdateFailed=!0),k.deltaUpdateFailed||!G)return;!N.details&&k.hasProgramDateTime&&G.hasProgramDateTime?((0,L.alignMediaPlaylistByPDT)(k,G),W=k.fragments[0].start):W=this.alignPlaylists(k,N.details)}N.details=k,this.levelLastLoaded=U,!this.startFragRequested&&(this.mainDetails||!k.live)&&this.setStartPosition(N.details,W),this.state===u.State.WAITING_TRACK&&!this.waitForCdnTuneIn(k)&&(this.state=u.State.IDLE),this.tick()},O._handleFragmentLoadProgress=function(P){var F,I=P.frag,y=P.part,k=P.payload,U=this.config,N=this.trackId,W=this.levels;if(!W){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+I.sn+" of level "+I.level+" will not be buffered");return}var G=W[N];console.assert(G,"Audio track is defined on fragment load progress");var z=G.details;console.assert(z,"Audio track details are defined on fragment load progress");var X=U.defaultAudioCodec||G.audioCodec||"mp4a.40.2",K=this.transmuxer;K||(K=this.transmuxer=new A.default(this.hls,d.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var $=this.initPTS[I.cc],q=(F=I.initSegment)===null||F===void 0?void 0:F.data;if($!==void 0){var J=!1,Q=y?y.index:-1,rt=Q!==-1,mt=new E.ChunkMetadata(I.level,I.sn,I.stats.chunkCount,k.byteLength,Q,rt);K.push(k,q,X,"",I,y,z.totalduration,J,mt,$)}else{this.log("Unknown video PTS for cc "+I.cc+", waiting for video PTS before demuxing audio frag "+I.sn+" of ["+z.startSN+" ,"+z.endSN+"],track "+N);var vt=this.waitingData=this.waitingData||{frag:I,part:y,cache:new v.default,complete:!1},_t=vt.cache;_t.push(new Uint8Array(k)),this.waitingVideoCC=this.videoTrackCC,this.state=u.State.WAITING_INIT_PTS}},O._handleFragmentLoadComplete=function(P){if(this.waitingData){this.waitingData.complete=!0;return}b.prototype._handleFragmentLoadComplete.call(this,P)},O.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},O.onBufferCreated=function(P,F){var I=F.tracks.audio;I&&(this.mediaBuffer=I.buffer||null),F.tracks.video&&(this.videoBuffer=F.tracks.video.buffer||null)},O.onFragBuffered=function(P,F){var I=F.frag,y=F.part;if(I.type===d.PlaylistLevelType.AUDIO){if(this.fragContextChanged(I)){this.warn("Fragment "+I.sn+(y?" p: "+y.index:"")+" of level "+I.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}I.sn!=="initSegment"&&(this.fragPrevious=I,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(f.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(I,y)}},O.onError=function(P,F){switch(F.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(d.PlaylistLevelType.AUDIO,F);break;case T.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case T.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==u.State.ERROR&&this.state!==u.State.STOPPED&&(this.state=F.fatal?u.State.ERROR:u.State.IDLE,this.warn(F.details+" while loading frag, switching to "+this.state+" state"));break;case T.ErrorDetails.BUFFER_FULL_ERROR:if(F.parent==="audio"&&(this.state===u.State.PARSING||this.state===u.State.PARSED)){var I=!0,y=this.getFwdBufferInfo(this.mediaBuffer,d.PlaylistLevelType.AUDIO);y&&y.len>.5&&(I=!this.reduceMaxBufferLength(y.len)),I&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,b.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},O.onBufferFlushed=function(P,F){var I=F.type;I===p.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},O._handleTransmuxComplete=function(P){var F,I="audio",y=this.hls,k=P.remuxResult,U=P.chunkMeta,N=this.getCurrentContext(U);if(!N){this.warn("The loading context changed while buffering fragment "+U.sn+" of level "+U.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(U.level);return}var W=N.frag,G=N.part,z=N.level.details,X=k.audio,K=k.text,$=k.id3,q=k.initSegment;if(!(this.fragContextChanged(W)||!z)){if(this.state=u.State.PARSING,this.audioSwitch&&X&&this.completeAudioSwitch(),q!=null&&q.tracks&&(this._bufferInitSegment(q.tracks,W,U),y.trigger(f.Events.FRAG_PARSING_INIT_SEGMENT,{frag:W,id:I,tracks:q.tracks})),X){var J=X.startPTS,Q=X.endPTS,rt=X.startDTS,mt=X.endDTS;G&&(G.elementaryStreams[p.ElementaryStreamTypes.AUDIO]={startPTS:J,endPTS:Q,startDTS:rt,endDTS:mt}),W.setElementaryStreamInfo(p.ElementaryStreamTypes.AUDIO,J,Q,rt,mt),this.bufferFragmentData(X,W,G,U)}if($!=null&&(F=$.samples)!==null&&F!==void 0&&F.length){var vt=x({id:I,frag:W,details:z},$);y.trigger(f.Events.FRAG_PARSING_METADATA,vt)}if(K){var _t=x({id:I,frag:W,details:z},K);y.trigger(f.Events.FRAG_PARSING_USERDATA,_t)}}},O._bufferInitSegment=function(P,F,I){if(this.state===u.State.PARSING){P.video&&delete P.video;var y=P.audio;if(!!y){y.levelCodec=y.codec,y.id="audio",this.log("Init audio buffer, container:"+y.container+", codecs[parsed]=["+y.codec+"]"),this.hls.trigger(f.Events.BUFFER_CODECS,P);var k=y.initSegment;if(k!=null&&k.byteLength){var U={type:"audio",frag:F,part:null,chunkMeta:I,parent:F.type,data:k};this.hls.trigger(f.Events.BUFFER_APPENDING,U)}this.tick()}}},O.loadFragment=function(P,F,I){var y=this.fragmentTracker.getState(P);this.fragCurrent=P,(this.audioSwitch||y===_.FragmentState.NOT_LOADED||y===_.FragmentState.PARTIAL)&&(P.sn==="initSegment"?this._loadInitSegment(P):F.live&&!(0,h.isFiniteNumber)(this.initPTS[P.cc])?(this.log("Waiting for video PTS in continuity counter "+P.cc+" of live stream before loading audio fragment "+P.sn+" of level "+this.trackId),this.state=u.State.WAITING_INIT_PTS):(this.startFragRequested=!0,b.prototype.loadFragment.call(this,P,F,I)))},O.completeAudioSwitch=function(){var P=this.hls,F=this.media,I=this.trackId;F&&(this.log("Switching audio track : flushing all audio"),b.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,P.trigger(f.Events.AUDIO_TRACK_SWITCHED,{id:I})},D}(u.default);const C=M},"./src/controller/audio-track-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>A});var h=l("./src/events.ts"),u=l("./src/errors.ts"),f=l("./src/controller/base-playlist-controller.ts"),c=l("./src/types/loader.ts");function _(E,S){for(var L=0;L<S.length;L++){var T=S[L];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(E,T.key,T)}}function g(E,S,L){return S&&_(E.prototype,S),L&&_(E,L),Object.defineProperty(E,"prototype",{writable:!1}),E}function d(E,S){E.prototype=Object.create(S.prototype),E.prototype.constructor=E,p(E,S)}function p(E,S){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(T,x){return T.__proto__=x,T},p(E,S)}var v=function(E){d(S,E);function S(T){var x;return x=E.call(this,T,"[audio-track-controller]")||this,x.tracks=[],x.groupId=null,x.tracksInGroup=[],x.trackId=-1,x.trackName="",x.selectDefaultTrack=!0,x.registerListeners(),x}var L=S.prototype;return L.registerListeners=function(){var x=this.hls;x.on(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),x.on(h.Events.MANIFEST_PARSED,this.onManifestParsed,this),x.on(h.Events.LEVEL_LOADING,this.onLevelLoading,this),x.on(h.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),x.on(h.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),x.on(h.Events.ERROR,this.onError,this)},L.unregisterListeners=function(){var x=this.hls;x.off(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),x.off(h.Events.MANIFEST_PARSED,this.onManifestParsed,this),x.off(h.Events.LEVEL_LOADING,this.onLevelLoading,this),x.off(h.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),x.off(h.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),x.off(h.Events.ERROR,this.onError,this)},L.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,E.prototype.destroy.call(this)},L.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},L.onManifestParsed=function(x,m){this.tracks=m.audioTracks||[]},L.onAudioTrackLoaded=function(x,m){var w=m.id,R=m.details,M=this.tracksInGroup[w];if(!M){this.warn("Invalid audio track id "+w);return}var C=M.details;M.details=m.details,this.log("audioTrack "+w+" loaded ["+R.startSN+"-"+R.endSN+"]"),w===this.trackId&&(this.retryCount=0,this.playlistLoaded(w,m,C))},L.onLevelLoading=function(x,m){this.switchLevel(m.level)},L.onLevelSwitching=function(x,m){this.switchLevel(m.level)},L.switchLevel=function(x){var m=this.hls.levels[x];if(!!(m!=null&&m.audioGroupIds)){var w=m.audioGroupIds[m.urlId];if(this.groupId!==w){this.groupId=w;var R=this.tracks.filter(function(C){return!w||C.groupId===w});this.selectDefaultTrack&&!R.some(function(C){return C.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=R;var M={audioTracks:R};this.log("Updating audio tracks, "+R.length+' track(s) found in "'+w+'" group-id'),this.hls.trigger(h.Events.AUDIO_TRACKS_UPDATED,M),this.selectInitialTrack()}}},L.onError=function(x,m){E.prototype.onError.call(this,x,m),!(m.fatal||!m.context)&&m.context.type===c.PlaylistContextType.AUDIO_TRACK&&m.context.id===this.trackId&&m.context.groupId===this.groupId&&this.retryLoadingOrFail(m)},L.setAudioTrack=function(x){var m=this.tracksInGroup;if(x<0||x>=m.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var w=m[this.trackId];this.log("Now switching to audio-track index "+x);var R=m[x],M=R.id,C=R.groupId,b=C===void 0?"":C,D=R.name,O=R.type,B=R.url;if(this.trackId=x,this.trackName=D,this.selectDefaultTrack=!1,this.hls.trigger(h.Events.AUDIO_TRACK_SWITCHING,{id:M,groupId:b,name:D,type:O,url:B}),!(R.details&&!R.details.live)){var P=this.switchParams(R.url,w==null?void 0:w.details);this.loadPlaylist(P)}},L.selectInitialTrack=function(){var x=this.tracksInGroup;console.assert(x.length,"Initial audio track should be selected when tracks are known");var m=this.trackName,w=this.findTrackId(m)||this.findTrackId();w!==-1?this.setAudioTrack(w):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(h.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},L.findTrackId=function(x){for(var m=this.tracksInGroup,w=0;w<m.length;w++){var R=m[w];if((!this.selectDefaultTrack||R.default)&&(!x||x===R.name))return R.id}return-1},L.loadPlaylist=function(x){var m=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(m)){var w=m.id,R=m.groupId,M=m.url;if(x)try{M=x.addDirectives(M)}catch(C){this.warn("Could not construct new URL with HLS Delivery Directives: "+C)}this.log("loading audio-track playlist for id: "+w),this.clearTimer(),this.hls.trigger(h.Events.AUDIO_TRACK_LOADING,{url:M,id:w,groupId:R,deliveryDirectives:x||null})}},g(S,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(x){this.selectDefaultTrack=!1,this.setAudioTrack(x)}}]),S}(f.default);const A=v},"./src/controller/base-playlist-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>g});var h=l("./src/polyfills/number.ts"),u=l("./src/types/level.ts"),f=l("./src/controller/level-helper.ts"),c=l("./src/utils/logger.ts"),_=l("./src/errors.ts"),g=function(){function d(v,A){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=c.logger.log.bind(c.logger,A+":"),this.warn=c.logger.warn.bind(c.logger,A+":"),this.hls=v}var p=d.prototype;return p.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},p.onError=function(A,E){E.fatal&&E.type===_.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},p.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},p.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},p.stopLoad=function(){this.canLoad=!1,this.clearTimer()},p.switchParams=function(A,E){var S=E==null?void 0:E.renditionReports;if(S)for(var L=0;L<S.length;L++){var T=S[L],x=""+T.URI;if(x===A.slice(-x.length)){var m=parseInt(T["LAST-MSN"]),w=parseInt(T["LAST-PART"]);if(E&&this.hls.config.lowLatencyMode){var R=Math.min(E.age-E.partTarget,E.targetduration);w!==void 0&&R>E.partTarget&&(w+=1)}if((0,h.isFiniteNumber)(m))return new u.HlsUrlParameters(m,(0,h.isFiniteNumber)(w)?w:void 0,u.HlsSkip.No)}}},p.loadPlaylist=function(A){},p.shouldLoadTrack=function(A){return this.canLoad&&A&&!!A.url&&(!A.details||A.details.live)},p.playlistLoaded=function(A,E,S){var L=this,T=E.details,x=E.stats,m=x.loading.end?Math.max(0,self.performance.now()-x.loading.end):0;if(T.advancedDateTime=Date.now()-m,T.live||S!=null&&S.live){if(T.reloaded(S),S&&this.log("live playlist "+A+" "+(T.advanced?"REFRESHED "+T.lastPartSn+"-"+T.lastPartIndex:"MISSED")),S&&T.fragments.length>0&&(0,f.mergeDetails)(S,T),!this.canLoad||!T.live)return;var w,R=void 0,M=void 0;if(T.canBlockReload&&T.endSN&&T.advanced){var C=this.hls.config.lowLatencyMode,b=T.lastPartSn,D=T.endSN,O=T.lastPartIndex,B=O!==-1,P=b===D,F=C?0:O;B?(R=P?D+1:b,M=P?F:O+1):R=D+1;var I=T.age,y=I+T.ageHeader,k=Math.min(y-T.partTarget,T.targetduration*1.5);if(k>0){if(S&&k>S.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+S.tuneInGoal+" to: "+k+" with playlist age: "+T.age),k=0;else{var U=Math.floor(k/T.targetduration);if(R+=U,M!==void 0){var N=Math.round(k%T.targetduration/T.partTarget);M+=N}this.log("CDN Tune-in age: "+T.ageHeader+"s last advanced "+I.toFixed(2)+"s goal: "+k+" skip sn "+U+" to part "+M)}T.tuneInGoal=k}if(w=this.getDeliveryDirectives(T,E.deliveryDirectives,R,M),C||!P){this.loadPlaylist(w);return}}else w=this.getDeliveryDirectives(T,E.deliveryDirectives,R,M);var W=(0,f.computeReloadInterval)(T,x);R!==void 0&&T.canBlockReload&&(W-=T.partTarget||1),this.log("reload live playlist "+A+" in "+Math.round(W)+" ms"),this.timer=self.setTimeout(function(){return L.loadPlaylist(w)},W)}else this.clearTimer()},p.getDeliveryDirectives=function(A,E,S,L){var T=(0,u.getSkipValue)(A,S);return E!=null&&E.skip&&A.deltaUpdateFailed&&(S=E.msn,L=E.part,T=u.HlsSkip.No),new u.HlsUrlParameters(S,L,T)},p.retryLoadingOrFail=function(A){var E=this,S=this.hls.config,L=this.retryCount<S.levelLoadingMaxRetry;if(L){var T;if(this.retryCount++,A.details.indexOf("LoadTimeOut")>-1&&(T=A.context)!==null&&T!==void 0&&T.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+A.details+'"'),this.loadPlaylist();else{var x=Math.min(Math.pow(2,this.retryCount)*S.levelLoadingRetryDelay,S.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return E.loadPlaylist()},x),this.warn("retry playlist loading #"+this.retryCount+" in "+x+' ms after "'+A.details+'"')}}else this.warn('cannot recover from error "'+A.details+'"'),this.clearTimer(),A.fatal=!0;return L},d}()},"./src/controller/base-stream-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{State:()=>D,default:()=>O});var h=l("./src/polyfills/number.ts"),u=l("./src/task-loop.ts"),f=l("./src/controller/fragment-tracker.ts"),c=l("./src/utils/buffer-helper.ts"),_=l("./src/utils/logger.ts"),g=l("./src/events.ts"),d=l("./src/errors.ts"),p=l("./src/types/transmuxer.ts"),v=l("./src/utils/mp4-tools.ts"),A=l("./src/utils/discontinuities.ts"),E=l("./src/controller/fragment-finders.ts"),S=l("./src/controller/level-helper.ts"),L=l("./src/loader/fragment-loader.ts"),T=l("./src/crypt/decrypter.ts"),x=l("./src/utils/time-ranges.ts"),m=l("./src/types/loader.ts");function w(B,P){for(var F=0;F<P.length;F++){var I=P[F];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(B,I.key,I)}}function R(B,P,F){return P&&w(B.prototype,P),F&&w(B,F),Object.defineProperty(B,"prototype",{writable:!1}),B}function M(B){if(B===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B}function C(B,P){B.prototype=Object.create(P.prototype),B.prototype.constructor=B,b(B,P)}function b(B,P){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(I,y){return I.__proto__=y,I},b(B,P)}var D={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},O=function(B){C(P,B);function P(I,y,k){var U;return U=B.call(this)||this,U.hls=void 0,U.fragPrevious=null,U.fragCurrent=null,U.fragmentTracker=void 0,U.transmuxer=null,U._state=D.STOPPED,U.media=null,U.mediaBuffer=null,U.config=void 0,U.bitrateTest=!1,U.lastCurrentTime=0,U.nextLoadPosition=0,U.startPosition=0,U.loadedmetadata=!1,U.fragLoadError=0,U.retryDate=0,U.levels=null,U.fragmentLoader=void 0,U.levelLastLoaded=null,U.startFragRequested=!1,U.decrypter=void 0,U.initPTS=[],U.onvseeking=null,U.onvended=null,U.logPrefix="",U.log=void 0,U.warn=void 0,U.logPrefix=k,U.log=_.logger.log.bind(_.logger,k+":"),U.warn=_.logger.warn.bind(_.logger,k+":"),U.hls=I,U.fragmentLoader=new L.default(I.config),U.fragmentTracker=y,U.config=I.config,U.decrypter=new T.default(I,I.config),I.on(g.Events.KEY_LOADED,U.onKeyLoaded,M(U)),I.on(g.Events.LEVEL_SWITCHING,U.onLevelSwitching,M(U)),U}var F=P.prototype;return F.doTick=function(){this.onTickEnd()},F.onTickEnd=function(){},F.startLoad=function(y){},F.stopLoad=function(){this.fragmentLoader.abort();var y=this.fragCurrent;y&&this.fragmentTracker.removeFragment(y),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=D.STOPPED},F._streamEnded=function(y,k){var U=this.fragCurrent,N=this.fragmentTracker;if(!k.live&&U&&this.media&&U.sn>=k.endSN&&!y.nextStart){var W=k.partList;if(W!=null&&W.length){var G=W[W.length-1],z=c.BufferHelper.isBuffered(this.media,G.start+G.duration/2);return z}var X=N.getState(U);return X===f.FragmentState.PARTIAL||X===f.FragmentState.OK}return!1},F.onMediaAttached=function(y,k){var U=this.media=this.mediaBuffer=k.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),U.addEventListener("seeking",this.onvseeking),U.addEventListener("ended",this.onvended);var N=this.config;this.levels&&N.autoStartLoad&&this.state===D.STOPPED&&this.startLoad(N.startPosition)},F.onMediaDetaching=function(){var y=this.media;y!=null&&y.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),y&&this.onvseeking&&this.onvended&&(y.removeEventListener("seeking",this.onvseeking),y.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},F.onMediaSeeking=function(){var y=this.config,k=this.fragCurrent,U=this.media,N=this.mediaBuffer,W=this.state,G=U?U.currentTime:0,z=c.BufferHelper.bufferInfo(N||U,G,y.maxBufferHole);if(this.log("media seeking to "+((0,h.isFiniteNumber)(G)?G.toFixed(3):G)+", state: "+W),W===D.ENDED)this.resetLoadingState();else if(k&&!z.len){var X=y.maxFragLookUpTolerance,K=k.start-X,$=k.start+k.duration+X,q=G>$;(G<K||q)&&(q&&k.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),k.loader.abort()),this.resetLoadingState())}U&&(this.lastCurrentTime=G),!this.loadedmetadata&&!z.len&&(this.nextLoadPosition=this.startPosition=G),this.tickImmediate()},F.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},F.onKeyLoaded=function(y,k){if(!(this.state!==D.KEY_LOADING||k.frag!==this.fragCurrent||!this.levels)){this.state=D.IDLE;var U=this.levels[k.frag.level].details;U&&this.loadFragment(k.frag,U,k.frag.start)}},F.onLevelSwitching=function(y,k){this.fragLoadError=0},F.onHandlerDestroying=function(){this.stopLoad(),B.prototype.onHandlerDestroying.call(this)},F.onHandlerDestroyed=function(){this.state=D.STOPPED,this.hls.off(g.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(g.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,B.prototype.onHandlerDestroyed.call(this)},F.loadKey=function(y,k){this.log("Loading key for "+y.sn+" of ["+k.startSN+"-"+k.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+y.level),this.state=D.KEY_LOADING,this.fragCurrent=y,this.hls.trigger(g.Events.KEY_LOADING,{frag:y})},F.loadFragment=function(y,k,U){this._loadFragForPlayback(y,k,U)},F._loadFragForPlayback=function(y,k,U){var N=this,W=function(z){if(N.fragContextChanged(y)){N.warn("Fragment "+y.sn+(z.part?" p: "+z.part.index:"")+" of level "+y.level+" was dropped during download."),N.fragmentTracker.removeFragment(y);return}y.stats.chunkCount++,N._handleFragmentLoadProgress(z)};this._doFragLoad(y,k,U,W).then(function(G){if(!!G){N.fragLoadError=0;var z=N.state;if(N.fragContextChanged(y)){(z===D.FRAG_LOADING||!N.fragCurrent&&z===D.PARSING)&&(N.fragmentTracker.removeFragment(y),N.state=D.IDLE);return}"payload"in G&&(N.log("Loaded fragment "+y.sn+" of level "+y.level),N.hls.trigger(g.Events.FRAG_LOADED,G)),N._handleFragmentLoadComplete(G)}}).catch(function(G){N.state===D.STOPPED||N.state===D.ERROR||(N.warn(G),N.resetFragmentLoading(y))})},F.flushMainBuffer=function(y,k,U){if(U===void 0&&(U=null),!!(y-k)){var N={startOffset:y,endOffset:k,type:U};this.fragLoadError=0,this.hls.trigger(g.Events.BUFFER_FLUSHING,N)}},F._loadInitSegment=function(y){var k=this;this._doFragLoad(y).then(function(U){if(!U||k.fragContextChanged(y)||!k.levels)throw new Error("init load aborted");return U}).then(function(U){var N=k.hls,W=U.payload,G=y.decryptdata;if(W&&W.byteLength>0&&G&&G.key&&G.iv&&G.method==="AES-128"){var z=self.performance.now();return k.decrypter.webCryptoDecrypt(new Uint8Array(W),G.key.buffer,G.iv.buffer).then(function(X){var K=self.performance.now();return N.trigger(g.Events.FRAG_DECRYPTED,{frag:y,payload:X,stats:{tstart:z,tdecrypt:K}}),U.payload=X,U})}return U}).then(function(U){var N=k.fragCurrent,W=k.hls,G=k.levels;if(!G)throw new Error("init load aborted, missing levels");var z=G[y.level].details;console.assert(z,"Level details are defined when init segment is loaded");var X=y.stats;k.state=D.IDLE,k.fragLoadError=0,y.data=new Uint8Array(U.payload),X.parsing.start=X.buffering.start=self.performance.now(),X.parsing.end=X.buffering.end=self.performance.now(),U.frag===N&&W.trigger(g.Events.FRAG_BUFFERED,{stats:X,frag:N,part:null,id:y.type}),k.tick()}).catch(function(U){k.state===D.STOPPED||k.state===D.ERROR||(k.warn(U),k.resetFragmentLoading(y))})},F.fragContextChanged=function(y){var k=this.fragCurrent;return!y||!k||y.level!==k.level||y.sn!==k.sn||y.urlId!==k.urlId},F.fragBufferedComplete=function(y,k){var U,N,W=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+y.type+" sn: "+y.sn+(k?" part: "+k.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+y.level+" "+(W?x.default.toString(c.BufferHelper.getBuffered(W)):"(detached)")),this.state=D.IDLE,W&&(!this.loadedmetadata&&W.buffered.length&&((U=this.fragCurrent)===null||U===void 0?void 0:U.sn)===((N=this.fragPrevious)===null||N===void 0?void 0:N.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},F.seekToStartPos=function(){},F._handleFragmentLoadComplete=function(y){var k=this.transmuxer;if(!!k){var U=y.frag,N=y.part,W=y.partsLoaded,G=!W||W.length===0||W.some(function(X){return!X}),z=new p.ChunkMetadata(U.level,U.sn,U.stats.chunkCount+1,0,N?N.index:-1,!G);k.flush(z)}},F._handleFragmentLoadProgress=function(y){},F._doFragLoad=function(y,k,U,N){var W=this;if(U===void 0&&(U=null),!this.levels)throw new Error("frag load aborted, missing levels");if(U=Math.max(y.start,U||0),this.config.lowLatencyMode&&k){var G=k.partList;if(G&&N){U>y.end&&k.fragmentHint&&(y=k.fragmentHint);var z=this.getNextPart(G,y,U);if(z>-1){var X=G[z];return this.log("Loading part sn: "+y.sn+" p: "+X.index+" cc: "+y.cc+" of playlist ["+k.startSN+"-"+k.endSN+"] parts [0-"+z+"-"+(G.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+y.level+", target: "+parseFloat(U.toFixed(3))),this.nextLoadPosition=X.start+X.duration,this.state=D.FRAG_LOADING,this.hls.trigger(g.Events.FRAG_LOADING,{frag:y,part:G[z],targetBufferTime:U}),this.doFragPartsLoad(y,G,z,N).catch(function(K){return W.handleFragLoadError(K)})}else if(!y.url||this.loadedEndOfParts(G,U))return Promise.resolve(null)}}return this.log("Loading fragment "+y.sn+" cc: "+y.cc+" "+(k?"of ["+k.startSN+"-"+k.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+y.level+", target: "+parseFloat(U.toFixed(3))),(0,h.isFiniteNumber)(y.sn)&&!this.bitrateTest&&(this.nextLoadPosition=y.start+y.duration),this.state=D.FRAG_LOADING,this.hls.trigger(g.Events.FRAG_LOADING,{frag:y,targetBufferTime:U}),this.fragmentLoader.load(y,N).catch(function(K){return W.handleFragLoadError(K)})},F.doFragPartsLoad=function(y,k,U,N){var W=this;return new Promise(function(G,z){var X=[],K=function $(q){var J=k[q];W.fragmentLoader.loadPart(y,J,N).then(function(Q){X[J.index]=Q;var rt=Q.part;W.hls.trigger(g.Events.FRAG_LOADED,Q);var mt=k[q+1];if(mt&&mt.fragment===y)$(q+1);else return G({frag:y,part:rt,partsLoaded:X})}).catch(z)};K(U)})},F.handleFragLoadError=function(y){var k=y.data;return k&&k.details===d.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(k.frag,k.part):this.hls.trigger(g.Events.ERROR,k),null},F._handleTransmuxerFlush=function(y){var k=this.getCurrentContext(y);if(!k||this.state!==D.PARSING){this.fragCurrent||(this.state=D.IDLE);return}var U=k.frag,N=k.part,W=k.level,G=self.performance.now();U.stats.parsing.end=G,N&&(N.stats.parsing.end=G),this.updateLevelTiming(U,N,W,y.partial)},F.getCurrentContext=function(y){var k=this.levels,U=y.level,N=y.sn,W=y.part;if(!k||!k[U])return this.warn("Levels object was unset while buffering fragment "+N+" of level "+U+". The current chunk will not be buffered."),null;var G=k[U],z=W>-1?(0,S.getPartWith)(G,N,W):null,X=z?z.fragment:(0,S.getFragmentWithSN)(G,N,this.fragCurrent);return X?{frag:X,part:z,level:G}:null},F.bufferFragmentData=function(y,k,U,N){if(!(!y||this.state!==D.PARSING)){var W=y.data1,G=y.data2,z=W;if(W&&G&&(z=(0,v.appendUint8Array)(W,G)),!(!z||!z.length)){var X={type:y.type,frag:k,part:U,chunkMeta:N,parent:k.type,data:z};this.hls.trigger(g.Events.BUFFER_APPENDING,X),y.dropped&&y.independent&&!U&&this.flushBufferGap(k)}}},F.flushBufferGap=function(y){var k=this.media;if(!!k){if(!c.BufferHelper.isBuffered(k,k.currentTime)){this.flushMainBuffer(0,y.start);return}var U=k.currentTime,N=c.BufferHelper.bufferInfo(k,U,0),W=y.duration,G=Math.min(this.config.maxFragLookUpTolerance*2,W*.25),z=Math.max(Math.min(y.start-G,N.end-G),U+G);y.start-z>G&&this.flushMainBuffer(z,y.start)}},F.getFwdBufferInfo=function(y,k){var U=this.config,N=this.getLoadPosition();if(!(0,h.isFiniteNumber)(N))return null;var W=c.BufferHelper.bufferInfo(y,N,U.maxBufferHole);if(W.len===0&&W.nextStart!==void 0){var G=this.fragmentTracker.getBufferedFrag(N,k);if(G&&W.nextStart<G.end)return c.BufferHelper.bufferInfo(y,N,Math.max(W.nextStart,U.maxBufferHole))}return W},F.getMaxBufferLength=function(y){var k=this.config,U;return y?U=Math.max(8*k.maxBufferSize/y,k.maxBufferLength):U=k.maxBufferLength,Math.min(U,k.maxMaxBufferLength)},F.reduceMaxBufferLength=function(y){var k=this.config,U=y||k.maxBufferLength;return k.maxMaxBufferLength>=U?(k.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+k.maxMaxBufferLength+"s"),!0):!1},F.getNextFragment=function(y,k){var U=k.fragments,N=U.length;if(!N)return null;var W=this.config,G=U[0].start,z;if(k.live){var X=W.initialLiveManifestSize;if(N<X)return this.warn("Not enough fragments to start playback (have: "+N+", need: "+X+")"),null;!k.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(z=this.getInitialLiveFragment(k,U),this.startPosition=z?this.hls.liveSyncPosition||z.start:y)}else y<=G&&(z=U[0]);if(!z){var K=W.lowLatencyMode?k.partEnd:k.fragmentEnd;z=this.getFragmentAtPosition(y,K,k)}return this.mapToInitFragWhenRequired(z)},F.mapToInitFragWhenRequired=function(y){return y!=null&&y.initSegment&&!(y!=null&&y.initSegment.data)&&!this.bitrateTest?y.initSegment:y},F.getNextPart=function(y,k,U){for(var N=-1,W=!1,G=!0,z=0,X=y.length;z<X;z++){var K=y[z];if(G=G&&!K.independent,N>-1&&U<K.start)break;var $=K.loaded;!$&&(W||K.independent||G)&&K.fragment===k&&(N=z),W=$}return N},F.loadedEndOfParts=function(y,k){var U=y[y.length-1];return U&&k>U.start&&U.loaded},F.getInitialLiveFragment=function(y,k){var U=this.fragPrevious,N=null;if(U){if(y.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+U.programDateTime),N=(0,E.findFragmentByPDT)(k,U.endProgramDateTime,this.config.maxFragLookUpTolerance)),!N){var W=U.sn+1;if(W>=y.startSN&&W<=y.endSN){var G=k[W-y.startSN];U.cc===G.cc&&(N=G,this.log("Live playlist, switching playlist, load frag with next SN: "+N.sn))}N||(N=(0,E.findFragWithCC)(k,U.cc),N&&this.log("Live playlist, switching playlist, load frag with same CC: "+N.sn))}}else{var z=this.hls.liveSyncPosition;z!==null&&(N=this.getFragmentAtPosition(z,this.bitrateTest?y.fragmentEnd:y.edge,y))}return N},F.getFragmentAtPosition=function(y,k,U){var N=this.config,W=this.fragPrevious,G=U.fragments,z=U.endSN,X=U.fragmentHint,K=N.maxFragLookUpTolerance,$=!!(N.lowLatencyMode&&U.partList&&X);$&&X&&!this.bitrateTest&&(G=G.concat(X),z=X.sn);var q;if(y<k){var J=y>k-K?0:K;q=(0,E.findFragmentByPTS)(W,G,y,J)}else q=G[G.length-1];if(q){var Q=q.sn-U.startSN;if(this.fragmentTracker.getState(q)===f.FragmentState.OK&&(W=q),W&&q.sn===W.sn&&!$){var rt=W&&q.level===W.level;if(rt){var mt=G[Q+1];q.sn<z&&this.fragmentTracker.getState(mt)!==f.FragmentState.OK?(this.log("SN "+q.sn+" just loaded, load next one: "+mt.sn),q=mt):q=null}}}return q},F.synchronizeToLiveEdge=function(y){var k=this.config,U=this.media;if(!!U){var N=this.hls.liveSyncPosition,W=U.currentTime,G=y.fragments[0].start,z=y.edge,X=W>=G-k.maxFragLookUpTolerance&&W<=z;if(N!==null&&U.duration>N&&(W<N||!X)){var K=k.liveMaxLatencyDuration!==void 0?k.liveMaxLatencyDuration:k.liveMaxLatencyDurationCount*y.targetduration;(!X&&U.readyState<4||W<z-K)&&(this.loadedmetadata||(this.nextLoadPosition=N),U.readyState&&(this.warn("Playback: "+W.toFixed(3)+" is located too far from the end of live sliding playlist: "+z+", reset currentTime to : "+N.toFixed(3)),U.currentTime=N))}}},F.alignPlaylists=function(y,k){var U=this.levels,N=this.levelLastLoaded,W=this.fragPrevious,G=N!==null?U[N]:null,z=y.fragments.length;if(!z)return this.warn("No fragments in live playlist"),0;var X=y.fragments[0].start,K=!k,$=y.alignedSliding&&(0,h.isFiniteNumber)(X);if(K||!$&&!X){(0,A.alignStream)(W,G,y);var q=y.fragments[0].start;return this.log("Live playlist sliding: "+q.toFixed(2)+" start-sn: "+(k?k.startSN:"na")+"->"+y.startSN+" prev-sn: "+(W?W.sn:"na")+" fragments: "+z),q}return X},F.waitForCdnTuneIn=function(y){var k=3;return y.live&&y.canBlockReload&&y.partTarget&&y.tuneInGoal>Math.max(y.partHoldBack,y.partTarget*k)},F.setStartPosition=function(y,k){var U=this.startPosition;if(U<k&&(U=-1),U===-1||this.lastCurrentTime===-1){var N=y.startTimeOffset;(0,h.isFiniteNumber)(N)?(U=k+N,N<0&&(U+=y.totalduration),U=Math.min(Math.max(k,U),k+y.totalduration),this.log("Start time offset "+N+" found in playlist, adjust startPosition to "+U),this.startPosition=U):y.live?U=this.hls.liveSyncPosition||k:this.startPosition=U=0,this.lastCurrentTime=U}this.nextLoadPosition=U},F.getLoadPosition=function(){var y=this.media,k=0;return this.loadedmetadata&&y?k=y.currentTime:this.nextLoadPosition&&(k=this.nextLoadPosition),k},F.handleFragLoadAborted=function(y,k){this.transmuxer&&y.sn!=="initSegment"&&y.stats.aborted&&(this.warn("Fragment "+y.sn+(k?" part"+k.index:"")+" of level "+y.level+" was aborted"),this.resetFragmentLoading(y))},F.resetFragmentLoading=function(y){(!this.fragCurrent||!this.fragContextChanged(y)&&this.state!==D.FRAG_LOADING_WAITING_RETRY)&&(this.state=D.IDLE)},F.onFragmentOrKeyLoadError=function(y,k){if(!k.fatal){var U=k.frag;if(!(!U||U.type!==y)){var N=this.fragCurrent;console.assert(N&&U.sn===N.sn&&U.level===N.level&&U.urlId===N.urlId,"Frag load error must match current frag to retry");var W=this.config;if(this.fragLoadError+1<=W.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var G=Math.min(Math.pow(2,this.fragLoadError)*W.fragLoadingRetryDelay,W.fragLoadingMaxRetryTimeout);this.warn("Fragment "+U.sn+" of "+y+" "+U.level+" failed to load, retrying in "+G+"ms"),this.retryDate=self.performance.now()+G,this.fragLoadError++,this.state=D.FRAG_LOADING_WAITING_RETRY}else k.levelRetry?(y===m.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=D.IDLE):(_.logger.error(k.details+" reaches max retry, redispatch as fatal ..."),k.fatal=!0,this.hls.stopLoad(),this.state=D.ERROR)}}},F.afterBufferFlushed=function(y,k,U){if(!!y){var N=c.BufferHelper.getBuffered(y);this.fragmentTracker.detectEvictedFragments(k,N,U),this.state===D.ENDED&&this.resetLoadingState()}},F.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=D.IDLE},F.resetStartWhenNotLoaded=function(y){if(!this.loadedmetadata){this.startFragRequested=!1;var k=this.levels?this.levels[y].details:null;k!=null&&k.live?(this.startPosition=-1,this.setStartPosition(k,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},F.updateLevelTiming=function(y,k,U,N){var W=this,G=U.details;console.assert(!!G,"level.details must be defined");var z=Object.keys(y.elementaryStreams).reduce(function(X,K){var $=y.elementaryStreams[K];if($){var q=$.endPTS-$.startPTS;if(q<=0)return W.warn("Could not parse fragment "+y.sn+" "+K+" duration reliably ("+q+")"),X||!1;var J=N?0:(0,S.updateFragPTSDTS)(G,y,$.startPTS,$.endPTS,$.startDTS,$.endDTS);return W.hls.trigger(g.Events.LEVEL_PTS_UPDATED,{details:G,level:U,drift:J,type:K,frag:y,start:$.startPTS,end:$.endPTS}),!0}return X},!1);z||(this.warn("Found no media in fragment "+y.sn+" of level "+U.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=D.PARSED,this.hls.trigger(g.Events.FRAG_PARSED,{frag:y,part:k})},F.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},R(P,[{key:"state",get:function(){return this._state},set:function(y){var k=this._state;k!==y&&(this._state=y,this.log(k+"->"+y))}}]),P}(u.default)},"./src/controller/buffer-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>E});var h=l("./src/polyfills/number.ts"),u=l("./src/events.ts"),f=l("./src/utils/logger.ts"),c=l("./src/errors.ts"),_=l("./src/utils/buffer-helper.ts"),g=l("./src/utils/mediasource-helper.ts"),d=l("./src/loader/fragment.ts"),p=l("./src/controller/buffer-operation-queue.ts"),v=(0,g.getMediaSource)(),A=/([ha]vc.)(?:\.[^.,]+)+/,E=function(){function S(T){var x=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var m=x.hls,w=x.media,R=x.mediaSource;f.logger.log("[buffer-controller]: Media source opened"),w&&(x.updateMediaElementDuration(),m.trigger(u.Events.MEDIA_ATTACHED,{media:w})),R&&R.removeEventListener("sourceopen",x._onMediaSourceOpen),x.checkPendingTracks()},this._onMediaSourceClose=function(){f.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){f.logger.log("[buffer-controller]: Media source ended")},this.hls=T,this._initSourceBuffer(),this.registerListeners()}var L=S.prototype;return L.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},L.destroy=function(){this.unregisterListeners(),this.details=null},L.registerListeners=function(){var x=this.hls;x.on(u.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),x.on(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),x.on(u.Events.MANIFEST_PARSED,this.onManifestParsed,this),x.on(u.Events.BUFFER_RESET,this.onBufferReset,this),x.on(u.Events.BUFFER_APPENDING,this.onBufferAppending,this),x.on(u.Events.BUFFER_CODECS,this.onBufferCodecs,this),x.on(u.Events.BUFFER_EOS,this.onBufferEos,this),x.on(u.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),x.on(u.Events.LEVEL_UPDATED,this.onLevelUpdated,this),x.on(u.Events.FRAG_PARSED,this.onFragParsed,this),x.on(u.Events.FRAG_CHANGED,this.onFragChanged,this)},L.unregisterListeners=function(){var x=this.hls;x.off(u.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),x.off(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),x.off(u.Events.MANIFEST_PARSED,this.onManifestParsed,this),x.off(u.Events.BUFFER_RESET,this.onBufferReset,this),x.off(u.Events.BUFFER_APPENDING,this.onBufferAppending,this),x.off(u.Events.BUFFER_CODECS,this.onBufferCodecs,this),x.off(u.Events.BUFFER_EOS,this.onBufferEos,this),x.off(u.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),x.off(u.Events.LEVEL_UPDATED,this.onLevelUpdated,this),x.off(u.Events.FRAG_PARSED,this.onFragParsed,this),x.off(u.Events.FRAG_CHANGED,this.onFragChanged,this)},L._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new p.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},L.onManifestParsed=function(x,m){var w=2;(m.audio&&!m.video||!m.altAudio)&&(w=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=w,this.details=null,f.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},L.onMediaAttaching=function(x,m){var w=this.media=m.media;if(w&&v){var R=this.mediaSource=new v;R.addEventListener("sourceopen",this._onMediaSourceOpen),R.addEventListener("sourceended",this._onMediaSourceEnded),R.addEventListener("sourceclose",this._onMediaSourceClose),w.src=self.URL.createObjectURL(R),this._objectUrl=w.src}},L.onMediaDetaching=function(){var x=this.media,m=this.mediaSource,w=this._objectUrl;if(m){if(f.logger.log("[buffer-controller]: media source detaching"),m.readyState==="open")try{m.endOfStream()}catch(R){f.logger.warn("[buffer-controller]: onMediaDetaching: "+R.message+" while calling endOfStream")}this.onBufferReset(),m.removeEventListener("sourceopen",this._onMediaSourceOpen),m.removeEventListener("sourceended",this._onMediaSourceEnded),m.removeEventListener("sourceclose",this._onMediaSourceClose),x&&(w&&self.URL.revokeObjectURL(w),x.src===w?(x.removeAttribute("src"),x.load()):f.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(u.Events.MEDIA_DETACHED,void 0)},L.onBufferReset=function(){var x=this;this.getSourceBufferTypes().forEach(function(m){var w=x.sourceBuffer[m];try{w&&(x.removeBufferListeners(m),x.mediaSource&&x.mediaSource.removeSourceBuffer(w),x.sourceBuffer[m]=void 0)}catch(R){f.logger.warn("[buffer-controller]: Failed to reset the "+m+" buffer",R)}}),this._initSourceBuffer()},L.onBufferCodecs=function(x,m){var w=this,R=this.getSourceBufferTypes().length;Object.keys(m).forEach(function(M){if(R){var C=w.tracks[M];if(C&&typeof C.buffer.changeType=="function"){var b=m[M],D=b.id,O=b.codec,B=b.levelCodec,P=b.container,F=b.metadata,I=(C.levelCodec||C.codec).replace(A,"$1"),y=(B||O).replace(A,"$1");if(I!==y){var k=P+";codecs="+(B||O);w.appendChangeType(M,k),f.logger.log("[buffer-controller]: switching codec "+I+" to "+y),w.tracks[M]={buffer:C.buffer,codec:O,container:P,levelCodec:B,metadata:F,id:D}}}}else w.pendingTracks[M]=m[M]}),!R&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},L.appendChangeType=function(x,m){var w=this,R=this.operationQueue,M={execute:function(){var b=w.sourceBuffer[x];b&&(f.logger.log("[buffer-controller]: changing "+x+" sourceBuffer type to "+m),b.changeType(m)),R.shiftAndExecuteNext(x)},onStart:function(){},onComplete:function(){},onError:function(b){f.logger.warn("[buffer-controller]: Failed to change "+x+" SourceBuffer type",b)}};R.append(M,x)},L.onBufferAppending=function(x,m){var w=this,R=this.hls,M=this.operationQueue,C=this.tracks,b=m.data,D=m.type,O=m.frag,B=m.part,P=m.chunkMeta,F=P.buffering[D],I=self.performance.now();F.start=I;var y=O.stats.buffering,k=B?B.stats.buffering:null;y.start===0&&(y.start=I),k&&k.start===0&&(k.start=I);var U=C.audio,N=D==="audio"&&P.id===1&&(U==null?void 0:U.container)==="audio/mpeg",W={execute:function(){if(F.executeStart=self.performance.now(),N){var z=w.sourceBuffer[D];if(z){var X=O.start-z.timestampOffset;Math.abs(X)>=.1&&(f.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+O.start+" (delta: "+X+") sn: "+O.sn+")"),z.timestampOffset=O.start)}}w.appendExecutor(b,D)},onStart:function(){},onComplete:function(){var z=self.performance.now();F.executeEnd=F.end=z,y.first===0&&(y.first=z),k&&k.first===0&&(k.first=z);var X=w.sourceBuffer,K={};for(var $ in X)K[$]=_.BufferHelper.getBuffered(X[$]);w.appendError=0,w.hls.trigger(u.Events.BUFFER_APPENDED,{type:D,frag:O,part:B,chunkMeta:P,parent:O.type,timeRanges:K})},onError:function(z){f.logger.error("[buffer-controller]: Error encountered while trying to append to the "+D+" SourceBuffer",z);var X={type:c.ErrorTypes.MEDIA_ERROR,parent:O.type,details:c.ErrorDetails.BUFFER_APPEND_ERROR,err:z,fatal:!1};z.code===DOMException.QUOTA_EXCEEDED_ERR?X.details=c.ErrorDetails.BUFFER_FULL_ERROR:(w.appendError++,X.details=c.ErrorDetails.BUFFER_APPEND_ERROR,w.appendError>R.config.appendErrorMaxRetry&&(f.logger.error("[buffer-controller]: Failed "+R.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),X.fatal=!0,R.stopLoad())),R.trigger(u.Events.ERROR,X)}};M.append(W,D)},L.onBufferFlushing=function(x,m){var w=this,R=this.operationQueue,M=function(b){return{execute:w.removeExecutor.bind(w,b,m.startOffset,m.endOffset),onStart:function(){},onComplete:function(){w.hls.trigger(u.Events.BUFFER_FLUSHED,{type:b})},onError:function(O){f.logger.warn("[buffer-controller]: Failed to remove from "+b+" SourceBuffer",O)}}};m.type?R.append(M(m.type),m.type):this.getSourceBufferTypes().forEach(function(C){R.append(M(C),C)})},L.onFragParsed=function(x,m){var w=this,R=m.frag,M=m.part,C=[],b=M?M.elementaryStreams:R.elementaryStreams;b[d.ElementaryStreamTypes.AUDIOVIDEO]?C.push("audiovideo"):(b[d.ElementaryStreamTypes.AUDIO]&&C.push("audio"),b[d.ElementaryStreamTypes.VIDEO]&&C.push("video"));var D=function(){var B=self.performance.now();R.stats.buffering.end=B,M&&(M.stats.buffering.end=B);var P=M?M.stats:R.stats;w.hls.trigger(u.Events.FRAG_BUFFERED,{frag:R,part:M,stats:P,id:R.type})};C.length===0&&f.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+R.type+" level: "+R.level+" sn: "+R.sn),this.blockBuffers(D,C)},L.onFragChanged=function(x,m){this.flushBackBuffer()},L.onBufferEos=function(x,m){var w=this,R=this.getSourceBufferTypes().reduce(function(M,C){var b=w.sourceBuffer[C];return(!m.type||m.type===C)&&b&&!b.ended&&(b.ended=!0,f.logger.log("[buffer-controller]: "+C+" sourceBuffer now EOS")),M&&!!(!b||b.ended)},!0);R&&this.blockBuffers(function(){var M=w.mediaSource;!M||M.readyState!=="open"||M.endOfStream()})},L.onLevelUpdated=function(x,m){var w=m.details;!w.fragments.length||(this.details=w,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},L.flushBackBuffer=function(){var x=this.hls,m=this.details,w=this.media,R=this.sourceBuffer;if(!(!w||m===null)){var M=this.getSourceBufferTypes();if(!!M.length){var C=m.live&&x.config.liveBackBufferLength!==null?x.config.liveBackBufferLength:x.config.backBufferLength;if(!(!(0,h.isFiniteNumber)(C)||C<0)){var b=w.currentTime,D=m.levelTargetDuration,O=Math.max(C,D),B=Math.floor(b/D)*D-O;M.forEach(function(P){var F=R[P];if(F){var I=_.BufferHelper.getBuffered(F);I.length>0&&B>I.start(0)&&(x.trigger(u.Events.BACK_BUFFER_REACHED,{bufferEnd:B}),m.live&&x.trigger(u.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:B}),x.trigger(u.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:B,type:P}))}})}}}},L.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var x=this.details,m=this.hls,w=this.media,R=this.mediaSource,M=x.fragments[0].start+x.totalduration,C=w.duration,b=(0,h.isFiniteNumber)(R.duration)?R.duration:0;x.live&&m.config.liveDurationInfinity?(f.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),R.duration=1/0,this.updateSeekableRange(x)):(M>b&&M>C||!(0,h.isFiniteNumber)(C))&&(f.logger.log("[buffer-controller]: Updating Media Source duration to "+M.toFixed(3)),R.duration=M)}},L.updateSeekableRange=function(x){var m=this.mediaSource,w=x.fragments,R=w.length;if(R&&x.live&&m!==null&&m!==void 0&&m.setLiveSeekableRange){var M=Math.max(0,w[0].start),C=Math.max(M,M+x.totalduration);m.setLiveSeekableRange(M,C)}},L.checkPendingTracks=function(){var x=this.bufferCodecEventsExpected,m=this.operationQueue,w=this.pendingTracks,R=Object.keys(w).length;if(R&&!x||R===2){this.createSourceBuffers(w),this.pendingTracks={};var M=this.getSourceBufferTypes();if(M.length===0){this.hls.trigger(u.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}M.forEach(function(C){m.executeNext(C)})}},L.createSourceBuffers=function(x){var m=this.sourceBuffer,w=this.mediaSource;if(!w)throw Error("createSourceBuffers called when mediaSource was null");var R=0;for(var M in x)if(!m[M]){var C=x[M];if(!C)throw Error("source buffer exists for track "+M+", however track does not");var b=C.levelCodec||C.codec,D=C.container+";codecs="+b;f.logger.log("[buffer-controller]: creating sourceBuffer("+D+")");try{var O=m[M]=w.addSourceBuffer(D),B=M;this.addBufferListener(B,"updatestart",this._onSBUpdateStart),this.addBufferListener(B,"updateend",this._onSBUpdateEnd),this.addBufferListener(B,"error",this._onSBUpdateError),this.tracks[M]={buffer:O,codec:b,container:C.container,levelCodec:C.levelCodec,metadata:C.metadata,id:C.id},R++}catch(P){f.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+P.message),this.hls.trigger(u.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:P,mimeType:D})}}R&&this.hls.trigger(u.Events.BUFFER_CREATED,{tracks:this.tracks})},L._onSBUpdateStart=function(x){var m=this.operationQueue,w=m.current(x);w.onStart()},L._onSBUpdateEnd=function(x){var m=this.operationQueue,w=m.current(x);w.onComplete(),m.shiftAndExecuteNext(x)},L._onSBUpdateError=function(x,m){f.logger.error("[buffer-controller]: "+x+" SourceBuffer error",m),this.hls.trigger(u.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var w=this.operationQueue.current(x);w&&w.onError(m)},L.removeExecutor=function(x,m,w){var R=this.media,M=this.mediaSource,C=this.operationQueue,b=this.sourceBuffer,D=b[x];if(!R||!M||!D){f.logger.warn("[buffer-controller]: Attempting to remove from the "+x+" SourceBuffer, but it does not exist"),C.shiftAndExecuteNext(x);return}var O=(0,h.isFiniteNumber)(R.duration)?R.duration:1/0,B=(0,h.isFiniteNumber)(M.duration)?M.duration:1/0,P=Math.max(0,m),F=Math.min(w,O,B);F>P?(f.logger.log("[buffer-controller]: Removing ["+P+","+F+"] from the "+x+" SourceBuffer"),console.assert(!D.updating,x+" sourceBuffer must not be updating"),D.remove(P,F)):C.shiftAndExecuteNext(x)},L.appendExecutor=function(x,m){var w=this.operationQueue,R=this.sourceBuffer,M=R[m];if(!M){f.logger.warn("[buffer-controller]: Attempting to append to the "+m+" SourceBuffer, but it does not exist"),w.shiftAndExecuteNext(m);return}M.ended=!1,console.assert(!M.updating,m+" sourceBuffer must not be updating"),M.appendBuffer(x)},L.blockBuffers=function(x,m){var w=this;if(m===void 0&&(m=this.getSourceBufferTypes()),!m.length){f.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(x);return}var R=this.operationQueue,M=m.map(function(C){return R.appendBlocker(C)});Promise.all(M).then(function(){x(),m.forEach(function(C){var b=w.sourceBuffer[C];(!b||!b.updating)&&R.shiftAndExecuteNext(C)})})},L.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},L.addBufferListener=function(x,m,w){var R=this.sourceBuffer[x];if(!!R){var M=w.bind(this,x);this.listeners[x].push({event:m,listener:M}),R.addEventListener(m,M)}},L.removeBufferListeners=function(x){var m=this.sourceBuffer[x];!m||this.listeners[x].forEach(function(w){m.removeEventListener(w.event,w.listener)})},S}()},"./src/controller/buffer-operation-queue.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>u});var h=l("./src/utils/logger.ts"),u=function(){function f(_){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=_}var c=f.prototype;return c.append=function(g,d){var p=this.queues[d];p.push(g),p.length===1&&this.buffers[d]&&this.executeNext(d)},c.insertAbort=function(g,d){var p=this.queues[d];p.unshift(g),this.executeNext(d)},c.appendBlocker=function(g){var d,p=new Promise(function(A){d=A}),v={execute:d,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(v,g),p},c.executeNext=function(g){var d=this.buffers,p=this.queues,v=d[g],A=p[g];if(A.length){var E=A[0];try{E.execute()}catch(S){h.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),E.onError(S),(!v||!v.updating)&&(A.shift(),this.executeNext(g))}}},c.shiftAndExecuteNext=function(g){this.queues[g].shift(),this.executeNext(g)},c.current=function(g){return this.queues[g][0]},f}()},"./src/controller/cap-level-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>_});var h=l("./src/events.ts");function u(g,d){for(var p=0;p<d.length;p++){var v=d[p];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(g,v.key,v)}}function f(g,d,p){return d&&u(g.prototype,d),p&&u(g,p),Object.defineProperty(g,"prototype",{writable:!1}),g}var c=function(){function g(p){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=p,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var d=g.prototype;return d.setStreamController=function(v){this.streamController=v},d.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},d.registerListeners=function(){var v=this.hls;v.on(h.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),v.on(h.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),v.on(h.Events.MANIFEST_PARSED,this.onManifestParsed,this),v.on(h.Events.BUFFER_CODECS,this.onBufferCodecs,this),v.on(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},d.unregisterListener=function(){var v=this.hls;v.off(h.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),v.off(h.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),v.off(h.Events.MANIFEST_PARSED,this.onManifestParsed,this),v.off(h.Events.BUFFER_CODECS,this.onBufferCodecs,this),v.off(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},d.onFpsDropLevelCapping=function(v,A){g.isLevelAllowed(A.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(A.droppedLevel)},d.onMediaAttaching=function(v,A){this.media=A.media instanceof HTMLVideoElement?A.media:null},d.onManifestParsed=function(v,A){var E=this.hls;this.restrictedLevels=[],this.firstLevel=A.firstLevel,E.config.capLevelToPlayerSize&&A.video&&this.startCapping()},d.onBufferCodecs=function(v,A){var E=this.hls;E.config.capLevelToPlayerSize&&A.video&&this.startCapping()},d.onMediaDetaching=function(){this.stopCapping()},d.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var v=this.hls.levels;if(v.length){var A=this.hls;A.autoLevelCapping=this.getMaxLevel(v.length-1),A.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=A.autoLevelCapping}}},d.getMaxLevel=function(v){var A=this,E=this.hls.levels;if(!E.length)return-1;var S=E.filter(function(L,T){return g.isLevelAllowed(T,A.restrictedLevels)&&T<=v});return this.clientRect=null,g.getMaxLevelByMediaSize(S,this.mediaWidth,this.mediaHeight)},d.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},d.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},d.getDimensions=function(){if(this.clientRect)return this.clientRect;var v=this.media,A={width:0,height:0};if(v){var E=v.getBoundingClientRect();A.width=E.width,A.height=E.height,!A.width&&!A.height&&(A.width=E.right-E.left||v.width||0,A.height=E.bottom-E.top||v.height||0)}return this.clientRect=A,A},g.isLevelAllowed=function(v,A){return A===void 0&&(A=[]),A.indexOf(v)===-1},g.getMaxLevelByMediaSize=function(v,A,E){if(!v||!v.length)return-1;for(var S=function(w,R){return R?w.width!==R.width||w.height!==R.height:!0},L=v.length-1,T=0;T<v.length;T+=1){var x=v[T];if((x.width>=A||x.height>=E)&&S(x,v[T+1])){L=T;break}}return L},f(g,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var v=1;if(!this.hls.config.ignoreDevicePixelRatio)try{v=self.devicePixelRatio}catch{}return v}}]),g}();const _=c},"./src/controller/cmcd-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>E});var h=l("./src/events.ts"),u=l("./src/types/cmcd.ts"),f=l("./src/utils/buffer-helper.ts"),c=l("./src/utils/logger.ts");function _(S,L){for(var T=0;T<L.length;T++){var x=L[T];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(S,x.key,x)}}function g(S,L,T){return L&&_(S.prototype,L),T&&_(S,T),Object.defineProperty(S,"prototype",{writable:!1}),S}function d(S,L){var T=typeof Symbol<"u"&&S[Symbol.iterator]||S["@@iterator"];if(T)return(T=T.call(S)).next.bind(T);if(Array.isArray(S)||(T=p(S))||L&&S&&typeof S.length=="number"){T&&(S=T);var x=0;return function(){return x>=S.length?{done:!0}:{done:!1,value:S[x++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function p(S,L){if(!!S){if(typeof S=="string")return v(S,L);var T=Object.prototype.toString.call(S).slice(8,-1);if(T==="Object"&&S.constructor&&(T=S.constructor.name),T==="Map"||T==="Set")return Array.from(S);if(T==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(T))return v(S,L)}}function v(S,L){(L==null||L>S.length)&&(L=S.length);for(var T=0,x=new Array(L);T<L;T++)x[T]=S[T];return x}function A(){return A=Object.assign?Object.assign.bind():function(S){for(var L=1;L<arguments.length;L++){var T=arguments[L];for(var x in T)Object.prototype.hasOwnProperty.call(T,x)&&(S[x]=T[x])}return S},A.apply(this,arguments)}var E=function(){function S(T){var x=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){x.initialized&&(x.starved=!0),x.buffering=!0},this.onPlaying=function(){x.initialized||(x.initialized=!0),x.buffering=!1},this.applyPlaylistData=function(R){try{x.apply(R,{ot:u.CMCDObjectType.MANIFEST,su:!x.initialized})}catch(M){c.logger.warn("Could not generate manifest CMCD data.",M)}},this.applyFragmentData=function(R){try{var M=R.frag,C=x.hls.levels[M.level],b=x.getObjectType(M),D={d:M.duration*1e3,ot:b};(b===u.CMCDObjectType.VIDEO||b===u.CMCDObjectType.AUDIO||b==u.CMCDObjectType.MUXED)&&(D.br=C.bitrate/1e3,D.tb=x.getTopBandwidth(b)/1e3,D.bl=x.getBufferLength(b)),x.apply(R,D)}catch(O){c.logger.warn("Could not generate segment CMCD data.",O)}},this.hls=T;var m=this.config=T.config,w=m.cmcd;w!=null&&(m.pLoader=this.createPlaylistLoader(),m.fLoader=this.createFragmentLoader(),this.sid=w.sessionId||S.uuid(),this.cid=w.contentId,this.useHeaders=w.useHeaders===!0,this.registerListeners())}var L=S.prototype;return L.registerListeners=function(){var x=this.hls;x.on(h.Events.MEDIA_ATTACHED,this.onMediaAttached,this),x.on(h.Events.MEDIA_DETACHED,this.onMediaDetached,this),x.on(h.Events.BUFFER_CREATED,this.onBufferCreated,this)},L.unregisterListeners=function(){var x=this.hls;x.off(h.Events.MEDIA_ATTACHED,this.onMediaAttached,this),x.off(h.Events.MEDIA_DETACHED,this.onMediaDetached,this),x.off(h.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},L.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},L.onMediaAttached=function(x,m){this.media=m.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},L.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},L.onBufferCreated=function(x,m){var w,R;this.audioBuffer=(w=m.tracks.audio)===null||w===void 0?void 0:w.buffer,this.videoBuffer=(R=m.tracks.video)===null||R===void 0?void 0:R.buffer},L.createData=function(){var x;return{v:u.CMCDVersion,sf:u.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(x=this.media)===null||x===void 0?void 0:x.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},L.apply=function(x,m){m===void 0&&(m={}),A(m,this.createData());var w=m.ot===u.CMCDObjectType.INIT||m.ot===u.CMCDObjectType.VIDEO||m.ot===u.CMCDObjectType.MUXED;if(this.starved&&w&&(m.bs=!0,m.su=!0,this.starved=!1),m.su==null&&(m.su=this.buffering),this.useHeaders){var R=S.toHeaders(m);if(!Object.keys(R).length)return;x.headers||(x.headers={}),A(x.headers,R)}else{var M=S.toQuery(m);if(!M)return;x.url=S.appendQueryToUri(x.url,M)}},L.getObjectType=function(x){var m=x.type;if(m==="subtitle")return u.CMCDObjectType.TIMED_TEXT;if(x.sn==="initSegment")return u.CMCDObjectType.INIT;if(m==="audio")return u.CMCDObjectType.AUDIO;if(m==="main")return this.hls.audioTracks.length?u.CMCDObjectType.VIDEO:u.CMCDObjectType.MUXED},L.getTopBandwidth=function(x){var m=0,w,R=this.hls;if(x===u.CMCDObjectType.AUDIO)w=R.audioTracks;else{var M=R.maxAutoLevel,C=M>-1?M+1:R.levels.length;w=R.levels.slice(0,C)}for(var b=d(w),D;!(D=b()).done;){var O=D.value;O.bitrate>m&&(m=O.bitrate)}return m>0?m:NaN},L.getBufferLength=function(x){var m=this.hls.media,w=x===u.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!w||!m)return NaN;var R=f.BufferHelper.bufferInfo(w,m.currentTime,this.config.maxBufferHole);return R.len*1e3},L.createPlaylistLoader=function(){var x=this.config.pLoader,m=this.applyPlaylistData,w=x||this.config.loader;return function(){function R(C){this.loader=void 0,this.loader=new w(C)}var M=R.prototype;return M.destroy=function(){this.loader.destroy()},M.abort=function(){this.loader.abort()},M.load=function(b,D,O){m(b),this.loader.load(b,D,O)},g(R,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),R}()},L.createFragmentLoader=function(){var x=this.config.fLoader,m=this.applyFragmentData,w=x||this.config.loader;return function(){function R(C){this.loader=void 0,this.loader=new w(C)}var M=R.prototype;return M.destroy=function(){this.loader.destroy()},M.abort=function(){this.loader.abort()},M.load=function(b,D,O){m(b),this.loader.load(b,D,O)},g(R,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),R}()},S.uuid=function(){var x=URL.createObjectURL(new Blob),m=x.toString();return URL.revokeObjectURL(x),m.slice(m.lastIndexOf("/")+1)},S.serialize=function(x){for(var m=[],w=function(N){return!Number.isNaN(N)&&N!=null&&N!==""&&N!==!1},R=function(N){return Math.round(N)},M=function(N){return R(N/100)*100},C=function(N){return encodeURIComponent(N)},b={br:R,d:R,bl:M,dl:M,mtp:M,nor:C,rtp:M,tb:R},D=Object.keys(x||{}).sort(),O=d(D),B;!(B=O()).done;){var P=B.value,F=x[P];if(!!w(F)&&!(P==="v"&&F===1)&&!(P=="pr"&&F===1)){var I=b[P];I&&(F=I(F));var y=typeof F,k=void 0;P==="ot"||P==="sf"||P==="st"?k=P+"="+F:y==="boolean"?k=P:y==="number"?k=P+"="+F:k=P+"="+JSON.stringify(F),m.push(k)}}return m.join(",")},S.toHeaders=function(x){for(var m=Object.keys(x),w={},R=["Object","Request","Session","Status"],M=[{},{},{},{}],C={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},b=0,D=m;b<D.length;b++){var O=D[b],B=C[O]!=null?C[O]:1;M[B][O]=x[O]}for(var P=0;P<M.length;P++){var F=S.serialize(M[P]);F&&(w["CMCD-"+R[P]]=F)}return w},S.toQuery=function(x){return"CMCD="+encodeURIComponent(S.serialize(x))},S.appendQueryToUri=function(x,m){if(!m)return x;var w=x.includes("?")?"&":"?";return""+x+w+m},S}()},"./src/controller/eme-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>E});var h=l("./src/events.ts"),u=l("./src/errors.ts"),f=l("./src/utils/logger.ts"),c=l("./src/utils/mediakeys-helper.ts");function _(S,L){for(var T=0;T<L.length;T++){var x=L[T];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(S,x.key,x)}}function g(S,L,T){return L&&_(S.prototype,L),T&&_(S,T),Object.defineProperty(S,"prototype",{writable:!1}),S}var d=3,p=function(L,T,x){var m={audioCapabilities:[],videoCapabilities:[]};return L.forEach(function(w){m.audioCapabilities.push({contentType:'audio/mp4; codecs="'+w+'"',robustness:x.audioRobustness||""})}),T.forEach(function(w){m.videoCapabilities.push({contentType:'video/mp4; codecs="'+w+'"',robustness:x.videoRobustness||""})}),[m]},v=function(L,T,x,m){switch(L){case c.KeySystems.WIDEVINE:return p(T,x,m);default:throw new Error("Unknown key-system: "+L)}},A=function(){function S(T){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=T,this._config=T.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var L=S.prototype;return L.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},L._registerListeners=function(){this.hls.on(h.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(h.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(h.Events.MANIFEST_PARSED,this.onManifestParsed,this)},L._unregisterListeners=function(){this.hls.off(h.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(h.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(h.Events.MANIFEST_PARSED,this.onManifestParsed,this)},L.getLicenseServerUrl=function(x){switch(x){case c.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+x+'"')},L._attemptKeySystemAccess=function(x,m,w){var R=this,M=v(x,m,w,this._drmSystemOptions);f.logger.log("Requesting encrypted media key-system access");var C=this.requestMediaKeySystemAccess(x,M);this.mediaKeysPromise=C.then(function(b){return R._onMediaKeySystemAccessObtained(x,b)}),C.catch(function(b){f.logger.error('Failed to obtain key-system "'+x+'" access:',b)})},L._onMediaKeySystemAccessObtained=function(x,m){var w=this;f.logger.log('Access for key-system "'+x+'" obtained');var R={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:m,mediaKeySystemDomain:x};this._mediaKeysList.push(R);var M=Promise.resolve().then(function(){return m.createMediaKeys()}).then(function(C){return R.mediaKeys=C,f.logger.log('Media-keys created for key-system "'+x+'"'),w._onMediaKeysCreated(),C});return M.catch(function(C){f.logger.error("Failed to create media-keys:",C)}),M},L._onMediaKeysCreated=function(){var x=this;this._mediaKeysList.forEach(function(m){m.mediaKeysSession||(m.mediaKeysSession=m.mediaKeys.createSession(),x._onNewMediaKeySession(m.mediaKeysSession))})},L._onNewMediaKeySession=function(x){var m=this;f.logger.log("New key-system session "+x.sessionId),x.addEventListener("message",function(w){m._onKeySessionMessage(x,w.message)},!1)},L._onKeySessionMessage=function(x,m){f.logger.log("Got EME message event, creating license request"),this._requestLicense(m,function(w){f.logger.log("Received license data (length: "+(w&&w.byteLength)+"), updating key-session"),x.update(w).catch(function(R){f.logger.warn("Updating key-session failed: "+R)})})},L.onMediaEncrypted=function(x){var m=this;if(f.logger.log('Media is encrypted using "'+x.initDataType+'" init data type'),!this.mediaKeysPromise){f.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(h.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var w=function(M){!m._media||(m._attemptSetMediaKeys(M),m._generateRequestWithPreferredKeySession(x.initDataType,x.initData))};this.mediaKeysPromise.then(w).catch(w)},L._attemptSetMediaKeys=function(x){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var m=this._mediaKeysList[0];if(!m||!m.mediaKeys){f.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(h.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}f.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(m.mediaKeys),this._hasSetMediaKeys=!0}},L._generateRequestWithPreferredKeySession=function(x,m){var w=this,R=this._mediaKeysList[0];if(!R){f.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(h.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(R.mediaKeysSessionInitialized){f.logger.warn("Key-Session already initialized but requested again");return}var M=R.mediaKeysSession;if(!M){f.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(h.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!m){f.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(h.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}f.logger.log('Generating key-session request for "'+x+'" init data type'),R.mediaKeysSessionInitialized=!0,M.generateRequest(x,m).then(function(){f.logger.debug("Key-session generation succeeded")}).catch(function(C){f.logger.error("Error generating key-session request:",C),w.hls.trigger(h.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},L._createLicenseXhr=function(x,m,w){var R=new XMLHttpRequest;R.responseType="arraybuffer",R.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,R,x,m,w);var M=this._licenseXhrSetup;if(M)try{M.call(this.hls,R,x),M=void 0}catch(C){f.logger.error(C)}try{R.readyState||R.open("POST",x,!0),M&&M.call(this.hls,R,x)}catch(C){throw new Error("issue setting up KeySystem license XHR "+C)}return R},L._onLicenseRequestReadyStageChange=function(x,m,w,R){switch(x.readyState){case 4:if(x.status===200){this._requestLicenseFailureCount=0,f.logger.log("License request succeeded");var M=x.response,C=this._licenseResponseCallback;if(C)try{M=C.call(this.hls,x,m)}catch(D){f.logger.error(D)}R(M)}else{if(f.logger.error("License Request XHR failed ("+m+"). Status: "+x.status+" ("+x.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d){this.hls.trigger(h.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var b=d-this._requestLicenseFailureCount+1;f.logger.warn("Retrying license request, "+b+" attempts left"),this._requestLicense(w,R)}break}},L._generateLicenseRequestChallenge=function(x,m){switch(x.mediaKeySystemDomain){case c.KeySystems.WIDEVINE:return m}throw new Error("unsupported key-system: "+x.mediaKeySystemDomain)},L._requestLicense=function(x,m){f.logger.log("Requesting content license for key-system");var w=this._mediaKeysList[0];if(!w){f.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(h.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var R=this.getLicenseServerUrl(w.mediaKeySystemDomain),M=this._createLicenseXhr(R,x,m);f.logger.log("Sending license request to URL: "+R);var C=this._generateLicenseRequestChallenge(w,x);M.send(C)}catch(b){f.logger.error("Failure requesting DRM license: "+b),this.hls.trigger(h.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},L.onMediaAttached=function(x,m){if(!!this._emeEnabled){var w=m.media;this._media=w,w.addEventListener("encrypted",this._onMediaEncrypted)}},L.onMediaDetached=function(){var x=this._media,m=this._mediaKeysList;!x||(x.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(m.map(function(w){if(w.mediaKeysSession)return w.mediaKeysSession.close().catch(function(){})})).then(function(){return x.setMediaKeys(null)}).catch(function(){}))},L.onManifestParsed=function(x,m){if(!!this._emeEnabled){var w=m.levels.map(function(M){return M.audioCodec}).filter(function(M){return!!M}),R=m.levels.map(function(M){return M.videoCodec}).filter(function(M){return!!M});this._attemptKeySystemAccess(c.KeySystems.WIDEVINE,w,R)}},g(S,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),S}();const E=A},"./src/controller/fps-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>c});var h=l("./src/events.ts"),u=l("./src/utils/logger.ts"),f=function(){function _(d){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=d,this.registerListeners()}var g=_.prototype;return g.setStreamController=function(p){this.streamController=p},g.registerListeners=function(){this.hls.on(h.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},g.unregisterListeners=function(){this.hls.off(h.Events.MEDIA_ATTACHING,this.onMediaAttaching)},g.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},g.onMediaAttaching=function(p,v){var A=this.hls.config;if(A.capLevelOnFPSDrop){var E=v.media instanceof self.HTMLVideoElement?v.media:null;this.media=E,E&&typeof E.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),A.fpsDroppedMonitoringPeriod)}},g.checkFPS=function(p,v,A){var E=performance.now();if(v){if(this.lastTime){var S=E-this.lastTime,L=A-this.lastDroppedFrames,T=v-this.lastDecodedFrames,x=1e3*L/S,m=this.hls;if(m.trigger(h.Events.FPS_DROP,{currentDropped:L,currentDecoded:T,totalDroppedFrames:A}),x>0&&L>m.config.fpsDroppedMonitoringThreshold*T){var w=m.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+w),w>0&&(m.autoLevelCapping===-1||m.autoLevelCapping>=w)&&(w=w-1,m.trigger(h.Events.FPS_DROP_LEVEL_CAPPING,{level:w,droppedLevel:m.currentLevel}),m.autoLevelCapping=w,this.streamController.nextLevelSwitch())}}this.lastTime=E,this.lastDroppedFrames=A,this.lastDecodedFrames=v}},g.checkFPSInterval=function(){var p=this.media;if(p)if(this.isVideoPlaybackQualityAvailable){var v=p.getVideoPlaybackQuality();this.checkFPS(p,v.totalVideoFrames,v.droppedVideoFrames)}else this.checkFPS(p,p.webkitDecodedFrameCount,p.webkitDroppedFrameCount)},_}();const c=f},"./src/controller/fragment-finders.ts":(a,o,l)=>{l.r(o),l.d(o,{findFragWithCC:()=>d,findFragmentByPDT:()=>f,findFragmentByPTS:()=>c,fragmentWithinToleranceTest:()=>_,pdtWithinToleranceTest:()=>g});var h=l("./src/polyfills/number.ts"),u=l("./src/utils/binary-search.ts");function f(p,v,A){if(v===null||!Array.isArray(p)||!p.length||!(0,h.isFiniteNumber)(v))return null;var E=p[0].programDateTime;if(v<(E||0))return null;var S=p[p.length-1].endProgramDateTime;if(v>=(S||0))return null;A=A||0;for(var L=0;L<p.length;++L){var T=p[L];if(g(v,A,T))return T}return null}function c(p,v,A,E){A===void 0&&(A=0),E===void 0&&(E=0);var S=null;if(p?S=v[p.sn-v[0].sn+1]||null:A===0&&v[0].start===0&&(S=v[0]),S&&_(A,E,S)===0)return S;var L=u.default.search(v,_.bind(null,A,E));return L||S}function _(p,v,A){p===void 0&&(p=0),v===void 0&&(v=0);var E=Math.min(v,A.duration+(A.deltaPTS?A.deltaPTS:0));return A.start+A.duration-E<=p?1:A.start-E>p&&A.start?-1:0}function g(p,v,A){var E=Math.min(v,A.duration+(A.deltaPTS?A.deltaPTS:0))*1e3,S=A.endProgramDateTime||0;return S-E>p}function d(p,v){return u.default.search(p,function(A){return A.cc<v?1:A.cc>v?-1:0})}},"./src/controller/fragment-tracker.ts":(a,o,l)=>{l.r(o),l.d(o,{FragmentState:()=>f,FragmentTracker:()=>c});var h=l("./src/events.ts"),u=l("./src/types/loader.ts"),f;(function(d){d.NOT_LOADED="NOT_LOADED",d.APPENDING="APPENDING",d.PARTIAL="PARTIAL",d.OK="OK"})(f||(f={}));var c=function(){function d(v){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=v,this._registerListeners()}var p=d.prototype;return p._registerListeners=function(){var A=this.hls;A.on(h.Events.BUFFER_APPENDED,this.onBufferAppended,this),A.on(h.Events.FRAG_BUFFERED,this.onFragBuffered,this),A.on(h.Events.FRAG_LOADED,this.onFragLoaded,this)},p._unregisterListeners=function(){var A=this.hls;A.off(h.Events.BUFFER_APPENDED,this.onBufferAppended,this),A.off(h.Events.FRAG_BUFFERED,this.onFragBuffered,this),A.off(h.Events.FRAG_LOADED,this.onFragLoaded,this)},p.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},p.getAppendedFrag=function(A,E){if(E===u.PlaylistLevelType.MAIN){var S=this.activeFragment,L=this.activeParts;if(!S)return null;if(L)for(var T=L.length;T--;){var x=L[T],m=x?x.end:S.appendedPTS;if(x.start<=A&&m!==void 0&&A<=m)return T>9&&(this.activeParts=L.slice(T-9)),x}else if(S.start<=A&&S.appendedPTS!==void 0&&A<=S.appendedPTS)return S}return this.getBufferedFrag(A,E)},p.getBufferedFrag=function(A,E){for(var S=this.fragments,L=Object.keys(S),T=L.length;T--;){var x=S[L[T]];if((x==null?void 0:x.body.type)===E&&x.buffered){var m=x.body;if(m.start<=A&&A<=m.end)return m}}return null},p.detectEvictedFragments=function(A,E,S){var L=this;Object.keys(this.fragments).forEach(function(T){var x=L.fragments[T];if(!!x){if(!x.buffered){x.body.type===S&&L.removeFragment(x.body);return}var m=x.range[A];!m||m.time.some(function(w){var R=!L.isTimeBuffered(w.startPTS,w.endPTS,E);return R&&L.removeFragment(x.body),R})}})},p.detectPartialFragments=function(A){var E=this,S=this.timeRanges,L=A.frag,T=A.part;if(!(!S||L.sn==="initSegment")){var x=g(L),m=this.fragments[x];!m||(Object.keys(S).forEach(function(w){var R=L.elementaryStreams[w];if(!!R){var M=S[w],C=T!==null||R.partial===!0;m.range[w]=E.getBufferedTimes(L,T,C,M)}}),m.loaded=null,Object.keys(m.range).length?m.buffered=!0:this.removeFragment(m.body))}},p.fragBuffered=function(A){var E=g(A),S=this.fragments[E];S&&(S.loaded=null,S.buffered=!0)},p.getBufferedTimes=function(A,E,S,L){for(var T={time:[],partial:S},x=E?E.start:A.start,m=E?E.end:A.end,w=A.minEndPTS||m,R=A.maxStartPTS||x,M=0;M<L.length;M++){var C=L.start(M)-this.bufferPadding,b=L.end(M)+this.bufferPadding;if(R>=C&&w<=b){T.time.push({startPTS:Math.max(x,L.start(M)),endPTS:Math.min(m,L.end(M))});break}else if(x<b&&m>C)T.partial=!0,T.time.push({startPTS:Math.max(x,L.start(M)),endPTS:Math.min(m,L.end(M))});else if(m<=C)break}return T},p.getPartialFragment=function(A){var E=null,S,L,T,x=0,m=this.bufferPadding,w=this.fragments;return Object.keys(w).forEach(function(R){var M=w[R];!M||_(M)&&(L=M.body.start-m,T=M.body.end+m,A>=L&&A<=T&&(S=Math.min(A-L,T-A),x<=S&&(E=M.body,x=S)))}),E},p.getState=function(A){var E=g(A),S=this.fragments[E];return S?S.buffered?_(S)?f.PARTIAL:f.OK:f.APPENDING:f.NOT_LOADED},p.isTimeBuffered=function(A,E,S){for(var L,T,x=0;x<S.length;x++){if(L=S.start(x)-this.bufferPadding,T=S.end(x)+this.bufferPadding,A>=L&&E<=T)return!0;if(E<=L)return!1}return!1},p.onFragLoaded=function(A,E){var S=E.frag,L=E.part;if(!(S.sn==="initSegment"||S.bitrateTest||L)){var T=g(S);this.fragments[T]={body:S,loaded:E,buffered:!1,range:Object.create(null)}}},p.onBufferAppended=function(A,E){var S=this,L=E.frag,T=E.part,x=E.timeRanges;if(L.type===u.PlaylistLevelType.MAIN)if(this.activeFragment=L,T){var m=this.activeParts;m||(this.activeParts=m=[]),m.push(T)}else this.activeParts=null;this.timeRanges=x,Object.keys(x).forEach(function(w){var R=x[w];if(S.detectEvictedFragments(w,R),!T)for(var M=0;M<R.length;M++)L.appendedPTS=Math.max(R.end(M),L.appendedPTS||0)})},p.onFragBuffered=function(A,E){this.detectPartialFragments(E)},p.hasFragment=function(A){var E=g(A);return!!this.fragments[E]},p.removeFragmentsInRange=function(A,E,S){var L=this;Object.keys(this.fragments).forEach(function(T){var x=L.fragments[T];if(!!x&&x.buffered){var m=x.body;m.type===S&&m.start<E&&m.end>A&&L.removeFragment(m)}})},p.removeFragment=function(A){var E=g(A);A.stats.loaded=0,A.clearElementaryStreamInfo(),delete this.fragments[E]},p.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},d}();function _(d){var p,v;return d.buffered&&(((p=d.range.video)===null||p===void 0?void 0:p.partial)||((v=d.range.audio)===null||v===void 0?void 0:v.partial))}function g(d){return d.type+"_"+d.level+"_"+d.urlId+"_"+d.sn}},"./src/controller/gap-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{MAX_START_GAP_JUMP:()=>g,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>d,SKIP_BUFFER_RANGE_START:()=>p,STALL_MINIMUM_DURATION_MS:()=>_,default:()=>v});var h=l("./src/utils/buffer-helper.ts"),u=l("./src/errors.ts"),f=l("./src/events.ts"),c=l("./src/utils/logger.ts"),_=250,g=2,d=.1,p=.05,v=function(){function A(S,L,T,x){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=S,this.media=L,this.fragmentTracker=T,this.hls=x}var E=A.prototype;return E.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},E.poll=function(L,T){var x=this.config,m=this.media,w=this.stalled;if(m!==null){var R=m.currentTime,M=m.seeking,C=this.seeking&&!M,b=!this.seeking&&M;if(this.seeking=M,R!==L){if(this.moved=!0,w!==null){if(this.stallReported){var D=self.performance.now()-w;c.logger.warn("playback not stuck anymore @"+R+", after "+Math.round(D)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((b||C)&&(this.stalled=null),!(m.paused&&!M||m.ended||m.playbackRate===0||!h.BufferHelper.getBuffered(m).length)){var O=h.BufferHelper.bufferInfo(m,R,0),B=O.len>0,P=O.nextStart||0;if(!(!B&&!P)){if(M){var F=O.len>g,I=!P||T&&T.start<=R||P-R>g&&!this.fragmentTracker.getPartialFragment(R);if(F||I)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var y,k=Math.max(P,O.start||0)-R,U=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,N=U==null||(y=U.details)===null||y===void 0?void 0:y.live,W=N?U.details.targetduration*2:g;if(k>0&&k<=W){this._trySkipBufferHole(null);return}}var G=self.performance.now();if(w===null){this.stalled=G;return}var z=G-w;if(!(!M&&z>=_&&(this._reportStall(O),!this.media))){var X=h.BufferHelper.bufferInfo(m,R,x.maxBufferHole);this._tryFixBufferStall(X,z)}}}}},E._tryFixBufferStall=function(L,T){var x=this.config,m=this.fragmentTracker,w=this.media;if(w!==null){var R=w.currentTime,M=m.getPartialFragment(R);if(M){var C=this._trySkipBufferHole(M);if(C||!this.media)return}L.len>x.maxBufferHole&&T>x.highBufferWatchdogPeriod*1e3&&(c.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},E._reportStall=function(L){var T=this.hls,x=this.media,m=this.stallReported;!m&&x&&(this.stallReported=!0,c.logger.warn("Playback stalling at @"+x.currentTime+" due to low buffer ("+JSON.stringify(L)+")"),T.trigger(f.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:L.len}))},E._trySkipBufferHole=function(L){var T=this.config,x=this.hls,m=this.media;if(m===null)return 0;for(var w=m.currentTime,R=0,M=h.BufferHelper.getBuffered(m),C=0;C<M.length;C++){var b=M.start(C);if(w+T.maxBufferHole>=R&&w<b){var D=Math.max(b+p,m.currentTime+d);return c.logger.warn("skipping hole, adjusting currentTime from "+w+" to "+D),this.moved=!0,this.stalled=null,m.currentTime=D,L&&x.trigger(f.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+w+" to "+D,frag:L}),D}R=M.end(C)}return 0},E._tryNudgeBuffer=function(){var L=this.config,T=this.hls,x=this.media,m=this.nudgeRetry;if(x!==null){var w=x.currentTime;if(this.nudgeRetry++,m<L.nudgeMaxRetry){var R=w+(m+1)*L.nudgeOffset;c.logger.warn("Nudging 'currentTime' from "+w+" to "+R),x.currentTime=R,T.trigger(f.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else c.logger.error("Playhead still not moving while enough data buffered @"+w+" after "+L.nudgeMaxRetry+" nudges"),T.trigger(f.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},A}()},"./src/controller/id3-track-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>L});var h=l("./src/polyfills/number.ts"),u=l("./src/events.ts"),f=l("./src/utils/texttrack-utils.ts"),c=l("./src/demux/id3.ts"),_=l("./src/loader/date-range.ts"),g=l("./src/types/demuxer.ts"),d=.25;function p(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var v=function(){var T=p();try{new T(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function A(T,x){return T.getTime()/1e3-x}function E(T){return Uint8Array.from(T.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var S=function(){function T(m){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=m,this._registerListeners()}var x=T.prototype;return x.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},x._registerListeners=function(){var w=this.hls;w.on(u.Events.MEDIA_ATTACHED,this.onMediaAttached,this),w.on(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),w.on(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),w.on(u.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),w.on(u.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),w.on(u.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},x._unregisterListeners=function(){var w=this.hls;w.off(u.Events.MEDIA_ATTACHED,this.onMediaAttached,this),w.off(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),w.off(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),w.off(u.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),w.off(u.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),w.off(u.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},x.onMediaAttached=function(w,R){this.media=R.media},x.onMediaDetaching=function(){!this.id3Track||((0,f.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},x.onManifestLoading=function(){this.dateRangeCuesAppended={}},x.createTrack=function(w){var R=this.getID3Track(w.textTracks);return R.mode="hidden",R},x.getID3Track=function(w){if(!!this.media){for(var R=0;R<w.length;R++){var M=w[R];if(M.kind==="metadata"&&M.label==="id3")return(0,f.sendAddTrackEvent)(M,this.media),M}return this.media.addTextTrack("metadata","id3")}},x.onFragParsingMetadata=function(w,R){if(!!this.media){var M=this.hls.config,C=M.enableEmsgMetadataCues,b=M.enableID3MetadataCues;if(!(!C&&!b)){R.frag;var D=R.samples;R.details,this.id3Track||(this.id3Track=this.createTrack(this.media));for(var O=p(),B=0;B<D.length;B++){var P=D[B].type;if(!(P===g.MetadataSchema.emsg&&!C||!b)){var F=c.getID3Frames(D[B].data);if(F){var I=D[B].pts,y=I+D[B].duration;y>v&&(y=v);var k=y-I;k<=0&&(y=I+d);for(var U=0;U<F.length;U++){var N=F[U];if(!c.isTimeStampFrame(N)){this.updateId3CueEnds(I);var W=new O(I,y,"");W.value=N,P&&(W.type=P),this.id3Track.addCue(W)}}}}}}}},x.updateId3CueEnds=function(w){var R,M=(R=this.id3Track)===null||R===void 0?void 0:R.cues;if(M)for(var C=M.length;C--;){var b=M[C];b.startTime<w&&b.endTime===v&&(b.endTime=w)}},x.onBufferFlushing=function(w,R){var M=R.startOffset,C=R.endOffset,b=R.type,D=this.id3Track,O=this.hls;if(!!O){var B=O.config,P=B.enableEmsgMetadataCues,F=B.enableID3MetadataCues;if(D&&(P||F)){var I;b==="audio"?I=function(k){return k.type===g.MetadataSchema.audioId3&&F}:b==="video"?I=function(k){return k.type===g.MetadataSchema.emsg&&P}:I=function(k){return k.type===g.MetadataSchema.audioId3&&F||k.type===g.MetadataSchema.emsg&&P},(0,f.removeCuesInRange)(D,M,C,I)}}},x.onLevelUpdated=function(w,R){var M=this,C=R.details;if(!(!this.media||!C.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var b=this.dateRangeCuesAppended,D=this.id3Track,O=C.dateRanges,B=Object.keys(O);if(D)for(var P=Object.keys(b).filter(function(G){return!B.includes(G)}),F=function(z){var X=P[z];Object.keys(b[X].cues).forEach(function(K){D.removeCue(b[X].cues[K])}),delete b[X]},I=P.length;I--;)F(I);var y=C.fragments[C.fragments.length-1];if(!(B.length===0||!(0,h.isFiniteNumber)(y==null?void 0:y.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var k=y.programDateTime/1e3-y.start,U=p(),N=function(z){var X=B[z],K=O[X],$=b[X],q=($==null?void 0:$.cues)||{},J=($==null?void 0:$.durationKnown)||!1,Q=A(K.startDate,k),rt=v,mt=K.endDate;if(mt)rt=A(mt,k),J=!0;else if(K.endOnNext&&!J){var vt=B.reduce(function(Ht,Y){var V=O[Y];return V.class===K.class&&V.id!==Y&&V.startDate>K.startDate&&Ht.push(V),Ht},[]).sort(function(Ht,Y){return Ht.startDate.getTime()-Y.startDate.getTime()})[0];vt&&(rt=A(vt.startDate,k),J=!0)}for(var _t=Object.keys(K.attr),tt=0;tt<_t.length;tt++){var Lt=_t[tt];if(!(Lt===_.DateRangeAttribute.ID||Lt===_.DateRangeAttribute.CLASS||Lt===_.DateRangeAttribute.START_DATE||Lt===_.DateRangeAttribute.DURATION||Lt===_.DateRangeAttribute.END_DATE||Lt===_.DateRangeAttribute.END_ON_NEXT)){var dt=q[Lt];if(dt)J&&!$.durationKnown&&(dt.endTime=rt);else{var Tt=K.attr[Lt];dt=new U(Q,rt,""),(Lt===_.DateRangeAttribute.SCTE35_OUT||Lt===_.DateRangeAttribute.SCTE35_IN)&&(Tt=E(Tt)),dt.value={key:Lt,data:Tt},dt.type=g.MetadataSchema.dateRange,M.id3Track.addCue(dt),q[Lt]=dt}}}b[X]={cues:q,dateRange:K,durationKnown:J}},W=0;W<B.length;W++)N(W)}}},T}();const L=S},"./src/controller/latency-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>g});var h=l("./src/errors.ts"),u=l("./src/events.ts"),f=l("./src/utils/logger.ts");function c(d,p){for(var v=0;v<p.length;v++){var A=p[v];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(d,A.key,A)}}function _(d,p,v){return p&&c(d.prototype,p),v&&c(d,v),Object.defineProperty(d,"prototype",{writable:!1}),d}var g=function(){function d(v){var A=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return A.timeupdate()},this.hls=v,this.config=v.config,this.registerListeners()}var p=d.prototype;return p.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},p.registerListeners=function(){this.hls.on(u.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(u.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(u.Events.ERROR,this.onError,this)},p.unregisterListeners=function(){this.hls.off(u.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(u.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(u.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(u.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(u.Events.ERROR,this.onError)},p.onMediaAttached=function(A,E){this.media=E.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},p.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},p.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},p.onLevelUpdated=function(A,E){var S=E.details;this.levelDetails=S,S.advanced&&this.timeupdate(),!S.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},p.onError=function(A,E){E.details===h.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,f.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},p.timeupdate=function(){var A=this.media,E=this.levelDetails;if(!(!A||!E)){this.currentTime=A.currentTime;var S=this.computeLatency();if(S!==null){this._latency=S;var L=this.config,T=L.lowLatencyMode,x=L.maxLiveSyncPlaybackRate;if(!(!T||x===1)){var m=this.targetLatency;if(m!==null){var w=S-m,R=Math.min(this.maxLatency,m+E.targetduration),M=w<R;if(E.live&&M&&w>.05&&this.forwardBufferLength>1){var C=Math.min(2,Math.max(1,x)),b=Math.round(2/(1+Math.exp(-.75*w-this.edgeStalled))*20)/20;A.playbackRate=Math.min(C,Math.max(1,b))}else A.playbackRate!==1&&A.playbackRate!==0&&(A.playbackRate=1)}}}}},p.estimateLiveEdge=function(){var A=this.levelDetails;return A===null?null:A.edge+A.age},p.computeLatency=function(){var A=this.estimateLiveEdge();return A===null?null:A-this.currentTime},_(d,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var A=this.config,E=this.levelDetails;return A.liveMaxLatencyDuration!==void 0?A.liveMaxLatencyDuration:E?A.liveMaxLatencyDurationCount*E.targetduration:0}},{key:"targetLatency",get:function(){var A=this.levelDetails;if(A===null)return null;var E=A.holdBack,S=A.partHoldBack,L=A.targetduration,T=this.config,x=T.liveSyncDuration,m=T.liveSyncDurationCount,w=T.lowLatencyMode,R=this.hls.userConfig,M=w&&S||E;(R.liveSyncDuration||R.liveSyncDurationCount||M===0)&&(M=x!==void 0?x:m*L);var C=L,b=1;return M+Math.min(this.stallCount*b,C)}},{key:"liveSyncPosition",get:function(){var A=this.estimateLiveEdge(),E=this.targetLatency,S=this.levelDetails;if(A===null||E===null||S===null)return null;var L=S.edge,T=A-E-this.edgeStalled,x=L-S.totalduration,m=L-(this.config.lowLatencyMode&&S.partTarget||S.targetduration);return Math.min(Math.max(x,T),m)}},{key:"drift",get:function(){var A=this.levelDetails;return A===null?1:A.drift}},{key:"edgeStalled",get:function(){var A=this.levelDetails;if(A===null)return 0;var E=(this.config.lowLatencyMode&&A.partTarget||A.targetduration)*3;return Math.max(A.age-E,0)}},{key:"forwardBufferLength",get:function(){var A=this.media,E=this.levelDetails;if(!A||!E)return 0;var S=A.buffered.length;return(S?A.buffered.end(S-1):E.edge)-this.currentTime}}]),d}()},"./src/controller/level-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>T});var h=l("./src/types/level.ts"),u=l("./src/events.ts"),f=l("./src/errors.ts"),c=l("./src/utils/codecs.ts"),_=l("./src/controller/level-helper.ts"),g=l("./src/controller/base-playlist-controller.ts"),d=l("./src/types/loader.ts");function p(){return p=Object.assign?Object.assign.bind():function(x){for(var m=1;m<arguments.length;m++){var w=arguments[m];for(var R in w)Object.prototype.hasOwnProperty.call(w,R)&&(x[R]=w[R])}return x},p.apply(this,arguments)}function v(x,m){for(var w=0;w<m.length;w++){var R=m[w];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(x,R.key,R)}}function A(x,m,w){return m&&v(x.prototype,m),w&&v(x,w),Object.defineProperty(x,"prototype",{writable:!1}),x}function E(x,m){x.prototype=Object.create(m.prototype),x.prototype.constructor=x,S(x,m)}function S(x,m){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(R,M){return R.__proto__=M,R},S(x,m)}var L=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),T=function(x){E(m,x);function m(R){var M;return M=x.call(this,R,"[level-controller]")||this,M._levels=[],M._firstLevel=-1,M._startLevel=void 0,M.currentLevelIndex=-1,M.manualLevelIndex=-1,M.onParsedComplete=void 0,M._registerListeners(),M}var w=m.prototype;return w._registerListeners=function(){var M=this.hls;M.on(u.Events.MANIFEST_LOADED,this.onManifestLoaded,this),M.on(u.Events.LEVEL_LOADED,this.onLevelLoaded,this),M.on(u.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),M.on(u.Events.FRAG_LOADED,this.onFragLoaded,this),M.on(u.Events.ERROR,this.onError,this)},w._unregisterListeners=function(){var M=this.hls;M.off(u.Events.MANIFEST_LOADED,this.onManifestLoaded,this),M.off(u.Events.LEVEL_LOADED,this.onLevelLoaded,this),M.off(u.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),M.off(u.Events.FRAG_LOADED,this.onFragLoaded,this),M.off(u.Events.ERROR,this.onError,this)},w.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,x.prototype.destroy.call(this)},w.startLoad=function(){var M=this._levels;M.forEach(function(C){C.loadError=0}),x.prototype.startLoad.call(this)},w.onManifestLoaded=function(M,C){var b=[],D=[],O=[],B,P={},F,I=!1,y=!1,k=!1;if(C.levels.forEach(function(G){var z=G.attrs;I=I||!!(G.width&&G.height),y=y||!!G.videoCodec,k=k||!!G.audioCodec,L&&G.audioCodec&&G.audioCodec.indexOf("mp4a.40.34")!==-1&&(G.audioCodec=void 0);var X=G.bitrate+"-"+G.attrs.RESOLUTION+"-"+G.attrs.CODECS;F=P[X],F?F.url.push(G.url):(F=new h.Level(G),P[X]=F,b.push(F)),z&&(z.AUDIO&&(0,_.addGroupId)(F,"audio",z.AUDIO),z.SUBTITLES&&(0,_.addGroupId)(F,"text",z.SUBTITLES))}),(I||y)&&k&&(b=b.filter(function(G){var z=G.videoCodec,X=G.width,K=G.height;return!!z||!!(X&&K)})),b=b.filter(function(G){var z=G.audioCodec,X=G.videoCodec;return(!z||(0,c.isCodecSupportedInMp4)(z,"audio"))&&(!X||(0,c.isCodecSupportedInMp4)(X,"video"))}),C.audioTracks&&(D=C.audioTracks.filter(function(G){return!G.audioCodec||(0,c.isCodecSupportedInMp4)(G.audioCodec,"audio")}),(0,_.assignTrackIdsByGroup)(D)),C.subtitles&&(O=C.subtitles,(0,_.assignTrackIdsByGroup)(O)),b.length>0){B=b[0].bitrate,b.sort(function(G,z){return G.bitrate-z.bitrate}),this._levels=b;for(var U=0;U<b.length;U++)if(b[U].bitrate===B){this._firstLevel=U,this.log("manifest loaded, "+b.length+" level(s) found, first bitrate: "+B);break}var N=k&&!y,W={levels:b,audioTracks:D,subtitleTracks:O,firstLevel:this._firstLevel,stats:C.stats,audio:k,video:y,altAudio:!N&&D.some(function(G){return!!G.url})};this.hls.trigger(u.Events.MANIFEST_PARSED,W),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(u.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:C.url,reason:"no level with compatible codecs found in manifest"})},w.onError=function(M,C){var b;if(x.prototype.onError.call(this,M,C),!C.fatal){var D=C.context,O=this._levels[this.currentLevelIndex];if(D&&(D.type===d.PlaylistContextType.AUDIO_TRACK&&O.audioGroupIds&&D.groupId===O.audioGroupIds[O.urlId]||D.type===d.PlaylistContextType.SUBTITLE_TRACK&&O.textGroupIds&&D.groupId===O.textGroupIds[O.urlId])){this.redundantFailover(this.currentLevelIndex);return}var B=!1,P=!0,F;switch(C.details){case f.ErrorDetails.FRAG_LOAD_ERROR:case f.ErrorDetails.FRAG_LOAD_TIMEOUT:case f.ErrorDetails.KEY_LOAD_ERROR:case f.ErrorDetails.KEY_LOAD_TIMEOUT:if(C.frag){var I=C.frag.type===d.PlaylistLevelType.MAIN?C.frag.level:this.currentLevelIndex,y=this._levels[I];y?(y.fragmentError++,y.fragmentError>this.hls.config.fragLoadingMaxRetry&&(F=I)):F=I}break;case f.ErrorDetails.LEVEL_LOAD_ERROR:case f.ErrorDetails.LEVEL_LOAD_TIMEOUT:D&&(D.deliveryDirectives&&(P=!1),F=D.level),B=!0;break;case f.ErrorDetails.REMUX_ALLOC_ERROR:F=(b=C.level)!=null?b:this.currentLevelIndex,B=!0;break}F!==void 0&&this.recoverLevel(C,F,B,P)}},w.recoverLevel=function(M,C,b,D){var O=M.details,B=this._levels[C];if(B.loadError++,b){var P=this.retryLoadingOrFail(M);if(P)M.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(D){var F=B.url.length;if(F>1&&B.loadError<F)M.levelRetry=!0,this.redundantFailover(C);else if(this.manualLevelIndex===-1){for(var I=-1,y=this._levels,k=y.length;k--;){var U=(k+this.currentLevelIndex)%y.length;if(U!==this.currentLevelIndex&&y[U].loadError===0){I=U;break}}I>-1&&this.currentLevelIndex!==I&&(this.warn(O+": switch to "+I),M.levelRetry=!0,this.hls.nextAutoLevel=I)}}},w.redundantFailover=function(M){var C=this._levels[M],b=C.url.length;if(b>1){var D=(C.urlId+1)%b;this.warn("Switching to redundant URL-id "+D),this._levels.forEach(function(O){O.urlId=D}),this.level=M}},w.onFragLoaded=function(M,C){var b=C.frag;if(b!==void 0&&b.type===d.PlaylistLevelType.MAIN){var D=this._levels[b.level];D!==void 0&&(D.fragmentError=0,D.loadError=0)}},w.onLevelLoaded=function(M,C){var b,D=C.level,O=C.details,B=this._levels[D];if(!B){var P;this.warn("Invalid level index "+D),(P=C.deliveryDirectives)!==null&&P!==void 0&&P.skip&&(O.deltaUpdateFailed=!0);return}D===this.currentLevelIndex?(B.fragmentError===0&&(B.loadError=0,this.retryCount=0),this.playlistLoaded(D,C,B.details)):(b=C.deliveryDirectives)!==null&&b!==void 0&&b.skip&&(O.deltaUpdateFailed=!0)},w.onAudioTrackSwitched=function(M,C){var b=this.hls.levels[this.currentLevelIndex];if(!!b&&b.audioGroupIds){for(var D=-1,O=this.hls.audioTracks[C.id].groupId,B=0;B<b.audioGroupIds.length;B++)if(b.audioGroupIds[B]===O){D=B;break}D!==b.urlId&&(b.urlId=D,this.startLoad())}},w.loadPlaylist=function(M){var C=this.currentLevelIndex,b=this._levels[C];if(this.canLoad&&b&&b.url.length>0){var D=b.urlId,O=b.url[D];if(M)try{O=M.addDirectives(O)}catch(B){this.warn("Could not construct new URL with HLS Delivery Directives: "+B)}this.log("Attempt loading level index "+C+(M?" at sn "+M.msn+" part "+M.part:"")+" with URL-id "+D+" "+O),this.clearTimer(),this.hls.trigger(u.Events.LEVEL_LOADING,{url:O,level:C,id:D,deliveryDirectives:M||null})}},w.removeLevel=function(M,C){var b=function(B,P){return P!==C},D=this._levels.filter(function(O,B){return B!==M?!0:O.url.length>1&&C!==void 0?(O.url=O.url.filter(b),O.audioGroupIds&&(O.audioGroupIds=O.audioGroupIds.filter(b)),O.textGroupIds&&(O.textGroupIds=O.textGroupIds.filter(b)),O.urlId=0,!0):!1}).map(function(O,B){var P=O.details;return P!=null&&P.fragments&&P.fragments.forEach(function(F){F.level=B}),O});this._levels=D,this.hls.trigger(u.Events.LEVELS_UPDATED,{levels:D})},A(m,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(M){var C,b=this._levels;if(b.length!==0&&!(this.currentLevelIndex===M&&(C=b[M])!==null&&C!==void 0&&C.details)){if(M<0||M>=b.length){var D=M<0;if(this.hls.trigger(u.Events.ERROR,{type:f.ErrorTypes.OTHER_ERROR,details:f.ErrorDetails.LEVEL_SWITCH_ERROR,level:M,fatal:D,reason:"invalid level idx"}),D)return;M=Math.min(M,b.length-1)}this.clearTimer();var O=this.currentLevelIndex,B=b[O],P=b[M];this.log("switching to level "+M+" from "+O),this.currentLevelIndex=M;var F=p({},P,{level:M,maxBitrate:P.maxBitrate,uri:P.uri,urlId:P.urlId});delete F._urlId,this.hls.trigger(u.Events.LEVEL_SWITCHING,F);var I=P.details;if(!I||I.live){var y=this.switchParams(P.uri,B==null?void 0:B.details);this.loadPlaylist(y)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(M){this.manualLevelIndex=M,this._startLevel===void 0&&(this._startLevel=M),M!==-1&&(this.level=M)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(M){this._firstLevel=M}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var M=this.hls.config.startLevel;return M!==void 0?M:this._firstLevel}else return this._startLevel},set:function(M){this._startLevel=M}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(M){this.level=M,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=M)}}]),m}(g.default)},"./src/controller/level-helper.ts":(a,o,l)=>{l.r(o),l.d(o,{addGroupId:()=>_,addSliding:()=>x,adjustSliding:()=>T,assignTrackIdsByGroup:()=>g,computeReloadInterval:()=>m,getFragmentWithSN:()=>w,getPartWith:()=>R,mapFragmentIntersection:()=>L,mapPartIntersection:()=>S,mergeDetails:()=>A,updateFragPTSDTS:()=>v,updatePTS:()=>d});var h=l("./src/polyfills/number.ts"),u=l("./src/utils/logger.ts"),f=l("./src/loader/date-range.ts");function c(){return c=Object.assign?Object.assign.bind():function(M){for(var C=1;C<arguments.length;C++){var b=arguments[C];for(var D in b)Object.prototype.hasOwnProperty.call(b,D)&&(M[D]=b[D])}return M},c.apply(this,arguments)}function _(M,C,b){switch(C){case"audio":M.audioGroupIds||(M.audioGroupIds=[]),M.audioGroupIds.push(b);break;case"text":M.textGroupIds||(M.textGroupIds=[]),M.textGroupIds.push(b);break}}function g(M){var C={};M.forEach(function(b){var D=b.groupId||"";b.id=C[D]=C[D]||0,C[D]++})}function d(M,C,b){var D=M[C],O=M[b];p(D,O)}function p(M,C){var b=C.startPTS;if((0,h.isFiniteNumber)(b)){var D=0,O;C.sn>M.sn?(D=b-M.start,O=M):(D=M.start-b,O=C),O.duration!==D&&(O.duration=D)}else if(C.sn>M.sn){var B=M.cc===C.cc;B&&M.minEndPTS?C.start=M.start+(M.minEndPTS-M.start):C.start=M.start+M.duration}else C.start=Math.max(M.start-C.duration,0)}function v(M,C,b,D,O,B){var P=D-b;P<=0&&(u.logger.warn("Fragment should have a positive duration",C),D=b+C.duration,B=O+C.duration);var F=b,I=D,y=C.startPTS,k=C.endPTS;if((0,h.isFiniteNumber)(y)){var U=Math.abs(y-b);(0,h.isFiniteNumber)(C.deltaPTS)?C.deltaPTS=Math.max(U,C.deltaPTS):C.deltaPTS=U,F=Math.max(b,y),b=Math.min(b,y),O=Math.min(O,C.startDTS),I=Math.min(D,k),D=Math.max(D,k),B=Math.max(B,C.endDTS)}C.duration=D-b;var N=b-C.start;C.appendedPTS=D,C.start=C.startPTS=b,C.maxStartPTS=F,C.startDTS=O,C.endPTS=D,C.minEndPTS=I,C.endDTS=B;var W=C.sn;if(!M||W<M.startSN||W>M.endSN)return 0;var G,z=W-M.startSN,X=M.fragments;for(X[z]=C,G=z;G>0;G--)p(X[G],X[G-1]);for(G=z;G<X.length-1;G++)p(X[G],X[G+1]);return M.fragmentHint&&p(X[X.length-1],M.fragmentHint),M.PTSKnown=M.alignedSliding=!0,N}function A(M,C){for(var b=null,D=M.fragments,O=D.length-1;O>=0;O--){var B=D[O].initSegment;if(B){b=B;break}}M.fragmentHint&&delete M.fragmentHint.endPTS;var P=0,F;if(L(M,C,function(G,z){G.relurl&&(P=G.cc-z.cc),(0,h.isFiniteNumber)(G.startPTS)&&(0,h.isFiniteNumber)(G.endPTS)&&(z.start=z.startPTS=G.startPTS,z.startDTS=G.startDTS,z.appendedPTS=G.appendedPTS,z.maxStartPTS=G.maxStartPTS,z.endPTS=G.endPTS,z.endDTS=G.endDTS,z.minEndPTS=G.minEndPTS,z.duration=G.endPTS-G.startPTS,z.duration&&(F=z),C.PTSKnown=C.alignedSliding=!0),z.elementaryStreams=G.elementaryStreams,z.loader=G.loader,z.stats=G.stats,z.urlId=G.urlId,G.initSegment&&(z.initSegment=G.initSegment,b=G.initSegment)}),b){var I=C.fragmentHint?C.fragments.concat(C.fragmentHint):C.fragments;I.forEach(function(G){var z;(!G.initSegment||G.initSegment.relurl===((z=b)===null||z===void 0?void 0:z.relurl))&&(G.initSegment=b)})}if(C.skippedSegments)if(C.deltaUpdateFailed=C.fragments.some(function(G){return!G}),C.deltaUpdateFailed){u.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var y=C.skippedSegments;y--;)C.fragments.shift();C.startSN=C.fragments[0].sn,C.startCC=C.fragments[0].cc}else C.canSkipDateRanges&&(C.dateRanges=E(M.dateRanges,C.dateRanges,C.recentlyRemovedDateranges));var k=C.fragments;if(P){u.logger.warn("discontinuity sliding from playlist, take drift into account");for(var U=0;U<k.length;U++)k[U].cc+=P}C.skippedSegments&&(C.startCC=C.fragments[0].cc),S(M.partList,C.partList,function(G,z){z.elementaryStreams=G.elementaryStreams,z.stats=G.stats}),F?v(C,F,F.startPTS,F.endPTS,F.startDTS,F.endDTS):T(M,C),k.length&&(C.totalduration=C.edge-k[0].start),C.driftStartTime=M.driftStartTime,C.driftStart=M.driftStart;var N=C.advancedDateTime;if(C.advanced&&N){var W=C.edge;C.driftStart||(C.driftStartTime=N,C.driftStart=W),C.driftEndTime=N,C.driftEnd=W}else C.driftEndTime=M.driftEndTime,C.driftEnd=M.driftEnd,C.advancedDateTime=M.advancedDateTime}function E(M,C,b){var D=c({},M);return b&&b.forEach(function(O){delete D[O]}),Object.keys(C).forEach(function(O){var B=new f.DateRange(C[O].attr,D[O]);B.isValid?D[O]=B:u.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(C[O].attr)+'"')}),D}function S(M,C,b){if(M&&C)for(var D=0,O=0,B=M.length;O<=B;O++){var P=M[O],F=C[O+D];P&&F&&P.index===F.index&&P.fragment.sn===F.fragment.sn?b(P,F):D--}}function L(M,C,b){for(var D=C.skippedSegments,O=Math.max(M.startSN,C.startSN)-C.startSN,B=(M.fragmentHint?1:0)+(D?C.endSN:Math.min(M.endSN,C.endSN))-C.startSN,P=C.startSN-M.startSN,F=C.fragmentHint?C.fragments.concat(C.fragmentHint):C.fragments,I=M.fragmentHint?M.fragments.concat(M.fragmentHint):M.fragments,y=O;y<=B;y++){var k=I[P+y],U=F[y];D&&!U&&y<D&&(U=C.fragments[y]=k),k&&U&&b(k,U)}}function T(M,C){var b=C.startSN+C.skippedSegments-M.startSN,D=M.fragments;b<0||b>=D.length||x(C,D[b].start)}function x(M,C){if(C){for(var b=M.fragments,D=M.skippedSegments;D<b.length;D++)b[D].start+=C;M.fragmentHint&&(M.fragmentHint.start+=C)}}function m(M,C){var b=1e3*M.levelTargetDuration,D=b/2,O=M.age,B=O>0&&O<b*3,P=C.loading.end-C.loading.start,F,I=M.availabilityDelay;if(M.updated===!1)if(B){var y=333*M.misses;F=Math.max(Math.min(D,P*2),y),M.availabilityDelay=(M.availabilityDelay||0)+F}else F=D;else B?(I=Math.min(I||b/2,O),M.availabilityDelay=I,F=I+b-O):F=b-P;return Math.round(F)}function w(M,C,b){if(!M||!M.details)return null;var D=M.details,O=D.fragments[C-D.startSN];return O||(O=D.fragmentHint,O&&O.sn===C)?O:C<D.startSN&&b&&b.sn===C?b:null}function R(M,C,b){if(!M||!M.details)return null;var D=M.details.partList;if(D)for(var O=D.length;O--;){var B=D[O];if(B.index===b&&B.fragment.sn===C)return B}return null}},"./src/controller/stream-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>R});var h=l("./src/polyfills/number.ts"),u=l("./src/controller/base-stream-controller.ts"),f=l("./src/is-supported.ts"),c=l("./src/events.ts"),_=l("./src/utils/buffer-helper.ts"),g=l("./src/controller/fragment-tracker.ts"),d=l("./src/types/loader.ts"),p=l("./src/loader/fragment.ts"),v=l("./src/demux/transmuxer-interface.ts"),A=l("./src/types/transmuxer.ts"),E=l("./src/controller/gap-controller.ts"),S=l("./src/errors.ts");function L(M,C){for(var b=0;b<C.length;b++){var D=C[b];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(M,D.key,D)}}function T(M,C,b){return C&&L(M.prototype,C),b&&L(M,b),Object.defineProperty(M,"prototype",{writable:!1}),M}function x(M,C){M.prototype=Object.create(C.prototype),M.prototype.constructor=M,m(M,C)}function m(M,C){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(D,O){return D.__proto__=O,D},m(M,C)}var w=100,R=function(M){x(C,M);function C(D,O){var B;return B=M.call(this,D,O,"[stream-controller]")||this,B.audioCodecSwap=!1,B.gapController=null,B.level=-1,B._forceStartLoad=!1,B.altAudio=!1,B.audioOnly=!1,B.fragPlaying=null,B.onvplaying=null,B.onvseeked=null,B.fragLastKbps=0,B.couldBacktrack=!1,B.backtrackFragment=null,B.audioCodecSwitch=!1,B.videoBuffer=null,B._registerListeners(),B}var b=C.prototype;return b._registerListeners=function(){var O=this.hls;O.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),O.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),O.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),O.on(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),O.on(c.Events.LEVEL_LOADING,this.onLevelLoading,this),O.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),O.on(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),O.on(c.Events.ERROR,this.onError,this),O.on(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),O.on(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),O.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this),O.on(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),O.on(c.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),O.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},b._unregisterListeners=function(){var O=this.hls;O.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),O.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),O.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),O.off(c.Events.MANIFEST_PARSED,this.onManifestParsed,this),O.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),O.off(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),O.off(c.Events.ERROR,this.onError,this),O.off(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),O.off(c.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),O.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),O.off(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),O.off(c.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),O.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},b.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},b.startLoad=function(O){if(this.levels){var B=this.lastCurrentTime,P=this.hls;if(this.stopLoad(),this.setInterval(w),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var F=P.startLevel;F===-1&&(P.config.testBandwidth&&this.levels.length>1?(F=0,this.bitrateTest=!0):F=P.nextAutoLevel),this.level=P.nextLoadLevel=F,this.loadedmetadata=!1}B>0&&O===-1&&(this.log("Override startPosition with lastCurrentTime @"+B.toFixed(3)),O=B),this.state=u.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=O,this.tick()}else this._forceStartLoad=!0,this.state=u.State.STOPPED},b.stopLoad=function(){this._forceStartLoad=!1,M.prototype.stopLoad.call(this)},b.doTick=function(){switch(this.state){case u.State.IDLE:this.doTickIdle();break;case u.State.WAITING_LEVEL:{var O,B=this.levels,P=this.level,F=B==null||(O=B[P])===null||O===void 0?void 0:O.details;if(F&&(!F.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(F))break;this.state=u.State.IDLE;break}break}case u.State.FRAG_LOADING_WAITING_RETRY:{var I,y=self.performance.now(),k=this.retryDate;(!k||y>=k||(I=this.media)!==null&&I!==void 0&&I.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=u.State.IDLE)}break}this.onTickEnd()},b.onTickEnd=function(){M.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},b.doTickIdle=function(){var O,B,P=this.hls,F=this.levelLastLoaded,I=this.levels,y=this.media,k=P.config,U=P.nextLoadLevel;if(!(F===null||!y&&(this.startFragRequested||!k.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!I||!I[U])){var N=I[U];this.level=P.nextLoadLevel=U;var W=N.details;if(!W||this.state===u.State.WAITING_LEVEL||W.live&&this.levelLastLoaded!==U){this.state=u.State.WAITING_LEVEL;return}var G=this.getMainFwdBufferInfo();if(G!==null){var z=G.len,X=this.getMaxBufferLength(N.maxBitrate);if(!(z>=X)){if(this._streamEnded(G,W)){var K={};this.altAudio&&(K.type="video"),this.hls.trigger(c.Events.BUFFER_EOS,K),this.state=u.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>G.end&&(this.backtrackFragment=null);var $=this.backtrackFragment?this.backtrackFragment.start:G.end,q=this.getNextFragment($,W);if(this.couldBacktrack&&!this.fragPrevious&&q&&q.sn!=="initSegment"&&this.fragmentTracker.getState(q)!==g.FragmentState.OK){var J,Q=((J=this.backtrackFragment)!=null?J:q).sn,rt=Q-W.startSN,mt=W.fragments[rt-1];mt&&q.cc===mt.cc&&(q=mt,this.fragmentTracker.removeFragment(mt))}else this.backtrackFragment&&G.len&&(this.backtrackFragment=null);if(q&&this.fragmentTracker.getState(q)===g.FragmentState.OK&&this.nextLoadPosition>$){var vt=this.audioOnly&&!this.altAudio?p.ElementaryStreamTypes.AUDIO:p.ElementaryStreamTypes.VIDEO;y&&this.afterBufferFlushed(y,vt,d.PlaylistLevelType.MAIN),q=this.getNextFragment(this.nextLoadPosition,W)}!q||(q.initSegment&&!q.initSegment.data&&!this.bitrateTest&&(q=q.initSegment),((O=q.decryptdata)===null||O===void 0?void 0:O.keyFormat)==="identity"&&!((B=q.decryptdata)!==null&&B!==void 0&&B.key)?this.loadKey(q,W):this.loadFragment(q,W,$))}}}},b.loadFragment=function(O,B,P){var F,I=this.fragmentTracker.getState(O);this.fragCurrent=O,I===g.FragmentState.NOT_LOADED?O.sn==="initSegment"?this._loadInitSegment(O):this.bitrateTest?(this.log("Fragment "+O.sn+" of level "+O.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(O)):(this.startFragRequested=!0,M.prototype.loadFragment.call(this,O,B,P)):I===g.FragmentState.APPENDING?this.reduceMaxBufferLength(O.duration)&&this.fragmentTracker.removeFragment(O):((F=this.media)===null||F===void 0?void 0:F.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},b.getAppendedFrag=function(O){var B=this.fragmentTracker.getAppendedFrag(O,d.PlaylistLevelType.MAIN);return B&&"fragment"in B?B.fragment:B},b.getBufferedFrag=function(O){return this.fragmentTracker.getBufferedFrag(O,d.PlaylistLevelType.MAIN)},b.followingBufferedFrag=function(O){return O?this.getBufferedFrag(O.end+.5):null},b.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},b.nextLevelSwitch=function(){var O=this.levels,B=this.media;if(B!=null&&B.readyState){var P,F=this.getAppendedFrag(B.currentTime);if(F&&F.start>1&&this.flushMainBuffer(0,F.start-1),!B.paused&&O){var I=this.hls.nextLoadLevel,y=O[I],k=this.fragLastKbps;k&&this.fragCurrent?P=this.fragCurrent.duration*y.maxBitrate/(1e3*k)+1:P=0}else P=0;var U=this.getBufferedFrag(B.currentTime+P);if(U){var N=this.followingBufferedFrag(U);if(N){this.abortCurrentFrag();var W=N.maxStartPTS?N.maxStartPTS:N.start,G=N.duration,z=Math.max(U.end,W+Math.min(Math.max(G-this.config.maxFragLookUpTolerance,G*.5),G*.75));this.flushMainBuffer(z,Number.POSITIVE_INFINITY)}}}},b.abortCurrentFrag=function(){var O=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,O!=null&&O.loader&&O.loader.abort(),this.state){case u.State.KEY_LOADING:case u.State.FRAG_LOADING:case u.State.FRAG_LOADING_WAITING_RETRY:case u.State.PARSING:case u.State.PARSED:this.state=u.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},b.flushMainBuffer=function(O,B){M.prototype.flushMainBuffer.call(this,O,B,this.altAudio?"video":null)},b.onMediaAttached=function(O,B){M.prototype.onMediaAttached.call(this,O,B);var P=B.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),P.addEventListener("playing",this.onvplaying),P.addEventListener("seeked",this.onvseeked),this.gapController=new E.default(this.config,P,this.fragmentTracker,this.hls)},b.onMediaDetaching=function(){var O=this.media;O&&this.onvplaying&&this.onvseeked&&(O.removeEventListener("playing",this.onvplaying),O.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),M.prototype.onMediaDetaching.call(this)},b.onMediaPlaying=function(){this.tick()},b.onMediaSeeked=function(){var O=this.media,B=O?O.currentTime:null;(0,h.isFiniteNumber)(B)&&this.log("Media seeked to "+B.toFixed(3)),this.tick()},b.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(c.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},b.onManifestParsed=function(O,B){var P=!1,F=!1,I;B.levels.forEach(function(y){I=y.audioCodec,I&&(I.indexOf("mp4a.40.2")!==-1&&(P=!0),I.indexOf("mp4a.40.5")!==-1&&(F=!0))}),this.audioCodecSwitch=P&&F&&!(0,f.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=B.levels,this.startFragRequested=!1},b.onLevelLoading=function(O,B){var P=this.levels;if(!(!P||this.state!==u.State.IDLE)){var F=P[B.level];(!F.details||F.details.live&&this.levelLastLoaded!==B.level||this.waitForCdnTuneIn(F.details))&&(this.state=u.State.WAITING_LEVEL)}},b.onLevelLoaded=function(O,B){var P,F=this.levels,I=B.level,y=B.details,k=y.totalduration;if(!F){this.warn("Levels were reset while loading level "+I);return}this.log("Level "+I+" loaded ["+y.startSN+","+y.endSN+"], cc ["+y.startCC+", "+y.endCC+"] duration:"+k);var U=this.fragCurrent;U&&(this.state===u.State.FRAG_LOADING||this.state===u.State.FRAG_LOADING_WAITING_RETRY)&&U.level!==B.level&&U.loader&&(this.state=u.State.IDLE,this.backtrackFragment=null,U.loader.abort());var N=F[I],W=0;if(y.live||(P=N.details)!==null&&P!==void 0&&P.live){if(y.fragments[0]||(y.deltaUpdateFailed=!0),y.deltaUpdateFailed)return;W=this.alignPlaylists(y,N.details)}if(N.details=y,this.levelLastLoaded=I,this.hls.trigger(c.Events.LEVEL_UPDATED,{details:y,level:I}),this.state===u.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(y))return;this.state=u.State.IDLE}this.startFragRequested?y.live&&this.synchronizeToLiveEdge(y):this.setStartPosition(y,W),this.tick()},b._handleFragmentLoadProgress=function(O){var B,P=O.frag,F=O.part,I=O.payload,y=this.levels;if(!y){this.warn("Levels were reset while fragment load was in progress. Fragment "+P.sn+" of level "+P.level+" will not be buffered");return}var k=y[P.level],U=k.details;if(!U){this.warn("Dropping fragment "+P.sn+" of level "+P.level+" after level details were reset");return}var N=k.videoCodec,W=U.PTSKnown||!U.live,G=(B=P.initSegment)===null||B===void 0?void 0:B.data,z=this._getAudioCodec(k),X=this.transmuxer=this.transmuxer||new v.default(this.hls,d.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),K=F?F.index:-1,$=K!==-1,q=new A.ChunkMetadata(P.level,P.sn,P.stats.chunkCount,I.byteLength,K,$),J=this.initPTS[P.cc];X.push(I,G,z,N,P,F,U.totalduration,W,q,J)},b.onAudioTrackSwitching=function(O,B){var P=this.altAudio,F=!!B.url,I=B.id;if(!F){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var y=this.fragCurrent;y!=null&&y.loader&&(this.log("Switching to main audio track, cancel main fragment load"),y.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var k=this.hls;P&&k.trigger(c.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),k.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:I})}},b.onAudioTrackSwitched=function(O,B){var P=B.id,F=!!this.hls.audioTracks[P].url;if(F){var I=this.videoBuffer;I&&this.mediaBuffer!==I&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=I)}this.altAudio=F,this.tick()},b.onBufferCreated=function(O,B){var P=B.tracks,F,I,y=!1;for(var k in P){var U=P[k];if(U.id==="main"){if(I=k,F=U,k==="video"){var N=P[k];N&&(this.videoBuffer=N.buffer)}}else y=!0}y&&F?(this.log("Alternate track found, use "+I+".buffered to schedule main fragment loading"),this.mediaBuffer=F.buffer):this.mediaBuffer=this.media},b.onFragBuffered=function(O,B){var P=B.frag,F=B.part;if(!(P&&P.type!==d.PlaylistLevelType.MAIN)){if(this.fragContextChanged(P)){this.warn("Fragment "+P.sn+(F?" p: "+F.index:"")+" of level "+P.level+" finished buffering, but was aborted. state: "+this.state),this.state===u.State.PARSED&&(this.state=u.State.IDLE);return}var I=F?F.stats:P.stats;this.fragLastKbps=Math.round(8*I.total/(I.buffering.end-I.loading.first)),P.sn!=="initSegment"&&(this.fragPrevious=P),this.fragBufferedComplete(P,F)}},b.onError=function(O,B){switch(B.details){case S.ErrorDetails.FRAG_LOAD_ERROR:case S.ErrorDetails.FRAG_LOAD_TIMEOUT:case S.ErrorDetails.KEY_LOAD_ERROR:case S.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(d.PlaylistLevelType.MAIN,B);break;case S.ErrorDetails.LEVEL_LOAD_ERROR:case S.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==u.State.ERROR&&(B.fatal?(this.warn(""+B.details),this.state=u.State.ERROR):!B.levelRetry&&this.state===u.State.WAITING_LEVEL&&(this.state=u.State.IDLE));break;case S.ErrorDetails.BUFFER_FULL_ERROR:if(B.parent==="main"&&(this.state===u.State.PARSING||this.state===u.State.PARSED)){var P=!0,F=this.getFwdBufferInfo(this.media,d.PlaylistLevelType.MAIN);F&&F.len>.5&&(P=!this.reduceMaxBufferLength(F.len)),P&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},b.checkBuffer=function(){var O=this.media,B=this.gapController;if(!(!O||!B||!O.readyState)){if(this.loadedmetadata||!_.BufferHelper.getBuffered(O).length){var P=this.state!==u.State.IDLE?this.fragCurrent:null;B.poll(this.lastCurrentTime,P)}this.lastCurrentTime=O.currentTime}},b.onFragLoadEmergencyAborted=function(){this.state=u.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},b.onBufferFlushed=function(O,B){var P=B.type;if(P!==p.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var F=(P===p.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(F,P,d.PlaylistLevelType.MAIN)}},b.onLevelsUpdated=function(O,B){this.levels=B.levels},b.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},b.seekToStartPos=function(){var O=this.media;if(!!O){var B=O.currentTime,P=this.startPosition;if(P>=0&&B<P){if(O.seeking){this.log("could not seek to "+P+", already seeking at "+B);return}var F=_.BufferHelper.getBuffered(O),I=F.length?F.start(0):0,y=I-P;y>0&&(y<this.config.maxBufferHole||y<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+y+" to match buffer start"),P+=y,this.startPosition=P),this.log("seek to target start position "+P+" from current time "+B),O.currentTime=P}}},b._getAudioCodec=function(O){var B=this.config.defaultAudioCodec||O.audioCodec;return this.audioCodecSwap&&B&&(this.log("Swapping audio codec"),B.indexOf("mp4a.40.5")!==-1?B="mp4a.40.2":B="mp4a.40.5"),B},b._loadBitrateTestFrag=function(O){var B=this;O.bitrateTest=!0,this._doFragLoad(O).then(function(P){var F=B.hls;if(!(!P||F.nextLoadLevel||B.fragContextChanged(O))){B.fragLoadError=0,B.state=u.State.IDLE,B.startFragRequested=!1,B.bitrateTest=!1;var I=O.stats;I.parsing.start=I.parsing.end=I.buffering.start=I.buffering.end=self.performance.now(),F.trigger(c.Events.FRAG_LOADED,P),O.bitrateTest=!1}})},b._handleTransmuxComplete=function(O){var B,P="main",F=this.hls,I=O.remuxResult,y=O.chunkMeta,k=this.getCurrentContext(y);if(!k){this.warn("The loading context changed while buffering fragment "+y.sn+" of level "+y.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(y.level);return}var U=k.frag,N=k.part,W=k.level,G=I.video,z=I.text,X=I.id3,K=I.initSegment,$=W.details,q=this.altAudio?void 0:I.audio;if(!this.fragContextChanged(U)){if(this.state=u.State.PARSING,K){K.tracks&&(this._bufferInitSegment(W,K.tracks,U,y),F.trigger(c.Events.FRAG_PARSING_INIT_SEGMENT,{frag:U,id:P,tracks:K.tracks}));var J=K.initPTS,Q=K.timescale;(0,h.isFiniteNumber)(J)&&(this.initPTS[U.cc]=J,F.trigger(c.Events.INIT_PTS_FOUND,{frag:U,id:P,initPTS:J,timescale:Q}))}if(G&&I.independent!==!1){if($){var rt=G.startPTS,mt=G.endPTS,vt=G.startDTS,_t=G.endDTS;if(N)N.elementaryStreams[G.type]={startPTS:rt,endPTS:mt,startDTS:vt,endDTS:_t};else if(G.firstKeyFrame&&G.independent&&(this.couldBacktrack=!0),G.dropped&&G.independent){var tt=this.getMainFwdBufferInfo(),Lt=(tt?tt.end:this.getLoadPosition())+this.config.maxBufferHole,dt=G.firstKeyFramePTS?G.firstKeyFramePTS:rt;if(Lt<dt-this.config.maxBufferHole){this.backtrack(U);return}U.setElementaryStreamInfo(G.type,U.start,mt,U.start,_t,!0)}U.setElementaryStreamInfo(G.type,rt,mt,vt,_t),this.backtrackFragment&&(this.backtrackFragment=U),this.bufferFragmentData(G,U,N,y)}}else if(I.independent===!1){this.backtrack(U);return}if(q){var Tt=q.startPTS,Ht=q.endPTS,Y=q.startDTS,V=q.endDTS;N&&(N.elementaryStreams[p.ElementaryStreamTypes.AUDIO]={startPTS:Tt,endPTS:Ht,startDTS:Y,endDTS:V}),U.setElementaryStreamInfo(p.ElementaryStreamTypes.AUDIO,Tt,Ht,Y,V),this.bufferFragmentData(q,U,N,y)}if($&&X!==null&&X!==void 0&&(B=X.samples)!==null&&B!==void 0&&B.length){var it={id:P,frag:U,details:$,samples:X.samples};F.trigger(c.Events.FRAG_PARSING_METADATA,it)}if($&&z){var at={id:P,frag:U,details:$,samples:z.samples};F.trigger(c.Events.FRAG_PARSING_USERDATA,at)}}},b._bufferInitSegment=function(O,B,P,F){var I=this;if(this.state===u.State.PARSING){this.audioOnly=!!B.audio&&!B.video,this.altAudio&&!this.audioOnly&&delete B.audio;var y=B.audio,k=B.video,U=B.audiovideo;if(y){var N=O.audioCodec,W=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(N&&(N.indexOf("mp4a.40.5")!==-1?N="mp4a.40.2":N="mp4a.40.5"),y.metadata.channelCount!==1&&W.indexOf("firefox")===-1&&(N="mp4a.40.5")),W.indexOf("android")!==-1&&y.container!=="audio/mpeg"&&(N="mp4a.40.2",this.log("Android: force audio codec to "+N)),O.audioCodec&&O.audioCodec!==N&&this.log('Swapping manifest audio codec "'+O.audioCodec+'" for "'+N+'"'),y.levelCodec=N,y.id="main",this.log("Init audio buffer, container:"+y.container+", codecs[selected/level/parsed]=["+(N||"")+"/"+(O.audioCodec||"")+"/"+y.codec+"]")}k&&(k.levelCodec=O.videoCodec,k.id="main",this.log("Init video buffer, container:"+k.container+", codecs[level/parsed]=["+(O.videoCodec||"")+"/"+k.codec+"]")),U&&this.log("Init audiovideo buffer, container:"+U.container+", codecs[level/parsed]=["+(O.attrs.CODECS||"")+"/"+U.codec+"]"),this.hls.trigger(c.Events.BUFFER_CODECS,B),Object.keys(B).forEach(function(G){var z=B[G],X=z.initSegment;X!=null&&X.byteLength&&I.hls.trigger(c.Events.BUFFER_APPENDING,{type:G,data:X,frag:P,part:null,chunkMeta:F,parent:P.type})}),this.tick()}},b.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,d.PlaylistLevelType.MAIN)},b.backtrack=function(O){this.couldBacktrack=!0,this.backtrackFragment=O,this.resetTransmuxer(),this.flushBufferGap(O),this.fragmentTracker.removeFragment(O),this.fragPrevious=null,this.nextLoadPosition=O.start,this.state=u.State.IDLE},b.checkFragmentChanged=function(){var O=this.media,B=null;if(O&&O.readyState>1&&O.seeking===!1){var P=O.currentTime;if(_.BufferHelper.isBuffered(O,P)?B=this.getAppendedFrag(P):_.BufferHelper.isBuffered(O,P+.1)&&(B=this.getAppendedFrag(P+.1)),B){this.backtrackFragment=null;var F=this.fragPlaying,I=B.level;(!F||B.sn!==F.sn||F.level!==I||B.urlId!==F.urlId)&&(this.hls.trigger(c.Events.FRAG_CHANGED,{frag:B}),(!F||F.level!==I)&&this.hls.trigger(c.Events.LEVEL_SWITCHED,{level:I}),this.fragPlaying=B)}}},T(C,[{key:"nextLevel",get:function(){var O=this.nextBufferedFrag;return O?O.level:-1}},{key:"currentFrag",get:function(){var O=this.media;return O?this.fragPlaying||this.getAppendedFrag(O.currentTime):null}},{key:"currentProgramDateTime",get:function(){var O=this.media;if(O){var B=O.currentTime,P=this.currentFrag;if(P&&(0,h.isFiniteNumber)(B)&&(0,h.isFiniteNumber)(P.programDateTime)){var F=P.programDateTime+(B-P.start)*1e3;return new Date(F)}}return null}},{key:"currentLevel",get:function(){var O=this.currentFrag;return O?O.level:-1}},{key:"nextBufferedFrag",get:function(){var O=this.currentFrag;return O?this.followingBufferedFrag(O):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),C}(u.default)},"./src/controller/subtitle-stream-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{SubtitleStreamController:()=>x});var h=l("./src/events.ts"),u=l("./src/utils/buffer-helper.ts"),f=l("./src/controller/fragment-finders.ts"),c=l("./src/utils/discontinuities.ts"),_=l("./src/controller/level-helper.ts"),g=l("./src/controller/fragment-tracker.ts"),d=l("./src/controller/base-stream-controller.ts"),p=l("./src/types/loader.ts"),v=l("./src/types/level.ts");function A(w,R){for(var M=0;M<R.length;M++){var C=R[M];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(w,C.key,C)}}function E(w,R,M){return R&&A(w.prototype,R),M&&A(w,M),Object.defineProperty(w,"prototype",{writable:!1}),w}function S(w,R){w.prototype=Object.create(R.prototype),w.prototype.constructor=w,L(w,R)}function L(w,R){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(C,b){return C.__proto__=b,C},L(w,R)}var T=500,x=function(w){S(R,w);function R(C,b){var D;return D=w.call(this,C,b,"[subtitle-stream-controller]")||this,D.levels=[],D.currentTrackId=-1,D.tracksBuffered=[],D.mainDetails=null,D._registerListeners(),D}var M=R.prototype;return M.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},M._registerListeners=function(){var b=this.hls;b.on(h.Events.MEDIA_ATTACHED,this.onMediaAttached,this),b.on(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.on(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.on(h.Events.LEVEL_LOADED,this.onLevelLoaded,this),b.on(h.Events.ERROR,this.onError,this),b.on(h.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),b.on(h.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),b.on(h.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),b.on(h.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),b.on(h.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},M._unregisterListeners=function(){var b=this.hls;b.off(h.Events.MEDIA_ATTACHED,this.onMediaAttached,this),b.off(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.off(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.off(h.Events.LEVEL_LOADED,this.onLevelLoaded,this),b.off(h.Events.ERROR,this.onError,this),b.off(h.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),b.off(h.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),b.off(h.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),b.off(h.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),b.off(h.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},M.startLoad=function(){this.stopLoad(),this.state=d.State.IDLE,this.setInterval(T),this.tick()},M.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},M.onLevelLoaded=function(b,D){this.mainDetails=D.details},M.onSubtitleFragProcessed=function(b,D){var O=D.frag,B=D.success;if(this.fragPrevious=O,this.state=d.State.IDLE,!!B){var P=this.tracksBuffered[this.currentTrackId];if(!!P){for(var F,I=O.start,y=0;y<P.length;y++)if(I>=P[y].start&&I<=P[y].end){F=P[y];break}var k=O.start+O.duration;F?F.end=k:(F={start:I,end:k},P.push(F)),this.fragmentTracker.fragBuffered(O)}}},M.onBufferFlushing=function(b,D){var O=D.startOffset,B=D.endOffset;if(O===0&&B!==Number.POSITIVE_INFINITY){var P=this.currentTrackId,F=this.levels;if(!F.length||!F[P]||!F[P].details)return;var I=F[P].details,y=I.targetduration,k=B-y;if(k<=0)return;D.endOffsetSubtitles=Math.max(0,k),this.tracksBuffered.forEach(function(U){for(var N=0;N<U.length;){if(U[N].end<=k){U.shift();continue}else if(U[N].start<k)U[N].start=k;else break;N++}}),this.fragmentTracker.removeFragmentsInRange(O,k,p.PlaylistLevelType.SUBTITLE)}},M.onError=function(b,D){var O,B=D.frag;!B||B.type!==p.PlaylistLevelType.SUBTITLE||((O=this.fragCurrent)!==null&&O!==void 0&&O.loader&&this.fragCurrent.loader.abort(),this.state=d.State.IDLE)},M.onSubtitleTracksUpdated=function(b,D){var O=this,B=D.subtitleTracks;this.tracksBuffered=[],this.levels=B.map(function(P){return new v.Level(P)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(P){O.tracksBuffered[P.id]=[]}),this.mediaBuffer=null},M.onSubtitleTrackSwitch=function(b,D){if(this.currentTrackId=D.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var O=this.levels[this.currentTrackId];O!=null&&O.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,O&&this.setInterval(T)},M.onSubtitleTrackLoaded=function(b,D){var O,B=D.details,P=D.id,F=this.currentTrackId,I=this.levels;if(!!I.length){var y=I[F];if(!(P>=I.length||P!==F||!y)){if(this.mediaBuffer=this.mediaBufferTimeRanges,B.live||(O=y.details)!==null&&O!==void 0&&O.live){var k=this.mainDetails;if(B.deltaUpdateFailed||!k)return;var U=k.fragments[0];if(!y.details)B.hasProgramDateTime&&k.hasProgramDateTime?(0,c.alignMediaPlaylistByPDT)(B,k):U&&(0,_.addSliding)(B,U.start);else{var N=this.alignPlaylists(B,y.details);N===0&&U&&(0,_.addSliding)(B,U.start)}}if(y.details=B,this.levelLastLoaded=P,this.tick(),B.live&&!this.fragCurrent&&this.media&&this.state===d.State.IDLE){var W=(0,f.findFragmentByPTS)(null,B.fragments,this.media.currentTime,0);W||(this.warn("Subtitle playlist not aligned with playback"),y.details=void 0)}}}},M._handleFragmentLoadComplete=function(b){var D=b.frag,O=b.payload,B=D.decryptdata,P=this.hls;if(!this.fragContextChanged(D)&&O&&O.byteLength>0&&B&&B.key&&B.iv&&B.method==="AES-128"){var F=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(O),B.key.buffer,B.iv.buffer).then(function(I){var y=performance.now();P.trigger(h.Events.FRAG_DECRYPTED,{frag:D,payload:I,stats:{tstart:F,tdecrypt:y}})})}},M.doTick=function(){if(!this.media){this.state=d.State.IDLE;return}if(this.state===d.State.IDLE){var b=this.currentTrackId,D=this.levels;if(!D.length||!D[b]||!D[b].details)return;var O=D[b].details,B=O.targetduration,P=this.config,F=this.media,I=u.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],F.currentTime-B,P.maxBufferHole),y=I.end,k=I.len,U=this.getMaxBufferLength()+B;if(k>U)return;console.assert(O,"Subtitle track details are defined on idle subtitle stream controller tick");var N=O.fragments,W=N.length,G=O.edge,z,X=this.fragPrevious;if(y<G){var K=P.maxFragLookUpTolerance;z=(0,f.findFragmentByPTS)(X,N,Math.max(N[0].start,y),K),!z&&X&&X.start<N[0].start&&(z=N[0])}else z=N[W-1];if(z=this.mapToInitFragWhenRequired(z),!z||this.fragmentTracker.getState(z)!==g.FragmentState.NOT_LOADED)return;z.encrypted?this.loadKey(z,O):this.loadFragment(z,O,y)}},M.loadFragment=function(b,D,O){this.fragCurrent=b,b.sn==="initSegment"?this._loadInitSegment(b):w.prototype.loadFragment.call(this,b,D,O)},E(R,[{key:"mediaBufferTimeRanges",get:function(){return new m(this.tracksBuffered[this.currentTrackId]||[])}}]),R}(d.default),m=function(R){this.buffered=void 0;var M=function(b,D,O){if(D=D>>>0,D>O-1)throw new DOMException("Failed to execute '"+b+"' on 'TimeRanges': The index provided ("+D+") is greater than the maximum bound ("+O+")");return R[D][b]};this.buffered={get length(){return R.length},end:function(b){return M("end",b,R.length)},start:function(b){return M("start",b,R.length)}}}},"./src/controller/subtitle-track-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>E});var h=l("./src/events.ts"),u=l("./src/utils/texttrack-utils.ts"),f=l("./src/controller/base-playlist-controller.ts"),c=l("./src/types/loader.ts");function _(S,L){for(var T=0;T<L.length;T++){var x=L[T];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(S,x.key,x)}}function g(S,L,T){return L&&_(S.prototype,L),T&&_(S,T),Object.defineProperty(S,"prototype",{writable:!1}),S}function d(S,L){S.prototype=Object.create(L.prototype),S.prototype.constructor=S,p(S,L)}function p(S,L){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(x,m){return x.__proto__=m,x},p(S,L)}var v=function(S){d(L,S);function L(x){var m;return m=S.call(this,x,"[subtitle-track-controller]")||this,m.media=null,m.tracks=[],m.groupId=null,m.tracksInGroup=[],m.trackId=-1,m.selectDefaultTrack=!0,m.queuedDefaultTrack=-1,m.trackChangeListener=function(){return m.onTextTracksChanged()},m.asyncPollTrackChange=function(){return m.pollTrackChange(0)},m.useTextTrackPolling=!1,m.subtitlePollingInterval=-1,m._subtitleDisplay=!0,m.registerListeners(),m}var T=L.prototype;return T.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,S.prototype.destroy.call(this)},T.registerListeners=function(){var m=this.hls;m.on(h.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.on(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.on(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.on(h.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.on(h.Events.LEVEL_LOADING,this.onLevelLoading,this),m.on(h.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),m.on(h.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),m.on(h.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){var m=this.hls;m.off(h.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.off(h.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.off(h.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.off(h.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.off(h.Events.LEVEL_LOADING,this.onLevelLoading,this),m.off(h.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),m.off(h.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),m.off(h.Events.ERROR,this.onError,this)},T.onMediaAttached=function(m,w){this.media=w.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},T.pollTrackChange=function(m){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,m)},T.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var m=A(this.media.textTracks);m.forEach(function(w){(0,u.clearCurrentCues)(w)}),this.subtitleTrack=-1,this.media=null}},T.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},T.onManifestParsed=function(m,w){this.tracks=w.subtitleTracks},T.onSubtitleTrackLoaded=function(m,w){var R=w.id,M=w.details,C=this.trackId,b=this.tracksInGroup[C];if(!b){this.warn("Invalid subtitle track id "+R);return}var D=b.details;b.details=w.details,this.log("subtitle track "+R+" loaded ["+M.startSN+"-"+M.endSN+"]"),R===this.trackId&&(this.retryCount=0,this.playlistLoaded(R,w,D))},T.onLevelLoading=function(m,w){this.switchLevel(w.level)},T.onLevelSwitching=function(m,w){this.switchLevel(w.level)},T.switchLevel=function(m){var w=this.hls.levels[m];if(!!(w!=null&&w.textGroupIds)){var R=w.textGroupIds[w.urlId];if(this.groupId!==R){var M=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,C=this.tracks.filter(function(O){return!R||O.groupId===R});this.tracksInGroup=C;var b=this.findTrackId(M==null?void 0:M.name)||this.findTrackId();this.groupId=R;var D={subtitleTracks:C};this.log("Updating subtitle tracks, "+C.length+' track(s) found in "'+R+'" group-id'),this.hls.trigger(h.Events.SUBTITLE_TRACKS_UPDATED,D),b!==-1&&this.setSubtitleTrack(b,M)}}},T.findTrackId=function(m){for(var w=this.tracksInGroup,R=0;R<w.length;R++){var M=w[R];if((!this.selectDefaultTrack||M.default)&&(!m||m===M.name))return M.id}return-1},T.onError=function(m,w){S.prototype.onError.call(this,m,w),!(w.fatal||!w.context)&&w.context.type===c.PlaylistContextType.SUBTITLE_TRACK&&w.context.id===this.trackId&&w.context.groupId===this.groupId&&this.retryLoadingOrFail(w)},T.loadPlaylist=function(m){var w=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(w)){var R=w.id,M=w.groupId,C=w.url;if(m)try{C=m.addDirectives(C)}catch(b){this.warn("Could not construct new URL with HLS Delivery Directives: "+b)}this.log("Loading subtitle playlist for id "+R),this.hls.trigger(h.Events.SUBTITLE_TRACK_LOADING,{url:C,id:R,groupId:M,deliveryDirectives:m||null})}},T.toggleTrackModes=function(m){var w=this,R=this.media,M=this.trackId;if(!!R){var C=A(R.textTracks),b=C.filter(function(B){return B.groupId===w.groupId});if(m===-1)[].slice.call(C).forEach(function(B){B.mode="disabled"});else{var D=b[M];D&&(D.mode="disabled")}var O=b[m];O&&(O.mode=this.subtitleDisplay?"showing":"hidden")}},T.setSubtitleTrack=function(m,w){var R,M=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=m;return}if(this.trackId!==m&&this.toggleTrackModes(m),!(this.trackId===m&&(m===-1||(R=M[m])!==null&&R!==void 0&&R.details)||m<-1||m>=M.length)){this.clearTimer();var C=M[m];if(this.log("Switching to subtitle track "+m),this.trackId=m,C){var b=C.id,D=C.groupId,O=D===void 0?"":D,B=C.name,P=C.type,F=C.url;this.hls.trigger(h.Events.SUBTITLE_TRACK_SWITCH,{id:b,groupId:O,name:B,type:P,url:F});var I=this.switchParams(C.url,w==null?void 0:w.details);this.loadPlaylist(I)}else this.hls.trigger(h.Events.SUBTITLE_TRACK_SWITCH,{id:m})}},T.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var m=-1,w=A(this.media.textTracks),R=0;R<w.length;R++)if(w[R].mode==="hidden")m=R;else if(w[R].mode==="showing"){m=R;break}this.subtitleTrack!==m&&(this.subtitleTrack=m)}},g(L,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(m){this._subtitleDisplay=m,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(m){this.selectDefaultTrack=!1;var w=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(m,w)}}]),L}(f.default);function A(S){for(var L=[],T=0;T<S.length;T++){var x=S[T];x.kind==="subtitles"&&x.label&&L.push(S[T])}return L}const E=v},"./src/controller/timeline-controller.ts":(a,o,l)=>{l.r(o),l.d(o,{TimelineController:()=>E});var h=l("./src/polyfills/number.ts"),u=l("./src/events.ts"),f=l("./src/utils/cea-608-parser.ts"),c=l("./src/utils/output-filter.ts"),_=l("./src/utils/webvtt-parser.ts"),g=l("./src/utils/texttrack-utils.ts"),d=l("./src/utils/imsc1-ttml-parser.ts"),p=l("./src/utils/mp4-tools.ts"),v=l("./src/types/loader.ts"),A=l("./src/utils/logger.ts"),E=function(){function x(w){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=T(),this.captionsProperties=void 0,this.hls=w,this.config=w.config,this.Cues=w.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var R=new c.default(this,"textTrack1"),M=new c.default(this,"textTrack2"),C=new c.default(this,"textTrack3"),b=new c.default(this,"textTrack4");this.cea608Parser1=new f.default(1,R,M),this.cea608Parser2=new f.default(3,C,b)}w.on(u.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),w.on(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),w.on(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),w.on(u.Events.MANIFEST_LOADED,this.onManifestLoaded,this),w.on(u.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),w.on(u.Events.FRAG_LOADING,this.onFragLoading,this),w.on(u.Events.FRAG_LOADED,this.onFragLoaded,this),w.on(u.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),w.on(u.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),w.on(u.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),w.on(u.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),w.on(u.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var m=x.prototype;return m.destroy=function(){var R=this.hls;R.off(u.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),R.off(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),R.off(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),R.off(u.Events.MANIFEST_LOADED,this.onManifestLoaded,this),R.off(u.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),R.off(u.Events.FRAG_LOADING,this.onFragLoading,this),R.off(u.Events.FRAG_LOADED,this.onFragLoaded,this),R.off(u.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),R.off(u.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),R.off(u.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),R.off(u.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),R.off(u.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},m.addCues=function(R,M,C,b,D){for(var O=!1,B=D.length;B--;){var P=D[B],F=L(P[0],P[1],M,C);if(F>=0&&(P[0]=Math.min(P[0],M),P[1]=Math.max(P[1],C),O=!0,F/(C-M)>.5))return}if(O||D.push([M,C]),this.config.renderTextTracksNatively){var I=this.captionsTracks[R];this.Cues.newCue(I,M,C,b)}else{var y=this.Cues.newCue(null,M,C,b);this.hls.trigger(u.Events.CUES_PARSED,{type:"captions",cues:y,track:R})}},m.onInitPtsFound=function(R,M){var C=this,b=M.frag,D=M.id,O=M.initPTS,B=M.timescale,P=this.unparsedVttFrags;D==="main"&&(this.initPTS[b.cc]=O,this.timescale[b.cc]=B),P.length&&(this.unparsedVttFrags=[],P.forEach(function(F){C.onFragLoaded(u.Events.FRAG_LOADED,F)}))},m.getExistingTrack=function(R){var M=this.media;if(M)for(var C=0;C<M.textTracks.length;C++){var b=M.textTracks[C];if(b[R])return b}return null},m.createCaptionsTrack=function(R){this.config.renderTextTracksNatively?this.createNativeTrack(R):this.createNonNativeTrack(R)},m.createNativeTrack=function(R){if(!this.captionsTracks[R]){var M=this.captionsProperties,C=this.captionsTracks,b=this.media,D=M[R],O=D.label,B=D.languageCode,P=this.getExistingTrack(R);if(P)C[R]=P,(0,g.clearCurrentCues)(C[R]),(0,g.sendAddTrackEvent)(C[R],b);else{var F=this.createTextTrack("captions",O,B);F&&(F[R]=!0,C[R]=F)}}},m.createNonNativeTrack=function(R){if(!this.nonNativeCaptionsTracks[R]){var M=this.captionsProperties[R];if(!!M){var C=M.label,b={_id:R,label:C,kind:"captions",default:M.media?!!M.media.default:!1,closedCaptions:M.media};this.nonNativeCaptionsTracks[R]=b,this.hls.trigger(u.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[b]})}}},m.createTextTrack=function(R,M,C){var b=this.media;if(!!b)return b.addTextTrack(R,M,C)},m.onMediaAttaching=function(R,M){this.media=M.media,this._cleanTracks()},m.onMediaDetaching=function(){var R=this.captionsTracks;Object.keys(R).forEach(function(M){(0,g.clearCurrentCues)(R[M]),delete R[M]}),this.nonNativeCaptionsTracks={}},m.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=T(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},m._cleanTracks=function(){var R=this.media;if(!!R){var M=R.textTracks;if(M)for(var C=0;C<M.length;C++)(0,g.clearCurrentCues)(M[C])}},m.onSubtitleTracksUpdated=function(R,M){var C=this;this.textTracks=[];var b=M.subtitleTracks||[],D=b.some(function(F){return F.textCodec===d.IMSC1_CODEC});if(this.config.enableWebVTT||D&&this.config.enableIMSC1){var O=this.tracks&&b&&this.tracks.length===b.length;if(this.tracks=b||[],this.config.renderTextTracksNatively){var B=this.media?this.media.textTracks:[];this.tracks.forEach(function(F,I){var y;if(I<B.length){for(var k=null,U=0;U<B.length;U++)if(S(B[U],F)){k=B[U];break}k&&(y=k)}if(y)(0,g.clearCurrentCues)(y);else{var N=C._captionsOrSubtitlesFromCharacteristics(F);y=C.createTextTrack(N,F.name,F.lang),y&&(y.mode="disabled")}y&&(y.groupId=F.groupId,C.textTracks.push(y))})}else if(!O&&this.tracks&&this.tracks.length){var P=this.tracks.map(function(F){return{label:F.name,kind:F.type.toLowerCase(),default:F.default,subtitleTrack:F}});this.hls.trigger(u.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:P})}}},m._captionsOrSubtitlesFromCharacteristics=function(R){var M;if((M=R.attrs)!==null&&M!==void 0&&M.CHARACTERISTICS){var C=/transcribes-spoken-dialog/gi.test(R.attrs.CHARACTERISTICS),b=/describes-music-and-sound/gi.test(R.attrs.CHARACTERISTICS);if(C&&b)return"captions"}return"subtitles"},m.onManifestLoaded=function(R,M){var C=this;this.config.enableCEA708Captions&&M.captions&&M.captions.forEach(function(b){var D=/(?:CC|SERVICE)([1-4])/.exec(b.instreamId);if(!!D){var O="textTrack"+D[1],B=C.captionsProperties[O];!B||(B.label=b.name,b.lang&&(B.languageCode=b.lang),B.media=b)}})},m.closedCaptionsForLevel=function(R){var M=this.hls.levels[R.level];return M==null?void 0:M.attrs["CLOSED-CAPTIONS"]},m.onFragLoading=function(R,M){var C=this.cea608Parser1,b=this.cea608Parser2,D=this.lastSn,O=this.lastPartIndex;if(!(!this.enabled||!(C&&b))&&M.frag.type===v.PlaylistLevelType.MAIN){var B,P,F=M.frag.sn,I=(B=M==null||(P=M.part)===null||P===void 0?void 0:P.index)!=null?B:-1;F===D+1||F===D&&I===O+1||(C.reset(),b.reset()),this.lastSn=F,this.lastPartIndex=I}},m.onFragLoaded=function(R,M){var C=M.frag,b=M.payload,D=this.initPTS,O=this.unparsedVttFrags;if(C.type===v.PlaylistLevelType.SUBTITLE)if(b.byteLength){if(!(0,h.isFiniteNumber)(D[C.cc])){O.push(M),D.length&&this.hls.trigger(u.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:C,error:new Error("Missing initial subtitle PTS")});return}var B=C.decryptdata,P="stats"in M;if(B==null||B.key==null||B.method!=="AES-128"||P){var F=this.tracks[C.level],I=this.vttCCs;I[C.cc]||(I[C.cc]={start:C.start,prevCC:this.prevCC,new:!0},this.prevCC=C.cc),F&&F.textCodec===d.IMSC1_CODEC?this._parseIMSC1(C,b):this._parseVTTs(C,b,I)}}else this.hls.trigger(u.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:C,error:new Error("Empty subtitle payload")})},m._parseIMSC1=function(R,M){var C=this,b=this.hls;(0,d.parseIMSC1)(M,this.initPTS[R.cc],this.timescale[R.cc],function(D){C._appendCues(D,R.level),b.trigger(u.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:R})},function(D){A.logger.log("Failed to parse IMSC1: "+D),b.trigger(u.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:R,error:D})})},m._parseVTTs=function(R,M,C){var b,D=this,O=this.hls,B=(b=R.initSegment)!==null&&b!==void 0&&b.data?(0,p.appendUint8Array)(R.initSegment.data,new Uint8Array(M)):M;(0,_.parseWebVTT)(B,this.initPTS[R.cc],this.timescale[R.cc],C,R.cc,R.start,function(P){D._appendCues(P,R.level),O.trigger(u.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:R})},function(P){D._fallbackToIMSC1(R,M),A.logger.log("Failed to parse VTT cue: "+P),O.trigger(u.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:R,error:P})})},m._fallbackToIMSC1=function(R,M){var C=this,b=this.tracks[R.level];b.textCodec||(0,d.parseIMSC1)(M,this.initPTS[R.cc],this.timescale[R.cc],function(){b.textCodec=d.IMSC1_CODEC,C._parseIMSC1(R,M)},function(){b.textCodec="wvtt"})},m._appendCues=function(R,M){var C=this.hls;if(this.config.renderTextTracksNatively){var b=this.textTracks[M];if(!b||b.mode==="disabled")return;R.forEach(function(B){return(0,g.addCueToTrack)(b,B)})}else{var D=this.tracks[M];if(!D)return;var O=D.default?"default":"subtitles"+M;C.trigger(u.Events.CUES_PARSED,{type:"subtitles",cues:R,track:O})}},m.onFragDecrypted=function(R,M){var C=M.frag;if(C.type===v.PlaylistLevelType.SUBTITLE){if(!(0,h.isFiniteNumber)(this.initPTS[C.cc])){this.unparsedVttFrags.push(M);return}this.onFragLoaded(u.Events.FRAG_LOADED,M)}},m.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},m.onFragParsingUserdata=function(R,M){var C=this.cea608Parser1,b=this.cea608Parser2;if(!(!this.enabled||!(C&&b))){var D=M.frag,O=M.samples;if(!(D.type===v.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(D)==="NONE"))for(var B=0;B<O.length;B++){var P=O[B].bytes;if(P){var F=this.extractCea608Data(P);C.addData(O[B].pts,F[0]),b.addData(O[B].pts,F[1])}}}},m.onBufferFlushing=function(R,M){var C=M.startOffset,b=M.endOffset,D=M.endOffsetSubtitles,O=M.type,B=this.media;if(!(!B||B.currentTime<b)){if(!O||O==="video"){var P=this.captionsTracks;Object.keys(P).forEach(function(I){return(0,g.removeCuesInRange)(P[I],C,b)})}if(this.config.renderTextTracksNatively&&C===0&&D!==void 0){var F=this.textTracks;Object.keys(F).forEach(function(I){return(0,g.removeCuesInRange)(F[I],C,D)})}}},m.extractCea608Data=function(R){for(var M=[[],[]],C=R[0]&31,b=2,D=0;D<C;D++){var O=R[b++],B=127&R[b++],P=127&R[b++];if(!(B===0&&P===0)){var F=(4&O)!==0;if(F){var I=3&O;(I===0||I===1)&&(M[I].push(B),M[I].push(P))}}}return M},x}();function S(x,m){return x&&x.label===m.name&&!(x.textTrack1||x.textTrack2)}function L(x,m,w,R){return Math.min(m,R)-Math.max(x,w)}function T(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>h});var h=function(){function u(c,_){this.subtle=void 0,this.aesIV=void 0,this.subtle=c,this.aesIV=_}var f=u.prototype;return f.decrypt=function(_,g){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},g,_)},u}()},"./src/crypt/aes-decryptor.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>f,removePadding:()=>u});var h=l("./src/utils/typed-array.ts");function u(c){var _=c.byteLength,g=_&&new DataView(c.buffer).getUint8(_-1);return g?(0,h.sliceUint8)(c,0,_-g):c}var f=function(){function c(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var _=c.prototype;return _.uint8ArrayToUint32Array_=function(d){for(var p=new DataView(d),v=new Uint32Array(4),A=0;A<4;A++)v[A]=p.getUint32(A*4);return v},_.initTable=function(){var d=this.sBox,p=this.invSBox,v=this.subMix,A=v[0],E=v[1],S=v[2],L=v[3],T=this.invSubMix,x=T[0],m=T[1],w=T[2],R=T[3],M=new Uint32Array(256),C=0,b=0,D=0;for(D=0;D<256;D++)D<128?M[D]=D<<1:M[D]=D<<1^283;for(D=0;D<256;D++){var O=b^b<<1^b<<2^b<<3^b<<4;O=O>>>8^O&255^99,d[C]=O,p[O]=C;var B=M[C],P=M[B],F=M[P],I=M[O]*257^O*16843008;A[C]=I<<24|I>>>8,E[C]=I<<16|I>>>16,S[C]=I<<8|I>>>24,L[C]=I,I=F*16843009^P*65537^B*257^C*16843008,x[O]=I<<24|I>>>8,m[O]=I<<16|I>>>16,w[O]=I<<8|I>>>24,R[O]=I,C?(C=B^M[M[M[F^B]]],b^=M[M[b]]):C=b=1}},_.expandKey=function(d){for(var p=this.uint8ArrayToUint32Array_(d),v=!0,A=0;A<p.length&&v;)v=p[A]===this.key[A],A++;if(!v){this.key=p;var E=this.keySize=p.length;if(E!==4&&E!==6&&E!==8)throw new Error("Invalid aes key size="+E);var S=this.ksRows=(E+6+1)*4,L,T,x=this.keySchedule=new Uint32Array(S),m=this.invKeySchedule=new Uint32Array(S),w=this.sBox,R=this.rcon,M=this.invSubMix,C=M[0],b=M[1],D=M[2],O=M[3],B,P;for(L=0;L<S;L++){if(L<E){B=x[L]=p[L];continue}P=B,L%E===0?(P=P<<8|P>>>24,P=w[P>>>24]<<24|w[P>>>16&255]<<16|w[P>>>8&255]<<8|w[P&255],P^=R[L/E|0]<<24):E>6&&L%E===4&&(P=w[P>>>24]<<24|w[P>>>16&255]<<16|w[P>>>8&255]<<8|w[P&255]),x[L]=B=(x[L-E]^P)>>>0}for(T=0;T<S;T++)L=S-T,T&3?P=x[L]:P=x[L-4],T<4||L<=4?m[T]=P:m[T]=C[w[P>>>24]]^b[w[P>>>16&255]]^D[w[P>>>8&255]]^O[w[P&255]],m[T]=m[T]>>>0}},_.networkToHostOrderSwap=function(d){return d<<24|(d&65280)<<8|(d&16711680)>>8|d>>>24},_.decrypt=function(d,p,v){for(var A=this.keySize+6,E=this.invKeySchedule,S=this.invSBox,L=this.invSubMix,T=L[0],x=L[1],m=L[2],w=L[3],R=this.uint8ArrayToUint32Array_(v),M=R[0],C=R[1],b=R[2],D=R[3],O=new Int32Array(d),B=new Int32Array(O.length),P,F,I,y,k,U,N,W,G,z,X,K,$,q,J=this.networkToHostOrderSwap;p<O.length;){for(G=J(O[p]),z=J(O[p+1]),X=J(O[p+2]),K=J(O[p+3]),k=G^E[0],U=K^E[1],N=X^E[2],W=z^E[3],$=4,q=1;q<A;q++)P=T[k>>>24]^x[U>>16&255]^m[N>>8&255]^w[W&255]^E[$],F=T[U>>>24]^x[N>>16&255]^m[W>>8&255]^w[k&255]^E[$+1],I=T[N>>>24]^x[W>>16&255]^m[k>>8&255]^w[U&255]^E[$+2],y=T[W>>>24]^x[k>>16&255]^m[U>>8&255]^w[N&255]^E[$+3],k=P,U=F,N=I,W=y,$=$+4;P=S[k>>>24]<<24^S[U>>16&255]<<16^S[N>>8&255]<<8^S[W&255]^E[$],F=S[U>>>24]<<24^S[N>>16&255]<<16^S[W>>8&255]<<8^S[k&255]^E[$+1],I=S[N>>>24]<<24^S[W>>16&255]<<16^S[k>>8&255]<<8^S[U&255]^E[$+2],y=S[W>>>24]<<24^S[k>>16&255]<<16^S[U>>8&255]<<8^S[N&255]^E[$+3],B[p]=J(P^M),B[p+1]=J(y^C),B[p+2]=J(I^b),B[p+3]=J(F^D),M=G,C=z,b=X,D=K,p=p+4}return B.buffer},c}()},"./src/crypt/decrypter.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>p});var h=l("./src/crypt/aes-crypto.ts"),u=l("./src/crypt/fast-aes-key.ts"),f=l("./src/crypt/aes-decryptor.ts"),c=l("./src/utils/logger.ts"),_=l("./src/utils/mp4-tools.ts"),g=l("./src/utils/typed-array.ts"),d=16,p=function(){function v(E,S,L){var T=L===void 0?{}:L,x=T.removePKCS7Padding,m=x===void 0?!0:x;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=E,this.config=S,this.removePKCS7Padding=m,m)try{var w=self.crypto;w&&(this.subtle=w.subtle||w.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var A=v.prototype;return A.destroy=function(){this.observer=null},A.isSync=function(){return this.config.enableSoftwareAES},A.flush=function(){var S=this.currentResult;if(!S){this.reset();return}var L=new Uint8Array(S);return this.reset(),this.removePKCS7Padding?(0,f.removePadding)(L):L},A.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},A.decrypt=function(S,L,T,x){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(S),L,T);var m=this.flush();m&&x(m.buffer)}else this.webCryptoDecrypt(new Uint8Array(S),L,T).then(x)},A.softwareDecrypt=function(S,L,T){var x=this.currentIV,m=this.currentResult,w=this.remainderData;this.logOnce("JS AES decrypt"),w&&(S=(0,_.appendUint8Array)(w,S),this.remainderData=null);var R=this.getValidChunk(S);if(!R.length)return null;x&&(T=x);var M=this.softwareDecrypter;M||(M=this.softwareDecrypter=new f.default),M.expandKey(L);var C=m;return this.currentResult=M.decrypt(R.buffer,0,T),this.currentIV=(0,g.sliceUint8)(R,-16).buffer,C||null},A.webCryptoDecrypt=function(S,L,T){var x=this,m=this.subtle;return(this.key!==L||!this.fastAesKey)&&(this.key=L,this.fastAesKey=new u.default(m,L)),this.fastAesKey.expandKey().then(function(w){if(!m)return Promise.reject(new Error("web crypto not initialized"));var R=new h.default(m,T);return R.decrypt(S.buffer,w)}).catch(function(w){return x.onWebCryptoError(w,S,L,T)})},A.onWebCryptoError=function(S,L,T,x){return c.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",S),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(L,T,x)},A.getValidChunk=function(S){var L=S,T=S.length-S.length%d;return T!==S.length&&(L=(0,g.sliceUint8)(S,0,T),this.remainderData=(0,g.sliceUint8)(S,T)),L},A.logOnce=function(S){!this.logEnabled||(c.logger.log("[decrypter.ts]: "+S),this.logEnabled=!1)},v}()},"./src/crypt/fast-aes-key.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>h});var h=function(){function u(c,_){this.subtle=void 0,this.key=void 0,this.subtle=c,this.key=_}var f=u.prototype;return f.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},u}()},"./src/demux/aacdemuxer.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>p});var h=l("./src/demux/base-audio-demuxer.ts"),u=l("./src/demux/adts.ts"),f=l("./src/utils/logger.ts"),c=l("./src/demux/id3.ts");function _(v,A){v.prototype=Object.create(A.prototype),v.prototype.constructor=v,g(v,A)}function g(v,A){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,L){return S.__proto__=L,S},g(v,A)}var d=function(v){_(A,v);function A(S,L){var T;return T=v.call(this)||this,T.observer=void 0,T.config=void 0,T.observer=S,T.config=L,T}var E=A.prototype;return E.resetInitSegment=function(L,T,x,m){v.prototype.resetInitSegment.call(this,L,T,x,m),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:T,duration:m,inputTimeScale:9e4,dropped:0}},A.probe=function(L){if(!L)return!1;for(var T=c.getID3Data(L,0)||[],x=T.length,m=L.length;x<m;x++)if(u.probe(L,x))return f.logger.log("ADTS sync word found !"),!0;return!1},E.canParse=function(L,T){return u.canParse(L,T)},E.appendFrame=function(L,T,x){u.initTrackConfig(L,this.observer,T,x,L.manifestCodec);var m=u.appendFrame(L,T,x,this.basePTS,this.frameIndex);if(m&&m.missing===0)return m},A}(h.default);const p=d},"./src/demux/adts.ts":(a,o,l)=>{l.r(o),l.d(o,{appendFrame:()=>x,canGetFrameLength:()=>p,canParse:()=>A,getAudioConfig:()=>c,getFrameDuration:()=>L,getFullFrameLength:()=>d,getHeaderLength:()=>g,initTrackConfig:()=>S,isHeader:()=>v,isHeaderPattern:()=>_,parseFrameHeader:()=>T,probe:()=>E});var h=l("./src/utils/logger.ts"),u=l("./src/errors.ts"),f=l("./src/events.ts");function c(m,w,R,M){var C,b,D,O,B=navigator.userAgent.toLowerCase(),P=M,F=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];C=((w[R+2]&192)>>>6)+1;var I=(w[R+2]&60)>>>2;if(I>F.length-1){m.trigger(f.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+I});return}return D=(w[R+2]&1)<<2,D|=(w[R+3]&192)>>>6,h.logger.log("manifest codec:"+M+", ADTS type:"+C+", samplingIndex:"+I),/firefox/i.test(B)?I>=6?(C=5,O=new Array(4),b=I-3):(C=2,O=new Array(2),b=I):B.indexOf("android")!==-1?(C=2,O=new Array(2),b=I):(C=5,O=new Array(4),M&&(M.indexOf("mp4a.40.29")!==-1||M.indexOf("mp4a.40.5")!==-1)||!M&&I>=6?b=I-3:((M&&M.indexOf("mp4a.40.2")!==-1&&(I>=6&&D===1||/vivaldi/i.test(B))||!M&&D===1)&&(C=2,O=new Array(2)),b=I)),O[0]=C<<3,O[0]|=(I&14)>>1,O[1]|=(I&1)<<7,O[1]|=D<<3,C===5&&(O[1]|=(b&14)>>1,O[2]=(b&1)<<7,O[2]|=8,O[3]=0),{config:O,samplerate:F[I],channelCount:D,codec:"mp4a.40."+C,manifestCodec:P}}function _(m,w){return m[w]===255&&(m[w+1]&246)===240}function g(m,w){return m[w+1]&1?7:9}function d(m,w){return(m[w+3]&3)<<11|m[w+4]<<3|(m[w+5]&224)>>>5}function p(m,w){return w+5<m.length}function v(m,w){return w+1<m.length&&_(m,w)}function A(m,w){return p(m,w)&&_(m,w)&&d(m,w)<=m.length-w}function E(m,w){if(v(m,w)){var R=g(m,w);if(w+R>=m.length)return!1;var M=d(m,w);if(M<=R)return!1;var C=w+M;return C===m.length||v(m,C)}return!1}function S(m,w,R,M,C){if(!m.samplerate){var b=c(w,R,M,C);if(!b)return;m.config=b.config,m.samplerate=b.samplerate,m.channelCount=b.channelCount,m.codec=b.codec,m.manifestCodec=b.manifestCodec,h.logger.log("parsed codec:"+m.codec+", rate:"+b.samplerate+", channels:"+b.channelCount)}}function L(m){return 9216e4/m}function T(m,w){var R=g(m,w);if(w+R<=m.length){var M=d(m,w)-R;if(M>0)return{headerLength:R,frameLength:M}}}function x(m,w,R,M,C){var b=L(m.samplerate),D=M+C*b,O=T(w,R),B;if(O){var P=O.frameLength,F=O.headerLength,I=F+P,y=Math.max(0,R+I-w.length);y?(B=new Uint8Array(I-F),B.set(w.subarray(R+F,w.length),0)):B=w.subarray(R+F,R+I);var k={unit:B,pts:D};return y||m.samples.push(k),{sample:k,length:I,missing:y}}var U=w.length-R;B=new Uint8Array(U),B.set(w.subarray(R,w.length),0);var N={unit:B,pts:D};return{sample:N,length:U,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>v,initPTSFn:()=>p});var h=l("./src/polyfills/number.ts"),u=l("./src/demux/id3.ts"),f=l("./src/types/demuxer.ts"),c=l("./src/demux/dummy-demuxed-track.ts"),_=l("./src/utils/mp4-tools.ts"),g=l("./src/utils/typed-array.ts"),d=function(){function A(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var E=A.prototype;return E.resetInitSegment=function(L,T,x,m){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},E.resetTimeStamp=function(L){this.initPTS=L,this.resetContiguity()},E.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},E.canParse=function(L,T){return!1},E.appendFrame=function(L,T,x){},E.demux=function(L,T){this.cachedData&&(L=(0,_.appendUint8Array)(this.cachedData,L),this.cachedData=null);var x=u.getID3Data(L,0),m=x?x.length:0,w,R=this._audioTrack,M=this._id3Track,C=x?u.getTimeStamp(x):void 0,b=L.length;for((this.basePTS===null||this.frameIndex===0&&(0,h.isFiniteNumber)(C))&&(this.basePTS=p(C,T,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),x&&x.length>0&&M.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:x,type:f.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});m<b;){if(this.canParse(L,m)){var D=this.appendFrame(R,L,m);D?(this.frameIndex++,this.lastPTS=D.sample.pts,m+=D.length,w=m):m=b}else u.canParse(L,m)?(x=u.getID3Data(L,m),M.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:x,type:f.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),m+=x.length,w=m):m++;if(m===b&&w!==b){var O=(0,g.sliceUint8)(L,w);this.cachedData?this.cachedData=(0,_.appendUint8Array)(this.cachedData,O):this.cachedData=O}}return{audioTrack:R,videoTrack:(0,c.dummyTrack)(),id3Track:M,textTrack:(0,c.dummyTrack)()}},E.demuxSampleAes=function(L,T,x){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},E.flush=function(L){var T=this.cachedData;return T&&(this.cachedData=null,this.demux(T,0)),{audioTrack:this._audioTrack,videoTrack:(0,c.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,c.dummyTrack)()}},E.destroy=function(){},A}(),p=function(E,S,L){return(0,h.isFiniteNumber)(E)?E*90:S*9e4+(L||0)};const v=d},"./src/demux/chunk-cache.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>h});var h=function(){function f(){this.chunks=[],this.dataLength=0}var c=f.prototype;return c.push=function(g){this.chunks.push(g),this.dataLength+=g.length},c.flush=function(){var g=this.chunks,d=this.dataLength,p;if(g.length)g.length===1?p=g[0]:p=u(g,d);else return new Uint8Array(0);return this.reset(),p},c.reset=function(){this.chunks.length=0,this.dataLength=0},f}();function u(f,c){for(var _=new Uint8Array(c),g=0,d=0;d<f.length;d++){var p=f[d];_.set(p,g),g+=p.length}return _}},"./src/demux/dummy-demuxed-track.ts":(a,o,l)=>{l.r(o),l.d(o,{dummyTrack:()=>h});function h(u,f){return u===void 0&&(u=""),f===void 0&&(f=9e4),{type:u,id:-1,pid:-1,inputTimeScale:f,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>f});var h=l("./src/utils/logger.ts"),u=function(){function c(g){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=g,this.bytesAvailable=g.byteLength,this.word=0,this.bitsAvailable=0}var _=c.prototype;return _.loadWord=function(){var d=this.data,p=this.bytesAvailable,v=d.byteLength-p,A=new Uint8Array(4),E=Math.min(4,p);if(E===0)throw new Error("no bytes available");A.set(d.subarray(v,v+E)),this.word=new DataView(A.buffer).getUint32(0),this.bitsAvailable=E*8,this.bytesAvailable-=E},_.skipBits=function(d){var p;this.bitsAvailable>d?(this.word<<=d,this.bitsAvailable-=d):(d-=this.bitsAvailable,p=d>>3,d-=p>>3,this.bytesAvailable-=p,this.loadWord(),this.word<<=d,this.bitsAvailable-=d)},_.readBits=function(d){var p=Math.min(this.bitsAvailable,d),v=this.word>>>32-p;return d>32&&h.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=p,this.bitsAvailable>0?this.word<<=p:this.bytesAvailable>0&&this.loadWord(),p=d-p,p>0&&this.bitsAvailable?v<<p|this.readBits(p):v},_.skipLZ=function(){var d;for(d=0;d<this.bitsAvailable;++d)if((this.word&2147483648>>>d)!==0)return this.word<<=d,this.bitsAvailable-=d,d;return this.loadWord(),d+this.skipLZ()},_.skipUEG=function(){this.skipBits(1+this.skipLZ())},_.skipEG=function(){this.skipBits(1+this.skipLZ())},_.readUEG=function(){var d=this.skipLZ();return this.readBits(d+1)-1},_.readEG=function(){var d=this.readUEG();return 1&d?1+d>>>1:-1*(d>>>1)},_.readBoolean=function(){return this.readBits(1)===1},_.readUByte=function(){return this.readBits(8)},_.readUShort=function(){return this.readBits(16)},_.readUInt=function(){return this.readBits(32)},_.skipScalingList=function(d){for(var p=8,v=8,A,E=0;E<d;E++)v!==0&&(A=this.readEG(),v=(p+A+256)%256),p=v===0?p:v},_.readSPS=function(){var d=0,p=0,v=0,A=0,E,S,L,T=this.readUByte.bind(this),x=this.readBits.bind(this),m=this.readUEG.bind(this),w=this.readBoolean.bind(this),R=this.skipBits.bind(this),M=this.skipEG.bind(this),C=this.skipUEG.bind(this),b=this.skipScalingList.bind(this);T();var D=T();if(x(5),R(3),T(),C(),D===100||D===110||D===122||D===244||D===44||D===83||D===86||D===118||D===128){var O=m();if(O===3&&R(1),C(),C(),R(1),w())for(S=O!==3?8:12,L=0;L<S;L++)w()&&(L<6?b(16):b(64))}C();var B=m();if(B===0)m();else if(B===1)for(R(1),M(),M(),E=m(),L=0;L<E;L++)M();C(),R(1);var P=m(),F=m(),I=x(1);I===0&&R(1),R(1),w()&&(d=m(),p=m(),v=m(),A=m());var y=[1,1];if(w()&&w()){var k=T();switch(k){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:{y=[T()<<8|T(),T()<<8|T()];break}}}return{width:Math.ceil((P+1)*16-d*2-p*2),height:(2-I)*(F+1)*16-(I?2:4)*(v+A),pixelRatio:y}},_.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},c}();const f=u},"./src/demux/id3.ts":(a,o,l)=>{l.r(o),l.d(o,{canParse:()=>_,decodeFrame:()=>A,getID3Data:()=>f,getID3Frames:()=>v,getTimeStamp:()=>g,isFooter:()=>u,isHeader:()=>h,isTimeStampFrame:()=>d,testables:()=>m,utf8ArrayToStr:()=>x});var h=function(C,b){return b+10<=C.length&&C[b]===73&&C[b+1]===68&&C[b+2]===51&&C[b+3]<255&&C[b+4]<255&&C[b+6]<128&&C[b+7]<128&&C[b+8]<128&&C[b+9]<128},u=function(C,b){return b+10<=C.length&&C[b]===51&&C[b+1]===68&&C[b+2]===73&&C[b+3]<255&&C[b+4]<255&&C[b+6]<128&&C[b+7]<128&&C[b+8]<128&&C[b+9]<128},f=function(C,b){for(var D=b,O=0;h(C,b);){O+=10;var B=c(C,b+6);O+=B,u(C,b+10)&&(O+=10),b+=O}if(O>0)return C.subarray(D,D+O)},c=function(C,b){var D=0;return D=(C[b]&127)<<21,D|=(C[b+1]&127)<<14,D|=(C[b+2]&127)<<7,D|=C[b+3]&127,D},_=function(C,b){return h(C,b)&&c(C,b+6)+10<=C.length-b},g=function(C){for(var b=v(C),D=0;D<b.length;D++){var O=b[D];if(d(O))return T(O)}},d=function(C){return C&&C.key==="PRIV"&&C.info==="com.apple.streaming.transportStreamTimestamp"},p=function(C){var b=String.fromCharCode(C[0],C[1],C[2],C[3]),D=c(C,4),O=10;return{type:b,size:D,data:C.subarray(O,O+D)}},v=function(C){for(var b=0,D=[];h(C,b);){var O=c(C,b+6);b+=10;for(var B=b+O;b+8<B;){var P=p(C.subarray(b)),F=A(P);F&&D.push(F),b+=P.size+10}u(C,b)&&(b+=10)}return D},A=function(C){return C.type==="PRIV"?E(C):C.type[0]==="W"?L(C):S(C)},E=function(C){if(!(C.size<2)){var b=x(C.data,!0),D=new Uint8Array(C.data.subarray(b.length+1));return{key:C.type,info:b,data:D.buffer}}},S=function(C){if(!(C.size<2)){if(C.type==="TXXX"){var b=1,D=x(C.data.subarray(b),!0);b+=D.length+1;var O=x(C.data.subarray(b));return{key:C.type,info:D,data:O}}var B=x(C.data.subarray(1));return{key:C.type,data:B}}},L=function(C){if(C.type==="WXXX"){if(C.size<2)return;var b=1,D=x(C.data.subarray(b),!0);b+=D.length+1;var O=x(C.data.subarray(b));return{key:C.type,info:D,data:O}}var B=x(C.data);return{key:C.type,data:B}},T=function(C){if(C.data.byteLength===8){var b=new Uint8Array(C.data),D=b[3]&1,O=(b[4]<<23)+(b[5]<<15)+(b[6]<<7)+b[7];return O/=45,D&&(O+=4772185884e-2),Math.round(O)}},x=function(C,b){b===void 0&&(b=!1);var D=R();if(D){var O=D.decode(C);if(b){var B=O.indexOf("\0");return B!==-1?O.substring(0,B):O}return O.replace(/\0/g,"")}for(var P=C.length,F,I,y,k="",U=0;U<P;){if(F=C[U++],F===0&&b)return k;if(F===0||F===3)continue;switch(F>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:k+=String.fromCharCode(F);break;case 12:case 13:I=C[U++],k+=String.fromCharCode((F&31)<<6|I&63);break;case 14:I=C[U++],y=C[U++],k+=String.fromCharCode((F&15)<<12|(I&63)<<6|(y&63)<<0);break}}return k},m={decodeTextFrame:S},w;function R(){return!w&&typeof self.TextDecoder<"u"&&(w=new self.TextDecoder("utf-8")),w}},"./src/demux/mp3demuxer.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>p});var h=l("./src/demux/base-audio-demuxer.ts"),u=l("./src/demux/id3.ts"),f=l("./src/utils/logger.ts"),c=l("./src/demux/mpegaudio.ts");function _(v,A){v.prototype=Object.create(A.prototype),v.prototype.constructor=v,g(v,A)}function g(v,A){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(S,L){return S.__proto__=L,S},g(v,A)}var d=function(v){_(A,v);function A(){return v.apply(this,arguments)||this}var E=A.prototype;return E.resetInitSegment=function(L,T,x,m){v.prototype.resetInitSegment.call(this,L,T,x,m),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:T,duration:m,inputTimeScale:9e4,dropped:0}},A.probe=function(L){if(!L)return!1;for(var T=u.getID3Data(L,0)||[],x=T.length,m=L.length;x<m;x++)if(c.probe(L,x))return f.logger.log("MPEG Audio sync word found !"),!0;return!1},E.canParse=function(L,T){return c.canParse(L,T)},E.appendFrame=function(L,T,x){if(this.basePTS!==null)return c.appendFrame(L,T,x,this.basePTS,this.frameIndex)},A}(h.default);const p=d},"./src/demux/mp4demuxer.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>d});var h=l("./src/polyfills/number.ts"),u=l("./src/types/demuxer.ts"),f=l("./src/utils/mp4-tools.ts"),c=l("./src/demux/dummy-demuxed-track.ts"),_=/\/emsg[-/]ID3/i,g=function(){function p(A,E){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=E}var v=p.prototype;return v.resetTimeStamp=function(){},v.resetInitSegment=function(E,S,L,T){var x=(0,f.parseInitSegment)(E),m=this.videoTrack=(0,c.dummyTrack)("video",1),w=this.audioTrack=(0,c.dummyTrack)("audio",1),R=this.txtTrack=(0,c.dummyTrack)("text",1);if(this.id3Track=(0,c.dummyTrack)("id3",1),this.timeOffset=0,x.video){var M=x.video,C=M.id,b=M.timescale,D=M.codec;m.id=C,m.timescale=R.timescale=b,m.codec=D}if(x.audio){var O=x.audio,B=O.id,P=O.timescale,F=O.codec;w.id=B,w.timescale=P,w.codec=F}R.id=f.RemuxerTrackIdConfig.text,m.sampleDuration=0,m.duration=w.duration=T},v.resetContiguity=function(){},p.probe=function(E){return E=E.length>16384?E.subarray(0,16384):E,(0,f.findBox)(E,["moof"]).length>0},v.demux=function(E,S){this.timeOffset=S;var L=E,T=this.videoTrack,x=this.txtTrack;if(this.config.progressive){this.remainderData&&(L=(0,f.appendUint8Array)(this.remainderData,E));var m=(0,f.segmentValidRange)(L);this.remainderData=m.remainder,T.samples=m.valid||new Uint8Array}else T.samples=L;var w=this.extractID3Track(T,S);return x.samples=(0,f.parseSamples)(S,T),{videoTrack:T,audioTrack:this.audioTrack,id3Track:w,textTrack:this.txtTrack}},v.flush=function(){var E=this.timeOffset,S=this.videoTrack,L=this.txtTrack;S.samples=this.remainderData||new Uint8Array,this.remainderData=null;var T=this.extractID3Track(S,this.timeOffset);return L.samples=(0,f.parseSamples)(E,S),{videoTrack:S,audioTrack:(0,c.dummyTrack)(),id3Track:T,textTrack:(0,c.dummyTrack)()}},v.extractID3Track=function(E,S){var L=this.id3Track;if(E.samples.length){var T=(0,f.findBox)(E.samples,["emsg"]);T&&T.forEach(function(x){var m=(0,f.parseEmsg)(x);if(_.test(m.schemeIdUri)){var w=(0,h.isFiniteNumber)(m.presentationTime)?m.presentationTime/m.timeScale:S+m.presentationTimeDelta/m.timeScale,R=m.eventDuration===4294967295?Number.POSITIVE_INFINITY:m.eventDuration/m.timeScale;R<=.001&&(R=Number.POSITIVE_INFINITY);var M=m.payload;L.samples.push({data:M,len:M.byteLength,dts:w,pts:w,type:u.MetadataSchema.emsg,duration:R})}})}return L},v.demuxSampleAes=function(E,S,L){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},v.destroy=function(){},p}();const d=g},"./src/demux/mpegaudio.ts":(a,o,l)=>{l.r(o),l.d(o,{appendFrame:()=>g,canParse:()=>A,isHeader:()=>v,isHeaderPattern:()=>p,parseHeader:()=>d,probe:()=>E});var h=null,u=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],f=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],c=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],_=[0,1,1,4];function g(S,L,T,x,m){if(!(T+24>L.length)){var w=d(L,T);if(w&&T+w.frameLength<=L.length){var R=w.samplesPerFrame*9e4/w.sampleRate,M=x+m*R,C={unit:L.subarray(T,T+w.frameLength),pts:M,dts:M};return S.config=[],S.channelCount=w.channelCount,S.samplerate=w.sampleRate,S.samples.push(C),{sample:C,length:w.frameLength,missing:0}}}}function d(S,L){var T=S[L+1]>>3&3,x=S[L+1]>>1&3,m=S[L+2]>>4&15,w=S[L+2]>>2&3;if(T!==1&&m!==0&&m!==15&&w!==3){var R=S[L+2]>>1&1,M=S[L+3]>>6,C=T===3?3-x:x===3?3:4,b=u[C*14+m-1]*1e3,D=T===3?0:T===2?1:2,O=f[D*3+w],B=M===3?1:2,P=c[T][x],F=_[x],I=P*8*F,y=Math.floor(P*b/O+R)*F;if(h===null){var k=navigator.userAgent||"",U=k.match(/Chrome\/(\d+)/i);h=U?parseInt(U[1]):0}var N=!!h&&h<=87;return N&&x===2&&b>=224e3&&M===0&&(S[L+3]=S[L+3]|128),{sampleRate:O,channelCount:B,frameLength:y,samplesPerFrame:I}}}function p(S,L){return S[L]===255&&(S[L+1]&224)===224&&(S[L+1]&6)!==0}function v(S,L){return L+1<S.length&&p(S,L)}function A(S,L){var T=4;return p(S,L)&&T<=S.length-L}function E(S,L){if(L+1<S.length&&p(S,L)){var T=4,x=d(S,L),m=T;x!=null&&x.frameLength&&(m=x.frameLength);var w=L+m;return w===S.length||v(S,w)}return!1}},"./src/demux/sample-aes.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>c});var h=l("./src/crypt/decrypter.ts"),u=l("./src/utils/mp4-tools.ts"),f=function(){function _(d,p,v){this.keyData=void 0,this.decrypter=void 0,this.keyData=v,this.decrypter=new h.default(d,p,{removePKCS7Padding:!1})}var g=_.prototype;return g.decryptBuffer=function(p,v){this.decrypter.decrypt(p,this.keyData.key.buffer,this.keyData.iv.buffer,v)},g.decryptAacSample=function(p,v,A,E){var S=p[v].unit;if(!(S.length<=16)){var L=S.subarray(16,S.length-S.length%16),T=L.buffer.slice(L.byteOffset,L.byteOffset+L.length),x=this;this.decryptBuffer(T,function(m){var w=new Uint8Array(m);S.set(w,16),E||x.decryptAacSamples(p,v+1,A)})}},g.decryptAacSamples=function(p,v,A){for(;;v++){if(v>=p.length){A();return}if(!(p[v].unit.length<32)){var E=this.decrypter.isSync();if(this.decryptAacSample(p,v,A,E),!E)return}}},g.getAvcEncryptedData=function(p){for(var v=Math.floor((p.length-48)/160)*16+16,A=new Int8Array(v),E=0,S=32;S<p.length-16;S+=160,E+=16)A.set(p.subarray(S,S+16),E);return A},g.getAvcDecryptedUnit=function(p,v){for(var A=new Uint8Array(v),E=0,S=32;S<p.length-16;S+=160,E+=16)p.set(A.subarray(E,E+16),S);return p},g.decryptAvcSample=function(p,v,A,E,S,L){var T=(0,u.discardEPB)(S.data),x=this.getAvcEncryptedData(T),m=this;this.decryptBuffer(x.buffer,function(w){S.data=m.getAvcDecryptedUnit(T,w),L||m.decryptAvcSamples(p,v,A+1,E)})},g.decryptAvcSamples=function(p,v,A,E){if(p instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;v++,A=0){if(v>=p.length){E();return}for(var S=p[v].units;!(A>=S.length);A++){var L=S[A];if(!(L.data.length<=48||L.type!==1&&L.type!==5)){var T=this.decrypter.isSync();if(this.decryptAvcSample(p,v,A,E,L,T),!T)return}}}},_}();const c=f},"./src/demux/transmuxer-interface.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>v});var h=l("./src/demux/webworkify-webpack.js"),u=l("./src/events.ts"),f=l("./src/demux/transmuxer.ts"),c=l("./src/utils/logger.ts"),_=l("./src/errors.ts"),g=l("./src/utils/mediasource-helper.ts"),d=l("./node_modules/eventemitter3/index.js"),p=(0,g.getMediaSource)()||{isTypeSupported:function(){return!1}},v=function(){function A(S,L,T,x){var m=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var w=S.config;this.hls=S,this.id=L,this.useWorker=!!w.enableWorker,this.onTransmuxComplete=T,this.onFlush=x;var R=function(O,B){B=B||{},B.frag=m.frag,B.id=m.id,m.hls.trigger(O,B)};this.observer=new d.EventEmitter,this.observer.on(u.Events.FRAG_DECRYPTED,R),this.observer.on(u.Events.ERROR,R);var M={mp4:p.isTypeSupported("video/mp4"),mpeg:p.isTypeSupported("audio/mpeg"),mp3:p.isTypeSupported('audio/mp4; codecs="mp3"')},C=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){c.logger.log("demuxing in webworker");var b;try{b=this.worker=(0,h.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),b.addEventListener("message",this.onwmsg),b.onerror=function(D){m.useWorker=!1,c.logger.warn("Exception in webworker, fallback to inline"),m.hls.trigger(u.Events.ERROR,{type:_.ErrorTypes.OTHER_ERROR,details:_.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(D.message+"  ("+D.filename+":"+D.lineno+")")})},b.postMessage({cmd:"init",typeSupported:M,vendor:C,id:L,config:JSON.stringify(w)})}catch(D){c.logger.warn("Error in worker:",D),c.logger.error("Error while initializing DemuxerWorker, fallback to inline"),b&&self.URL.revokeObjectURL(b.objectURL),this.transmuxer=new f.default(this.observer,M,w,C,L),this.worker=null}}else this.transmuxer=new f.default(this.observer,M,w,C,L)}var E=A.prototype;return E.destroy=function(){var L=this.worker;if(L)L.removeEventListener("message",this.onwmsg),L.terminate(),this.worker=null,this.onwmsg=void 0;else{var T=this.transmuxer;T&&(T.destroy(),this.transmuxer=null)}var x=this.observer;x&&x.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},E.push=function(L,T,x,m,w,R,M,C,b,D){var O,B,P=this;b.transmuxing.start=self.performance.now();var F=this.transmuxer,I=this.worker,y=R?R.start:w.start,k=w.decryptdata,U=this.frag,N=!(U&&w.cc===U.cc),W=!(U&&b.level===U.level),G=U?b.sn-U.sn:-1,z=this.part?b.part-this.part.index:-1,X=G===0&&b.id>1&&b.id===(U==null?void 0:U.stats.chunkCount),K=!W&&(G===1||G===0&&(z===1||X&&z<=0)),$=self.performance.now();(W||G||w.stats.parsing.start===0)&&(w.stats.parsing.start=$),R&&(z||!K)&&(R.stats.parsing.start=$);var q=!(U&&((O=w.initSegment)===null||O===void 0?void 0:O.url)===((B=U.initSegment)===null||B===void 0?void 0:B.url)),J=new f.TransmuxState(N,K,C,W,y,q);if(!K||N||q){c.logger.log("[transmuxer-interface, "+w.type+"]: Starting new transmux session for sn: "+b.sn+" p: "+b.part+" level: "+b.level+" id: "+b.id+`
        discontinuity: `+N+`
        trackSwitch: `+W+`
        contiguous: `+K+`
        accurateTimeOffset: `+C+`
        timeOffset: `+y+`
        initSegmentChange: `+q);var Q=new f.TransmuxConfig(x,m,T,M,D);this.configureTransmuxer(Q)}if(this.frag=w,this.part=R,I)I.postMessage({cmd:"demux",data:L,decryptdata:k,chunkMeta:b,state:J},L instanceof ArrayBuffer?[L]:[]);else if(F){var rt=F.push(L,k,b,J);(0,f.isPromise)(rt)?rt.then(function(mt){P.handleTransmuxComplete(mt)}):this.handleTransmuxComplete(rt)}},E.flush=function(L){var T=this;L.transmuxing.start=self.performance.now();var x=this.transmuxer,m=this.worker;if(m)m.postMessage({cmd:"flush",chunkMeta:L});else if(x){var w=x.flush(L);(0,f.isPromise)(w)?w.then(function(R){T.handleFlushResult(R,L)}):this.handleFlushResult(w,L)}},E.handleFlushResult=function(L,T){var x=this;L.forEach(function(m){x.handleTransmuxComplete(m)}),this.onFlush(T)},E.onWorkerMessage=function(L){var T=L.data,x=this.hls;switch(T.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(T.data);break}case"flush":{this.onFlush(T.data);break}case"workerLog":c.logger[T.data.logType]&&c.logger[T.data.logType](T.data.message);break;default:{T.data=T.data||{},T.data.frag=this.frag,T.data.id=this.id,x.trigger(T.event,T.data);break}}},E.configureTransmuxer=function(L){var T=this.worker,x=this.transmuxer;T?T.postMessage({cmd:"configure",config:L}):x&&x.configure(L)},E.handleTransmuxComplete=function(L){L.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(L)},A}()},"./src/demux/transmuxer-worker.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>_});var h=l("./src/demux/transmuxer.ts"),u=l("./src/events.ts"),f=l("./src/utils/logger.ts"),c=l("./node_modules/eventemitter3/index.js");function _(A){var E=new c.EventEmitter,S=function(x,m){A.postMessage({event:x,data:m})};E.on(u.Events.FRAG_DECRYPTED,S),E.on(u.Events.ERROR,S);var L=function(){var x=function(R){var M=function(b){S("workerLog",{logType:R,message:b})};f.logger[R]=M};for(var m in f.logger)x(m)};A.addEventListener("message",function(T){var x=T.data;switch(x.cmd){case"init":{var m=JSON.parse(x.config);A.transmuxer=new h.default(E,x.typeSupported,m,x.vendor,x.id),(0,f.enableLogs)(m.debug,x.id),L(),S("init",null);break}case"configure":{A.transmuxer.configure(x.config);break}case"demux":{var w=A.transmuxer.push(x.data,x.decryptdata,x.chunkMeta,x.state);(0,h.isPromise)(w)?w.then(function(C){g(A,C)}):g(A,w);break}case"flush":{var R=x.chunkMeta,M=A.transmuxer.flush(R);(0,h.isPromise)(M)?M.then(function(C){p(A,C,R)}):p(A,M,R);break}}})}function g(A,E){if(v(E.remuxResult))return!1;var S=[],L=E.remuxResult,T=L.audio,x=L.video;return T&&d(S,T),x&&d(S,x),A.postMessage({event:"transmuxComplete",data:E},S),!0}function d(A,E){E.data1&&A.push(E.data1.buffer),E.data2&&A.push(E.data2.buffer)}function p(A,E,S){var L=E.reduce(function(T,x){return g(A,x)||T},!1);L||A.postMessage({event:"transmuxComplete",data:E[0]}),A.postMessage({event:"flush",data:S})}function v(A){return!A.audio&&!A.video&&!A.text&&!A.id3&&!A.initSegment}},"./src/demux/transmuxer.ts":(a,o,l)=>{l.r(o),l.d(o,{TransmuxConfig:()=>w,TransmuxState:()=>R,default:()=>L,isPromise:()=>m});var h=l("./src/events.ts"),u=l("./src/errors.ts"),f=l("./src/crypt/decrypter.ts"),c=l("./src/demux/aacdemuxer.ts"),_=l("./src/demux/mp4demuxer.ts"),g=l("./src/demux/tsdemuxer.ts"),d=l("./src/demux/mp3demuxer.ts"),p=l("./src/remux/mp4-remuxer.ts"),v=l("./src/remux/passthrough-remuxer.ts"),A=l("./src/utils/logger.ts"),E;try{E=self.performance.now.bind(self.performance)}catch{A.logger.debug("Unable to use Performance API on this environment"),E=self.Date.now}var S=[{demux:g.default,remux:p.default},{demux:_.default,remux:v.default},{demux:c.default,remux:p.default},{demux:d.default,remux:p.default}],L=function(){function M(b,D,O,B,P){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=b,this.typeSupported=D,this.config=O,this.vendor=B,this.id=P}var C=M.prototype;return C.configure=function(D){this.transmuxConfig=D,this.decrypter&&this.decrypter.reset()},C.push=function(D,O,B,P){var F=this,I=B.transmuxing;I.executeStart=E();var y=new Uint8Array(D),k=this.config,U=this.currentTransmuxState,N=this.transmuxConfig;P&&(this.currentTransmuxState=P);var W=P||U,G=W.contiguous,z=W.discontinuity,X=W.trackSwitch,K=W.accurateTimeOffset,$=W.timeOffset,q=W.initSegmentChange,J=N.audioCodec,Q=N.videoCodec,rt=N.defaultInitPts,mt=N.duration,vt=N.initSegmentData;(z||X||q)&&this.resetInitSegment(vt,J,Q,mt),(z||q)&&this.resetInitialTimestamp(rt),G||this.resetContiguity();var _t=T(y,O);if(_t&&_t.method==="AES-128"){var tt=this.getDecrypter();if(k.enableSoftwareAES){var Lt=tt.softwareDecrypt(y,_t.key.buffer,_t.iv.buffer);if(!Lt)return I.executeEnd=E(),x(B);y=new Uint8Array(Lt)}else return this.decryptionPromise=tt.webCryptoDecrypt(y,_t.key.buffer,_t.iv.buffer).then(function(Ht){var Y=F.push(Ht,null,B);return F.decryptionPromise=null,Y}),this.decryptionPromise}this.needsProbing(y,z,X)&&this.configureTransmuxer(y,N);var dt=this.transmux(y,_t,$,K,B),Tt=this.currentTransmuxState;return Tt.contiguous=!0,Tt.discontinuity=!1,Tt.trackSwitch=!1,I.executeEnd=E(),dt},C.flush=function(D){var O=this,B=D.transmuxing;B.executeStart=E();var P=this.decrypter,F=this.currentTransmuxState,I=this.decryptionPromise;if(I)return I.then(function(){return O.flush(D)});var y=[],k=F.timeOffset;if(P){var U=P.flush();U&&y.push(this.push(U,null,D))}var N=this.demuxer,W=this.remuxer;if(!N||!W)return this.observer.emit(h.Events.ERROR,h.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),B.executeEnd=E(),[x(D)];var G=N.flush(k);return m(G)?G.then(function(z){return O.flushRemux(y,z,D),y}):(this.flushRemux(y,G,D),y)},C.flushRemux=function(D,O,B){var P=O.audioTrack,F=O.videoTrack,I=O.id3Track,y=O.textTrack,k=this.currentTransmuxState,U=k.accurateTimeOffset,N=k.timeOffset;A.logger.log("[transmuxer.ts]: Flushed fragment "+B.sn+(B.part>-1?" p: "+B.part:"")+" of level "+B.level);var W=this.remuxer.remux(P,F,I,y,N,U,!0,this.id);D.push({remuxResult:W,chunkMeta:B}),B.transmuxing.executeEnd=E()},C.resetInitialTimestamp=function(D){var O=this.demuxer,B=this.remuxer;!O||!B||(O.resetTimeStamp(D),B.resetTimeStamp(D))},C.resetContiguity=function(){var D=this.demuxer,O=this.remuxer;!D||!O||(D.resetContiguity(),O.resetNextTimestamp())},C.resetInitSegment=function(D,O,B,P){var F=this.demuxer,I=this.remuxer;!F||!I||(F.resetInitSegment(D,O,B,P),I.resetInitSegment(D,O,B))},C.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},C.transmux=function(D,O,B,P,F){var I;return O&&O.method==="SAMPLE-AES"?I=this.transmuxSampleAes(D,O,B,P,F):I=this.transmuxUnencrypted(D,B,P,F),I},C.transmuxUnencrypted=function(D,O,B,P){var F=this.demuxer.demux(D,O,!1,!this.config.progressive),I=F.audioTrack,y=F.videoTrack,k=F.id3Track,U=F.textTrack,N=this.remuxer.remux(I,y,k,U,O,B,!1,this.id);return{remuxResult:N,chunkMeta:P}},C.transmuxSampleAes=function(D,O,B,P,F){var I=this;return this.demuxer.demuxSampleAes(D,O,B).then(function(y){var k=I.remuxer.remux(y.audioTrack,y.videoTrack,y.id3Track,y.textTrack,B,P,!1,I.id);return{remuxResult:k,chunkMeta:F}})},C.configureTransmuxer=function(D,O){for(var B=this.config,P=this.observer,F=this.typeSupported,I=this.vendor,y=O.audioCodec,k=O.defaultInitPts,U=O.duration,N=O.initSegmentData,W=O.videoCodec,G,z=0,X=S.length;z<X;z++)if(S[z].demux.probe(D)){G=S[z];break}G||(A.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),G={demux:_.default,remux:v.default});var K=this.demuxer,$=this.remuxer,q=G.remux,J=G.demux;(!$||!($ instanceof q))&&(this.remuxer=new q(P,B,F,I)),(!K||!(K instanceof J))&&(this.demuxer=new J(P,B,F),this.probe=J.probe),this.resetInitSegment(N,y,W,U),this.resetInitialTimestamp(k)},C.needsProbing=function(D,O,B){return!this.demuxer||!this.remuxer||O||B},C.getDecrypter=function(){var D=this.decrypter;return D||(D=this.decrypter=new f.default(this.observer,this.config)),D},M}();function T(M,C){var b=null;return M.byteLength>0&&C!=null&&C.key!=null&&C.iv!==null&&C.method!=null&&(b=C),b}var x=function(C){return{remuxResult:{},chunkMeta:C}};function m(M){return"then"in M&&M.then instanceof Function}var w=function(C,b,D,O,B){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=C,this.videoCodec=b,this.initSegmentData=D,this.duration=O,this.defaultInitPts=B},R=function(C,b,D,O,B,P){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=C,this.contiguous=b,this.accurateTimeOffset=D,this.trackSwitch=O,this.timeOffset=B,this.initSegmentChange=P}},"./src/demux/tsdemuxer.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>R});var h=l("./src/demux/adts.ts"),u=l("./src/demux/mpegaudio.ts"),f=l("./src/demux/exp-golomb.ts"),c=l("./src/demux/sample-aes.ts"),_=l("./src/events.ts"),g=l("./src/utils/mp4-tools.ts"),d=l("./src/utils/logger.ts"),p=l("./src/errors.ts"),v=l("./src/types/demuxer.ts");function A(){return A=Object.assign?Object.assign.bind():function(M){for(var C=1;C<arguments.length;C++){var b=arguments[C];for(var D in b)Object.prototype.hasOwnProperty.call(b,D)&&(M[D]=b[D])}return M},A.apply(this,arguments)}var E=188,S=function(){function M(b,D,O){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=b,this.config=D,this.typeSupported=O}M.probe=function(D){var O=M.syncOffset(D);return O>0&&d.logger.warn("MPEG2-TS detected but first sync word found @ offset "+O),O!==-1},M.syncOffset=function(D){for(var O=Math.min(E*5,D.length-E*2)+1,B=0;B<O;){if(D[B]===71&&D[B+E]===71)return B;B++}return-1},M.createTrack=function(D,O){return{container:D==="video"||D==="audio"?"video/mp2t":void 0,type:D,id:g.RemuxerTrackIdConfig[D],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:D==="audio"?O:void 0}};var C=M.prototype;return C.resetInitSegment=function(D,O,B,P){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=M.createTrack("video"),this._audioTrack=M.createTrack("audio",P),this._id3Track=M.createTrack("id3"),this._txtTrack=M.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=O,this.videoCodec=B,this._duration=P},C.resetTimeStamp=function(){},C.resetContiguity=function(){var D=this._audioTrack,O=this._avcTrack,B=this._id3Track;D&&(D.pesData=null),O&&(O.pesData=null),B&&(B.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},C.demux=function(D,O,B,P){B===void 0&&(B=!1),P===void 0&&(P=!1),B||(this.sampleAes=null);var F,I=this._avcTrack,y=this._audioTrack,k=this._id3Track,U=this._txtTrack,N=I.pid,W=I.pesData,G=y.pid,z=k.pid,X=y.pesData,K=k.pesData,$=null,q=this.pmtParsed,J=this._pmtId,Q=D.length;if(this.remainderData&&(D=(0,g.appendUint8Array)(this.remainderData,D),Q=D.length,this.remainderData=null),Q<E&&!P)return this.remainderData=D,{audioTrack:y,videoTrack:I,id3Track:k,textTrack:U};var rt=Math.max(0,M.syncOffset(D));Q-=(Q-rt)%E,Q<D.byteLength&&!P&&(this.remainderData=new Uint8Array(D.buffer,Q,D.buffer.byteLength-Q));for(var mt=0,vt=rt;vt<Q;vt+=E)if(D[vt]===71){var _t=!!(D[vt+1]&64),tt=((D[vt+1]&31)<<8)+D[vt+2],Lt=(D[vt+3]&48)>>4,dt=void 0;if(Lt>1){if(dt=vt+5+D[vt+4],dt===vt+E)continue}else dt=vt+4;switch(tt){case N:_t&&(W&&(F=m(W))&&this.parseAVCPES(I,U,F,!1),W={data:[],size:0}),W&&(W.data.push(D.subarray(dt,vt+E)),W.size+=vt+E-dt);break;case G:if(_t){if(X&&(F=m(X)))switch(y.segmentCodec){case"aac":this.parseAACPES(y,F);break;case"mp3":this.parseMPEGPES(y,F);break}X={data:[],size:0}}X&&(X.data.push(D.subarray(dt,vt+E)),X.size+=vt+E-dt);break;case z:_t&&(K&&(F=m(K))&&this.parseID3PES(k,F),K={data:[],size:0}),K&&(K.data.push(D.subarray(dt,vt+E)),K.size+=vt+E-dt);break;case 0:_t&&(dt+=D[dt]+1),J=this._pmtId=T(D,dt);break;case J:{_t&&(dt+=D[dt]+1);var Tt=x(D,dt,this.typeSupported,B);N=Tt.avc,N>0&&(I.pid=N),G=Tt.audio,G>0&&(y.pid=G,y.segmentCodec=Tt.segmentCodec),z=Tt.id3,z>0&&(k.pid=z),$!==null&&!q&&(d.logger.log("unknown PID '"+$+"' in TS found"),$=null,vt=rt-188),q=this.pmtParsed=!0;break}case 17:case 8191:break;default:$=tt;break}}else mt++;mt>0&&this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+mt+" TS packet/s that do not start with 0x47"}),I.pesData=W,y.pesData=X,k.pesData=K;var Ht={audioTrack:y,videoTrack:I,id3Track:k,textTrack:U};return P&&this.extractRemainingSamples(Ht),Ht},C.flush=function(){var D=this.remainderData;this.remainderData=null;var O;return D?O=this.demux(D,-1,!1,!0):O={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(O),this.sampleAes?this.decrypt(O,this.sampleAes):O},C.extractRemainingSamples=function(D){var O=D.audioTrack,B=D.videoTrack,P=D.id3Track,F=D.textTrack,I=B.pesData,y=O.pesData,k=P.pesData,U;if(I&&(U=m(I))?(this.parseAVCPES(B,F,U,!0),B.pesData=null):B.pesData=I,y&&(U=m(y))){switch(O.segmentCodec){case"aac":this.parseAACPES(O,U);break;case"mp3":this.parseMPEGPES(O,U);break}O.pesData=null}else y!=null&&y.size&&d.logger.log("last AAC PES packet truncated,might overlap between fragments"),O.pesData=y;k&&(U=m(k))?(this.parseID3PES(P,U),P.pesData=null):P.pesData=k},C.demuxSampleAes=function(D,O,B){var P=this.demux(D,B,!0,!this.config.progressive),F=this.sampleAes=new c.default(this.observer,this.config,O);return this.decrypt(P,F)},C.decrypt=function(D,O){return new Promise(function(B){var P=D.audioTrack,F=D.videoTrack;P.samples&&P.segmentCodec==="aac"?O.decryptAacSamples(P.samples,0,function(){F.samples?O.decryptAvcSamples(F.samples,0,0,function(){B(D)}):B(D)}):F.samples&&O.decryptAvcSamples(F.samples,0,0,function(){B(D)})})},C.destroy=function(){this._duration=0},C.parseAVCPES=function(D,O,B,P){var F=this,I=this.parseAVCNALu(D,B.data),y=this.avcSample,k,U=!1;B.data=null,y&&I.length&&!D.audFound&&(w(y,D),y=this.avcSample=L(!1,B.pts,B.dts,"")),I.forEach(function(N){switch(N.type){case 1:{k=!0,y||(y=F.avcSample=L(!0,B.pts,B.dts,"")),y.frame=!0;var W=N.data;if(U&&W.length>4){var G=new f.default(W).readSliceType();(G===2||G===4||G===7||G===9)&&(y.key=!0)}break}case 5:k=!0,y||(y=F.avcSample=L(!0,B.pts,B.dts,"")),y.key=!0,y.frame=!0;break;case 6:{k=!0,(0,g.parseSEIMessageFromNALu)(N.data,1,B.pts,O.samples);break}case 7:if(k=!0,U=!0,!D.sps){var z=new f.default(N.data),X=z.readSPS();D.width=X.width,D.height=X.height,D.pixelRatio=X.pixelRatio,D.sps=[N.data],D.duration=F._duration;for(var K=N.data.subarray(1,4),$="avc1.",q=0;q<3;q++){var J=K[q].toString(16);J.length<2&&(J="0"+J),$+=J}D.codec=$}break;case 8:k=!0,D.pps||(D.pps=[N.data]);break;case 9:k=!1,D.audFound=!0,y&&w(y,D),y=F.avcSample=L(!1,B.pts,B.dts,"");break;case 12:k=!0;break;default:k=!1,y&&(y.debug+="unknown NAL "+N.type+" ");break}if(y&&k){var Q=y.units;Q.push(N)}}),P&&y&&(w(y,D),this.avcSample=null)},C.getLastNalUnit=function(D){var O,B=this.avcSample,P;if((!B||B.units.length===0)&&(B=D[D.length-1]),(O=B)!==null&&O!==void 0&&O.units){var F=B.units;P=F[F.length-1]}return P},C.parseAVCNALu=function(D,O){var B=O.byteLength,P=D.naluState||0,F=P,I=[],y=0,k,U,N,W=-1,G=0;for(P===-1&&(W=0,G=O[0]&31,P=0,y=1);y<B;){if(k=O[y++],!P){P=k?0:1;continue}if(P===1){P=k?0:2;continue}if(!k)P=3;else if(k===1){if(W>=0){var z={data:O.subarray(W,y-P-1),type:G};I.push(z)}else{var X=this.getLastNalUnit(D.samples);if(X&&(F&&y<=4-F&&X.state&&(X.data=X.data.subarray(0,X.data.byteLength-F)),U=y-P-1,U>0)){var K=new Uint8Array(X.data.byteLength+U);K.set(X.data,0),K.set(O.subarray(0,U),X.data.byteLength),X.data=K,X.state=0}}y<B?(N=O[y]&31,W=y,G=N,P=0):P=-1}else P=0}if(W>=0&&P>=0){var $={data:O.subarray(W,B),type:G,state:P};I.push($)}if(I.length===0){var q=this.getLastNalUnit(D.samples);if(q){var J=new Uint8Array(q.data.byteLength+O.byteLength);J.set(q.data,0),J.set(O,q.data.byteLength),q.data=J}}return D.naluState=P,I},C.parseAACPES=function(D,O){var B=0,P=this.aacOverFlow,F=O.data;if(P){this.aacOverFlow=null;var I=P.missing,y=P.sample.unit.byteLength;if(I===-1){var k=new Uint8Array(y+F.byteLength);k.set(P.sample.unit,0),k.set(F,y),F=k}else{var U=y-I;P.sample.unit.set(F.subarray(0,I),U),D.samples.push(P.sample),B=P.missing}}var N,W;for(N=B,W=F.length;N<W-1&&!h.isHeader(F,N);N++);if(N!==B){var G,z;if(N<W-1?(G="AAC PES did not start with ADTS header,offset:"+N,z=!1):(G="no ADTS header found in AAC PES",z=!0),d.logger.warn("parsing error:"+G),this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:p.ErrorTypes.MEDIA_ERROR,details:p.ErrorDetails.FRAG_PARSING_ERROR,fatal:z,reason:G}),z)return}h.initTrackConfig(D,this.observer,F,N,this.audioCodec);var X;if(O.pts!==void 0)X=O.pts;else if(P){var K=h.getFrameDuration(D.samplerate);X=P.sample.pts+K}else{d.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var $=0,q;N<W;)if(q=h.appendFrame(D,F,N,X,$),N+=q.length,q.missing){this.aacOverFlow=q;break}else for($++;N<W-1&&!h.isHeader(F,N);N++);},C.parseMPEGPES=function(D,O){var B=O.data,P=B.length,F=0,I=0,y=O.pts;if(y===void 0){d.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;I<P;)if(u.isHeader(B,I)){var k=u.appendFrame(D,B,I,y,F);if(k)I+=k.length,F++;else break}else I++},C.parseID3PES=function(D,O){if(O.pts===void 0){d.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var B=A({},O,{type:this._avcTrack?v.MetadataSchema.emsg:v.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});D.samples.push(B)},M}();function L(M,C,b,D){return{key:M,frame:!1,pts:C,dts:b,units:[],debug:D,length:0}}function T(M,C){return(M[C+10]&31)<<8|M[C+11]}function x(M,C,b,D){var O={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},B=(M[C+1]&15)<<8|M[C+2],P=C+3+B-4,F=(M[C+10]&15)<<8|M[C+11];for(C+=12+F;C<P;){var I=(M[C+1]&31)<<8|M[C+2];switch(M[C]){case 207:if(!D){d.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:O.audio===-1&&(O.audio=I);break;case 21:O.id3===-1&&(O.id3=I);break;case 219:if(!D){d.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:O.avc===-1&&(O.avc=I);break;case 3:case 4:b.mpeg!==!0&&b.mp3!==!0?d.logger.log("MPEG audio found, not supported in this browser"):O.audio===-1&&(O.audio=I,O.segmentCodec="mp3");break;case 36:d.logger.warn("Unsupported HEVC stream type found");break}C+=((M[C+3]&15)<<8|M[C+4])+5}return O}function m(M){var C=0,b,D,O,B,P,F=M.data;if(!M||M.size===0)return null;for(;F[0].length<19&&F.length>1;){var I=new Uint8Array(F[0].length+F[1].length);I.set(F[0]),I.set(F[1],F[0].length),F[0]=I,F.splice(1,1)}b=F[0];var y=(b[0]<<16)+(b[1]<<8)+b[2];if(y===1){if(D=(b[4]<<8)+b[5],D&&D>M.size-6)return null;var k=b[7];k&192&&(B=(b[9]&14)*536870912+(b[10]&255)*4194304+(b[11]&254)*16384+(b[12]&255)*128+(b[13]&254)/2,k&64?(P=(b[14]&14)*536870912+(b[15]&255)*4194304+(b[16]&254)*16384+(b[17]&255)*128+(b[18]&254)/2,B-P>54e5&&(d.logger.warn(Math.round((B-P)/9e4)+"s delta between PTS and DTS, align them"),B=P)):P=B),O=b[8];var U=O+9;if(M.size<=U)return null;M.size-=U;for(var N=new Uint8Array(M.size),W=0,G=F.length;W<G;W++){b=F[W];var z=b.byteLength;if(U)if(U>z){U-=z;continue}else b=b.subarray(U),z-=U,U=0;N.set(b,C),C+=z}return D&&(D-=O+3),{data:N,pts:B,dts:P,len:D}}return null}function w(M,C){if(M.units.length&&M.frame){if(M.pts===void 0){var b=C.samples,D=b.length;if(D){var O=b[D-1];M.pts=O.pts,M.dts=O.dts}else{C.dropped++;return}}C.samples.push(M)}M.debug.length&&d.logger.log(M.pts+"/"+M.dts+":"+M.debug)}const R=S},"./src/demux/webworkify-webpack.js":(a,o,l)=>{l.r(o),l.d(o,{default:()=>A});var h=function(){var S=ENTRY_MODULE,L={};function T(m){var w=L[m];if(w!==void 0)return w.exports;var R=L[m]={exports:{}};return S[m].call(R.exports,R,R.exports,T),R.exports}T.m=S,function(){T.n=function(m){var w=m&&m.__esModule?function(){return m.default}:function(){return m};return T.d(w,{a:w}),w}}(),function(){T.d=function(m,w){for(var R in w)T.o(w,R)&&!T.o(m,R)&&Object.defineProperty(m,R,{enumerable:!0,get:w[R]})}}(),function(){T.o=function(m,w){return Object.prototype.hasOwnProperty.call(m,w)}}(),function(){T.r=function(m){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(m,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(m,"__esModule",{value:!0})}}();var x=T(ENTRY_MODULE);return x.default||x};h.toString();var u="[\\.|\\-|\\+|\\w|/|@]+",f="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+u+").*?\\)";function c(E){return(E+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function _(E){return!isNaN(1*E)}function g(E,S,L){var T={};T[L]=[];var x=S.toString(),m=x.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||x.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!m)return T;for(var w=m[1],R=new RegExp("(\\\\n|\\W)"+c(w)+f,"g"),M;M=R.exec(x);)M[3]!=="dll-reference"&&T[L].push(M[3]);for(R=new RegExp("\\("+c(w)+'\\("(dll-reference\\s('+u+'))"\\)\\)'+f,"g");M=R.exec(x);)E[M[2]]||(T[L].push(M[1]),E[M[2]]=l(M[1]).m),T[M[2]]=T[M[2]]||[],T[M[2]].push(M[4]);for(var C=Object.keys(T),b=0;b<C.length;b++)for(var D=0;D<T[C[b]].length;D++)_(T[C[b]][D])&&(T[C[b]][D]=1*T[C[b]][D]);return T}function d(E){var S=Object.keys(E);return S.reduce(function(L,T){return L||E[T].length>0},!1)}function p(E,S){for(var L={main:[S]},T={main:[]},x={main:{}};d(L);)for(var m=Object.keys(L),w=0;w<m.length;w++){var R=m[w],M=L[R],C=M.pop();if(x[R]=x[R]||{},!(x[R][C]||!E[R][C])){x[R][C]=!0,T[R]=T[R]||[],T[R].push(C);for(var b=g(E,E[R][C],R),D=Object.keys(b),O=0;O<D.length;O++)L[D[O]]=L[D[O]]||[],L[D[O]]=L[D[O]].concat(b[D[O]])}}return T}function v(E,S,L,T){var x=E[T].map(function(w){return'"'+w+'": '+S[T][w].toString()}).join(","),m=h.toString().split("ENTRY_MODULE");return m[0]+"{"+x+"}"+m[1]+'"'+L+'"'+m[2]}function A(E,S){S=S||{};var L={main:l.m},T=S.all?{main:Object.keys(L.main)}:p(L,E),x="";Object.keys(T).filter(function(C){return C!=="main"}).forEach(function(C){for(var b=0;T[C][b];)b++;T[C].push(b),L[C][b]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",x=x+("var "+C+" = ("+v(T,L,b,modules)+`)();
`)}),x=x+("(("+v(T,L,E,"main")+")())(self);");var m=new window.Blob([x],{type:"text/javascript"}),w=window.URL||window.webkitURL||window.mozURL||window.msURL,R=w.createObjectURL(m),M=new window.Worker(R);return M.objectURL=R,M}},"./src/errors.ts":(a,o,l)=>{l.r(o),l.d(o,{ErrorDetails:()=>u,ErrorTypes:()=>h});var h;(function(f){f.NETWORK_ERROR="networkError",f.MEDIA_ERROR="mediaError",f.KEY_SYSTEM_ERROR="keySystemError",f.MUX_ERROR="muxError",f.OTHER_ERROR="otherError"})(h||(h={}));var u;(function(f){f.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",f.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",f.KEY_SYSTEM_NO_SESSION="keySystemNoSession",f.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",f.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",f.MANIFEST_LOAD_ERROR="manifestLoadError",f.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",f.MANIFEST_PARSING_ERROR="manifestParsingError",f.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",f.LEVEL_EMPTY_ERROR="levelEmptyError",f.LEVEL_LOAD_ERROR="levelLoadError",f.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",f.LEVEL_SWITCH_ERROR="levelSwitchError",f.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",f.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",f.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",f.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",f.FRAG_LOAD_ERROR="fragLoadError",f.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",f.FRAG_DECRYPT_ERROR="fragDecryptError",f.FRAG_PARSING_ERROR="fragParsingError",f.REMUX_ALLOC_ERROR="remuxAllocError",f.KEY_LOAD_ERROR="keyLoadError",f.KEY_LOAD_TIMEOUT="keyLoadTimeOut",f.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",f.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",f.BUFFER_APPEND_ERROR="bufferAppendError",f.BUFFER_APPENDING_ERROR="bufferAppendingError",f.BUFFER_STALLED_ERROR="bufferStalledError",f.BUFFER_FULL_ERROR="bufferFullError",f.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",f.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",f.INTERNAL_EXCEPTION="internalException",f.INTERNAL_ABORTED="aborted",f.UNKNOWN="unknown"})(u||(u={}))},"./src/events.ts":(a,o,l)=>{l.r(o),l.d(o,{Events:()=>h});var h;(function(u){u.MEDIA_ATTACHING="hlsMediaAttaching",u.MEDIA_ATTACHED="hlsMediaAttached",u.MEDIA_DETACHING="hlsMediaDetaching",u.MEDIA_DETACHED="hlsMediaDetached",u.BUFFER_RESET="hlsBufferReset",u.BUFFER_CODECS="hlsBufferCodecs",u.BUFFER_CREATED="hlsBufferCreated",u.BUFFER_APPENDING="hlsBufferAppending",u.BUFFER_APPENDED="hlsBufferAppended",u.BUFFER_EOS="hlsBufferEos",u.BUFFER_FLUSHING="hlsBufferFlushing",u.BUFFER_FLUSHED="hlsBufferFlushed",u.MANIFEST_LOADING="hlsManifestLoading",u.MANIFEST_LOADED="hlsManifestLoaded",u.MANIFEST_PARSED="hlsManifestParsed",u.LEVEL_SWITCHING="hlsLevelSwitching",u.LEVEL_SWITCHED="hlsLevelSwitched",u.LEVEL_LOADING="hlsLevelLoading",u.LEVEL_LOADED="hlsLevelLoaded",u.LEVEL_UPDATED="hlsLevelUpdated",u.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",u.LEVELS_UPDATED="hlsLevelsUpdated",u.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",u.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",u.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",u.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",u.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",u.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",u.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",u.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",u.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",u.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",u.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",u.CUES_PARSED="hlsCuesParsed",u.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",u.INIT_PTS_FOUND="hlsInitPtsFound",u.FRAG_LOADING="hlsFragLoading",u.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",u.FRAG_LOADED="hlsFragLoaded",u.FRAG_DECRYPTED="hlsFragDecrypted",u.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",u.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",u.FRAG_PARSING_METADATA="hlsFragParsingMetadata",u.FRAG_PARSED="hlsFragParsed",u.FRAG_BUFFERED="hlsFragBuffered",u.FRAG_CHANGED="hlsFragChanged",u.FPS_DROP="hlsFpsDrop",u.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",u.ERROR="hlsError",u.DESTROYING="hlsDestroying",u.KEY_LOADING="hlsKeyLoading",u.KEY_LOADED="hlsKeyLoaded",u.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",u.BACK_BUFFER_REACHED="hlsBackBufferReached"})(h||(h={}))},"./src/hls.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>w});var h=l("./node_modules/url-toolkit/src/url-toolkit.js"),u=l("./src/loader/playlist-loader.ts"),f=l("./src/loader/key-loader.ts"),c=l("./src/controller/id3-track-controller.ts"),_=l("./src/controller/latency-controller.ts"),g=l("./src/controller/level-controller.ts"),d=l("./src/controller/fragment-tracker.ts"),p=l("./src/controller/stream-controller.ts"),v=l("./src/is-supported.ts"),A=l("./src/utils/logger.ts"),E=l("./src/config.ts"),S=l("./node_modules/eventemitter3/index.js"),L=l("./src/events.ts"),T=l("./src/errors.ts");function x(R,M){for(var C=0;C<M.length;C++){var b=M[C];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(R,b.key,b)}}function m(R,M,C){return M&&x(R.prototype,M),C&&x(R,C),Object.defineProperty(R,"prototype",{writable:!1}),R}var w=function(){R.isSupported=function(){return(0,v.isSupported)()};function R(C){C===void 0&&(C={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new S.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var b=this.config=(0,E.mergeConfig)(R.DefaultConfig,C);this.userConfig=C,(0,A.enableLogs)(b.debug,"Hls instance"),this._autoLevelCapping=-1,b.progressive&&(0,E.enableStreamingMode)(b);var D=b.abrController,O=b.bufferController,B=b.capLevelController,P=b.fpsController,F=this.abrController=new D(this),I=this.bufferController=new O(this),y=this.capLevelController=new B(this),k=new P(this),U=new u.default(this),N=new f.default(this),W=new c.default(this),G=this.levelController=new g.default(this),z=new d.FragmentTracker(this),X=this.streamController=new p.default(this,z);y.setStreamController(X),k.setStreamController(X);var K=[U,N,G,X];this.networkControllers=K;var $=[F,I,y,k,W,z];this.audioTrackController=this.createController(b.audioTrackController,null,K),this.createController(b.audioStreamController,z,K),this.subtitleTrackController=this.createController(b.subtitleTrackController,null,K),this.createController(b.subtitleStreamController,z,K),this.createController(b.timelineController,null,$),this.emeController=this.createController(b.emeController,null,$),this.cmcdController=this.createController(b.cmcdController,null,$),this.latencyController=this.createController(_.default,null,$),this.coreComponents=$}var M=R.prototype;return M.createController=function(b,D,O){if(b){var B=D?new b(this,D):new b(this);return O&&O.push(B),B}return null},M.on=function(b,D,O){O===void 0&&(O=this),this._emitter.on(b,D,O)},M.once=function(b,D,O){O===void 0&&(O=this),this._emitter.once(b,D,O)},M.removeAllListeners=function(b){this._emitter.removeAllListeners(b)},M.off=function(b,D,O,B){O===void 0&&(O=this),this._emitter.off(b,D,O,B)},M.listeners=function(b){return this._emitter.listeners(b)},M.emit=function(b,D,O){return this._emitter.emit(b,D,O)},M.trigger=function(b,D){if(this.config.debug)return this.emit(b,b,D);try{return this.emit(b,b,D)}catch(O){A.logger.error("An internal error happened while handling event "+b+'. Error message: "'+O.message+'". Here is a stacktrace:',O),this.trigger(L.Events.ERROR,{type:T.ErrorTypes.OTHER_ERROR,details:T.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:b,error:O})}return!1},M.listenerCount=function(b){return this._emitter.listenerCount(b)},M.destroy=function(){A.logger.log("destroy"),this.trigger(L.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(b){return b.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(b){return b.destroy()}),this.coreComponents.length=0},M.attachMedia=function(b){A.logger.log("attachMedia"),this._media=b,this.trigger(L.Events.MEDIA_ATTACHING,{media:b})},M.detachMedia=function(){A.logger.log("detachMedia"),this.trigger(L.Events.MEDIA_DETACHING,void 0),this._media=null},M.loadSource=function(b){this.stopLoad();var D=this.media,O=this.url,B=this.url=h.buildAbsoluteURL(self.location.href,b,{alwaysNormalize:!0});A.logger.log("loadSource:"+B),D&&O&&O!==B&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(D)),this.trigger(L.Events.MANIFEST_LOADING,{url:b})},M.startLoad=function(b){b===void 0&&(b=-1),A.logger.log("startLoad("+b+")"),this.networkControllers.forEach(function(D){D.startLoad(b)})},M.stopLoad=function(){A.logger.log("stopLoad"),this.networkControllers.forEach(function(b){b.stopLoad()})},M.swapAudioCodec=function(){A.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},M.recoverMediaError=function(){A.logger.log("recoverMediaError");var b=this._media;this.detachMedia(),b&&this.attachMedia(b)},M.removeLevel=function(b,D){D===void 0&&(D=0),this.levelController.removeLevel(b,D)},m(R,[{key:"levels",get:function(){var b=this.levelController.levels;return b||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(b){A.logger.log("set currentLevel:"+b),this.loadLevel=b,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(b){A.logger.log("set nextLevel:"+b),this.levelController.manualLevel=b,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(b){A.logger.log("set loadLevel:"+b),this.levelController.manualLevel=b}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(b){this.levelController.nextLoadLevel=b}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(b){A.logger.log("set firstLevel:"+b),this.levelController.firstLevel=b}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(b){A.logger.log("set startLevel:"+b),b!==-1&&(b=Math.max(b,this.minAutoLevel)),this.levelController.startLevel=b}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(b){var D=!!b;D!==this.config.capLevelToPlayerSize&&(D?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=D)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(b){this._autoLevelCapping!==b&&(A.logger.log("set autoLevelCapping:"+b),this._autoLevelCapping=b)}},{key:"bandwidthEstimate",get:function(){var b=this.abrController.bwEstimator;return b?b.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var b=this.levels,D=this.config.minAutoBitrate;if(!b)return 0;for(var O=b.length,B=0;B<O;B++)if(b[B].maxBitrate>=D)return B;return 0}},{key:"maxAutoLevel",get:function(){var b=this.levels,D=this.autoLevelCapping,O;return D===-1&&b&&b.length?O=b.length-1:O=D,O}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(b){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,b)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var b=this.audioTrackController;return b?b.audioTracks:[]}},{key:"audioTrack",get:function(){var b=this.audioTrackController;return b?b.audioTrack:-1},set:function(b){var D=this.audioTrackController;D&&(D.audioTrack=b)}},{key:"subtitleTracks",get:function(){var b=this.subtitleTrackController;return b?b.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var b=this.subtitleTrackController;return b?b.subtitleTrack:-1},set:function(b){var D=this.subtitleTrackController;D&&(D.subtitleTrack=b)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var b=this.subtitleTrackController;return b?b.subtitleDisplay:!1},set:function(b){var D=this.subtitleTrackController;D&&(D.subtitleDisplay=b)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(b){this.config.lowLatencyMode=b}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.7"}},{key:"Events",get:function(){return L.Events}},{key:"ErrorTypes",get:function(){return T.ErrorTypes}},{key:"ErrorDetails",get:function(){return T.ErrorDetails}},{key:"DefaultConfig",get:function(){return R.defaultConfig?R.defaultConfig:E.hlsDefaultConfig},set:function(b){R.defaultConfig=b}}]),R}();w.defaultConfig=void 0},"./src/is-supported.ts":(a,o,l)=>{l.r(o),l.d(o,{changeTypeSupported:()=>c,isSupported:()=>f});var h=l("./src/utils/mediasource-helper.ts");function u(){return self.SourceBuffer||self.WebKitSourceBuffer}function f(){var _=(0,h.getMediaSource)();if(!_)return!1;var g=u(),d=_&&typeof _.isTypeSupported=="function"&&_.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),p=!g||g.prototype&&typeof g.prototype.appendBuffer=="function"&&typeof g.prototype.remove=="function";return!!d&&!!p}function c(){var _,g=u();return typeof(g==null||(_=g.prototype)===null||_===void 0?void 0:_.changeType)=="function"}},"./src/loader/date-range.ts":(a,o,l)=>{l.r(o),l.d(o,{DateRange:()=>p,DateRangeAttribute:()=>d});var h=l("./src/polyfills/number.ts"),u=l("./src/utils/attr-list.ts"),f=l("./src/utils/logger.ts");function c(){return c=Object.assign?Object.assign.bind():function(v){for(var A=1;A<arguments.length;A++){var E=arguments[A];for(var S in E)Object.prototype.hasOwnProperty.call(E,S)&&(v[S]=E[S])}return v},c.apply(this,arguments)}function _(v,A){for(var E=0;E<A.length;E++){var S=A[E];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(v,S.key,S)}}function g(v,A,E){return A&&_(v.prototype,A),E&&_(v,E),Object.defineProperty(v,"prototype",{writable:!1}),v}var d;(function(v){v.ID="ID",v.CLASS="CLASS",v.START_DATE="START-DATE",v.DURATION="DURATION",v.END_DATE="END-DATE",v.END_ON_NEXT="END-ON-NEXT",v.PLANNED_DURATION="PLANNED-DURATION",v.SCTE35_OUT="SCTE35-OUT",v.SCTE35_IN="SCTE35-IN"})(d||(d={}));var p=function(){function v(A,E){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,E){var S=E.attr;for(var L in S)if(Object.prototype.hasOwnProperty.call(A,L)&&A[L]!==S[L]){f.logger.warn('DATERANGE tag attribute: "'+L+'" does not match for tags with ID: "'+A.ID+'"'),this._badValueForSameId=L;break}A=c(new u.AttrList({}),S,A)}if(this.attr=A,this._startDate=new Date(A[d.START_DATE]),d.END_DATE in this.attr){var T=new Date(this.attr[d.END_DATE]);(0,h.isFiniteNumber)(T.getTime())&&(this._endDate=T)}}return g(v,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var E=this.duration;return E!==null?new Date(this._startDate.getTime()+E*1e3):null}},{key:"duration",get:function(){if(d.DURATION in this.attr){var E=this.attr.decimalFloatingPoint(d.DURATION);if((0,h.isFiniteNumber)(E))return E}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return d.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(d.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(d.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,h.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),v}()},"./src/loader/fragment-loader.ts":(a,o,l)=>{l.r(o),l.d(o,{LoadError:()=>L,default:()=>E});var h=l("./src/polyfills/number.ts"),u=l("./src/errors.ts");function f(T,x){T.prototype=Object.create(x.prototype),T.prototype.constructor=T,p(T,x)}function c(T){var x=typeof Map=="function"?new Map:void 0;return c=function(w){if(w===null||!d(w))return w;if(typeof w!="function")throw new TypeError("Super expression must either be null or a function");if(typeof x<"u"){if(x.has(w))return x.get(w);x.set(w,R)}function R(){return _(w,arguments,v(this).constructor)}return R.prototype=Object.create(w.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),p(R,w)},c(T)}function _(T,x,m){return g()?_=Reflect.construct.bind():_=function(R,M,C){var b=[null];b.push.apply(b,M);var D=Function.bind.apply(R,b),O=new D;return C&&p(O,C.prototype),O},_.apply(null,arguments)}function g(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function d(T){return Function.toString.call(T).indexOf("[native code]")!==-1}function p(T,x){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(w,R){return w.__proto__=R,w},p(T,x)}function v(T){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(m){return m.__proto__||Object.getPrototypeOf(m)},v(T)}var A=Math.pow(2,17),E=function(){function T(m){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=m}var x=T.prototype;return x.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},x.abort=function(){this.loader&&this.loader.abort()},x.load=function(w,R){var M=this,C=w.url;if(!C)return Promise.reject(new L({type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:w,networkDetails:null},"Fragment does not have a "+(C?"part list":"url")));this.abort();var b=this.config,D=b.fLoader,O=b.loader;return new Promise(function(B,P){M.loader&&M.loader.destroy();var F=M.loader=w.loader=D?new D(b):new O(b),I=S(w),y={timeout:b.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:b.fragLoadingMaxRetryTimeout,highWaterMark:w.sn==="initSegment"?1/0:A};w.stats=F.stats,F.load(I,y,{onSuccess:function(U,N,W,G){M.resetLoader(w,F),B({frag:w,part:null,payload:U.data,networkDetails:G})},onError:function(U,N,W){M.resetLoader(w,F),P(new L({type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:w,response:U,networkDetails:W}))},onAbort:function(U,N,W){M.resetLoader(w,F),P(new L({type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:w,networkDetails:W}))},onTimeout:function(U,N,W){M.resetLoader(w,F),P(new L({type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:w,networkDetails:W}))},onProgress:function(U,N,W,G){R&&R({frag:w,part:null,payload:W,networkDetails:G})}})})},x.loadPart=function(w,R,M){var C=this;this.abort();var b=this.config,D=b.fLoader,O=b.loader;return new Promise(function(B,P){C.loader&&C.loader.destroy();var F=C.loader=w.loader=D?new D(b):new O(b),I=S(w,R),y={timeout:b.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:b.fragLoadingMaxRetryTimeout,highWaterMark:A};R.stats=F.stats,F.load(I,y,{onSuccess:function(U,N,W,G){C.resetLoader(w,F),C.updateStatsFromPart(w,R);var z={frag:w,part:R,payload:U.data,networkDetails:G};M(z),B(z)},onError:function(U,N,W){C.resetLoader(w,F),P(new L({type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:w,part:R,response:U,networkDetails:W}))},onAbort:function(U,N,W){w.stats.aborted=R.stats.aborted,C.resetLoader(w,F),P(new L({type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:w,part:R,networkDetails:W}))},onTimeout:function(U,N,W){C.resetLoader(w,F),P(new L({type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:w,part:R,networkDetails:W}))}})})},x.updateStatsFromPart=function(w,R){var M=w.stats,C=R.stats,b=C.total;if(M.loaded+=C.loaded,b){var D=Math.round(w.duration/R.duration),O=Math.min(Math.round(M.loaded/b),D),B=D-O,P=B*Math.round(M.loaded/O);M.total=M.loaded+P}else M.total=Math.max(M.loaded,M.total);var F=M.loading,I=C.loading;F.start?F.first+=I.first-I.start:(F.start=I.start,F.first=I.first),F.end=I.end},x.resetLoader=function(w,R){w.loader=null,this.loader===R&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),R.destroy()},T}();function S(T,x){x===void 0&&(x=null);var m=x||T,w={frag:T,part:x,responseType:"arraybuffer",url:m.url,headers:{},rangeStart:0,rangeEnd:0},R=m.byteRangeStartOffset,M=m.byteRangeEndOffset;return(0,h.isFiniteNumber)(R)&&(0,h.isFiniteNumber)(M)&&(w.rangeStart=R,w.rangeEnd=M),w}var L=function(T){f(x,T);function x(m){for(var w,R=arguments.length,M=new Array(R>1?R-1:0),C=1;C<R;C++)M[C-1]=arguments[C];return w=T.call.apply(T,[this].concat(M))||this,w.data=void 0,w.data=m,w}return x}(c(Error))},"./src/loader/fragment.ts":(a,o,l)=>{l.r(o),l.d(o,{BaseSegment:()=>E,ElementaryStreamTypes:()=>A,Fragment:()=>S,Part:()=>L});var h=l("./src/polyfills/number.ts"),u=l("./node_modules/url-toolkit/src/url-toolkit.js"),f=l("./src/utils/logger.ts"),c=l("./src/loader/level-key.ts"),_=l("./src/loader/load-stats.ts");function g(T,x){T.prototype=Object.create(x.prototype),T.prototype.constructor=T,d(T,x)}function d(T,x){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(w,R){return w.__proto__=R,w},d(T,x)}function p(T,x){for(var m=0;m<x.length;m++){var w=x[m];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(T,w.key,w)}}function v(T,x,m){return x&&p(T.prototype,x),m&&p(T,m),Object.defineProperty(T,"prototype",{writable:!1}),T}var A;(function(T){T.AUDIO="audio",T.VIDEO="video",T.AUDIOVIDEO="audiovideo"})(A||(A={}));var E=function(){function T(m){var w;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(w={},w[A.AUDIO]=null,w[A.VIDEO]=null,w[A.AUDIOVIDEO]=null,w),this.baseurl=m}var x=T.prototype;return x.setByteRange=function(w,R){var M=w.split("@",2),C=[];M.length===1?C[0]=R?R.byteRangeEndOffset:0:C[0]=parseInt(M[1]),C[1]=parseInt(M[0])+C[0],this._byteRange=C},v(T,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,u.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(w){this._url=w}}]),T}(),S=function(T){g(x,T);function x(w,R){var M;return M=T.call(this,R)||this,M._decryptdata=null,M.rawProgramDateTime=null,M.programDateTime=null,M.tagList=[],M.duration=0,M.sn=0,M.levelkey=void 0,M.type=void 0,M.loader=null,M.level=-1,M.cc=0,M.startPTS=void 0,M.endPTS=void 0,M.appendedPTS=void 0,M.startDTS=void 0,M.endDTS=void 0,M.start=0,M.deltaPTS=void 0,M.maxStartPTS=void 0,M.minEndPTS=void 0,M.stats=new _.LoadStats,M.urlId=0,M.data=void 0,M.bitrateTest=!1,M.title=null,M.initSegment=null,M.type=w,M}var m=x.prototype;return m.createInitializationVector=function(R){for(var M=new Uint8Array(16),C=12;C<16;C++)M[C]=R>>8*(15-C)&255;return M},m.setDecryptDataFromLevelKey=function(R,M){var C=R;return(R==null?void 0:R.method)==="AES-128"&&R.uri&&!R.iv&&(C=c.LevelKey.fromURI(R.uri),C.method=R.method,C.iv=this.createInitializationVector(M),C.keyFormat="identity"),C},m.setElementaryStreamInfo=function(R,M,C,b,D,O){O===void 0&&(O=!1);var B=this.elementaryStreams,P=B[R];if(!P){B[R]={startPTS:M,endPTS:C,startDTS:b,endDTS:D,partial:O};return}P.startPTS=Math.min(P.startPTS,M),P.endPTS=Math.max(P.endPTS,C),P.startDTS=Math.min(P.startDTS,b),P.endDTS=Math.max(P.endDTS,D)},m.clearElementaryStreamInfo=function(){var R=this.elementaryStreams;R[A.AUDIO]=null,R[A.VIDEO]=null,R[A.AUDIOVIDEO]=null},v(x,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var R=this.sn;typeof R!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&f.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),R=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,R)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,h.isFiniteNumber)(this.programDateTime))return null;var R=(0,h.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+R*1e3}},{key:"encrypted",get:function(){var R;return!!((R=this.decryptdata)!==null&&R!==void 0&&R.keyFormat&&this.decryptdata.uri)}}]),x}(E),L=function(T){g(x,T);function x(m,w,R,M,C){var b;b=T.call(this,R)||this,b.fragOffset=0,b.duration=0,b.gap=!1,b.independent=!1,b.relurl=void 0,b.fragment=void 0,b.index=void 0,b.stats=new _.LoadStats,b.duration=m.decimalFloatingPoint("DURATION"),b.gap=m.bool("GAP"),b.independent=m.bool("INDEPENDENT"),b.relurl=m.enumeratedString("URI"),b.fragment=w,b.index=M;var D=m.enumeratedString("BYTERANGE");return D&&b.setByteRange(D,C),C&&(b.fragOffset=C.fragOffset+C.duration),b}return v(x,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var w=this.elementaryStreams;return!!(w.audio||w.video||w.audiovideo)}}]),x}(E)},"./src/loader/key-loader.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>c});var h=l("./src/events.ts"),u=l("./src/errors.ts"),f=l("./src/utils/logger.ts"),c=function(){function _(d){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=d,this.registerListeners()}var g=_.prototype;return g.startLoad=function(p){},g.stopLoad=function(){this.destroyInternalLoaders()},g.registerListeners=function(){this.hls.on(h.Events.KEY_LOADING,this.onKeyLoading,this)},g.unregisterListeners=function(){this.hls.off(h.Events.KEY_LOADING,this.onKeyLoading)},g.destroyInternalLoaders=function(){for(var p in this.loaders){var v=this.loaders[p];v&&v.destroy()}this.loaders={}},g.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},g.onKeyLoading=function(p,v){var A=v.frag,E=A.type,S=this.loaders[E];if(!A.decryptdata){f.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var L=A.decryptdata.uri;if(L!==this.decrypturl||this.decryptkey===null){var T=this.hls.config;if(S&&(f.logger.warn("abort previous key loader for type:"+E),S.abort()),!L){f.logger.warn("key uri is falsy");return}var x=T.loader,m=A.loader=this.loaders[E]=new x(T);this.decrypturl=L,this.decryptkey=null;var w={url:L,frag:A,responseType:"arraybuffer"},R={timeout:T.fragLoadingTimeOut,maxRetry:0,retryDelay:T.fragLoadingRetryDelay,maxRetryDelay:T.fragLoadingMaxRetryTimeout,highWaterMark:0},M={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};m.load(w,R,M)}else this.decryptkey&&(A.decryptdata.key=this.decryptkey,this.hls.trigger(h.Events.KEY_LOADED,{frag:A}))},g.loadsuccess=function(p,v,A){var E=A.frag;if(!E.decryptdata){f.logger.error("after key load, decryptdata unset");return}this.decryptkey=E.decryptdata.key=new Uint8Array(p.data),E.loader=null,delete this.loaders[E.type],this.hls.trigger(h.Events.KEY_LOADED,{frag:E})},g.loaderror=function(p,v){var A=v.frag,E=A.loader;E&&E.abort(),delete this.loaders[A.type],this.hls.trigger(h.Events.ERROR,{type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:A,response:p})},g.loadtimeout=function(p,v){var A=v.frag,E=A.loader;E&&E.abort(),delete this.loaders[A.type],this.hls.trigger(h.Events.ERROR,{type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:A})},_}()},"./src/loader/level-details.ts":(a,o,l)=>{l.r(o),l.d(o,{LevelDetails:()=>_});var h=l("./src/polyfills/number.ts");function u(g,d){for(var p=0;p<d.length;p++){var v=d[p];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(g,v.key,v)}}function f(g,d,p){return d&&u(g.prototype,d),p&&u(g,p),Object.defineProperty(g,"prototype",{writable:!1}),g}var c=10,_=function(){function g(p){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=p}var d=g.prototype;return d.reloaded=function(v){if(!v){this.advanced=!0,this.updated=!0;return}var A=this.lastPartSn-v.lastPartSn,E=this.lastPartIndex-v.lastPartIndex;this.updated=this.endSN!==v.endSN||!!E||!!A,this.advanced=this.endSN>v.endSN||A>0||A===0&&E>0,this.updated||this.advanced?this.misses=Math.floor(v.misses*.6):this.misses=v.misses+1,this.availabilityDelay=v.availabilityDelay},f(g,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?(0,h.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||c}},{key:"drift",get:function(){var v=this.driftEndTime-this.driftStartTime;if(v>0){var A=this.driftEnd-this.driftStart;return A*1e3/v}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var v;return(v=this.partList)!==null&&v!==void 0&&v.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var v;return(v=this.fragments)!==null&&v!==void 0&&v.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var v;return(v=this.partList)!==null&&v!==void 0&&v.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var v;return(v=this.partList)!==null&&v!==void 0&&v.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),g}()},"./src/loader/level-key.ts":(a,o,l)=>{l.r(o),l.d(o,{LevelKey:()=>c});var h=l("./node_modules/url-toolkit/src/url-toolkit.js");function u(_,g){for(var d=0;d<g.length;d++){var p=g[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(_,p.key,p)}}function f(_,g,d){return g&&u(_.prototype,g),d&&u(_,d),Object.defineProperty(_,"prototype",{writable:!1}),_}var c=function(){_.fromURL=function(d,p){return new _(d,p)},_.fromURI=function(d){return new _(d)};function _(g,d){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,d?this._uri=(0,h.buildAbsoluteURL)(g,d,{alwaysNormalize:!0}):this._uri=g}return f(_,[{key:"uri",get:function(){return this._uri}}]),_}()},"./src/loader/load-stats.ts":(a,o,l)=>{l.r(o),l.d(o,{LoadStats:()=>h});var h=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>m});var h=l("./src/polyfills/number.ts"),u=l("./node_modules/url-toolkit/src/url-toolkit.js"),f=l("./src/loader/date-range.ts"),c=l("./src/loader/fragment.ts"),_=l("./src/loader/level-details.ts"),g=l("./src/loader/level-key.ts"),d=l("./src/utils/attr-list.ts"),p=l("./src/utils/logger.ts"),v=l("./src/utils/codecs.ts"),A=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,E=/#EXT-X-MEDIA:(.*)/g,S=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),L=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),T=/\.(mp4|m4s|m4v|m4a)$/i;function x(D){var O,B;return T.test((O=(B=u.parseURL(D))===null||B===void 0?void 0:B.path)!=null?O:"")}var m=function(){function D(){}return D.findGroup=function(B,P){for(var F=0;F<B.length;F++){var I=B[F];if(I.id===P)return I}},D.convertAVC1ToAVCOTI=function(B){var P=B.split(".");if(P.length>2){var F=P.shift()+".";return F+=parseInt(P.shift()).toString(16),F+=("000"+parseInt(P.shift()).toString(16)).slice(-4),F}return B},D.resolve=function(B,P){return u.buildAbsoluteURL(P,B,{alwaysNormalize:!0})},D.parseMasterPlaylist=function(B,P){var F=[],I=[],y={},k=!1;A.lastIndex=0;for(var U;(U=A.exec(B))!=null;)if(U[1]){var N,W=new d.AttrList(U[1]),G={attrs:W,bitrate:W.decimalInteger("AVERAGE-BANDWIDTH")||W.decimalInteger("BANDWIDTH"),name:W.NAME,url:D.resolve(U[2],P)},z=W.decimalResolution("RESOLUTION");z&&(G.width=z.width,G.height=z.height),w((W.CODECS||"").split(/[ ,]+/).filter(function($){return $}),G),G.videoCodec&&G.videoCodec.indexOf("avc1")!==-1&&(G.videoCodec=D.convertAVC1ToAVCOTI(G.videoCodec)),(N=G.unknownCodecs)!==null&&N!==void 0&&N.length||I.push(G),F.push(G)}else if(U[3]){var X=new d.AttrList(U[3]);X["DATA-ID"]&&(k=!0,y[X["DATA-ID"]]=X)}var K=I.length>0&&I.length<F.length;return{levels:K?I:F,sessionData:k?y:null}},D.parseMasterPlaylistMedia=function(B,P,F,I){I===void 0&&(I=[]);var y,k=[],U=0;for(E.lastIndex=0;(y=E.exec(B))!==null;){var N=new d.AttrList(y[1]);if(N.TYPE===F){var W={attrs:N,bitrate:0,id:U++,groupId:N["GROUP-ID"],instreamId:N["INSTREAM-ID"],name:N.NAME||N.LANGUAGE||"",type:F,default:N.bool("DEFAULT"),autoselect:N.bool("AUTOSELECT"),forced:N.bool("FORCED"),lang:N.LANGUAGE,url:N.URI?D.resolve(N.URI,P):""};if(I.length){var G=D.findGroup(I,W.groupId)||I[0];R(W,G,"audioCodec"),R(W,G,"textCodec")}k.push(W)}}return k},D.parseLevelPlaylist=function(B,P,F,I,y){var k=new _.LevelDetails(P),U=k.fragments,N=null,W=0,G=0,z=0,X=0,K=null,$=new c.Fragment(I,P),q,J,Q,rt=-1,mt=!1;for(S.lastIndex=0,k.m3u8=B;(q=S.exec(B))!==null;){mt&&(mt=!1,$=new c.Fragment(I,P),$.start=z,$.sn=W,$.cc=X,$.level=F,N&&($.initSegment=N,$.rawProgramDateTime=N.rawProgramDateTime,N.rawProgramDateTime=null));var vt=q[1];if(vt){$.duration=parseFloat(vt);var _t=(" "+q[2]).slice(1);$.title=_t||null,$.tagList.push(_t?["INF",vt,_t]:["INF",vt])}else if(q[3])(0,h.isFiniteNumber)($.duration)&&($.start=z,Q&&($.levelkey=Q),$.sn=W,$.level=F,$.cc=X,$.urlId=y,U.push($),$.relurl=(" "+q[3]).slice(1),C($,K),K=$,z+=$.duration,W++,G=0,mt=!0);else if(q[4]){var tt=(" "+q[4]).slice(1);K?$.setByteRange(tt,K):$.setByteRange(tt)}else if(q[5])$.rawProgramDateTime=(" "+q[5]).slice(1),$.tagList.push(["PROGRAM-DATE-TIME",$.rawProgramDateTime]),rt===-1&&(rt=U.length);else{if(q=q[0].match(L),!q){p.logger.warn("No matches on slow regex match for level playlist!");continue}for(J=1;J<q.length&&!(typeof q[J]<"u");J++);var Lt=(" "+q[J]).slice(1),dt=(" "+q[J+1]).slice(1),Tt=q[J+2]?(" "+q[J+2]).slice(1):"";switch(Lt){case"PLAYLIST-TYPE":k.type=dt.toUpperCase();break;case"MEDIA-SEQUENCE":W=k.startSN=parseInt(dt);break;case"SKIP":{var Ht=new d.AttrList(dt),Y=Ht.decimalInteger("SKIPPED-SEGMENTS");if((0,h.isFiniteNumber)(Y)){k.skippedSegments=Y;for(var V=Y;V--;)U.unshift(null);W+=Y}var it=Ht.enumeratedString("RECENTLY-REMOVED-DATERANGES");it&&(k.recentlyRemovedDateranges=it.split("	"));break}case"TARGETDURATION":k.targetduration=parseFloat(dt);break;case"VERSION":k.version=parseInt(dt);break;case"EXTM3U":break;case"ENDLIST":k.live=!1;break;case"#":(dt||Tt)&&$.tagList.push(Tt?[dt,Tt]:[dt]);break;case"DISCONTINUITY":X++,$.tagList.push(["DIS"]);break;case"GAP":$.tagList.push([Lt]);break;case"BITRATE":$.tagList.push([Lt,dt]);break;case"DATERANGE":{var at=new d.AttrList(dt),ut=new f.DateRange(at,k.dateRanges[at.ID]);ut.isValid||k.skippedSegments?k.dateRanges[ut.id]=ut:p.logger.warn('Ignoring invalid DATERANGE tag: "'+dt+'"'),$.tagList.push(["EXT-X-DATERANGE",dt]);break}case"DISCONTINUITY-SEQUENCE":X=parseInt(dt);break;case"KEY":{var ct,St=new d.AttrList(dt),gt=St.enumeratedString("METHOD"),ht=St.URI,wt=St.hexadecimalInteger("IV"),Nt=St.enumeratedString("KEYFORMATVERSIONS"),Mt=St.enumeratedString("KEYID"),Ut=(ct=St.enumeratedString("KEYFORMAT"))!=null?ct:"identity",Vt=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(Vt.indexOf(Ut)>-1){p.logger.warn("Keyformat "+Ut+" is not supported from the manifest");continue}else if(Ut!=="identity")continue;gt&&(Q=g.LevelKey.fromURL(P,ht),ht&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(gt)>=0&&(Q.method=gt,Q.keyFormat=Ut,Mt&&(Q.keyID=Mt),Nt&&(Q.keyFormatVersions=Nt),Q.iv=wt));break}case"START":{var Ft=new d.AttrList(dt),Z=Ft.decimalFloatingPoint("TIME-OFFSET");(0,h.isFiniteNumber)(Z)&&(k.startTimeOffset=Z);break}case"MAP":{var Et=new d.AttrList(dt);if($.duration){var yt=new c.Fragment(I,P);b(yt,Et,F,Q),N=yt,$.initSegment=N,N.rawProgramDateTime&&!$.rawProgramDateTime&&($.rawProgramDateTime=N.rawProgramDateTime)}else b($,Et,F,Q),N=$,mt=!0;break}case"SERVER-CONTROL":{var lt=new d.AttrList(dt);k.canBlockReload=lt.bool("CAN-BLOCK-RELOAD"),k.canSkipUntil=lt.optionalFloat("CAN-SKIP-UNTIL",0),k.canSkipDateRanges=k.canSkipUntil>0&&lt.bool("CAN-SKIP-DATERANGES"),k.partHoldBack=lt.optionalFloat("PART-HOLD-BACK",0),k.holdBack=lt.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var xt=new d.AttrList(dt);k.partTarget=xt.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Bt=k.partList;Bt||(Bt=k.partList=[]);var ee=G>0?Bt[Bt.length-1]:void 0,ie=G++,Be=new c.Part(new d.AttrList(dt),$,P,ie,ee);Bt.push(Be),$.duration+=Be.duration;break}case"PRELOAD-HINT":{var re=new d.AttrList(dt);k.preloadHint=re;break}case"RENDITION-REPORT":{var Qt=new d.AttrList(dt);k.renditionReports=k.renditionReports||[],k.renditionReports.push(Qt);break}default:p.logger.warn("line parsed but not handled: "+q);break}}}K&&!K.relurl?(U.pop(),z-=K.duration,k.partList&&(k.fragmentHint=K)):k.partList&&(C($,K),$.cc=X,k.fragmentHint=$);var pt=U.length,Rt=U[0],It=U[pt-1];if(z+=k.skippedSegments*k.targetduration,z>0&&pt&&It){k.averagetargetduration=z/pt;var jt=It.sn;k.endSN=jt!=="initSegment"?jt:0,Rt&&(k.startCC=Rt.cc,Rt.initSegment||k.fragments.every(function(ye){return ye.relurl&&x(ye.relurl)})&&(p.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),$=new c.Fragment(I,P),$.relurl=It.relurl,$.level=F,$.sn="initSegment",Rt.initSegment=$,k.needSidxRanges=!0))}else k.endSN=0,k.startCC=0;return k.fragmentHint&&(z+=k.fragmentHint.duration),k.totalduration=z,k.endCC=X,rt>0&&M(U,rt),k},D}();function w(D,O){["video","audio","text"].forEach(function(B){var P=D.filter(function(I){return(0,v.isCodecType)(I,B)});if(P.length){var F=P.filter(function(I){return I.lastIndexOf("avc1",0)===0||I.lastIndexOf("mp4a",0)===0});O[B+"Codec"]=F.length>0?F[0]:P[0],D=D.filter(function(I){return P.indexOf(I)===-1})}}),O.unknownCodecs=D}function R(D,O,B){var P=O[B];P&&(D[B]=P)}function M(D,O){for(var B=D[O],P=O;P--;){var F=D[P];if(!F)return;F.programDateTime=B.programDateTime-F.duration*1e3,B=F}}function C(D,O){D.rawProgramDateTime?D.programDateTime=Date.parse(D.rawProgramDateTime):O!=null&&O.programDateTime&&(D.programDateTime=O.endProgramDateTime),(0,h.isFiniteNumber)(D.programDateTime)||(D.programDateTime=null,D.rawProgramDateTime=null)}function b(D,O,B,P){D.relurl=O.URI,O.BYTERANGE&&D.setByteRange(O.BYTERANGE),D.level=B,D.sn="initSegment",P&&(D.levelkey=P),D.initSegment=null}},"./src/loader/playlist-loader.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>S});var h=l("./src/polyfills/number.ts"),u=l("./src/events.ts"),f=l("./src/errors.ts"),c=l("./src/utils/logger.ts"),_=l("./src/utils/mp4-tools.ts"),g=l("./src/loader/m3u8-parser.ts"),d=l("./src/types/loader.ts"),p=l("./src/utils/attr-list.ts");function v(L){var T=L.type;switch(T){case d.PlaylistContextType.AUDIO_TRACK:return d.PlaylistLevelType.AUDIO;case d.PlaylistContextType.SUBTITLE_TRACK:return d.PlaylistLevelType.SUBTITLE;default:return d.PlaylistLevelType.MAIN}}function A(L,T){var x=L.url;return(x===void 0||x.indexOf("data:")===0)&&(x=T.url),x}var E=function(){function L(x){this.hls=void 0,this.loaders=Object.create(null),this.hls=x,this.registerListeners()}var T=L.prototype;return T.startLoad=function(m){},T.stopLoad=function(){this.destroyInternalLoaders()},T.registerListeners=function(){var m=this.hls;m.on(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.on(u.Events.LEVEL_LOADING,this.onLevelLoading,this),m.on(u.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),m.on(u.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},T.unregisterListeners=function(){var m=this.hls;m.off(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.off(u.Events.LEVEL_LOADING,this.onLevelLoading,this),m.off(u.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),m.off(u.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},T.createInternalLoader=function(m){var w=this.hls.config,R=w.pLoader,M=w.loader,C=R||M,b=new C(w);return m.loader=b,this.loaders[m.type]=b,b},T.getInternalLoader=function(m){return this.loaders[m.type]},T.resetInternalLoader=function(m){this.loaders[m]&&delete this.loaders[m]},T.destroyInternalLoaders=function(){for(var m in this.loaders){var w=this.loaders[m];w&&w.destroy(),this.resetInternalLoader(m)}},T.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},T.onManifestLoading=function(m,w){var R=w.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:d.PlaylistContextType.MANIFEST,url:R,deliveryDirectives:null})},T.onLevelLoading=function(m,w){var R=w.id,M=w.level,C=w.url,b=w.deliveryDirectives;this.load({id:R,groupId:null,level:M,responseType:"text",type:d.PlaylistContextType.LEVEL,url:C,deliveryDirectives:b})},T.onAudioTrackLoading=function(m,w){var R=w.id,M=w.groupId,C=w.url,b=w.deliveryDirectives;this.load({id:R,groupId:M,level:null,responseType:"text",type:d.PlaylistContextType.AUDIO_TRACK,url:C,deliveryDirectives:b})},T.onSubtitleTrackLoading=function(m,w){var R=w.id,M=w.groupId,C=w.url,b=w.deliveryDirectives;this.load({id:R,groupId:M,level:null,responseType:"text",type:d.PlaylistContextType.SUBTITLE_TRACK,url:C,deliveryDirectives:b})},T.load=function(m){var w,R=this.hls.config,M=this.getInternalLoader(m);if(M){var C=M.context;if(C&&C.url===m.url){c.logger.trace("[playlist-loader]: playlist request ongoing");return}c.logger.log("[playlist-loader]: aborting previous loader for type: "+m.type),M.abort()}var b,D,O,B;switch(m.type){case d.PlaylistContextType.MANIFEST:b=R.manifestLoadingMaxRetry,D=R.manifestLoadingTimeOut,O=R.manifestLoadingRetryDelay,B=R.manifestLoadingMaxRetryTimeout;break;case d.PlaylistContextType.LEVEL:case d.PlaylistContextType.AUDIO_TRACK:case d.PlaylistContextType.SUBTITLE_TRACK:b=0,D=R.levelLoadingTimeOut;break;default:b=R.levelLoadingMaxRetry,D=R.levelLoadingTimeOut,O=R.levelLoadingRetryDelay,B=R.levelLoadingMaxRetryTimeout;break}if(M=this.createInternalLoader(m),(w=m.deliveryDirectives)!==null&&w!==void 0&&w.part){var P;if(m.type===d.PlaylistContextType.LEVEL&&m.level!==null?P=this.hls.levels[m.level].details:m.type===d.PlaylistContextType.AUDIO_TRACK&&m.id!==null?P=this.hls.audioTracks[m.id].details:m.type===d.PlaylistContextType.SUBTITLE_TRACK&&m.id!==null&&(P=this.hls.subtitleTracks[m.id].details),P){var F=P.partTarget,I=P.targetduration;F&&I&&(D=Math.min(Math.max(F*3,I*.8)*1e3,D))}}var y={timeout:D,maxRetry:b,retryDelay:O,maxRetryDelay:B,highWaterMark:0},k={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};M.load(m,y,k)},T.loadsuccess=function(m,w,R,M){if(M===void 0&&(M=null),R.isSidxRequest){this.handleSidxRequest(m,R),this.handlePlaylistLoaded(m,w,R,M);return}this.resetInternalLoader(R.type);var C=m.data;if(C.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(m,R,"no EXTM3U delimiter",M);return}w.parsing.start=performance.now(),C.indexOf("#EXTINF:")>0||C.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(m,w,R,M):this.handleMasterPlaylist(m,w,R,M)},T.loaderror=function(m,w,R){R===void 0&&(R=null),this.handleNetworkError(w,R,!1,m)},T.loadtimeout=function(m,w,R){R===void 0&&(R=null),this.handleNetworkError(w,R,!0)},T.handleMasterPlaylist=function(m,w,R,M){var C=this.hls,b=m.data,D=A(m,R),O=g.default.parseMasterPlaylist(b,D),B=O.levels,P=O.sessionData;if(!B.length){this.handleManifestParsingError(m,R,"no level found in manifest",M);return}var F=B.map(function(W){return{id:W.attrs.AUDIO,audioCodec:W.audioCodec}}),I=B.map(function(W){return{id:W.attrs.SUBTITLES,textCodec:W.textCodec}}),y=g.default.parseMasterPlaylistMedia(b,D,"AUDIO",F),k=g.default.parseMasterPlaylistMedia(b,D,"SUBTITLES",I),U=g.default.parseMasterPlaylistMedia(b,D,"CLOSED-CAPTIONS");if(y.length){var N=y.some(function(W){return!W.url});!N&&B[0].audioCodec&&!B[0].attrs.AUDIO&&(c.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),y.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new p.AttrList({}),bitrate:0,url:""}))}C.trigger(u.Events.MANIFEST_LOADED,{levels:B,audioTracks:y,subtitles:k,captions:U,url:D,stats:w,networkDetails:M,sessionData:P})},T.handleTrackOrLevelPlaylist=function(m,w,R,M){var C=this.hls,b=R.id,D=R.level,O=R.type,B=A(m,R),P=(0,h.isFiniteNumber)(b)?b:0,F=(0,h.isFiniteNumber)(D)?D:P,I=v(R),y=g.default.parseLevelPlaylist(m.data,B,F,I,P);if(!y.fragments.length){C.trigger(u.Events.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:B,reason:"no fragments found in level",level:typeof R.level=="number"?R.level:void 0});return}if(O===d.PlaylistContextType.MANIFEST){var k={attrs:new p.AttrList({}),bitrate:0,details:y,name:"",url:B};C.trigger(u.Events.MANIFEST_LOADED,{levels:[k],audioTracks:[],url:B,stats:w,networkDetails:M,sessionData:null})}if(w.parsing.end=performance.now(),y.needSidxRanges){var U,N=(U=y.fragments[0].initSegment)===null||U===void 0?void 0:U.url;this.load({url:N,isSidxRequest:!0,type:O,level:D,levelDetails:y,id:b,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}R.levelDetails=y,this.handlePlaylistLoaded(m,w,R,M)},T.handleSidxRequest=function(m,w){var R=new Uint8Array(m.data),M=(0,_.findBox)(R,["sidx"])[0];if(!!M){var C=(0,_.parseSegmentIndex)(M);if(!!C){var b=C.references,D=w.levelDetails;b.forEach(function(O,B){var P=O.info,F=D.fragments[B];if(F.byteRange.length===0&&F.setByteRange(String(1+P.end-P.start)+"@"+String(P.start)),F.initSegment){var I=(0,_.findBox)(R,["moov"])[0],y=I?I.length:null;F.initSegment.setByteRange(String(y)+"@0")}})}}},T.handleManifestParsingError=function(m,w,R,M){this.hls.trigger(u.Events.ERROR,{type:f.ErrorTypes.NETWORK_ERROR,details:f.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:w.type===d.PlaylistContextType.MANIFEST,url:m.url,reason:R,response:m,context:w,networkDetails:M})},T.handleNetworkError=function(m,w,R,M){R===void 0&&(R=!1),c.logger.warn("[playlist-loader]: A network "+(R?"timeout":"error")+" occurred while loading "+m.type+" level: "+m.level+" id: "+m.id+' group-id: "'+m.groupId+'"');var C=f.ErrorDetails.UNKNOWN,b=!1,D=this.getInternalLoader(m);switch(m.type){case d.PlaylistContextType.MANIFEST:C=R?f.ErrorDetails.MANIFEST_LOAD_TIMEOUT:f.ErrorDetails.MANIFEST_LOAD_ERROR,b=!0;break;case d.PlaylistContextType.LEVEL:C=R?f.ErrorDetails.LEVEL_LOAD_TIMEOUT:f.ErrorDetails.LEVEL_LOAD_ERROR,b=!1;break;case d.PlaylistContextType.AUDIO_TRACK:C=R?f.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:f.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,b=!1;break;case d.PlaylistContextType.SUBTITLE_TRACK:C=R?f.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:f.ErrorDetails.SUBTITLE_LOAD_ERROR,b=!1;break}D&&this.resetInternalLoader(m.type);var O={type:f.ErrorTypes.NETWORK_ERROR,details:C,fatal:b,url:m.url,loader:D,context:m,networkDetails:w};M&&(O.response=M),this.hls.trigger(u.Events.ERROR,O)},T.handlePlaylistLoaded=function(m,w,R,M){var C=R.type,b=R.level,D=R.id,O=R.groupId,B=R.loader,P=R.levelDetails,F=R.deliveryDirectives;if(!(P!=null&&P.targetduration)){this.handleManifestParsingError(m,R,"invalid target duration",M);return}if(!!B)switch(P.live&&(B.getCacheAge&&(P.ageHeader=B.getCacheAge()||0),(!B.getCacheAge||isNaN(P.ageHeader))&&(P.ageHeader=0)),C){case d.PlaylistContextType.MANIFEST:case d.PlaylistContextType.LEVEL:this.hls.trigger(u.Events.LEVEL_LOADED,{details:P,level:b||0,id:D||0,stats:w,networkDetails:M,deliveryDirectives:F});break;case d.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(u.Events.AUDIO_TRACK_LOADED,{details:P,id:D||0,groupId:O||"",stats:w,networkDetails:M,deliveryDirectives:F});break;case d.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(u.Events.SUBTITLE_TRACK_LOADED,{details:P,id:D||0,groupId:O||"",stats:w,networkDetails:M,deliveryDirectives:F});break}},L}();const S=E},"./src/polyfills/number.ts":(a,o,l)=>{l.r(o),l.d(o,{MAX_SAFE_INTEGER:()=>u,isFiniteNumber:()=>h});var h=Number.isFinite||function(f){return typeof f=="number"&&isFinite(f)},u=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>u});var h=function(){function f(){}return f.getSilentFrame=function(_,g){switch(_){case"mp4a.40.2":if(g===1)return new Uint8Array([0,200,0,128,35,128]);if(g===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(g===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(g===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(g===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(g===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(g===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(g===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(g===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},f}();const u=h},"./src/remux/mp4-generator.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>f});var h=Math.pow(2,32)-1,u=function(){function c(){}return c.init=function(){c.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var g;for(g in c.types)c.types.hasOwnProperty(g)&&(c.types[g]=[g.charCodeAt(0),g.charCodeAt(1),g.charCodeAt(2),g.charCodeAt(3)]);var d=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),p=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);c.HDLR_TYPES={video:d,audio:p};var v=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),A=new Uint8Array([0,0,0,0,0,0,0,0]);c.STTS=c.STSC=c.STCO=A,c.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),c.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),c.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),c.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var E=new Uint8Array([105,115,111,109]),S=new Uint8Array([97,118,99,49]),L=new Uint8Array([0,0,0,1]);c.FTYP=c.box(c.types.ftyp,E,L,E,S),c.DINF=c.box(c.types.dinf,c.box(c.types.dref,v))},c.box=function(g){for(var d=8,p=arguments.length,v=new Array(p>1?p-1:0),A=1;A<p;A++)v[A-1]=arguments[A];for(var E=v.length,S=E;E--;)d+=v[E].byteLength;var L=new Uint8Array(d);for(L[0]=d>>24&255,L[1]=d>>16&255,L[2]=d>>8&255,L[3]=d&255,L.set(g,4),E=0,d=8;E<S;E++)L.set(v[E],d),d+=v[E].byteLength;return L},c.hdlr=function(g){return c.box(c.types.hdlr,c.HDLR_TYPES[g])},c.mdat=function(g){return c.box(c.types.mdat,g)},c.mdhd=function(g,d){d*=g;var p=Math.floor(d/(h+1)),v=Math.floor(d%(h+1));return c.box(c.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,g>>24&255,g>>16&255,g>>8&255,g&255,p>>24,p>>16&255,p>>8&255,p&255,v>>24,v>>16&255,v>>8&255,v&255,85,196,0,0]))},c.mdia=function(g){return c.box(c.types.mdia,c.mdhd(g.timescale,g.duration),c.hdlr(g.type),c.minf(g))},c.mfhd=function(g){return c.box(c.types.mfhd,new Uint8Array([0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255]))},c.minf=function(g){return g.type==="audio"?c.box(c.types.minf,c.box(c.types.smhd,c.SMHD),c.DINF,c.stbl(g)):c.box(c.types.minf,c.box(c.types.vmhd,c.VMHD),c.DINF,c.stbl(g))},c.moof=function(g,d,p){return c.box(c.types.moof,c.mfhd(g),c.traf(p,d))},c.moov=function(g){for(var d=g.length,p=[];d--;)p[d]=c.trak(g[d]);return c.box.apply(null,[c.types.moov,c.mvhd(g[0].timescale,g[0].duration)].concat(p).concat(c.mvex(g)))},c.mvex=function(g){for(var d=g.length,p=[];d--;)p[d]=c.trex(g[d]);return c.box.apply(null,[c.types.mvex].concat(p))},c.mvhd=function(g,d){d*=g;var p=Math.floor(d/(h+1)),v=Math.floor(d%(h+1)),A=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,g>>24&255,g>>16&255,g>>8&255,g&255,p>>24,p>>16&255,p>>8&255,p&255,v>>24,v>>16&255,v>>8&255,v&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return c.box(c.types.mvhd,A)},c.sdtp=function(g){var d=g.samples||[],p=new Uint8Array(4+d.length),v,A;for(v=0;v<d.length;v++)A=d[v].flags,p[v+4]=A.dependsOn<<4|A.isDependedOn<<2|A.hasRedundancy;return c.box(c.types.sdtp,p)},c.stbl=function(g){return c.box(c.types.stbl,c.stsd(g),c.box(c.types.stts,c.STTS),c.box(c.types.stsc,c.STSC),c.box(c.types.stsz,c.STSZ),c.box(c.types.stco,c.STCO))},c.avc1=function(g){var d=[],p=[],v,A,E;for(v=0;v<g.sps.length;v++)A=g.sps[v],E=A.byteLength,d.push(E>>>8&255),d.push(E&255),d=d.concat(Array.prototype.slice.call(A));for(v=0;v<g.pps.length;v++)A=g.pps[v],E=A.byteLength,p.push(E>>>8&255),p.push(E&255),p=p.concat(Array.prototype.slice.call(A));var S=c.box(c.types.avcC,new Uint8Array([1,d[3],d[4],d[5],255,224|g.sps.length].concat(d).concat([g.pps.length]).concat(p))),L=g.width,T=g.height,x=g.pixelRatio[0],m=g.pixelRatio[1];return c.box(c.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,L>>8&255,L&255,T>>8&255,T&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),S,c.box(c.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),c.box(c.types.pasp,new Uint8Array([x>>24,x>>16&255,x>>8&255,x&255,m>>24,m>>16&255,m>>8&255,m&255])))},c.esds=function(g){var d=g.config.length;return new Uint8Array([0,0,0,0,3,23+d,0,1,0,4,15+d,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([d]).concat(g.config).concat([6,1,2]))},c.mp4a=function(g){var d=g.samplerate;return c.box(c.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,g.channelCount,0,16,0,0,0,0,d>>8&255,d&255,0,0]),c.box(c.types.esds,c.esds(g)))},c.mp3=function(g){var d=g.samplerate;return c.box(c.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,g.channelCount,0,16,0,0,0,0,d>>8&255,d&255,0,0]))},c.stsd=function(g){return g.type==="audio"?g.segmentCodec==="mp3"&&g.codec==="mp3"?c.box(c.types.stsd,c.STSD,c.mp3(g)):c.box(c.types.stsd,c.STSD,c.mp4a(g)):c.box(c.types.stsd,c.STSD,c.avc1(g))},c.tkhd=function(g){var d=g.id,p=g.duration*g.timescale,v=g.width,A=g.height,E=Math.floor(p/(h+1)),S=Math.floor(p%(h+1));return c.box(c.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,d>>24&255,d>>16&255,d>>8&255,d&255,0,0,0,0,E>>24,E>>16&255,E>>8&255,E&255,S>>24,S>>16&255,S>>8&255,S&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,v>>8&255,v&255,0,0,A>>8&255,A&255,0,0]))},c.traf=function(g,d){var p=c.sdtp(g),v=g.id,A=Math.floor(d/(h+1)),E=Math.floor(d%(h+1));return c.box(c.types.traf,c.box(c.types.tfhd,new Uint8Array([0,0,0,0,v>>24,v>>16&255,v>>8&255,v&255])),c.box(c.types.tfdt,new Uint8Array([1,0,0,0,A>>24,A>>16&255,A>>8&255,A&255,E>>24,E>>16&255,E>>8&255,E&255])),c.trun(g,p.length+16+20+8+16+8+8),p)},c.trak=function(g){return g.duration=g.duration||4294967295,c.box(c.types.trak,c.tkhd(g),c.mdia(g))},c.trex=function(g){var d=g.id;return c.box(c.types.trex,new Uint8Array([0,0,0,0,d>>24,d>>16&255,d>>8&255,d&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},c.trun=function(g,d){var p=g.samples||[],v=p.length,A=12+16*v,E=new Uint8Array(A),S,L,T,x,m,w;for(d+=8+A,E.set([g.type==="video"?1:0,0,15,1,v>>>24&255,v>>>16&255,v>>>8&255,v&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255],0),S=0;S<v;S++)L=p[S],T=L.duration,x=L.size,m=L.flags,w=L.cts,E.set([T>>>24&255,T>>>16&255,T>>>8&255,T&255,x>>>24&255,x>>>16&255,x>>>8&255,x&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&240<<8,m.degradPrio&15,w>>>24&255,w>>>16&255,w>>>8&255,w&255],12+16*S);return c.box(c.types.trun,E)},c.initSegment=function(g){c.types||c.init();var d=c.moov(g),p=new Uint8Array(c.FTYP.byteLength+d.byteLength);return p.set(c.FTYP),p.set(d,c.FTYP.byteLength),p},c}();u.types=void 0,u.HDLR_TYPES=void 0,u.STTS=void 0,u.STSC=void 0,u.STCO=void 0,u.STSZ=void 0,u.VMHD=void 0,u.SMHD=void 0,u.STSD=void 0,u.FTYP=void 0,u.DINF=void 0;const f=u},"./src/remux/mp4-remuxer.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>x,flushTextTrackMetadataCueSamples:()=>R,flushTextTrackUserdataCueSamples:()=>M,normalizePts:()=>m});var h=l("./src/polyfills/number.ts"),u=l("./src/remux/aac-helper.ts"),f=l("./src/remux/mp4-generator.ts"),c=l("./src/events.ts"),_=l("./src/errors.ts"),g=l("./src/utils/logger.ts"),d=l("./src/types/loader.ts"),p=l("./src/utils/timescale-conversion.ts");function v(){return v=Object.assign?Object.assign.bind():function(D){for(var O=1;O<arguments.length;O++){var B=arguments[O];for(var P in B)Object.prototype.hasOwnProperty.call(B,P)&&(D[P]=B[P])}return D},v.apply(this,arguments)}var A=10*1e3,E=1024,S=1152,L=null,T=null,x=function(){function D(B,P,F,I){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=B,this.config=P,this.typeSupported=F,this.ISGenerated=!1,L===null){var y=navigator.userAgent||"",k=y.match(/Chrome\/(\d+)/i);L=k?parseInt(k[1]):0}if(T===null){var U=navigator.userAgent.match(/Safari\/(\d+)/i);T=U?parseInt(U[1]):0}}var O=D.prototype;return O.destroy=function(){},O.resetTimeStamp=function(P){g.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=P},O.resetNextTimestamp=function(){g.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},O.resetInitSegment=function(){g.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},O.getVideoStartPts=function(P){var F=!1,I=P.reduce(function(y,k){var U=k.pts-y;return U<-4294967296?(F=!0,m(y,k.pts)):U>0?y:k.pts},P[0].pts);return F&&g.logger.debug("PTS rollover detected"),I},O.remux=function(P,F,I,y,k,U,N,W){var G,z,X,K,$,q,J=k,Q=k,rt=P.pid>-1,mt=F.pid>-1,vt=F.samples.length,_t=P.samples.length>0,tt=N&&vt>0||vt>1,Lt=(!rt||_t)&&(!mt||tt)||this.ISGenerated||N;if(Lt){this.ISGenerated||(X=this.generateIS(P,F,k));var dt=this.isVideoContiguous,Tt=-1,Ht;if(tt&&(Tt=w(F.samples),!dt&&this.config.forceKeyFrameOnDiscontinuity))if(q=!0,Tt>0){g.logger.warn("[mp4-remuxer]: Dropped "+Tt+" out of "+vt+" video samples due to a missing keyframe");var Y=this.getVideoStartPts(F.samples);F.samples=F.samples.slice(Tt),F.dropped+=Tt,Q+=(F.samples[0].pts-Y)/F.inputTimeScale,Ht=Q}else Tt===-1&&(g.logger.warn("[mp4-remuxer]: No keyframe found out of "+vt+" video samples"),q=!1);if(this.ISGenerated){if(_t&&tt){var V=this.getVideoStartPts(F.samples),it=m(P.samples[0].pts,V)-V,at=it/F.inputTimeScale;J+=Math.max(0,at),Q+=Math.max(0,-at)}if(_t){if(P.samplerate||(g.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),X=this.generateIS(P,F,k)),z=this.remuxAudio(P,J,this.isAudioContiguous,U,mt||tt||W===d.PlaylistLevelType.AUDIO?Q:void 0),tt){var ut=z?z.endPTS-z.startPTS:0;F.inputTimeScale||(g.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),X=this.generateIS(P,F,k)),G=this.remuxVideo(F,Q,dt,ut)}}else tt&&(G=this.remuxVideo(F,Q,dt,0));G&&(G.firstKeyFrame=Tt,G.independent=Tt!==-1,G.firstKeyFramePTS=Ht)}}return this.ISGenerated&&(I.samples.length&&($=R(I,k,this._initPTS,this._initDTS)),y.samples.length&&(K=M(y,k,this._initPTS))),{audio:z,video:G,initSegment:X,independent:q,text:K,id3:$}},O.generateIS=function(P,F,I){var y=P.samples,k=F.samples,U=this.typeSupported,N={},W=!(0,h.isFiniteNumber)(this._initPTS),G="audio/mp4",z,X,K;if(W&&(z=X=1/0),P.config&&y.length){switch(P.timescale=P.samplerate,P.segmentCodec){case"mp3":U.mpeg?(G="audio/mpeg",P.codec=""):U.mp3&&(P.codec="mp3");break}N.audio={id:"audio",container:G,codec:P.codec,initSegment:P.segmentCodec==="mp3"&&U.mpeg?new Uint8Array(0):f.default.initSegment([P]),metadata:{channelCount:P.channelCount}},W&&(K=P.inputTimeScale,z=X=y[0].pts-Math.round(K*I))}if(F.sps&&F.pps&&k.length&&(F.timescale=F.inputTimeScale,N.video={id:"main",container:"video/mp4",codec:F.codec,initSegment:f.default.initSegment([F]),metadata:{width:F.width,height:F.height}},W)){K=F.inputTimeScale;var $=this.getVideoStartPts(k),q=Math.round(K*I);X=Math.min(X,m(k[0].dts,$)-q),z=Math.min(z,$-q)}if(Object.keys(N).length)return this.ISGenerated=!0,W&&(this._initPTS=z,this._initDTS=X),{tracks:N,initPTS:z,timescale:K}},O.remuxVideo=function(P,F,I,y){var k=P.inputTimeScale,U=P.samples,N=[],W=U.length,G=this._initPTS,z=this.nextAvcDts,X=8,K=this.videoSampleDuration,$,q,J=Number.POSITIVE_INFINITY,Q=Number.NEGATIVE_INFINITY,rt=!1;if(!I||z===null){var mt=F*k,vt=U[0].pts-m(U[0].dts,U[0].pts);z=mt-vt}for(var _t=0;_t<W;_t++){var tt=U[_t];tt.pts=m(tt.pts-G,z),tt.dts=m(tt.dts-G,z),tt.dts<U[_t>0?_t-1:_t].dts&&(rt=!0)}rt&&U.sort(function(Kt,Xt){var fe=Kt.dts-Xt.dts,Ii=Kt.pts-Xt.pts;return fe||Ii}),$=U[0].dts,q=U[U.length-1].dts;var Lt=q-$,dt=Lt?Math.round(Lt/(W-1)):K||P.inputTimeScale/30;if(I){var Tt=$-z,Ht=Tt>dt,Y=Tt<-1;if((Ht||Y)&&(Ht?g.logger.warn("AVC: "+(0,p.toMsFromMpegTsClock)(Tt,!0)+" ms ("+Tt+"dts) hole between fragments detected, filling it"):g.logger.warn("AVC: "+(0,p.toMsFromMpegTsClock)(-Tt,!0)+" ms ("+Tt+"dts) overlapping between fragments detected"),!Y||z>U[0].pts)){$=z;var V=U[0].pts-Tt;U[0].dts=$,U[0].pts=V,g.logger.log("Video: First PTS/DTS adjusted: "+(0,p.toMsFromMpegTsClock)(V,!0)+"/"+(0,p.toMsFromMpegTsClock)($,!0)+", delta: "+(0,p.toMsFromMpegTsClock)(Tt,!0)+" ms")}}$=Math.max(0,$);for(var it=0,at=0,ut=0;ut<W;ut++){for(var ct=U[ut],St=ct.units,gt=St.length,ht=0,wt=0;wt<gt;wt++)ht+=St[wt].data.length;at+=ht,it+=gt,ct.length=ht,ct.dts=Math.max(ct.dts,$),J=Math.min(ct.pts,J),Q=Math.max(ct.pts,Q)}q=U[W-1].dts;var Nt=at+4*it+8,Mt;try{Mt=new Uint8Array(Nt)}catch{this.observer.emit(c.Events.ERROR,c.Events.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Nt,reason:"fail allocating video mdat "+Nt});return}var Ut=new DataView(Mt.buffer);Ut.setUint32(0,Nt),Mt.set(f.default.types.mdat,4);for(var Vt=!1,Ft=Number.POSITIVE_INFINITY,Z=Number.POSITIVE_INFINITY,Et=Number.NEGATIVE_INFINITY,yt=Number.NEGATIVE_INFINITY,lt=0;lt<W;lt++){for(var xt=U[lt],Bt=xt.units,ee=0,ie=0,Be=Bt.length;ie<Be;ie++){var re=Bt[ie],Qt=re.data,pt=re.data.byteLength;Ut.setUint32(X,pt),X+=4,Mt.set(Qt,X),X+=pt,ee+=4+pt}var Rt=void 0;if(lt<W-1)K=U[lt+1].dts-xt.dts,Rt=U[lt+1].pts-xt.pts;else{var It=this.config,jt=lt>0?xt.dts-U[lt-1].dts:dt;if(Rt=lt>0?xt.pts-U[lt-1].pts:dt,It.stretchShortVideoTrack&&this.nextAudioPts!==null){var ye=Math.floor(It.maxBufferHole*k),te=(y?J+y*k:this.nextAudioPts)-xt.pts;te>ye?(K=te-jt,K<0?K=jt:Vt=!0,g.logger.log("[mp4-remuxer]: It is approximately "+te/90+" ms to the next segment; using duration "+K/90+" ms for the last video frame.")):K=jt}else K=jt}var Ee=Math.round(xt.pts-xt.dts);Ft=Math.min(Ft,K),Et=Math.max(Et,K),Z=Math.min(Z,Rt),yt=Math.max(yt,Rt),N.push(new C(xt.key,K,ee,Ee))}if(N.length){if(L){if(L<70){var j=N[0].flags;j.dependsOn=2,j.isNonSync=0}}else if(T&&yt-Z<Et-Ft&&dt/Et<.025&&N[0].cts===0){g.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var nt=$,st=0,et=N.length;st<et;st++){var ft=nt+N[st].duration,Dt=nt+N[st].cts;if(st<et-1){var kt=ft+N[st+1].cts;N[st].duration=kt-Dt}else N[st].duration=st?N[st-1].duration:dt;N[st].cts=0,nt=ft}}}console.assert(K!==null,"mp4SampleDuration must be computed"),K=Vt||!K?dt:K,this.nextAvcDts=z=q+K,this.videoSampleDuration=K,this.isVideoContiguous=!0;var zt=f.default.moof(P.sequenceNumber++,$,v({},P,{samples:N})),Zt="video",ne={data1:zt,data2:Mt,startPTS:J/k,endPTS:(Q+K)/k,startDTS:$/k,endDTS:z/k,type:Zt,hasAudio:!1,hasVideo:!0,nb:N.length,dropped:P.dropped};return P.samples=[],P.dropped=0,console.assert(Mt.length,"MDAT length must not be zero"),ne},O.remuxAudio=function(P,F,I,y,k){var U=P.inputTimeScale,N=P.samplerate?P.samplerate:U,W=U/N,G=P.segmentCodec==="aac"?E:S,z=G*W,X=this._initPTS,K=P.segmentCodec==="mp3"&&this.typeSupported.mpeg,$=[],q=k!==void 0,J=P.samples,Q=K?0:8,rt=this.nextAudioPts||-1,mt=F*U;if(this.isAudioContiguous=I=I||J.length&&rt>0&&(y&&Math.abs(mt-rt)<9e3||Math.abs(m(J[0].pts-X,mt)-rt)<20*z),J.forEach(function(re){re.pts=m(re.pts-X,mt)}),!I||rt<0){if(J=J.filter(function(re){return re.pts>=0}),!J.length)return;k===0?rt=0:y&&!q?rt=Math.max(0,mt):rt=J[0].pts}if(P.segmentCodec==="aac")for(var vt=this.config.maxAudioFramesDrift,_t=0,tt=rt;_t<J.length;_t++){var Lt=J[_t],dt=Lt.pts,Tt=dt-tt,Ht=Math.abs(1e3*Tt/U);if(Tt<=-vt*z&&q)_t===0&&(g.logger.warn("Audio frame @ "+(dt/U).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Tt/U)+" ms."),this.nextAudioPts=rt=tt=dt);else if(Tt>=vt*z&&Ht<A&&q){var Y=Math.round(Tt/z);tt=dt-Y*z,tt<0&&(Y--,tt+=z),_t===0&&(this.nextAudioPts=rt=tt),g.logger.warn("[mp4-remuxer]: Injecting "+Y+" audio frame @ "+(tt/U).toFixed(3)+"s due to "+Math.round(1e3*Tt/U)+" ms gap.");for(var V=0;V<Y;V++){var it=Math.max(tt,0),at=u.default.getSilentFrame(P.manifestCodec||P.codec,P.channelCount);at||(g.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),at=Lt.unit.subarray()),J.splice(_t,0,{unit:at,pts:it}),tt+=z,_t++}}Lt.pts=tt,tt+=z}for(var ut=null,ct=null,St,gt=0,ht=J.length;ht--;)gt+=J[ht].unit.byteLength;for(var wt=0,Nt=J.length;wt<Nt;wt++){var Mt=J[wt],Ut=Mt.unit,Vt=Mt.pts;if(ct!==null){var Ft=$[wt-1];Ft.duration=Math.round((Vt-ct)/W)}else if(I&&P.segmentCodec==="aac"&&(Vt=rt),ut=Vt,gt>0){gt+=Q;try{St=new Uint8Array(gt)}catch{this.observer.emit(c.Events.ERROR,c.Events.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:gt,reason:"fail allocating audio mdat "+gt});return}if(!K){var Z=new DataView(St.buffer);Z.setUint32(0,gt),St.set(f.default.types.mdat,4)}}else return;St.set(Ut,Q);var Et=Ut.byteLength;Q+=Et,$.push(new C(!0,G,Et,0)),ct=Vt}var yt=$.length;if(!!yt){var lt=$[$.length-1];this.nextAudioPts=rt=ct+W*lt.duration;var xt=K?new Uint8Array(0):f.default.moof(P.sequenceNumber++,ut/W,v({},P,{samples:$}));P.samples=[];var Bt=ut/U,ee=rt/U,ie="audio",Be={data1:xt,data2:St,startPTS:Bt,endPTS:ee,startDTS:Bt,endDTS:ee,type:ie,hasAudio:!0,hasVideo:!1,nb:yt};return this.isAudioContiguous=!0,console.assert(St.length,"MDAT length must not be zero"),Be}},O.remuxEmptyAudio=function(P,F,I,y){var k=P.inputTimeScale,U=P.samplerate?P.samplerate:k,N=k/U,W=this.nextAudioPts,G=(W!==null?W:y.startDTS*k)+this._initDTS,z=y.endDTS*k+this._initDTS,X=N*E,K=Math.ceil((z-G)/X),$=u.default.getSilentFrame(P.manifestCodec||P.codec,P.channelCount);if(g.logger.warn("[mp4-remuxer]: remux empty Audio"),!$){g.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var q=[],J=0;J<K;J++){var Q=G+J*X;q.push({unit:$,pts:Q,dts:Q})}return P.samples=q,this.remuxAudio(P,F,I,!1)},D}();function m(D,O){var B;if(O===null)return D;for(O<D?B=-8589934592:B=8589934592;Math.abs(D-O)>4294967296;)D+=B;return D}function w(D){for(var O=0;O<D.length;O++)if(D[O].key)return O;return-1}function R(D,O,B,P){var F=D.samples.length;if(!!F){for(var I=D.inputTimeScale,y=0;y<F;y++){var k=D.samples[y];k.pts=m(k.pts-B,O*I)/I,k.dts=m(k.dts-P,O*I)/I}var U=D.samples;return D.samples=[],{samples:U}}}function M(D,O,B){var P=D.samples.length;if(!!P){for(var F=D.inputTimeScale,I=0;I<P;I++){var y=D.samples[I];y.pts=m(y.pts-B,O*F)/F}D.samples.sort(function(U,N){return U.pts-N.pts});var k=D.samples;return D.samples=[],{samples:k}}}var C=function(O,B,P,F){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=B,this.size=P,this.cts=F,this.flags=new b(O)},b=function(O){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=O?2:1,this.isNonSync=O?0:1}},"./src/remux/passthrough-remuxer.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>p});var h=l("./src/polyfills/number.ts"),u=l("./src/remux/mp4-remuxer.ts"),f=l("./src/utils/mp4-tools.ts"),c=l("./src/loader/fragment.ts"),_=l("./src/utils/logger.ts"),g=function(){function v(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var A=v.prototype;return A.destroy=function(){},A.resetTimeStamp=function(S){this.initPTS=S,this.lastEndTime=null},A.resetNextTimestamp=function(){this.lastEndTime=null},A.resetInitSegment=function(S,L,T){this.audioCodec=L,this.videoCodec=T,this.generateInitSegment(S),this.emitInitSegment=!0},A.generateInitSegment=function(S){var L=this.audioCodec,T=this.videoCodec;if(!S||!S.byteLength){this.initTracks=void 0,this.initData=void 0;return}var x=this.initData=(0,f.parseInitSegment)(S);L||(L=d(x.audio,c.ElementaryStreamTypes.AUDIO)),T||(T=d(x.video,c.ElementaryStreamTypes.VIDEO));var m={};x.audio&&x.video?m.audiovideo={container:"video/mp4",codec:L+","+T,initSegment:S,id:"main"}:x.audio?m.audio={container:"audio/mp4",codec:L,initSegment:S,id:"audio"}:x.video?m.video={container:"video/mp4",codec:T,initSegment:S,id:"main"}:_.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=m},A.remux=function(S,L,T,x,m){var w,R=this.initPTS,M=this.lastEndTime,C={audio:void 0,video:void 0,text:x,id3:T,initSegment:void 0};(0,h.isFiniteNumber)(M)||(M=this.lastEndTime=m||0);var b=L.samples;if(!b||!b.length)return C;var D={initPTS:void 0,timescale:1},O=this.initData;if((!O||!O.length)&&(this.generateInitSegment(b),O=this.initData),!O||!O.length)return _.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),C;this.emitInitSegment&&(D.tracks=this.initTracks,this.emitInitSegment=!1);var B=(0,f.getStartDTS)(O,b);(0,h.isFiniteNumber)(R)||(this.initPTS=D.initPTS=R=B-m);var P=(0,f.getDuration)(b,O),F=S?B-R:M,I=F+P;(0,f.offsetStartDTS)(O,b,R),P>0?this.lastEndTime=I:(_.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var y=!!O.audio,k=!!O.video,U="";y&&(U+="audio"),k&&(U+="video");var N={data1:b,startPTS:F,startDTS:F,endPTS:I,endDTS:I,type:U,hasAudio:y,hasVideo:k,nb:1,dropped:0};C.audio=N.type==="audio"?N:void 0,C.video=N.type!=="audio"?N:void 0,C.initSegment=D;var W=(w=this.initPTS)!=null?w:0;return C.id3=(0,u.flushTextTrackMetadataCueSamples)(T,m,W,W),x.samples.length&&(C.text=(0,u.flushTextTrackUserdataCueSamples)(x,m,W)),C},v}();function d(v,A){var E=v==null?void 0:v.codec;return E&&E.length>4?E:E==="hvc1"||E==="hev1"?"hvc1.1.c.L120.90":E==="av01"?"av01.0.04M.08":E==="avc1"||A===c.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const p=g},"./src/task-loop.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>h});var h=function(){function u(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var f=u.prototype;return f.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},f.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},f.onHandlerDestroyed=function(){},f.hasInterval=function(){return!!this._tickInterval},f.hasNextTick=function(){return!!this._tickTimer},f.setInterval=function(_){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,_),!0)},f.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},f.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},f.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},f.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},f.doTick=function(){},u}()},"./src/types/cmcd.ts":(a,o,l)=>{l.r(o),l.d(o,{CMCDObjectType:()=>u,CMCDStreamType:()=>c,CMCDStreamingFormat:()=>f,CMCDVersion:()=>h});var h=1,u;(function(_){_.MANIFEST="m",_.AUDIO="a",_.VIDEO="v",_.MUXED="av",_.INIT="i",_.CAPTION="c",_.TIMED_TEXT="tt",_.KEY="k",_.OTHER="o"})(u||(u={}));var f;(function(_){_.DASH="d",_.HLS="h",_.SMOOTH="s",_.OTHER="o"})(f||(f={}));var c;(function(_){_.VOD="v",_.LIVE="l"})(c||(c={}))},"./src/types/demuxer.ts":(a,o,l)=>{l.r(o),l.d(o,{MetadataSchema:()=>h});var h;(function(u){u.audioId3="org.id3",u.dateRange="com.apple.quicktime.HLS",u.emsg="https://aomedia.org/emsg/ID3"})(h||(h={}))},"./src/types/level.ts":(a,o,l)=>{l.r(o),l.d(o,{HlsSkip:()=>f,HlsUrlParameters:()=>_,Level:()=>g,getSkipValue:()=>c});function h(d,p){for(var v=0;v<p.length;v++){var A=p[v];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(d,A.key,A)}}function u(d,p,v){return p&&h(d.prototype,p),v&&h(d,v),Object.defineProperty(d,"prototype",{writable:!1}),d}var f;(function(d){d.No="",d.Yes="YES",d.v2="v2"})(f||(f={}));function c(d,p){var v=d.canSkipUntil,A=d.canSkipDateRanges,E=d.endSN,S=p!==void 0?p-E:0;return v&&S<v?A?f.v2:f.Yes:f.No}var _=function(){function d(v,A,E){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=v,this.part=A,this.skip=E}var p=d.prototype;return p.addDirectives=function(A){var E=new self.URL(A);return this.msn!==void 0&&E.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&E.searchParams.set("_HLS_part",this.part.toString()),this.skip&&E.searchParams.set("_HLS_skip",this.skip),E.toString()},d}(),g=function(){function d(p){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[p.url],this.attrs=p.attrs,this.bitrate=p.bitrate,p.details&&(this.details=p.details),this.id=p.id||0,this.name=p.name,this.width=p.width||0,this.height=p.height||0,this.audioCodec=p.audioCodec,this.videoCodec=p.videoCodec,this.unknownCodecs=p.unknownCodecs,this.codecSet=[p.videoCodec,p.audioCodec].filter(function(v){return v}).join(",").replace(/\.[^.,]+/g,"")}return u(d,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(v){var A=v%this.url.length;this._urlId!==A&&(this.details=void 0,this._urlId=A)}}]),d}()},"./src/types/loader.ts":(a,o,l)=>{l.r(o),l.d(o,{PlaylistContextType:()=>h,PlaylistLevelType:()=>u});var h;(function(f){f.MANIFEST="manifest",f.LEVEL="level",f.AUDIO_TRACK="audioTrack",f.SUBTITLE_TRACK="subtitleTrack"})(h||(h={}));var u;(function(f){f.MAIN="main",f.AUDIO="audio",f.SUBTITLE="subtitle"})(u||(u={}))},"./src/types/transmuxer.ts":(a,o,l)=>{l.r(o),l.d(o,{ChunkMetadata:()=>h});var h=function(c,_,g,d,p,v){d===void 0&&(d=0),p===void 0&&(p=-1),v===void 0&&(v=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=u(),this.buffering={audio:u(),video:u(),audiovideo:u()},this.level=c,this.sn=_,this.id=g,this.size=d,this.part=p,this.partial=v};function u(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":(a,o,l)=>{l.r(o),l.d(o,{AttrList:()=>f});var h=/^(\d+)x(\d+)$/,u=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,f=function(){function c(g){typeof g=="string"&&(g=c.parseAttrList(g));for(var d in g)g.hasOwnProperty(d)&&(this[d]=g[d])}var _=c.prototype;return _.decimalInteger=function(d){var p=parseInt(this[d],10);return p>Number.MAX_SAFE_INTEGER?1/0:p},_.hexadecimalInteger=function(d){if(this[d]){var p=(this[d]||"0x").slice(2);p=(p.length&1?"0":"")+p;for(var v=new Uint8Array(p.length/2),A=0;A<p.length/2;A++)v[A]=parseInt(p.slice(A*2,A*2+2),16);return v}else return null},_.hexadecimalIntegerAsNumber=function(d){var p=parseInt(this[d],16);return p>Number.MAX_SAFE_INTEGER?1/0:p},_.decimalFloatingPoint=function(d){return parseFloat(this[d])},_.optionalFloat=function(d,p){var v=this[d];return v?parseFloat(v):p},_.enumeratedString=function(d){return this[d]},_.bool=function(d){return this[d]==="YES"},_.decimalResolution=function(d){var p=h.exec(this[d]);if(p!==null)return{width:parseInt(p[1],10),height:parseInt(p[2],10)}},c.parseAttrList=function(d){var p,v={},A='"';for(u.lastIndex=0;(p=u.exec(d))!==null;){var E=p[2];E.indexOf(A)===0&&E.lastIndexOf(A)===E.length-1&&(E=E.slice(1,-1)),v[p[1]]=E}return v},c}()},"./src/utils/binary-search.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>u});var h={search:function(c,_){for(var g=0,d=c.length-1,p=null,v=null;g<=d;){p=(g+d)/2|0,v=c[p];var A=_(v);if(A>0)g=p+1;else if(A<0)d=p-1;else return v}return null}};const u=h},"./src/utils/buffer-helper.ts":(a,o,l)=>{l.r(o),l.d(o,{BufferHelper:()=>f});var h=l("./src/utils/logger.ts"),u={length:0,start:function(){return 0},end:function(){return 0}},f=function(){function c(){}return c.isBuffered=function(g,d){try{if(g){for(var p=c.getBuffered(g),v=0;v<p.length;v++)if(d>=p.start(v)&&d<=p.end(v))return!0}}catch{}return!1},c.bufferInfo=function(g,d,p){try{if(g){var v=c.getBuffered(g),A=[],E;for(E=0;E<v.length;E++)A.push({start:v.start(E),end:v.end(E)});return this.bufferedInfo(A,d,p)}}catch{}return{len:0,start:d,end:d,nextStart:void 0}},c.bufferedInfo=function(g,d,p){d=Math.max(0,d),g.sort(function(C,b){var D=C.start-b.start;return D||b.end-C.end});var v=[];if(p)for(var A=0;A<g.length;A++){var E=v.length;if(E){var S=v[E-1].end;g[A].start-S<p?g[A].end>S&&(v[E-1].end=g[A].end):v.push(g[A])}else v.push(g[A])}else v=g;for(var L=0,T,x=d,m=d,w=0;w<v.length;w++){var R=v[w].start,M=v[w].end;if(d+p>=R&&d<M)x=R,m=M,L=m-d;else if(d+p<R){T=R;break}}return{len:L,start:x||0,end:m||0,nextStart:T}},c.getBuffered=function(g){try{return g.buffered}catch(d){return h.logger.log("failed to get media.buffered",d),u}},c}()},"./src/utils/cea-608-parser.ts":(a,o,l)=>{l.r(o),l.d(o,{CaptionScreen:()=>w,Row:()=>m,default:()=>O});var h=l("./src/utils/logger.ts"),u={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},f=function(P){var F=P;return u.hasOwnProperty(P)&&(F=u[P]),String.fromCharCode(F)},c=15,_=100,g={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},d={17:2,18:4,21:6,22:8,23:10,19:13,20:15},p={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},v={25:2,26:4,29:6,30:8,31:10,27:13,28:15},A=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],E;(function(B){B[B.ERROR=0]="ERROR",B[B.TEXT=1]="TEXT",B[B.WARNING=2]="WARNING",B[B.INFO=2]="INFO",B[B.DEBUG=3]="DEBUG",B[B.DATA=3]="DATA"})(E||(E={}));var S=function(){function B(){this.time=null,this.verboseLevel=E.ERROR}var P=B.prototype;return P.log=function(I,y){this.verboseLevel>=I&&h.logger.log(this.time+" ["+I+"] "+y)},B}(),L=function(P){for(var F=[],I=0;I<P.length;I++)F.push(P[I].toString(16));return F},T=function(){function B(F,I,y,k,U){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=F||"white",this.underline=I||!1,this.italics=y||!1,this.background=k||"black",this.flash=U||!1}var P=B.prototype;return P.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},P.setStyles=function(I){for(var y=["foreground","underline","italics","background","flash"],k=0;k<y.length;k++){var U=y[k];I.hasOwnProperty(U)&&(this[U]=I[U])}},P.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},P.equals=function(I){return this.foreground===I.foreground&&this.underline===I.underline&&this.italics===I.italics&&this.background===I.background&&this.flash===I.flash},P.copy=function(I){this.foreground=I.foreground,this.underline=I.underline,this.italics=I.italics,this.background=I.background,this.flash=I.flash},P.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},B}(),x=function(){function B(F,I,y,k,U,N){this.uchar=void 0,this.penState=void 0,this.uchar=F||" ",this.penState=new T(I,y,k,U,N)}var P=B.prototype;return P.reset=function(){this.uchar=" ",this.penState.reset()},P.setChar=function(I,y){this.uchar=I,this.penState.copy(y)},P.setPenState=function(I){this.penState.copy(I)},P.equals=function(I){return this.uchar===I.uchar&&this.penState.equals(I.penState)},P.copy=function(I){this.uchar=I.uchar,this.penState.copy(I.penState)},P.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},B}(),m=function(){function B(F){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var I=0;I<_;I++)this.chars.push(new x);this.logger=F,this.pos=0,this.currPenState=new T}var P=B.prototype;return P.equals=function(I){for(var y=!0,k=0;k<_;k++)if(!this.chars[k].equals(I.chars[k])){y=!1;break}return y},P.copy=function(I){for(var y=0;y<_;y++)this.chars[y].copy(I.chars[y])},P.isEmpty=function(){for(var I=!0,y=0;y<_;y++)if(!this.chars[y].isEmpty()){I=!1;break}return I},P.setCursor=function(I){this.pos!==I&&(this.pos=I),this.pos<0?(this.logger.log(E.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>_&&(this.logger.log(E.DEBUG,"Too large cursor position "+this.pos),this.pos=_)},P.moveCursor=function(I){var y=this.pos+I;if(I>1)for(var k=this.pos+1;k<y+1;k++)this.chars[k].setPenState(this.currPenState);this.setCursor(y)},P.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},P.insertChar=function(I){I>=144&&this.backSpace();var y=f(I);if(this.pos>=_){this.logger.log(E.ERROR,"Cannot insert "+I.toString(16)+" ("+y+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(y,this.currPenState),this.moveCursor(1)},P.clearFromPos=function(I){var y;for(y=I;y<_;y++)this.chars[y].reset()},P.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},P.clearToEndOfRow=function(){this.clearFromPos(this.pos)},P.getTextString=function(){for(var I=[],y=!0,k=0;k<_;k++){var U=this.chars[k].uchar;U!==" "&&(y=!1),I.push(U)}return y?"":I.join("")},P.setPenStyles=function(I){this.currPenState.setStyles(I);var y=this.chars[this.pos];y.setPenState(this.currPenState)},B}(),w=function(){function B(F){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var I=0;I<c;I++)this.rows.push(new m(F));this.logger=F,this.currRow=c-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var P=B.prototype;return P.reset=function(){for(var I=0;I<c;I++)this.rows[I].clear();this.currRow=c-1},P.equals=function(I){for(var y=!0,k=0;k<c;k++)if(!this.rows[k].equals(I.rows[k])){y=!1;break}return y},P.copy=function(I){for(var y=0;y<c;y++)this.rows[y].copy(I.rows[y])},P.isEmpty=function(){for(var I=!0,y=0;y<c;y++)if(!this.rows[y].isEmpty()){I=!1;break}return I},P.backSpace=function(){var I=this.rows[this.currRow];I.backSpace()},P.clearToEndOfRow=function(){var I=this.rows[this.currRow];I.clearToEndOfRow()},P.insertChar=function(I){var y=this.rows[this.currRow];y.insertChar(I)},P.setPen=function(I){var y=this.rows[this.currRow];y.setPenStyles(I)},P.moveCursor=function(I){var y=this.rows[this.currRow];y.moveCursor(I)},P.setCursor=function(I){this.logger.log(E.INFO,"setCursor: "+I);var y=this.rows[this.currRow];y.setCursor(I)},P.setPAC=function(I){this.logger.log(E.INFO,"pacData = "+JSON.stringify(I));var y=I.row-1;if(this.nrRollUpRows&&y<this.nrRollUpRows-1&&(y=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==y){for(var k=0;k<c;k++)this.rows[k].clear();var U=this.currRow+1-this.nrRollUpRows,N=this.lastOutputScreen;if(N){var W=N.rows[U].cueStartTime,G=this.logger.time;if(W&&G!==null&&W<G)for(var z=0;z<this.nrRollUpRows;z++)this.rows[y-this.nrRollUpRows+z+1].copy(N.rows[U+z])}}this.currRow=y;var X=this.rows[this.currRow];if(I.indent!==null){var K=I.indent,$=Math.max(K-1,0);X.setCursor(I.indent),I.color=X.chars[$].penState.foreground}var q={foreground:I.color,underline:I.underline,italics:I.italics,background:"black",flash:!1};this.setPen(q)},P.setBkgData=function(I){this.logger.log(E.INFO,"bkgData = "+JSON.stringify(I)),this.backSpace(),this.setPen(I),this.insertChar(32)},P.setRollUpRows=function(I){this.nrRollUpRows=I},P.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(E.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(E.TEXT,this.getDisplayText());var I=this.currRow+1-this.nrRollUpRows,y=this.rows.splice(I,1)[0];y.clear(),this.rows.splice(this.currRow,0,y),this.logger.log(E.INFO,"Rolling up")},P.getDisplayText=function(I){I=I||!1;for(var y=[],k="",U=-1,N=0;N<c;N++){var W=this.rows[N].getTextString();W&&(U=N+1,I?y.push("Row "+U+": '"+W+"'"):y.push(W.trim()))}return y.length>0&&(I?k="["+y.join(" | ")+"]":k=y.join(`
`)),k},P.getTextAndFormat=function(){return this.rows},B}(),R=function(){function B(F,I,y){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=F,this.outputFilter=I,this.mode=null,this.verbose=0,this.displayedMemory=new w(y),this.nonDisplayedMemory=new w(y),this.lastOutputScreen=new w(y),this.currRollUpRow=this.displayedMemory.rows[c-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=y}var P=B.prototype;return P.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[c-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},P.getHandler=function(){return this.outputFilter},P.setHandler=function(I){this.outputFilter=I},P.setPAC=function(I){this.writeScreen.setPAC(I)},P.setBkgData=function(I){this.writeScreen.setBkgData(I)},P.setMode=function(I){I!==this.mode&&(this.mode=I,this.logger.log(E.INFO,"MODE="+I),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=I)},P.insertChars=function(I){for(var y=0;y<I.length;y++)this.writeScreen.insertChar(I[y]);var k=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(E.INFO,k+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(E.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},P.ccRCL=function(){this.logger.log(E.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},P.ccBS=function(){this.logger.log(E.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},P.ccAOF=function(){},P.ccAON=function(){},P.ccDER=function(){this.logger.log(E.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},P.ccRU=function(I){this.logger.log(E.INFO,"RU("+I+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(I)},P.ccFON=function(){this.logger.log(E.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},P.ccRDC=function(){this.logger.log(E.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},P.ccTR=function(){this.logger.log(E.INFO,"TR"),this.setMode("MODE_TEXT")},P.ccRTD=function(){this.logger.log(E.INFO,"RTD"),this.setMode("MODE_TEXT")},P.ccEDM=function(){this.logger.log(E.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},P.ccCR=function(){this.logger.log(E.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},P.ccENM=function(){this.logger.log(E.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},P.ccEOC=function(){if(this.logger.log(E.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var I=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=I,this.writeScreen=this.nonDisplayedMemory,this.logger.log(E.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},P.ccTO=function(I){this.logger.log(E.INFO,"TO("+I+") - Tab Offset"),this.writeScreen.moveCursor(I)},P.ccMIDROW=function(I){var y={flash:!1};if(y.underline=I%2===1,y.italics=I>=46,y.italics)y.foreground="white";else{var k=Math.floor(I/2)-16,U=["white","green","blue","cyan","red","yellow","magenta"];y.foreground=U[k]}this.logger.log(E.INFO,"MIDROW: "+JSON.stringify(y)),this.writeScreen.setPen(y)},P.outputDataUpdate=function(I){I===void 0&&(I=!1);var y=this.logger.time;y!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=y:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,y,this.lastOutputScreen),I&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:y),this.lastOutputScreen.copy(this.displayedMemory))},P.cueSplitAtTime=function(I){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,I,this.displayedMemory),this.cueStartTime=I))},B}(),M=function(){function B(F,I,y){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var k=new S;this.channels=[null,new R(F,I,k),new R(F+1,y,k)],this.cmdHistory=D(),this.logger=k}var P=B.prototype;return P.getHandler=function(I){return this.channels[I].getHandler()},P.setHandler=function(I,y){this.channels[I].setHandler(y)},P.addData=function(I,y){var k,U,N,W=!1;this.logger.time=I;for(var G=0;G<y.length;G+=2)if(U=y[G]&127,N=y[G+1]&127,!(U===0&&N===0)){if(this.logger.log(E.DATA,"["+L([y[G],y[G+1]])+"] -> ("+L([U,N])+")"),k=this.parseCmd(U,N),k||(k=this.parseMidrow(U,N)),k||(k=this.parsePAC(U,N)),k||(k=this.parseBackgroundAttributes(U,N)),!k&&(W=this.parseChars(U,N),W)){var z=this.currentChannel;if(z&&z>0){var X=this.channels[z];X.insertChars(W)}else this.logger.log(E.WARNING,"No channel found yet. TEXT-MODE?")}!k&&!W&&this.logger.log(E.WARNING,"Couldn't parse cleaned data "+L([U,N])+" orig: "+L([y[G],y[G+1]]))}},P.parseCmd=function(I,y){var k=this.cmdHistory,U=(I===20||I===28||I===21||I===29)&&y>=32&&y<=47,N=(I===23||I===31)&&y>=33&&y<=35;if(!(U||N))return!1;if(b(I,y,k))return C(null,null,k),this.logger.log(E.DEBUG,"Repeated command ("+L([I,y])+") is dropped"),!0;var W=I===20||I===21||I===23?1:2,G=this.channels[W];return I===20||I===21||I===28||I===29?y===32?G.ccRCL():y===33?G.ccBS():y===34?G.ccAOF():y===35?G.ccAON():y===36?G.ccDER():y===37?G.ccRU(2):y===38?G.ccRU(3):y===39?G.ccRU(4):y===40?G.ccFON():y===41?G.ccRDC():y===42?G.ccTR():y===43?G.ccRTD():y===44?G.ccEDM():y===45?G.ccCR():y===46?G.ccENM():y===47&&G.ccEOC():G.ccTO(y-32),C(I,y,k),this.currentChannel=W,!0},P.parseMidrow=function(I,y){var k=0;if((I===17||I===25)&&y>=32&&y<=47){if(I===17?k=1:k=2,k!==this.currentChannel)return this.logger.log(E.ERROR,"Mismatch channel in midrow parsing"),!1;var U=this.channels[k];return U?(U.ccMIDROW(y),this.logger.log(E.DEBUG,"MIDROW ("+L([I,y])+")"),!0):!1}return!1},P.parsePAC=function(I,y){var k,U=this.cmdHistory,N=(I>=17&&I<=23||I>=25&&I<=31)&&y>=64&&y<=127,W=(I===16||I===24)&&y>=64&&y<=95;if(!(N||W))return!1;if(b(I,y,U))return C(null,null,U),!0;var G=I<=23?1:2;y>=64&&y<=95?k=G===1?g[I]:p[I]:k=G===1?d[I]:v[I];var z=this.channels[G];return z?(z.setPAC(this.interpretPAC(k,y)),C(I,y,U),this.currentChannel=G,!0):!1},P.interpretPAC=function(I,y){var k,U={color:null,italics:!1,indent:null,underline:!1,row:I};return y>95?k=y-96:k=y-64,U.underline=(k&1)===1,k<=13?U.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(k/2)]:k<=15?(U.italics=!0,U.color="white"):U.indent=Math.floor((k-16)/2)*4,U},P.parseChars=function(I,y){var k,U=null,N=null;if(I>=25?(k=2,N=I-8):(k=1,N=I),N>=17&&N<=19){var W;N===17?W=y+80:N===18?W=y+112:W=y+144,this.logger.log(E.INFO,"Special char '"+f(W)+"' in channel "+k),U=[W]}else I>=32&&I<=127&&(U=y===0?[I]:[I,y]);if(U){var G=L(U);this.logger.log(E.DEBUG,"Char codes =  "+G.join(",")),C(I,y,this.cmdHistory)}return U},P.parseBackgroundAttributes=function(I,y){var k=(I===16||I===24)&&y>=32&&y<=47,U=(I===23||I===31)&&y>=45&&y<=47;if(!(k||U))return!1;var N,W={};I===16||I===24?(N=Math.floor((y-32)/2),W.background=A[N],y%2===1&&(W.background=W.background+"_semi")):y===45?W.background="transparent":(W.foreground="black",y===47&&(W.underline=!0));var G=I<=23?1:2,z=this.channels[G];return z.setBkgData(W),C(I,y,this.cmdHistory),!0},P.reset=function(){for(var I=0;I<Object.keys(this.channels).length;I++){var y=this.channels[I];y&&y.reset()}this.cmdHistory=D()},P.cueSplitAtTime=function(I){for(var y=0;y<this.channels.length;y++){var k=this.channels[y];k&&k.cueSplitAtTime(I)}},B}();function C(B,P,F){F.a=B,F.b=P}function b(B,P,F){return F.a===B&&F.b===P}function D(){return{a:null,b:null}}const O=M},"./src/utils/codecs.ts":(a,o,l)=>{l.r(o),l.d(o,{isCodecSupportedInMp4:()=>f,isCodecType:()=>u});var h={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function u(c,_){var g=h[_];return!!g&&g[c.slice(0,4)]===!0}function f(c,_){return MediaSource.isTypeSupported((_||"video")+'/mp4;codecs="'+c+'"')}},"./src/utils/cues.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>g});var h=l("./src/utils/vttparser.ts"),u=l("./src/utils/webvtt-parser.ts"),f=l("./src/utils/texttrack-utils.ts"),c=/\s/,_={newCue:function(p,v,A,E){for(var S=[],L,T,x,m,w,R=self.VTTCue||self.TextTrackCue,M=0;M<E.rows.length;M++)if(L=E.rows[M],x=!0,m=0,w="",!L.isEmpty()){for(var C=0;C<L.chars.length;C++)c.test(L.chars[C].uchar)&&x?m++:(w+=L.chars[C].uchar,x=!1);L.cueStartTime=v,v===A&&(A+=1e-4),m>=16?m--:m++;var b=(0,h.fixLineBreaks)(w.trim()),D=(0,u.generateCueId)(v,A,b);(!p||!p.cues||!p.cues.getCueById(D))&&(T=new R(v,A,b),T.id=D,T.line=M+1,T.align="left",T.position=10+Math.min(80,Math.floor(m*8/32)*10),S.push(T))}return p&&S.length&&(S.sort(function(O,B){return O.line==="auto"||B.line==="auto"?0:O.line>8&&B.line>8?B.line-O.line:O.line-B.line}),S.forEach(function(O){return(0,f.addCueToTrack)(p,O)})),S}};const g=_},"./src/utils/discontinuities.ts":(a,o,l)=>{l.r(o),l.d(o,{adjustSlidingStart:()=>p,alignMediaPlaylistByPDT:()=>S,alignPDT:()=>E,alignStream:()=>v,findDiscontinuousReferenceFrag:()=>g,findFirstFragWithCC:()=>c,shouldAlignOnDiscontinuities:()=>_});var h=l("./src/polyfills/number.ts"),u=l("./src/utils/logger.ts"),f=l("./src/controller/level-helper.ts");function c(L,T){for(var x=null,m=0,w=L.length;m<w;m++){var R=L[m];if(R&&R.cc===T){x=R;break}}return x}function _(L,T,x){return!!(T.details&&(x.endCC>x.startCC||L&&L.cc<x.startCC))}function g(L,T,x){var m=L.fragments,w=T.fragments;if(!w.length||!m.length){u.logger.log("No fragments to align");return}var R=c(m,w[0].cc);if(!R||R&&!R.startPTS){u.logger.log("No frag in previous level to align on");return}return R}function d(L,T){if(L){var x=L.start+T;L.start=L.startPTS=x,L.endPTS=x+L.duration}}function p(L,T){for(var x=T.fragments,m=0,w=x.length;m<w;m++)d(x[m],L);T.fragmentHint&&d(T.fragmentHint,L),T.alignedSliding=!0}function v(L,T,x){!T||(A(L,x,T),!x.alignedSliding&&T.details&&E(x,T.details),!x.alignedSliding&&T.details&&!x.skippedSegments&&(0,f.adjustSliding)(T.details,x))}function A(L,T,x){if(_(L,x,T)){var m=g(x.details,T);m&&(0,h.isFiniteNumber)(m.start)&&(u.logger.log("Adjusting PTS using last level due to CC increase within current level "+T.url),p(m.start,T))}}function E(L,T){if(!(!T.fragments.length||!L.hasProgramDateTime||!T.hasProgramDateTime)){var x=T.fragments[0].programDateTime,m=L.fragments[0].programDateTime,w=(m-x)/1e3+T.fragments[0].start;w&&(0,h.isFiniteNumber)(w)&&(u.logger.log("Adjusting PTS using programDateTime delta "+(m-x)+"ms, sliding:"+w.toFixed(3)+" "+L.url+" "),p(w,L))}}function S(L,T){if(!(!L.hasProgramDateTime||!T.hasProgramDateTime)){var x=L.fragments,m=T.fragments;if(!(!x.length||!m.length)){var w=Math.round(m.length/2)-1,R=m[w],M=c(x,R.cc)||x[Math.round(x.length/2)-1],C=R.programDateTime,b=M.programDateTime;if(!(C===null||b===null)){var D=(b-C)/1e3-(M.start-R.start);p(D,L)}}}}},"./src/utils/ewma-bandwidth-estimator.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>f});var h=l("./src/utils/ewma.ts"),u=function(){function c(g,d,p){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=p,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new h.default(g),this.fast_=new h.default(d)}var _=c.prototype;return _.update=function(d,p){var v=this.slow_,A=this.fast_;this.slow_.halfLife!==d&&(this.slow_=new h.default(d,v.getEstimate(),v.getTotalWeight())),this.fast_.halfLife!==p&&(this.fast_=new h.default(p,A.getEstimate(),A.getTotalWeight()))},_.sample=function(d,p){d=Math.max(d,this.minDelayMs_);var v=8*p,A=d/1e3,E=v/A;this.fast_.sample(A,E),this.slow_.sample(A,E)},_.canEstimate=function(){var d=this.fast_;return d&&d.getTotalWeight()>=this.minWeight_},_.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},_.destroy=function(){},c}();const f=u},"./src/utils/ewma.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>u});var h=function(){function f(_,g,d){g===void 0&&(g=0),d===void 0&&(d=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=_,this.alpha_=_?Math.exp(Math.log(.5)/_):0,this.estimate_=g,this.totalWeight_=d}var c=f.prototype;return c.sample=function(g,d){var p=Math.pow(this.alpha_,g);this.estimate_=d*(1-p)+p*this.estimate_,this.totalWeight_+=g},c.getTotalWeight=function(){return this.totalWeight_},c.getEstimate=function(){if(this.alpha_){var g=1-Math.pow(this.alpha_,this.totalWeight_);if(g)return this.estimate_/g}return this.estimate_},f}();const u=h},"./src/utils/fetch-loader.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>w,fetchSupported:()=>S});var h=l("./src/polyfills/number.ts"),u=l("./src/loader/load-stats.ts"),f=l("./src/demux/chunk-cache.ts");function c(R,M){R.prototype=Object.create(M.prototype),R.prototype.constructor=R,v(R,M)}function _(R){var M=typeof Map=="function"?new Map:void 0;return _=function(b){if(b===null||!p(b))return b;if(typeof b!="function")throw new TypeError("Super expression must either be null or a function");if(typeof M<"u"){if(M.has(b))return M.get(b);M.set(b,D)}function D(){return g(b,arguments,A(this).constructor)}return D.prototype=Object.create(b.prototype,{constructor:{value:D,enumerable:!1,writable:!0,configurable:!0}}),v(D,b)},_(R)}function g(R,M,C){return d()?g=Reflect.construct.bind():g=function(D,O,B){var P=[null];P.push.apply(P,O);var F=Function.bind.apply(D,P),I=new F;return B&&v(I,B.prototype),I},g.apply(null,arguments)}function d(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function p(R){return Function.toString.call(R).indexOf("[native code]")!==-1}function v(R,M){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(b,D){return b.__proto__=D,b},v(R,M)}function A(R){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(C){return C.__proto__||Object.getPrototypeOf(C)},A(R)}function E(){return E=Object.assign?Object.assign.bind():function(R){for(var M=1;M<arguments.length;M++){var C=arguments[M];for(var b in C)Object.prototype.hasOwnProperty.call(C,b)&&(R[b]=C[b])}return R},E.apply(this,arguments)}function S(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var L=function(){function R(C){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=C.fetchSetup||x,this.controller=new self.AbortController,this.stats=new u.LoadStats}var M=R.prototype;return M.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},M.abortInternal=function(){var b=this.response;(!b||!b.ok)&&(this.stats.aborted=!0,this.controller.abort())},M.abort=function(){var b;this.abortInternal(),(b=this.callbacks)!==null&&b!==void 0&&b.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},M.load=function(b,D,O){var B=this,P=this.stats;if(P.loading.start)throw new Error("Loader can only be used once.");P.loading.start=self.performance.now();var F=T(b,this.controller.signal),I=O.onProgress,y=b.responseType==="arraybuffer",k=y?"byteLength":"length";this.context=b,this.config=D,this.callbacks=O,this.request=this.fetchSetup(b,F),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){B.abortInternal(),O.onTimeout(P,b,B.response)},D.timeout),self.fetch(this.request).then(function(U){if(B.response=B.loader=U,!U.ok){var N=U.status,W=U.statusText;throw new m(W||"fetch, bad network response",N,U)}return P.loading.first=Math.max(self.performance.now(),P.loading.start),P.total=parseInt(U.headers.get("Content-Length")||"0"),I&&(0,h.isFiniteNumber)(D.highWaterMark)?B.loadProgressively(U,P,b,D.highWaterMark,I):y?U.arrayBuffer():U.text()}).then(function(U){var N=B.response;self.clearTimeout(B.requestTimeout),P.loading.end=Math.max(self.performance.now(),P.loading.first),P.loaded=P.total=U[k];var W={url:N.url,data:U};I&&!(0,h.isFiniteNumber)(D.highWaterMark)&&I(P,b,U,N),O.onSuccess(W,P,b,N)}).catch(function(U){if(self.clearTimeout(B.requestTimeout),!P.aborted){var N=U&&U.code||0,W=U?U.message:null;O.onError({code:N,text:W},b,U?U.details:null)}})},M.getCacheAge=function(){var b=null;if(this.response){var D=this.response.headers.get("age");b=D?parseFloat(D):null}return b},M.loadProgressively=function(b,D,O,B,P){B===void 0&&(B=0);var F=new f.default,I=b.body.getReader(),y=function k(){return I.read().then(function(U){if(U.done)return F.dataLength&&P(D,O,F.flush(),b),Promise.resolve(new ArrayBuffer(0));var N=U.value,W=N.length;return D.loaded+=W,W<B||F.dataLength?(F.push(N),F.dataLength>=B&&P(D,O,F.flush(),b)):P(D,O,N,b),k()}).catch(function(){return Promise.reject()})};return y()},R}();function T(R,M){var C={method:"GET",mode:"cors",credentials:"same-origin",signal:M,headers:new self.Headers(E({},R.headers))};return R.rangeEnd&&C.headers.set("Range","bytes="+R.rangeStart+"-"+String(R.rangeEnd-1)),C}function x(R,M){return new self.Request(R.url,M)}var m=function(R){c(M,R);function M(C,b,D){var O;return O=R.call(this,C)||this,O.code=void 0,O.details=void 0,O.code=b,O.details=D,O}return M}(_(Error));const w=L},"./src/utils/imsc1-ttml-parser.ts":(a,o,l)=>{l.r(o),l.d(o,{IMSC1_CODEC:()=>p,parseIMSC1:()=>S});var h=l("./src/utils/mp4-tools.ts"),u=l("./src/utils/vttparser.ts"),f=l("./src/utils/vttcue.ts"),c=l("./src/demux/id3.ts"),_=l("./src/utils/timescale-conversion.ts"),g=l("./src/utils/webvtt-parser.ts");function d(){return d=Object.assign?Object.assign.bind():function(O){for(var B=1;B<arguments.length;B++){var P=arguments[B];for(var F in P)Object.prototype.hasOwnProperty.call(P,F)&&(O[F]=P[F])}return O},d.apply(this,arguments)}var p="stpp.ttml.im1t",v=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,A=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,E={left:"start",center:"center",right:"end",start:"start",end:"end"};function S(O,B,P,F,I){var y=(0,h.findBox)(new Uint8Array(O),["mdat"]);if(y.length===0){I(new Error("Could not parse IMSC1 mdat"));return}var k=y.map(function(N){return(0,c.utf8ArrayToStr)(N)}),U=(0,_.toTimescaleFromScale)(B,1,P);try{k.forEach(function(N){return F(L(N,U))})}catch(N){I(N)}}function L(O,B){var P=new DOMParser,F=P.parseFromString(O,"text/xml"),I=F.getElementsByTagName("tt")[0];if(!I)throw new Error("Invalid ttml");var y={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},k=Object.keys(y).reduce(function(z,X){return z[X]=I.getAttribute("ttp:"+X)||y[X],z},{}),U=I.getAttribute("xml:space")!=="preserve",N=x(T(I,"styling","style")),W=x(T(I,"layout","region")),G=T(I,"body","[begin]");return[].map.call(G,function(z){var X=m(z,U);if(!X||!z.hasAttribute("begin"))return null;var K=C(z.getAttribute("begin"),k),$=C(z.getAttribute("dur"),k),q=C(z.getAttribute("end"),k);if(K===null)throw M(z);if(q===null){if($===null)throw M(z);q=K+$}var J=new f.default(K-B,q-B,X);J.id=(0,g.generateCueId)(J.startTime,J.endTime,J.text);var Q=W[z.getAttribute("region")],rt=N[z.getAttribute("style")];J.position=10,J.size=80;var mt=w(Q,rt,N),vt=mt.textAlign;if(vt){var _t=E[vt];_t&&(J.lineAlign=_t),J.align=vt}return d(J,mt),J}).filter(function(z){return z!==null})}function T(O,B,P){var F=O.getElementsByTagName(B)[0];return F?[].slice.call(F.querySelectorAll(P)):[]}function x(O){return O.reduce(function(B,P){var F=P.getAttribute("xml:id");return F&&(B[F]=P),B},{})}function m(O,B){return[].slice.call(O.childNodes).reduce(function(P,F,I){var y;return F.nodeName==="br"&&I?P+`
`:(y=F.childNodes)!==null&&y!==void 0&&y.length?m(F,B):B?P+F.textContent.trim().replace(/\s+/g," "):P+F.textContent},"")}function w(O,B,P){var F="http://www.w3.org/ns/ttml#styling",I=null,y=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],k=O!=null&&O.hasAttribute("style")?O.getAttribute("style"):null;return k&&P.hasOwnProperty(k)&&(I=P[k]),y.reduce(function(U,N){var W=R(B,F,N)||R(O,F,N)||R(I,F,N);return W&&(U[N]=W),U},{})}function R(O,B,P){return O&&O.hasAttributeNS(B,P)?O.getAttributeNS(B,P):null}function M(O){return new Error("Could not parse ttml timestamp "+O)}function C(O,B){if(!O)return null;var P=(0,u.parseTimeStamp)(O);return P===null&&(v.test(O)?P=b(O,B):A.test(O)&&(P=D(O,B))),P}function b(O,B){var P=v.exec(O),F=(P[4]|0)+(P[5]|0)/B.subFrameRate;return(P[1]|0)*3600+(P[2]|0)*60+(P[3]|0)+F/B.frameRate}function D(O,B){var P=A.exec(O),F=Number(P[1]),I=P[2];switch(I){case"h":return F*3600;case"m":return F*60;case"ms":return F*1e3;case"f":return F/B.frameRate;case"t":return F/B.tickRate}return F}},"./src/utils/logger.ts":(a,o,l)=>{l.r(o),l.d(o,{enableLogs:()=>g,logger:()=>d});var h=function(){},u={trace:h,debug:h,log:h,warn:h,info:h,error:h},f=u;function c(p){var v=self.console[p];return v?v.bind(self.console,"["+p+"] >"):h}function _(p){for(var v=arguments.length,A=new Array(v>1?v-1:0),E=1;E<v;E++)A[E-1]=arguments[E];A.forEach(function(S){f[S]=p[S]?p[S].bind(p):c(S)})}function g(p,v){if(self.console&&p===!0||typeof p=="object"){_(p,"debug","log","info","warn","error");try{f.log('Debug logs enabled for "'+v+'"')}catch{f=u}}else f=u}var d=f},"./src/utils/mediakeys-helper.ts":(a,o,l)=>{l.r(o),l.d(o,{KeySystems:()=>h,requestMediaKeySystemAccess:()=>u});var h;(function(f){f.WIDEVINE="com.widevine.alpha",f.PLAYREADY="com.microsoft.playready"})(h||(h={}));var u=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":(a,o,l)=>{l.r(o),l.d(o,{getMediaSource:()=>h});function h(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":(a,o,l)=>{l.r(o),l.d(o,{RemuxerTrackIdConfig:()=>g,appendUint8Array:()=>C,bin2str:()=>d,computeRawDurationFromSamples:()=>w,discardEPB:()=>P,findBox:()=>S,getDuration:()=>m,getStartDTS:()=>x,offsetStartDTS:()=>R,parseEmsg:()=>F,parseInitSegment:()=>T,parseSEIMessageFromNALu:()=>B,parseSamples:()=>b,parseSegmentIndex:()=>L,readSint32:()=>A,readUint16:()=>p,readUint32:()=>v,segmentValidRange:()=>M,writeUint32:()=>E});var h=l("./src/utils/typed-array.ts"),u=l("./src/loader/fragment.ts"),f=l("./src/demux/id3.ts"),c=Math.pow(2,32)-1,_=[].push,g={video:1,audio:2,id3:3,text:4};function d(I){return String.fromCharCode.apply(null,I)}function p(I,y){var k=I[y]<<8|I[y+1];return k<0?65536+k:k}function v(I,y){var k=A(I,y);return k<0?4294967296+k:k}function A(I,y){return I[y]<<24|I[y+1]<<16|I[y+2]<<8|I[y+3]}function E(I,y,k){I[y]=k>>24,I[y+1]=k>>16&255,I[y+2]=k>>8&255,I[y+3]=k&255}function S(I,y){var k=[];if(!y.length)return k;for(var U=I.byteLength,N=0;N<U;){var W=v(I,N),G=d(I.subarray(N+4,N+8)),z=W>1?N+W:U;if(G===y[0])if(y.length===1)k.push(I.subarray(N+8,z));else{var X=S(I.subarray(N+8,z),y.slice(1));X.length&&_.apply(k,X)}N=z}return k}function L(I){var y=[],k=I[0],U=8,N=v(I,U);U+=4;var W=0,G=0;k===0?U+=8:U+=16,U+=2;var z=I.length+G,X=p(I,U);U+=2;for(var K=0;K<X;K++){var $=U,q=v(I,$);$+=4;var J=q&2147483647,Q=(q&2147483648)>>>31;if(Q===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var rt=v(I,$);$+=4,y.push({referenceSize:J,subsegmentDuration:rt,info:{duration:rt/N,start:z,end:z+J-1}}),z+=J,$+=4,U=$}return{earliestPresentationTime:W,timescale:N,version:k,referencesCount:X,references:y}}function T(I){for(var y=[],k=S(I,["moov","trak"]),U=0;U<k.length;U++){var N=k[U],W=S(N,["tkhd"])[0];if(W){var G=W[0],z=G===0?12:20,X=v(W,z),K=S(N,["mdia","mdhd"])[0];if(K){G=K[0],z=G===0?12:20;var $=v(K,z),q=S(N,["mdia","hdlr"])[0];if(q){var J=d(q.subarray(8,12)),Q={soun:u.ElementaryStreamTypes.AUDIO,vide:u.ElementaryStreamTypes.VIDEO}[J];if(Q){var rt=S(N,["mdia","minf","stbl","stsd"])[0],mt=void 0;rt&&(mt=d(rt.subarray(12,16))),y[X]={timescale:$,type:Q},y[Q]={timescale:$,id:X,codec:mt}}}}}}var vt=S(I,["moov","mvex","trex"]);return vt.forEach(function(_t){var tt=v(_t,4),Lt=y[tt];Lt&&(Lt.default={duration:v(_t,12),flags:v(_t,20)})}),y}function x(I,y){return S(y,["moof","traf"]).reduce(function(k,U){var N=S(U,["tfdt"])[0],W=N[0],G=S(U,["tfhd"]).reduce(function(z,X){var K=v(X,4),$=I[K];if($){var q=v(N,4);W===1&&(q*=Math.pow(2,32),q+=v(N,8));var J=$.timescale||9e4,Q=q/J;if(isFinite(Q)&&(z===null||Q<z))return Q}return z},null);return G!==null&&isFinite(G)&&(k===null||G<k)?G:k},null)||0}function m(I,y){for(var k=0,U=0,N=0,W=S(I,["moof","traf"]),G=0;G<W.length;G++){var z=W[G],X=S(z,["tfhd"])[0],K=v(X,4),$=y[K];if(!!$){var q=$.default,J=v(X,0)|(q==null?void 0:q.flags),Q=q==null?void 0:q.duration;J&8&&(J&2?Q=v(X,12):Q=v(X,8));for(var rt=$.timescale||9e4,mt=S(z,["trun"]),vt=0;vt<mt.length;vt++){if(k=w(mt[vt]),!k&&Q){var _t=v(mt[vt],4);k=Q*_t}$.type===u.ElementaryStreamTypes.VIDEO?U+=k/rt:$.type===u.ElementaryStreamTypes.AUDIO&&(N+=k/rt)}}}if(U===0&&N===0){for(var tt=0,Lt=S(I,["sidx"]),dt=0;dt<Lt.length;dt++){var Tt=L(Lt[dt]);Tt!=null&&Tt.references&&(tt+=Tt.references.reduce(function(Ht,Y){return Ht+Y.info.duration||0},0))}return tt}return U||N}function w(I){var y=v(I,0),k=8;y&1&&(k+=4),y&4&&(k+=4);for(var U=0,N=v(I,4),W=0;W<N;W++){if(y&256){var G=v(I,k);U+=G,k+=4}y&512&&(k+=4),y&1024&&(k+=4),y&2048&&(k+=4)}return U}function R(I,y,k){S(y,["moof","traf"]).forEach(function(U){S(U,["tfhd"]).forEach(function(N){var W=v(N,4),G=I[W];if(!!G){var z=G.timescale||9e4;S(U,["tfdt"]).forEach(function(X){var K=X[0],$=v(X,4);if(K===0)$-=k*z,$=Math.max($,0),E(X,4,$);else{$*=Math.pow(2,32),$+=v(X,8),$-=k*z,$=Math.max($,0);var q=Math.floor($/(c+1)),J=Math.floor($%(c+1));E(X,4,q),E(X,8,J)}})}})})}function M(I){var y={valid:null,remainder:null},k=S(I,["moof"]);if(k){if(k.length<2)return y.remainder=I,y}else return y;var U=k[k.length-1];return y.valid=(0,h.sliceUint8)(I,0,U.byteOffset-8),y.remainder=(0,h.sliceUint8)(I,U.byteOffset-8),y}function C(I,y){var k=new Uint8Array(I.length+y.length);return k.set(I),k.set(y,I.length),k}function b(I,y){var k=[],U=y.samples,N=y.timescale,W=y.id,G=!1,z=S(U,["moof"]);return z.map(function(X){var K=X.byteOffset-8,$=S(X,["traf"]);$.map(function(q){var J=S(q,["tfdt"]).map(function(Q){var rt=Q[0],mt=v(Q,4);return rt===1&&(mt*=Math.pow(2,32),mt+=v(Q,8)),mt/N})[0];return J!==void 0&&(I=J),S(q,["tfhd"]).map(function(Q){var rt=v(Q,4),mt=v(Q,0)&16777215,vt=(mt&1)!==0,_t=(mt&2)!==0,tt=(mt&8)!==0,Lt=0,dt=(mt&16)!==0,Tt=0,Ht=(mt&32)!==0,Y=8;rt===W&&(vt&&(Y+=8),_t&&(Y+=4),tt&&(Lt=v(Q,Y),Y+=4),dt&&(Tt=v(Q,Y),Y+=4),Ht&&(Y+=4),y.type==="video"&&(G=D(y.codec)),S(q,["trun"]).map(function(V){var it=V[0],at=v(V,0)&16777215,ut=(at&1)!==0,ct=0,St=(at&4)!==0,gt=(at&256)!==0,ht=0,wt=(at&512)!==0,Nt=0,Mt=(at&1024)!==0,Ut=(at&2048)!==0,Vt=0,Ft=v(V,4),Z=8;ut&&(ct=v(V,Z),Z+=4),St&&(Z+=4);for(var Et=ct+K,yt=0;yt<Ft;yt++){if(gt?(ht=v(V,Z),Z+=4):ht=Lt,wt?(Nt=v(V,Z),Z+=4):Nt=Tt,Mt&&(Z+=4),Ut&&(it===0?Vt=v(V,Z):Vt=A(V,Z),Z+=4),y.type===u.ElementaryStreamTypes.VIDEO)for(var lt=0;lt<Nt;){var xt=v(U,Et);if(Et+=4,O(G,U[Et])){var Bt=U.subarray(Et,Et+xt);B(Bt,G?2:1,I+Vt/N,k)}Et+=xt,lt+=xt+4}I+=ht/N}}))})})}),k}function D(I){if(!I)return!1;var y=I.indexOf("."),k=y<0?I:I.substring(0,y);return k==="hvc1"||k==="hev1"||k==="dvh1"||k==="dvhe"}function O(I,y){if(I){var k=y>>1&63;return k===39||k===40}else{var U=y&31;return U===6}}function B(I,y,k,U){var N=P(I),W=0;W+=y;for(var G=0,z=0,X=!1,K=0;W<N.length;){G=0;do{if(W>=N.length)break;K=N[W++],G+=K}while(K===255);z=0;do{if(W>=N.length)break;K=N[W++],z+=K}while(K===255);var $=N.length-W;if(!X&&G===4&&W<N.length){X=!0;var q=N[W++];if(q===181){var J=p(N,W);if(W+=2,J===49){var Q=v(N,W);if(W+=4,Q===1195456820){var rt=N[W++];if(rt===3){var mt=N[W++],vt=31&mt,_t=64&mt,tt=_t?2+vt*3:0,Lt=new Uint8Array(tt);if(_t){Lt[0]=mt;for(var dt=1;dt<tt;dt++)Lt[dt]=N[W++]}U.push({type:rt,payloadType:G,pts:k,bytes:Lt})}}}}}else if(G===5&&z<$){if(X=!0,z>16){for(var Tt=[],Ht=0;Ht<16;Ht++){var Y=N[W++].toString(16);Tt.push(Y.length==1?"0"+Y:Y),(Ht===3||Ht===5||Ht===7||Ht===9)&&Tt.push("-")}for(var V=z-16,it=new Uint8Array(V),at=0;at<V;at++)it[at]=N[W++];U.push({payloadType:G,pts:k,uuid:Tt.join(""),userData:(0,f.utf8ArrayToStr)(it),userDataBytes:it})}}else if(z<$)W+=z;else if(z>$)break}}function P(I){for(var y=I.byteLength,k=[],U=1;U<y-2;)I[U]===0&&I[U+1]===0&&I[U+2]===3?(k.push(U+2),U+=2):U++;if(k.length===0)return I;var N=y-k.length,W=new Uint8Array(N),G=0;for(U=0;U<N;G++,U++)G===k[0]&&(G++,k.shift()),W[U]=I[G];return W}function F(I){var y=I[0],k="",U="",N=0,W=0,G=0,z=0,X=0,K=0;if(y===0){for(;d(I.subarray(K,K+1))!=="\0";)k+=d(I.subarray(K,K+1)),K+=1;for(k+=d(I.subarray(K,K+1)),K+=1;d(I.subarray(K,K+1))!=="\0";)U+=d(I.subarray(K,K+1)),K+=1;U+=d(I.subarray(K,K+1)),K+=1,N=v(I,12),W=v(I,16),z=v(I,20),X=v(I,24),K=28}else if(y===1){K+=4,N=v(I,K),K+=4;var $=v(I,K);K+=4;var q=v(I,K);for(K+=4,G=Math.pow(2,32)*$+q,Number.isSafeInteger(G)||(G=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),z=v(I,K),K+=4,X=v(I,K),K+=4;d(I.subarray(K,K+1))!=="\0";)k+=d(I.subarray(K,K+1)),K+=1;for(k+=d(I.subarray(K,K+1)),K+=1;d(I.subarray(K,K+1))!=="\0";)U+=d(I.subarray(K,K+1)),K+=1;U+=d(I.subarray(K,K+1)),K+=1}var J=I.subarray(K,I.byteLength);return{schemeIdUri:k,value:U,timeScale:N,presentationTime:G,presentationTimeDelta:W,eventDuration:z,id:X,payload:J}}},"./src/utils/output-filter.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>h});var h=function(){function u(c,_){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=c,this.trackName=_}var f=u.prototype;return f.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},f.newCue=function(_,g,d){(this.startTime===null||this.startTime>_)&&(this.startTime=_),this.endTime=g,this.screen=d,this.timelineController.createCaptionsTrack(this.trackName)},f.reset=function(){this.cueRanges=[],this.startTime=null},u}()},"./src/utils/texttrack-utils.ts":(a,o,l)=>{l.r(o),l.d(o,{addCueToTrack:()=>f,clearCurrentCues:()=>c,getCuesInRange:()=>d,removeCuesInRange:()=>_,sendAddTrackEvent:()=>u});var h=l("./src/utils/logger.ts");function u(p,v){var A;try{A=new Event("addtrack")}catch{A=document.createEvent("Event"),A.initEvent("addtrack",!1,!1)}A.track=p,v.dispatchEvent(A)}function f(p,v){var A=p.mode;if(A==="disabled"&&(p.mode="hidden"),p.cues&&!p.cues.getCueById(v.id))try{if(p.addCue(v),!p.cues.getCueById(v.id))throw new Error("addCue is failed for: "+v)}catch(S){h.logger.debug("[texttrack-utils]: "+S);var E=new self.TextTrackCue(v.startTime,v.endTime,v.text);E.id=v.id,p.addCue(E)}A==="disabled"&&(p.mode=A)}function c(p){var v=p.mode;if(v==="disabled"&&(p.mode="hidden"),p.cues)for(var A=p.cues.length;A--;)p.removeCue(p.cues[A]);v==="disabled"&&(p.mode=v)}function _(p,v,A,E){var S=p.mode;if(S==="disabled"&&(p.mode="hidden"),p.cues&&p.cues.length>0)for(var L=d(p.cues,v,A),T=0;T<L.length;T++)(!E||E(L[T]))&&p.removeCue(L[T]);S==="disabled"&&(p.mode=S)}function g(p,v){if(v<p[0].startTime)return 0;var A=p.length-1;if(v>p[A].endTime)return-1;for(var E=0,S=A;E<=S;){var L=Math.floor((S+E)/2);if(v<p[L].startTime)S=L-1;else if(v>p[L].startTime&&E<A)E=L+1;else return L}return p[E].startTime-v<v-p[S].startTime?E:S}function d(p,v,A){var E=[],S=g(p,v);if(S>-1)for(var L=S,T=p.length;L<T;L++){var x=p[L];if(x.startTime>=v&&x.endTime<=A)E.push(x);else if(x.startTime>A)return E}return E}},"./src/utils/time-ranges.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>u});var h={toString:function(c){for(var _="",g=c.length,d=0;d<g;d++)_+="["+c.start(d).toFixed(3)+","+c.end(d).toFixed(3)+"]";return _}};const u=h},"./src/utils/timescale-conversion.ts":(a,o,l)=>{l.r(o),l.d(o,{toMpegTsClockFromTimescale:()=>_,toMsFromMpegTsClock:()=>c,toTimescaleFromBase:()=>u,toTimescaleFromScale:()=>f});var h=9e4;function u(g,d,p,v){p===void 0&&(p=1),v===void 0&&(v=!1);var A=g*d*p;return v?Math.round(A):A}function f(g,d,p,v){return p===void 0&&(p=1),v===void 0&&(v=!1),u(g,d,1/p,v)}function c(g,d){return d===void 0&&(d=!1),u(g,1e3,1/h,d)}function _(g,d){return d===void 0&&(d=1),u(g,h,1/d)}},"./src/utils/typed-array.ts":(a,o,l)=>{l.r(o),l.d(o,{sliceUint8:()=>h});function h(u,f,c){return Uint8Array.prototype.slice?u.slice(f,c):new Uint8Array(Array.prototype.slice.call(u,f,c))}},"./src/utils/vttcue.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>h});const h=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var u=["","lr","rl"],f=["start","middle","end","left","right"];function c(v,A){if(typeof A!="string"||!Array.isArray(v))return!1;var E=A.toLowerCase();return~v.indexOf(E)?E:!1}function _(v){return c(u,v)}function g(v){return c(f,v)}function d(v){for(var A=arguments.length,E=new Array(A>1?A-1:0),S=1;S<A;S++)E[S-1]=arguments[S];for(var L=1;L<arguments.length;L++){var T=arguments[L];for(var x in T)v[x]=T[x]}return v}function p(v,A,E){var S=this,L={enumerable:!0};S.hasBeenReset=!1;var T="",x=!1,m=v,w=A,R=E,M=null,C="",b=!0,D="auto",O="start",B=50,P="middle",F=50,I="middle";Object.defineProperty(S,"id",d({},L,{get:function(){return T},set:function(k){T=""+k}})),Object.defineProperty(S,"pauseOnExit",d({},L,{get:function(){return x},set:function(k){x=!!k}})),Object.defineProperty(S,"startTime",d({},L,{get:function(){return m},set:function(k){if(typeof k!="number")throw new TypeError("Start time must be set to a number.");m=k,this.hasBeenReset=!0}})),Object.defineProperty(S,"endTime",d({},L,{get:function(){return w},set:function(k){if(typeof k!="number")throw new TypeError("End time must be set to a number.");w=k,this.hasBeenReset=!0}})),Object.defineProperty(S,"text",d({},L,{get:function(){return R},set:function(k){R=""+k,this.hasBeenReset=!0}})),Object.defineProperty(S,"region",d({},L,{get:function(){return M},set:function(k){M=k,this.hasBeenReset=!0}})),Object.defineProperty(S,"vertical",d({},L,{get:function(){return C},set:function(k){var U=_(k);if(U===!1)throw new SyntaxError("An invalid or illegal string was specified.");C=U,this.hasBeenReset=!0}})),Object.defineProperty(S,"snapToLines",d({},L,{get:function(){return b},set:function(k){b=!!k,this.hasBeenReset=!0}})),Object.defineProperty(S,"line",d({},L,{get:function(){return D},set:function(k){if(typeof k!="number"&&k!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");D=k,this.hasBeenReset=!0}})),Object.defineProperty(S,"lineAlign",d({},L,{get:function(){return O},set:function(k){var U=g(k);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");O=U,this.hasBeenReset=!0}})),Object.defineProperty(S,"position",d({},L,{get:function(){return B},set:function(k){if(k<0||k>100)throw new Error("Position must be between 0 and 100.");B=k,this.hasBeenReset=!0}})),Object.defineProperty(S,"positionAlign",d({},L,{get:function(){return P},set:function(k){var U=g(k);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");P=U,this.hasBeenReset=!0}})),Object.defineProperty(S,"size",d({},L,{get:function(){return F},set:function(k){if(k<0||k>100)throw new Error("Size must be between 0 and 100.");F=k,this.hasBeenReset=!0}})),Object.defineProperty(S,"align",d({},L,{get:function(){return I},set:function(k){var U=g(k);if(!U)throw new SyntaxError("An invalid or illegal string was specified.");I=U,this.hasBeenReset=!0}})),S.displayState=void 0}return p.prototype.getCueAsHTML=function(){var v=self.WebVTT;return v.convertCueToDOMTree(self,this.text)},p}()},"./src/utils/vttparser.ts":(a,o,l)=>{l.r(o),l.d(o,{VTTParser:()=>A,fixLineBreaks:()=>v,parseTimeStamp:()=>f});var h=l("./src/utils/vttcue.ts"),u=function(){function E(){}var S=E.prototype;return S.decode=function(T,x){if(!T)return"";if(typeof T!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(T))},E}();function f(E){function S(T,x,m,w){return(T|0)*3600+(x|0)*60+(m|0)+parseFloat(w||0)}var L=E.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return L?parseFloat(L[2])>59?S(L[2],L[3],0,L[4]):S(L[1],L[2],L[3],L[4]):null}var c=function(){function E(){this.values=Object.create(null)}var S=E.prototype;return S.set=function(T,x){!this.get(T)&&x!==""&&(this.values[T]=x)},S.get=function(T,x,m){return m?this.has(T)?this.values[T]:x[m]:this.has(T)?this.values[T]:x},S.has=function(T){return T in this.values},S.alt=function(T,x,m){for(var w=0;w<m.length;++w)if(x===m[w]){this.set(T,x);break}},S.integer=function(T,x){/^-?\d+$/.test(x)&&this.set(T,parseInt(x,10))},S.percent=function(T,x){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(x)){var m=parseFloat(x);if(m>=0&&m<=100)return this.set(T,m),!0}return!1},E}();function _(E,S,L,T){var x=T?E.split(T):[E];for(var m in x)if(typeof x[m]=="string"){var w=x[m].split(L);if(w.length===2){var R=w[0],M=w[1];S(R,M)}}}var g=new h.default(0,0,""),d=g.align==="middle"?"middle":"center";function p(E,S,L){var T=E;function x(){var R=f(E);if(R===null)throw new Error("Malformed timestamp: "+T);return E=E.replace(/^[^\sa-zA-Z-]+/,""),R}function m(R,M){var C=new c;_(R,function(O,B){var P;switch(O){case"region":for(var F=L.length-1;F>=0;F--)if(L[F].id===B){C.set(O,L[F].region);break}break;case"vertical":C.alt(O,B,["rl","lr"]);break;case"line":P=B.split(","),C.integer(O,P[0]),C.percent(O,P[0])&&C.set("snapToLines",!1),C.alt(O,P[0],["auto"]),P.length===2&&C.alt("lineAlign",P[1],["start",d,"end"]);break;case"position":P=B.split(","),C.percent(O,P[0]),P.length===2&&C.alt("positionAlign",P[1],["start",d,"end","line-left","line-right","auto"]);break;case"size":C.percent(O,B);break;case"align":C.alt(O,B,["start",d,"end","left","right"]);break}},/:/,/\s/),M.region=C.get("region",null),M.vertical=C.get("vertical","");var b=C.get("line","auto");b==="auto"&&g.line===-1&&(b=-1),M.line=b,M.lineAlign=C.get("lineAlign","start"),M.snapToLines=C.get("snapToLines",!0),M.size=C.get("size",100),M.align=C.get("align",d);var D=C.get("position","auto");D==="auto"&&g.position===50&&(D=M.align==="start"||M.align==="left"?0:M.align==="end"||M.align==="right"?100:50),M.position=D}function w(){E=E.replace(/^\s+/,"")}if(w(),S.startTime=x(),w(),E.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+T);E=E.slice(3),w(),S.endTime=x(),w(),m(E,S)}function v(E){return E.replace(/<br(?: \/)?>/gi,`
`)}var A=function(){function E(){this.state="INITIAL",this.buffer="",this.decoder=new u,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var S=E.prototype;return S.parse=function(T){var x=this;T&&(x.buffer+=x.decoder.decode(T,{stream:!0}));function m(){var D=x.buffer,O=0;for(D=v(D);O<D.length&&D[O]!=="\r"&&D[O]!==`
`;)++O;var B=D.slice(0,O);return D[O]==="\r"&&++O,D[O]===`
`&&++O,x.buffer=D.slice(O),B}function w(D){_(D,function(O,B){},/:/)}try{var R="";if(x.state==="INITIAL"){if(!/\r\n|\n/.test(x.buffer))return this;R=m();var M=R.match(/^()?WEBVTT([ \t].*)?$/);if(!M||!M[0])throw new Error("Malformed WebVTT signature.");x.state="HEADER"}for(var C=!1;x.buffer;){if(!/\r\n|\n/.test(x.buffer))return this;switch(C?C=!1:R=m(),x.state){case"HEADER":/:/.test(R)?w(R):R||(x.state="ID");continue;case"NOTE":R||(x.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(R)){x.state="NOTE";break}if(!R)continue;if(x.cue=new h.default(0,0,""),x.state="CUE",R.indexOf("-->")===-1){x.cue.id=R;continue}case"CUE":if(!x.cue){x.state="BADCUE";continue}try{p(R,x.cue,x.regionList)}catch{x.cue=null,x.state="BADCUE";continue}x.state="CUETEXT";continue;case"CUETEXT":{var b=R.indexOf("-->")!==-1;if(!R||b&&(C=!0)){x.oncue&&x.cue&&x.oncue(x.cue),x.cue=null,x.state="ID";continue}if(x.cue===null)continue;x.cue.text&&(x.cue.text+=`
`),x.cue.text+=R}continue;case"BADCUE":R||(x.state="ID")}}}catch{x.state==="CUETEXT"&&x.cue&&x.oncue&&x.oncue(x.cue),x.cue=null,x.state=x.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},S.flush=function(){var T=this;try{if((T.cue||T.state==="HEADER")&&(T.buffer+=`

`,T.parse()),T.state==="INITIAL"||T.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(x){T.onparsingerror&&T.onparsingerror(x)}return T.onflush&&T.onflush(),this},E}()},"./src/utils/webvtt-parser.ts":(a,o,l)=>{l.r(o),l.d(o,{generateCueId:()=>A,parseWebVTT:()=>S});var h=l("./src/polyfills/number.ts"),u=l("./src/utils/vttparser.ts"),f=l("./src/demux/id3.ts"),c=l("./src/utils/timescale-conversion.ts"),_=l("./src/remux/mp4-remuxer.ts"),g=/\r\n|\n\r|\n|\r/g,d=function(T,x,m){return m===void 0&&(m=0),T.slice(m,m+x.length)===x},p=function(T){var x=parseInt(T.slice(-3)),m=parseInt(T.slice(-6,-4)),w=parseInt(T.slice(-9,-7)),R=T.length>9?parseInt(T.substring(0,T.indexOf(":"))):0;if(!(0,h.isFiniteNumber)(x)||!(0,h.isFiniteNumber)(m)||!(0,h.isFiniteNumber)(w)||!(0,h.isFiniteNumber)(R))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+T);return x+=1e3*m,x+=60*1e3*w,x+=60*60*1e3*R,x},v=function(T){for(var x=5381,m=T.length;m;)x=x*33^T.charCodeAt(--m);return(x>>>0).toString()};function A(L,T,x){return v(L.toString())+v(T.toString())+v(x)}var E=function(T,x,m){var w=T[x],R=T[w.prevCC];if(!R||!R.new&&w.new){T.ccOffset=T.presentationOffset=w.start,w.new=!1;return}for(;(M=R)!==null&&M!==void 0&&M.new;){var M;T.ccOffset+=w.start-R.start,w.new=!1,w=R,R=T[w.prevCC]}T.presentationOffset=m};function S(L,T,x,m,w,R,M,C){var b=new u.VTTParser,D=(0,f.utf8ArrayToStr)(new Uint8Array(L)).trim().replace(g,`
`).split(`
`),O=[],B=(0,c.toMpegTsClockFromTimescale)(T,x),P="00:00.000",F=0,I=0,y,k=!0;b.oncue=function(U){var N=m[w],W=m.ccOffset,G=(F-B)/9e4;N!=null&&N.new&&(I!==void 0?W=m.ccOffset=N.start:E(m,w,G)),G&&(W=G-m.presentationOffset);var z=U.endTime-U.startTime,X=(0,_.normalizePts)((U.startTime+W-I)*9e4,R*9e4)/9e4;U.startTime=Math.max(X,0),U.endTime=Math.max(X+z,0);var K=U.text.trim();U.text=decodeURIComponent(encodeURIComponent(K)),U.id||(U.id=A(U.startTime,U.endTime,K)),U.endTime>0&&O.push(U)},b.onparsingerror=function(U){y=U},b.onflush=function(){if(y){C(y);return}M(O)},D.forEach(function(U){if(k)if(d(U,"X-TIMESTAMP-MAP=")){k=!1,U.slice(16).split(",").forEach(function(N){d(N,"LOCAL:")?P=N.slice(6):d(N,"MPEGTS:")&&(F=parseInt(N.slice(7)))});try{I=p(P)/1e3}catch(N){y=N}return}else U===""&&(k=!1);b.parse(U+`
`)}),b.flush()}},"./src/utils/xhr-loader.ts":(a,o,l)=>{l.r(o),l.d(o,{default:()=>_});var h=l("./src/utils/logger.ts"),u=l("./src/loader/load-stats.ts"),f=/^age:\s*[\d.]+\s*$/m,c=function(){function g(p){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=p?p.xhrSetup:null,this.stats=new u.LoadStats,this.retryDelay=0}var d=g.prototype;return d.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},d.abortInternal=function(){var v=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),v&&(v.onreadystatechange=null,v.onprogress=null,v.readyState!==4&&(this.stats.aborted=!0,v.abort()))},d.abort=function(){var v;this.abortInternal(),(v=this.callbacks)!==null&&v!==void 0&&v.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},d.load=function(v,A,E){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=v,this.config=A,this.callbacks=E,this.retryDelay=A.retryDelay,this.loadInternal()},d.loadInternal=function(){var v=this.config,A=this.context;if(!!v){var E=this.loader=new self.XMLHttpRequest,S=this.stats;S.loading.first=0,S.loaded=0;var L=this.xhrSetup;try{if(L)try{L(E,A.url)}catch{E.open("GET",A.url,!0),L(E,A.url)}E.readyState||E.open("GET",A.url,!0);var T=this.context.headers;if(T)for(var x in T)E.setRequestHeader(x,T[x])}catch(m){this.callbacks.onError({code:E.status,text:m.message},A,E);return}A.rangeEnd&&E.setRequestHeader("Range","bytes="+A.rangeStart+"-"+(A.rangeEnd-1)),E.onreadystatechange=this.readystatechange.bind(this),E.onprogress=this.loadprogress.bind(this),E.responseType=A.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),v.timeout),E.send()}},d.readystatechange=function(){var v=this.context,A=this.loader,E=this.stats;if(!(!v||!A)){var S=A.readyState,L=this.config;if(!E.aborted&&S>=2)if(self.clearTimeout(this.requestTimeout),E.loading.first===0&&(E.loading.first=Math.max(self.performance.now(),E.loading.start)),S===4){A.onreadystatechange=null,A.onprogress=null;var T=A.status,x=A.responseType==="arraybuffer";if(T>=200&&T<300&&(x&&A.response||A.responseText!==null)){E.loading.end=Math.max(self.performance.now(),E.loading.first);var m,w;if(x?(m=A.response,w=m.byteLength):(m=A.responseText,w=m.length),E.loaded=E.total=w,!this.callbacks)return;var R=this.callbacks.onProgress;if(R&&R(E,v,m,A),!this.callbacks)return;var M={url:A.responseURL,data:m};this.callbacks.onSuccess(M,E,v,A)}else E.retry>=L.maxRetry||T>=400&&T<499?(h.logger.error(T+" while loading "+v.url),this.callbacks.onError({code:T,text:A.statusText},v,A)):(h.logger.warn(T+" while loading "+v.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,L.maxRetryDelay),E.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),L.timeout)}},d.loadtimeout=function(){h.logger.warn("timeout while loading "+this.context.url);var v=this.callbacks;v&&(this.abortInternal(),v.onTimeout(this.stats,this.context,this.loader))},d.loadprogress=function(v){var A=this.stats;A.loaded=v.loaded,v.lengthComputable&&(A.total=v.total)},d.getCacheAge=function(){var v=null;if(this.loader&&f.test(this.loader.getAllResponseHeaders())){var A=this.loader.getResponseHeader("age");v=A?parseFloat(A):null}return v},g}();const _=c},"./node_modules/eventemitter3/index.js":a=>{var o=Object.prototype.hasOwnProperty,l="~";function h(){}Object.create&&(h.prototype=Object.create(null),new h().__proto__||(l=!1));function u(g,d,p){this.fn=g,this.context=d,this.once=p||!1}function f(g,d,p,v,A){if(typeof p!="function")throw new TypeError("The listener must be a function");var E=new u(p,v||g,A),S=l?l+d:d;return g._events[S]?g._events[S].fn?g._events[S]=[g._events[S],E]:g._events[S].push(E):(g._events[S]=E,g._eventsCount++),g}function c(g,d){--g._eventsCount===0?g._events=new h:delete g._events[d]}function _(){this._events=new h,this._eventsCount=0}_.prototype.eventNames=function(){var d=[],p,v;if(this._eventsCount===0)return d;for(v in p=this._events)o.call(p,v)&&d.push(l?v.slice(1):v);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(p)):d},_.prototype.listeners=function(d){var p=l?l+d:d,v=this._events[p];if(!v)return[];if(v.fn)return[v.fn];for(var A=0,E=v.length,S=new Array(E);A<E;A++)S[A]=v[A].fn;return S},_.prototype.listenerCount=function(d){var p=l?l+d:d,v=this._events[p];return v?v.fn?1:v.length:0},_.prototype.emit=function(d,p,v,A,E,S){var L=l?l+d:d;if(!this._events[L])return!1;var T=this._events[L],x=arguments.length,m,w;if(T.fn){switch(T.once&&this.removeListener(d,T.fn,void 0,!0),x){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,p),!0;case 3:return T.fn.call(T.context,p,v),!0;case 4:return T.fn.call(T.context,p,v,A),!0;case 5:return T.fn.call(T.context,p,v,A,E),!0;case 6:return T.fn.call(T.context,p,v,A,E,S),!0}for(w=1,m=new Array(x-1);w<x;w++)m[w-1]=arguments[w];T.fn.apply(T.context,m)}else{var R=T.length,M;for(w=0;w<R;w++)switch(T[w].once&&this.removeListener(d,T[w].fn,void 0,!0),x){case 1:T[w].fn.call(T[w].context);break;case 2:T[w].fn.call(T[w].context,p);break;case 3:T[w].fn.call(T[w].context,p,v);break;case 4:T[w].fn.call(T[w].context,p,v,A);break;default:if(!m)for(M=1,m=new Array(x-1);M<x;M++)m[M-1]=arguments[M];T[w].fn.apply(T[w].context,m)}}return!0},_.prototype.on=function(d,p,v){return f(this,d,p,v,!1)},_.prototype.once=function(d,p,v){return f(this,d,p,v,!0)},_.prototype.removeListener=function(d,p,v,A){var E=l?l+d:d;if(!this._events[E])return this;if(!p)return c(this,E),this;var S=this._events[E];if(S.fn)S.fn===p&&(!A||S.once)&&(!v||S.context===v)&&c(this,E);else{for(var L=0,T=[],x=S.length;L<x;L++)(S[L].fn!==p||A&&!S[L].once||v&&S[L].context!==v)&&T.push(S[L]);T.length?this._events[E]=T.length===1?T[0]:T:c(this,E)}return this},_.prototype.removeAllListeners=function(d){var p;return d?(p=l?l+d:d,this._events[p]&&c(this,p)):(this._events=new h,this._eventsCount=0),this},_.prototype.off=_.prototype.removeListener,_.prototype.addListener=_.prototype.on,_.prefixed=l,_.EventEmitter=_,a.exports=_},"./node_modules/url-toolkit/src/url-toolkit.js":function(a){(function(o){var l=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,h=/^(?=([^\/?#]*))\1([^]*)$/,u=/(?:\/|^)\.(?=\/)/g,f=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(_,g,d){if(d=d||{},_=_.trim(),g=g.trim(),!g){if(!d.alwaysNormalize)return _;var p=c.parseURL(_);if(!p)throw new Error("Error trying to parse base URL.");return p.path=c.normalizePath(p.path),c.buildURLFromParts(p)}var v=c.parseURL(g);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return d.alwaysNormalize?(v.path=c.normalizePath(v.path),c.buildURLFromParts(v)):g;var A=c.parseURL(_);if(!A)throw new Error("Error trying to parse base URL.");if(!A.netLoc&&A.path&&A.path[0]!=="/"){var E=h.exec(A.path);A.netLoc=E[1],A.path=E[2]}A.netLoc&&!A.path&&(A.path="/");var S={scheme:A.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(S.netLoc=A.netLoc,v.path[0]!=="/"))if(!v.path)S.path=A.path,v.params||(S.params=A.params,v.query||(S.query=A.query));else{var L=A.path,T=L.substring(0,L.lastIndexOf("/")+1)+v.path;S.path=c.normalizePath(T)}return S.path===null&&(S.path=d.alwaysNormalize?c.normalizePath(v.path):v.path),c.buildURLFromParts(S)},parseURL:function(_){var g=l.exec(_);return g?{scheme:g[1]||"",netLoc:g[2]||"",path:g[3]||"",params:g[4]||"",query:g[5]||"",fragment:g[6]||""}:null},normalizePath:function(_){for(_=_.split("").reverse().join("").replace(u,"");_.length!==(_=_.replace(f,"")).length;);return _.split("").reverse().join("")},buildURLFromParts:function(_){return _.scheme+_.netLoc+_.path+_.params+_.query+_.fragment}};a.exports=c})()}},i={};function n(a){var o=i[a];if(o!==void 0)return o.exports;var l=i[a]={exports:{}};return e[a].call(l.exports,l,l.exports,n),l.exports}n.m=e,n.n=a=>{var o=a&&a.__esModule?()=>a.default:()=>a;return n.d(o,{a:o}),o},n.d=(a,o)=>{for(var l in o)n.o(o,l)&&!n.o(a,l)&&Object.defineProperty(a,l,{enumerable:!0,get:o[l]})},n.o=(a,o)=>Object.prototype.hasOwnProperty.call(a,o),n.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})};var s=n("./src/hls.ts");return s=s.default,s})())})(F0);const Yo=NA(F0.exports);class kM{constructor(){H(this,"_wrapper");H(this,"_video");this._wrapper=document.querySelector(".js_thumbnail"),this._video=document.createElement("video"),this._video.playsInline=!0,this._video.muted=!0,this._video.loop=!0,this._wrapper.append(this._video)}setup(){const t="/wp-content/themes/camcom/assets/movies/thumbnail.m3u8";if(Yo.isSupported()){const e=new Yo;e.loadSource(t),e.attachMedia(this._video),e.on(Yo.Events.MANIFEST_PARSED,()=>{this._video.play()})}else this._video.canPlayType("application/vnd.apple.mpegurl")&&(this._video.src=t,this._video.addEventListener("loadedmetadata",()=>{this._video.play()}));Ot.to(this._wrapper,{scrollTrigger:{trigger:this._wrapper,start:"0% 100%",end:"100% 0%",markers:!1,onEnter:()=>this._video.play(),onLeaveBack:()=>this._video.pause(),onLeave:()=>this._video.pause(),onEnterBack:()=>this._video.play()}})}}const B0="SHOW_MODAL",k0="HIDE_MODAL";class UM extends Re.exports.EventEmitter{constructor(){super();H(this,"_body");H(this,"_modal");H(this,"_video");H(this,"_closeBtn");H(this,"_showBtn");H(this,"_bg");H(this,"_thumbnail");H(this,"_showCls","show_modal");H(this,"_setup",()=>{this._thumbnail.setup();const e="/wp-content/themes/camcom/assets/movies/promo.m3u8";if(Yo.isSupported()){const i=new Yo;i.loadSource(e),i.attachMedia(this._video)}else this._video.canPlayType("application/vnd.apple.mpegurl")&&(this._video.src=e);this._video.style.opacity="0"});H(this,"_onShowClick",e=>{e.preventDefault(),this.show()});H(this,"_onCloseClick",e=>{e.preventDefault(),this.hide()});H(this,"show",()=>{this.emit(B0),this._body.classList.add(this._showCls);const e=Ot.timeline();this._video.play(),Ot.killTweensOf(this._modal),Ot.killTweensOf(this._video),e.to(this._modal,{opacity:1,duration:.6,ease:"circ.out"}),e.to(this._video,{opacity:1,duration:.4,ease:"circ.out"})});H(this,"hide",()=>{this.emit(k0),this._body.classList.remove(this._showCls),this._video.pause(),this._video.currentTime=0;const e=Ot.timeline();Ot.killTweensOf(this._modal),Ot.killTweensOf(this._video),e.to(this._video,{opacity:0,duration:.4,ease:"circ.out"}),e.to(this._modal,{opacity:0,duration:.4,ease:"circ.out"})});H(this,"play",()=>{this._video.play()});H(this,"pause",()=>{this._video.pause()});this._body=document.querySelector("body"),this._modal=document.querySelector(".modal_movie");const e=this._modal.querySelector(".wrapper");this._bg=this._modal.querySelector(".bg"),this._closeBtn=this._modal.querySelector(".close"),this._showBtn=document.querySelector(".js_show_modal"),this._video=document.createElement("video"),this._video.playsInline=!0,this._thumbnail=new kM,e.append(this._video),this._setup(),this._bg.addEventListener("click",this._onCloseClick),this._closeBtn.addEventListener("click",this._onCloseClick),this._showBtn.addEventListener("click",this._onShowClick)}}class NM{constructor(t){H(this,"_target");H(this,"_bg");H(this,"_showCls","show");H(this,"_tween");H(this,"_setup",()=>{const t=document.querySelector(".morphing_step2");Ot.to(this._target,{scrollTrigger:{trigger:t,markers:!1,start:"10% 90%",end:"65% 100%",onEnterBack:()=>this._hide(),onLeave:()=>this._show()}}),Ot.to(this._target,{scrollTrigger:{trigger:this._target,markers:!1,start:"0% 80%",end:"100% 70%",onEnterBack:()=>this._show(),onLeave:()=>this._hide()}})});H(this,"_show",()=>{this._tween&&this._tween.kill(),this._tween=Ot.delayedCall(.5,()=>{this._bg.classList.add(this._showCls)})});H(this,"_hide",()=>{this._tween&&this._tween.kill(),this._bg.classList.remove(this._showCls)});this._target=t,this._bg=document.querySelector(".group_bg"),this._setup()}}const U0="COMPANY_BLOCK_COMPLETE";class GM extends Re.exports.EventEmitter{constructor(e){super();H(this,"_contents");H(this,"_logo");H(this,"_name");H(this,"_summaries",[]);H(this,"_arrow");H(this,"_line");H(this,"animate",()=>{this._arrow?this._arrow.once(js,this._end):this._summaries[0].once(es,this._end),Ot.to(this._logo,{opacity:1,ease:"circ.out",duration:.6,onComplete:()=>{this._logo.removeAttribute("style")}}),this._name.animate(),this._summaries.forEach(e=>e.animate()),this._line.animate(),this._arrow&&this._arrow.animate()});H(this,"_end",()=>{this.emit(U0,this)});this._contents=e;const i=e.querySelector(".name .js_grad_image_self"),n=e.querySelectorAll(".summary .js_grad_text_self"),s=e.querySelector(".arrow .js_grad_image_self"),a=e.querySelector(".line");this._logo=e.querySelector(".logo"),this._name=new be(i,{delay:.1,x:-20,y:0}),n.forEach(o=>{const l=new ti(o,{delay:.3,x:-20,y:0});l.changeEndColor(56,77,116),this._summaries.push(l)}),s!==null&&(this._arrow=new be(s,{delay:.4,x:-20,y:0})),this._line=new uo(a,{}),Ot.set(this._logo,{opacity:0}),this._name.changeEndColor(56,77,116),this._line.changeEndColor(182,182,200),this._arrow&&this._arrow.changeEndColor(56,77,116)}}class zM{constructor(){H(this,"_contents");H(this,"_bg");H(this,"_companies",[]);H(this,"_setup",()=>{const t=this._contents.querySelector(".contents");Ot.to(t,{scrollTrigger:{trigger:t,markers:!1,once:!0,start:"0% 50%",onEnter:()=>this._animate()}})});H(this,"_animate",()=>{this._companies.forEach((t,e)=>{Ot.delayedCall(e*.15,()=>t.animate())})});H(this,"_end",t=>{const e=this._companies.indexOf(t);e!==-1&&(delete this._companies[e],this._companies.splice(e,1))});this._contents=document.querySelector(".section_our_group"),this._bg=new NM(this._contents),this._contents.querySelectorAll("li.item").forEach(t=>{const e=new GM(t);e.once(U0,this._end),this._companies.push(e)}),this._setup()}}var Qs=(r=>(r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2",r))(Qs||{}),Hd=(r=>(r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL",r))(Hd||{}),Jt=(r=>(r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR",r))(Jt||{}),Nr=(r=>(r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r))(Nr||{}),At=(r=>(r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r))(At||{}),Va=(r=>(r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r))(Va||{}),qt=(r=>(r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT",r))(qt||{}),Vd=(r=>(r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT",r))(Vd||{}),dn=(r=>(r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR",r))(dn||{}),Vn=(r=>(r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r))(Vn||{}),jr=(r=>(r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL",r))(jr||{}),Cr=(r=>(r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",r))(Cr||{}),gs=(r=>(r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT",r))(gs||{}),Xf=(r=>(r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL",r))(Xf||{}),or=(r=>(r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp",r))(or||{}),Ke=(r=>(r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR",r))(Ke||{}),We=(r=>(r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH",r))(We||{}),Vr=(r=>(r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r))(Vr||{});const WM={createCanvas:(r,t)=>{const e=document.createElement("canvas");return e.width=r,e.height=t,e},getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var r;return(r=document.baseURI)!=null?r:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(r,t)=>fetch(r,t)};var Fc=/iPhone/i,dg=/iPod/i,fg=/iPad/i,pg=/\biOS-universal(?:.+)Mac\b/i,Bc=/\bAndroid(?:.+)Mobile\b/i,mg=/Android/i,xa=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,oh=/Silk/i,en=/Windows Phone/i,gg=/\bWindows(?:.+)ARM\b/i,_g=/BlackBerry/i,vg=/BB10/i,xg=/Opera Mini/i,yg=/\b(CriOS|Chrome)(?:.+)Mobile/i,Eg=/Mobile(?:.+)Firefox\b/i,Tg=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function HM(r){return function(t){return t.test(r)}}function VM(r){var t={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?t.userAgent=r:r&&r.userAgent&&(t={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var e=t.userAgent,i=e.split("[FBAN");typeof i[1]<"u"&&(e=i[0]),i=e.split("Twitter"),typeof i[1]<"u"&&(e=i[0]);var n=HM(e),s={apple:{phone:n(Fc)&&!n(en),ipod:n(dg),tablet:!n(Fc)&&(n(fg)||Tg(t))&&!n(en),universal:n(pg),device:(n(Fc)||n(dg)||n(fg)||n(pg)||Tg(t))&&!n(en)},amazon:{phone:n(xa),tablet:!n(xa)&&n(oh),device:n(xa)||n(oh)},android:{phone:!n(en)&&n(xa)||!n(en)&&n(Bc),tablet:!n(en)&&!n(xa)&&!n(Bc)&&(n(oh)||n(mg)),device:!n(en)&&(n(xa)||n(oh)||n(Bc)||n(mg))||n(/\bokhttp\b/i)},windows:{phone:n(en),tablet:n(gg),device:n(en)||n(gg)},other:{blackberry:n(_g),blackberry10:n(vg),opera:n(xg),firefox:n(Eg),chrome:n(yg),device:n(_g)||n(vg)||n(xg)||n(Eg)||n(yg)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const fn=VM(globalThis.navigator);function XM(){return!fn.apple.device}function KM(r){let t=!0;if(fn.tablet||fn.phone){if(fn.apple.device){const e=navigator.userAgent.match(/OS (\d+)_(\d+)?/);e&&parseInt(e[1],10)<11&&(t=!1)}if(fn.android.device){const e=navigator.userAgent.match(/Android\s([0-9.]*)/);e&&parseInt(e[1],10)<7&&(t=!1)}}return t?r:4}const bt={ADAPTER:WM,MIPMAP_TEXTURES:jr.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:We.NONE,SPRITE_MAX_TEXTURES:KM(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},GC_MODE:Xf.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:Vn.CLAMP,SCALE_MODE:dn.LINEAR,PRECISION_VERTEX:or.HIGH,PRECISION_FRAGMENT:fn.apple.device?or.HIGH:or.MEDIUM,CAN_UPLOAD_SAME_BUFFER:XM(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};bt.PREFER_ENV=Qs.WEBGL2;bt.STRICT_TEXTURE_CACHE=!1;var Pt=(r=>(r.Renderer="renderer",r.Application="application",r.RendererSystem="renderer-webgl-system",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererSystem="renderer-canvas-system",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Asset="asset",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser",r))(Pt||{});const bg=r=>{if((typeof r=="function"||typeof r=="object"&&r.extension)&&(r={...typeof r.extension!="object"?{type:r.extension}:r.extension,ref:r}),typeof r=="object")r={...r};else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},Yt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...r){return r.map(bg).forEach(t=>{t.type.forEach(e=>{var i,n;return(n=(i=this._removeHandlers)[e])==null?void 0:n.call(i,t)})}),this},add(...r){return r.map(bg).forEach(t=>{t.type.forEach(e=>{const i=this._addHandlers,n=this._queue;i[e]?i[e](t):(n[e]=n[e]||[],n[e].push(t))})}),this},handle(r,t,e){const i=this._addHandlers,n=this._removeHandlers;i[r]=t,n[r]=e;const s=this._queue;return s[r]&&(s[r].forEach(a=>t(a)),delete s[r]),this},handleByMap(r,t){return this.handle(r,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(r,t){return this.handle(r,e=>{t.includes(e.ref)||(t.push(e.ref),t.sort((i,n)=>{var s,a;return((s=n.priority)!=null?s:-1)-((a=i.priority)!=null?a:-1)}))},e=>{const i=t.indexOf(e.ref);i!==-1&&t.splice(i,1)})}},su=Math.PI*2,jM=180/Math.PI,YM=Math.PI/180;var si=(r=>(r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC",r))(si||{});class me{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new me(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}const lh=[new me,new me,new me,new me];class le{constructor(t=0,e=0,i=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(n),this.type=si.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new le(0,0,0,0)}clone(){return new le(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const m=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=m)return!1;const R=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>R}const i=this.left,n=this.right,s=this.top,a=this.bottom;if(n<=i||a<=s)return!1;const o=lh[0].set(t.left,t.top),l=lh[1].set(t.left,t.bottom),h=lh[2].set(t.right,t.top),u=lh[3].set(t.right,t.bottom);if(h.x<=o.x||l.y<=o.y)return!1;const f=Math.sign(e.a*e.d-e.b*e.c);if(f===0||(e.apply(o,o),e.apply(l,l),e.apply(h,h),e.apply(u,u),Math.max(o.x,l.x,h.x,u.x)<=i||Math.min(o.x,l.x,h.x,u.x)>=n||Math.max(o.y,l.y,h.y,u.y)<=s||Math.min(o.y,l.y,h.y,u.y)>=a))return!1;const c=f*(l.y-o.y),_=f*(o.x-l.x),g=c*i+_*s,d=c*n+_*s,p=c*i+_*a,v=c*n+_*a;if(Math.max(g,d,p,v)<=c*o.x+_*o.y||Math.min(g,d,p,v)>=c*u.x+_*u.y)return!1;const A=f*(o.y-h.y),E=f*(h.x-o.x),S=A*i+E*s,L=A*n+E*s,T=A*i+E*a,x=A*n+E*a;return!(Math.max(S,L,T,x)<=A*o.x+E*o.y||Math.min(S,L,T,x)>=A*u.x+E*u.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=n,this.height=s-n,this}}class Kf{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=si.CIRC}clone(){return new Kf(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-t,s=this.y-e;return n*=n,s*=s,n+s<=i}getBounds(){return new le(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}class jf{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.width=i,this.height=n,this.type=si.ELIP}clone(){return new jf(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,n=(e-this.y)/this.height;return i*=i,n*=n,i+n<=1}getBounds(){return new le(this.x-this.width,this.y-this.height,this.width,this.height)}}class Xa{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const i=[];for(let n=0,s=e.length;n<s;n++)i.push(e[n].x,e[n].y);e=i}this.points=e,this.type=si.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Xa(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1;const n=this.points.length/2;for(let s=0,a=n-1;s<n;a=s++){const o=this.points[s*2],l=this.points[s*2+1],h=this.points[a*2],u=this.points[a*2+1];l>e!=u>e&&t<(h-o)*((e-l)/(u-l))+o&&(i=!i)}return i}}class Yf{constructor(t=0,e=0,i=0,n=0,s=20){this.x=t,this.y=e,this.width=i,this.height=n,this.radius=s,this.type=si.RREC}clone(){return new Yf(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let n=t-(this.x+i),s=e-(this.y+i);const a=i*i;if(n*n+s*s<=a||(n=t-(this.x+this.width-i),n*n+s*s<=a)||(s=e-(this.y+this.height-i),n*n+s*s<=a)||(n=t-(this.x+i),n*n+s*s<=a))return!0}return!1}}class Un{constructor(t,e,i=0,n=0){this._x=i,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Un(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}class Fe{constructor(t=1,e=0,i=0,n=1,s=0,a=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,n,s,a){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=s,this.ty=a,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new me;const i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e}applyInverse(t,e){e=e||new me;const i=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*i*n+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*s+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.a,s=this.c,a=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this}append(t){const e=this.a,i=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this}setTransform(t,e,i,n,s,a,o,l,h){return this.a=Math.cos(o+h)*s,this.b=Math.sin(o+h)*s,this.c=-Math.sin(o-l)*a,this.d=Math.cos(o-l)*a,this.tx=t-(i*this.a+n*this.c),this.ty=e-(i*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,n=this.c,s=this.d,a=t.pivot,o=-Math.atan2(-n,s),l=Math.atan2(i,e),h=Math.abs(o+l);return h<1e-5||Math.abs(su-h)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=l),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(a.x*e+a.y*n),t.position.y=this.ty+(a.x*i+a.y*s),t}invert(){const t=this.a,e=this.b,i=this.c,n=this.d,s=this.tx,a=t*n-e*i;return this.a=n/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-n*s)/a,this.ty=-(t*this.ty-e*s)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Fe;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new Fe}static get TEMP_MATRIX(){return new Fe}}const _s=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],vs=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],xs=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],ys=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Xd=[],N0=[],hh=Math.sign;function $M(){for(let r=0;r<16;r++){const t=[];Xd.push(t);for(let e=0;e<16;e++){const i=hh(_s[r]*_s[e]+xs[r]*vs[e]),n=hh(vs[r]*_s[e]+ys[r]*vs[e]),s=hh(_s[r]*xs[e]+xs[r]*ys[e]),a=hh(vs[r]*xs[e]+ys[r]*ys[e]);for(let o=0;o<16;o++)if(_s[o]===i&&vs[o]===n&&xs[o]===s&&ys[o]===a){t.push(o);break}}}for(let r=0;r<16;r++){const t=new Fe;t.set(_s[r],vs[r],xs[r],ys[r],0,0),N0.push(t)}}$M();const we={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:r=>_s[r],uY:r=>vs[r],vX:r=>xs[r],vY:r=>ys[r],inv:r=>r&8?r&15:-r&7,add:(r,t)=>Xd[r][t],sub:(r,t)=>Xd[r][we.inv(t)],rotate180:r=>r^4,isVertical:r=>(r&3)===2,byDirection:(r,t)=>Math.abs(r)*2<=Math.abs(t)?t>=0?we.S:we.N:Math.abs(t)*2<=Math.abs(r)?r>0?we.E:we.W:t>0?r>0?we.SE:we.SW:r>0?we.NE:we.NW,matrixAppendRotationInv:(r,t,e=0,i=0)=>{const n=N0[we.inv(t)];n.tx=e,n.ty=i,r.append(n)}},G0=class{constructor(){this.worldTransform=new Fe,this.localTransform=new Fe,this.position=new Un(this.onChange,this,0,0),this.scale=new Un(this.onChange,this,1,1),this.pivot=new Un(this.onChange,this,0,0),this.skew=new Un(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const r=this.localTransform;this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(r){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==r._worldID){const e=r.worldTransform,i=this.worldTransform;i.a=t.a*e.a+t.b*e.c,i.b=t.a*e.b+t.b*e.d,i.c=t.c*e.a+t.d*e.c,i.d=t.c*e.b+t.d*e.d,i.tx=t.tx*e.a+t.ty*e.c+e.tx,i.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=r._worldID,this._worldID++}}setFromMatrix(r){r.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(r){this._rotation!==r&&(this._rotation=r,this.updateSkew())}};let $f=G0;$f.IDENTITY=new G0;class Sr{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,n,s,a,o,l){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:u}=this;this._aliasCount++;for(let f=0,c=u.length;f<c;f++)u[f][h](t,e,i,n,s,a,o,l);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Sr.prototype,{dispatch:{value:Sr.prototype.emit},run:{value:Sr.prototype.emit}});bt.TARGET_FPMS=.06;var Ys=(r=>(r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY",r))(Ys||{});class kc{constructor(t,e=null,i=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}class Te{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new kc(null,null,1/0),this.deltaMS=1/bt.TARGET_FPMS,this.elapsedMS=1/bt.TARGET_FPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=Ys.NORMAL){return this._addListener(new kc(t,e,i))}addOnce(t,e,i=Ys.NORMAL){return this._addListener(new kc(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(!e)t.connect(i);else{for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i.match(t,e)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const s=t-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=t-s%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*bt.TARGET_FPMS;const i=this._head;let n=i.next;for(;n;)n=n.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,bt.TARGET_FPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Te._shared){const t=Te._shared=new Te;t.autoStart=!0,t._protected=!0}return Te._shared}static get system(){if(!Te._system){const t=Te._system=new Te;t.autoStart=!0,t._protected=!0}return Te._system}}class z0{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Ys.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Te.shared:new Te,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}z0.extension=Pt.Application;Yt.add(z0);var W0={exports:{}};(function(r){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function n(l,h,u){this.fn=l,this.context=h,this.once=u||!1}function s(l,h,u,f,c){if(typeof u!="function")throw new TypeError("The listener must be a function");var _=new n(u,f||l,c),g=e?e+h:h;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],_]:l._events[g].push(_):(l._events[g]=_,l._eventsCount++),l}function a(l,h){--l._eventsCount===0?l._events=new i:delete l._events[h]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var h=[],u,f;if(this._eventsCount===0)return h;for(f in u=this._events)t.call(u,f)&&h.push(e?f.slice(1):f);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(u)):h},o.prototype.listeners=function(h){var u=e?e+h:h,f=this._events[u];if(!f)return[];if(f.fn)return[f.fn];for(var c=0,_=f.length,g=new Array(_);c<_;c++)g[c]=f[c].fn;return g},o.prototype.listenerCount=function(h){var u=e?e+h:h,f=this._events[u];return f?f.fn?1:f.length:0},o.prototype.emit=function(h,u,f,c,_,g){var d=e?e+h:h;if(!this._events[d])return!1;var p=this._events[d],v=arguments.length,A,E;if(p.fn){switch(p.once&&this.removeListener(h,p.fn,void 0,!0),v){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,u),!0;case 3:return p.fn.call(p.context,u,f),!0;case 4:return p.fn.call(p.context,u,f,c),!0;case 5:return p.fn.call(p.context,u,f,c,_),!0;case 6:return p.fn.call(p.context,u,f,c,_,g),!0}for(E=1,A=new Array(v-1);E<v;E++)A[E-1]=arguments[E];p.fn.apply(p.context,A)}else{var S=p.length,L;for(E=0;E<S;E++)switch(p[E].once&&this.removeListener(h,p[E].fn,void 0,!0),v){case 1:p[E].fn.call(p[E].context);break;case 2:p[E].fn.call(p[E].context,u);break;case 3:p[E].fn.call(p[E].context,u,f);break;case 4:p[E].fn.call(p[E].context,u,f,c);break;default:if(!A)for(L=1,A=new Array(v-1);L<v;L++)A[L-1]=arguments[L];p[E].fn.apply(p[E].context,A)}}return!0},o.prototype.on=function(h,u,f){return s(this,h,u,f,!1)},o.prototype.once=function(h,u,f){return s(this,h,u,f,!0)},o.prototype.removeListener=function(h,u,f,c){var _=e?e+h:h;if(!this._events[_])return this;if(!u)return a(this,_),this;var g=this._events[_];if(g.fn)g.fn===u&&(!c||g.once)&&(!f||g.context===f)&&a(this,_);else{for(var d=0,p=[],v=g.length;d<v;d++)(g[d].fn!==u||c&&!g[d].once||f&&g[d].context!==f)&&p.push(g[d]);p.length?this._events[_]=p.length===1?p[0]:p:a(this,_)}return this},o.prototype.removeAllListeners=function(h){var u;return h?(u=e?e+h:h,this._events[u]&&a(this,u)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,r.exports=o})(W0);const Sl=W0.exports;var qf={exports:{}};qf.exports=Mu;qf.exports.default=Mu;function Mu(r,t,e){e=e||2;var i=t&&t.length,n=i?t[0]*e:r.length,s=H0(r,0,n,e,!0),a=[];if(!s||s.next===s.prev)return a;var o,l,h,u,f,c,_;if(i&&(s=tC(r,t,s,e)),r.length>80*e){o=h=r[0],l=u=r[1];for(var g=e;g<n;g+=e)f=r[g],c=r[g+1],f<o&&(o=f),c<l&&(l=c),f>h&&(h=f),c>u&&(u=c);_=Math.max(h-o,u-l),_=_!==0?32767/_:0}return ol(s,a,e,o,l,_,0),a}function H0(r,t,e,i,n){var s,a;if(n===Yd(r,t,e,i)>0)for(s=t;s<e;s+=i)a=Sg(s,r[s],r[s+1],a);else for(s=e-i;s>=t;s-=i)a=Sg(s,r[s],r[s+1],a);return a&&Cu(a,a.next)&&(hl(a),a=a.next),a}function $s(r,t){if(!r)return r;t||(t=r);var e=r,i;do if(i=!1,!e.steiner&&(Cu(e,e.next)||Le(e.prev,e,e.next)===0)){if(hl(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function ol(r,t,e,i,n,s,a){if(!!r){!a&&s&&sC(r,i,n,s);for(var o=r,l,h;r.prev!==r.next;){if(l=r.prev,h=r.next,s?ZM(r,i,n,s):qM(r)){t.push(l.i/e|0),t.push(r.i/e|0),t.push(h.i/e|0),hl(r),r=h.next,o=h.next;continue}if(r=h,r===o){a?a===1?(r=JM($s(r),t,e),ol(r,t,e,i,n,s,2)):a===2&&QM(r,t,e,i,n,s):ol($s(r),t,e,i,n,s,1);break}}}}function qM(r){var t=r.prev,e=r,i=r.next;if(Le(t,e,i)>=0)return!1;for(var n=t.x,s=e.x,a=i.x,o=t.y,l=e.y,h=i.y,u=n<s?n<a?n:a:s<a?s:a,f=o<l?o<h?o:h:l<h?l:h,c=n>s?n>a?n:a:s>a?s:a,_=o>l?o>h?o:h:l>h?l:h,g=i.next;g!==t;){if(g.x>=u&&g.x<=c&&g.y>=f&&g.y<=_&&Ra(n,o,s,l,a,h,g.x,g.y)&&Le(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function ZM(r,t,e,i){var n=r.prev,s=r,a=r.next;if(Le(n,s,a)>=0)return!1;for(var o=n.x,l=s.x,h=a.x,u=n.y,f=s.y,c=a.y,_=o<l?o<h?o:h:l<h?l:h,g=u<f?u<c?u:c:f<c?f:c,d=o>l?o>h?o:h:l>h?l:h,p=u>f?u>c?u:c:f>c?f:c,v=Kd(_,g,t,e,i),A=Kd(d,p,t,e,i),E=r.prevZ,S=r.nextZ;E&&E.z>=v&&S&&S.z<=A;){if(E.x>=_&&E.x<=d&&E.y>=g&&E.y<=p&&E!==n&&E!==a&&Ra(o,u,l,f,h,c,E.x,E.y)&&Le(E.prev,E,E.next)>=0||(E=E.prevZ,S.x>=_&&S.x<=d&&S.y>=g&&S.y<=p&&S!==n&&S!==a&&Ra(o,u,l,f,h,c,S.x,S.y)&&Le(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;E&&E.z>=v;){if(E.x>=_&&E.x<=d&&E.y>=g&&E.y<=p&&E!==n&&E!==a&&Ra(o,u,l,f,h,c,E.x,E.y)&&Le(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;S&&S.z<=A;){if(S.x>=_&&S.x<=d&&S.y>=g&&S.y<=p&&S!==n&&S!==a&&Ra(o,u,l,f,h,c,S.x,S.y)&&Le(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function JM(r,t,e){var i=r;do{var n=i.prev,s=i.next.next;!Cu(n,s)&&V0(n,i,i.next,s)&&ll(n,s)&&ll(s,n)&&(t.push(n.i/e|0),t.push(i.i/e|0),t.push(s.i/e|0),hl(i),hl(i.next),i=r=s),i=i.next}while(i!==r);return $s(i)}function QM(r,t,e,i,n,s){var a=r;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&lC(a,o)){var l=X0(a,o);a=$s(a,a.next),l=$s(l,l.next),ol(a,t,e,i,n,s,0),ol(l,t,e,i,n,s,0);return}o=o.next}a=a.next}while(a!==r)}function tC(r,t,e,i){var n=[],s,a,o,l,h;for(s=0,a=t.length;s<a;s++)o=t[s]*i,l=s<a-1?t[s+1]*i:r.length,h=H0(r,o,l,i,!1),h===h.next&&(h.steiner=!0),n.push(oC(h));for(n.sort(eC),s=0;s<n.length;s++)e=iC(n[s],e);return e}function eC(r,t){return r.x-t.x}function iC(r,t){var e=rC(r,t);if(!e)return t;var i=X0(e,r);return $s(i,i.next),$s(e,e.next)}function rC(r,t){var e=t,i=r.x,n=r.y,s=-1/0,a;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){var o=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(o<=i&&o>s&&(s=o,a=e.x<e.next.x?e:e.next,o===i))return a}e=e.next}while(e!==t);if(!a)return null;var l=a,h=a.x,u=a.y,f=1/0,c;e=a;do i>=e.x&&e.x>=h&&i!==e.x&&Ra(n<u?i:s,n,h,u,n<u?s:i,n,e.x,e.y)&&(c=Math.abs(n-e.y)/(i-e.x),ll(e,r)&&(c<f||c===f&&(e.x>a.x||e.x===a.x&&nC(a,e)))&&(a=e,f=c)),e=e.next;while(e!==l);return a}function nC(r,t){return Le(r.prev,r,t.prev)<0&&Le(t.next,r,r.next)<0}function sC(r,t,e,i){var n=r;do n.z===0&&(n.z=Kd(n.x,n.y,t,e,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==r);n.prevZ.nextZ=null,n.prevZ=null,aC(n)}function aC(r){var t,e,i,n,s,a,o,l,h=1;do{for(e=r,r=null,s=null,a=0;e;){for(a++,i=e,o=0,t=0;t<h&&(o++,i=i.nextZ,!!i);t++);for(l=h;o>0||l>0&&i;)o!==0&&(l===0||!i||e.z<=i.z)?(n=e,e=e.nextZ,o--):(n=i,i=i.nextZ,l--),s?s.nextZ=n:r=n,n.prevZ=s,s=n;e=i}s.nextZ=null,h*=2}while(a>1);return r}function Kd(r,t,e,i,n){return r=(r-e)*n|0,t=(t-i)*n|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function oC(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function Ra(r,t,e,i,n,s,a,o){return(n-a)*(t-o)>=(r-a)*(s-o)&&(r-a)*(i-o)>=(e-a)*(t-o)&&(e-a)*(s-o)>=(n-a)*(i-o)}function lC(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!hC(r,t)&&(ll(r,t)&&ll(t,r)&&uC(r,t)&&(Le(r.prev,r,t.prev)||Le(r,t.prev,t))||Cu(r,t)&&Le(r.prev,r,r.next)>0&&Le(t.prev,t,t.next)>0)}function Le(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function Cu(r,t){return r.x===t.x&&r.y===t.y}function V0(r,t,e,i){var n=ch(Le(r,t,e)),s=ch(Le(r,t,i)),a=ch(Le(e,i,r)),o=ch(Le(e,i,t));return!!(n!==s&&a!==o||n===0&&uh(r,e,t)||s===0&&uh(r,i,t)||a===0&&uh(e,r,i)||o===0&&uh(e,t,i))}function uh(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function ch(r){return r>0?1:r<0?-1:0}function hC(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&V0(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function ll(r,t){return Le(r.prev,r,r.next)<0?Le(r,t,r.next)>=0&&Le(r,r.prev,t)>=0:Le(r,t,r.prev)<0||Le(r,r.next,t)<0}function uC(r,t){var e=r,i=!1,n=(r.x+t.x)/2,s=(r.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&n<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==r);return i}function X0(r,t){var e=new jd(r.i,r.x,r.y),i=new jd(t.i,t.x,t.y),n=r.next,s=t.prev;return r.next=t,t.prev=r,e.next=n,n.prev=e,i.next=e,e.prev=i,s.next=i,i.prev=s,i}function Sg(r,t,e,i){var n=new jd(r,t,e);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function hl(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function jd(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Mu.deviation=function(r,t,e,i){var n=t&&t.length,s=n?t[0]*e:r.length,a=Math.abs(Yd(r,0,s,e));if(n)for(var o=0,l=t.length;o<l;o++){var h=t[o]*e,u=o<l-1?t[o+1]*e:r.length;a-=Math.abs(Yd(r,h,u,e))}var f=0;for(o=0;o<i.length;o+=3){var c=i[o]*e,_=i[o+1]*e,g=i[o+2]*e;f+=Math.abs((r[c]-r[g])*(r[_+1]-r[c+1])-(r[c]-r[_])*(r[g+1]-r[c+1]))}return a===0&&f===0?0:Math.abs((f-a)/a)};function Yd(r,t,e,i){for(var n=0,s=t,a=e-i;s<e;s+=i)n+=(r[a]-r[s])*(r[s+1]+r[a+1]),a=s;return n}Mu.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},i=0,n=0;n<r.length;n++){for(var s=0;s<r[n].length;s++)for(var a=0;a<t;a++)e.vertices.push(r[n][s][a]);n>0&&(i+=r[n-1].length,e.holes.push(i))}return e};var $d={exports:{}};/*! https://mths.be/punycode v1.3.2 by @mathias */(function(r,t){(function(e){var i=t&&!t.nodeType&&t,n=r&&!r.nodeType&&r,s=typeof Ko=="object"&&Ko;(s.global===s||s.window===s||s.self===s)&&(e=s);var a,o=2147483647,l=36,h=1,u=26,f=38,c=700,_=72,g=128,d="-",p=/^xn--/,v=/[^\x20-\x7E]/,A=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=l-h,L=Math.floor,T=String.fromCharCode,x;function m(y){throw RangeError(E[y])}function w(y,k){for(var U=y.length,N=[];U--;)N[U]=k(y[U]);return N}function R(y,k){var U=y.split("@"),N="";U.length>1&&(N=U[0]+"@",y=U[1]),y=y.replace(A,".");var W=y.split("."),G=w(W,k).join(".");return N+G}function M(y){for(var k=[],U=0,N=y.length,W,G;U<N;)W=y.charCodeAt(U++),W>=55296&&W<=56319&&U<N?(G=y.charCodeAt(U++),(G&64512)==56320?k.push(((W&1023)<<10)+(G&1023)+65536):(k.push(W),U--)):k.push(W);return k}function C(y){return w(y,function(k){var U="";return k>65535&&(k-=65536,U+=T(k>>>10&1023|55296),k=56320|k&1023),U+=T(k),U}).join("")}function b(y){return y-48<10?y-22:y-65<26?y-65:y-97<26?y-97:l}function D(y,k){return y+22+75*(y<26)-((k!=0)<<5)}function O(y,k,U){var N=0;for(y=U?L(y/c):y>>1,y+=L(y/k);y>S*u>>1;N+=l)y=L(y/S);return L(N+(S+1)*y/(y+f))}function B(y){var k=[],U=y.length,N,W=0,G=g,z=_,X,K,$,q,J,Q,rt,mt,vt;for(X=y.lastIndexOf(d),X<0&&(X=0),K=0;K<X;++K)y.charCodeAt(K)>=128&&m("not-basic"),k.push(y.charCodeAt(K));for($=X>0?X+1:0;$<U;){for(q=W,J=1,Q=l;$>=U&&m("invalid-input"),rt=b(y.charCodeAt($++)),(rt>=l||rt>L((o-W)/J))&&m("overflow"),W+=rt*J,mt=Q<=z?h:Q>=z+u?u:Q-z,!(rt<mt);Q+=l)vt=l-mt,J>L(o/vt)&&m("overflow"),J*=vt;N=k.length+1,z=O(W-q,N,q==0),L(W/N)>o-G&&m("overflow"),G+=L(W/N),W%=N,k.splice(W++,0,G)}return C(k)}function P(y){var k,U,N,W,G,z,X,K,$,q,J,Q=[],rt,mt,vt,_t;for(y=M(y),rt=y.length,k=g,U=0,G=_,z=0;z<rt;++z)J=y[z],J<128&&Q.push(T(J));for(N=W=Q.length,W&&Q.push(d);N<rt;){for(X=o,z=0;z<rt;++z)J=y[z],J>=k&&J<X&&(X=J);for(mt=N+1,X-k>L((o-U)/mt)&&m("overflow"),U+=(X-k)*mt,k=X,z=0;z<rt;++z)if(J=y[z],J<k&&++U>o&&m("overflow"),J==k){for(K=U,$=l;q=$<=G?h:$>=G+u?u:$-G,!(K<q);$+=l)_t=K-q,vt=l-q,Q.push(T(D(q+_t%vt,0))),K=L(_t/vt);Q.push(T(D(K,0))),G=O(U,mt,N==W),U=0,++N}++U,++k}return Q.join("")}function F(y){return R(y,function(k){return p.test(k)?B(k.slice(4).toLowerCase()):k})}function I(y){return R(y,function(k){return v.test(k)?"xn--"+P(k):k})}if(a={version:"1.3.2",ucs2:{decode:M,encode:C},decode:B,encode:P,toASCII:I,toUnicode:F},i&&n)if(r.exports==i)n.exports=a;else for(x in a)a.hasOwnProperty(x)&&(i[x]=a[x]);else e.punycode=a})(Ko)})($d,$d.exports);var cC={isString:function(r){return typeof r=="string"},isObject:function(r){return typeof r=="object"&&r!==null},isNull:function(r){return r===null},isNullOrUndefined:function(r){return r==null}},ul={};function dC(r,t){return Object.prototype.hasOwnProperty.call(r,t)}var fC=function(r,t,e,i){t=t||"&",e=e||"=";var n={};if(typeof r!="string"||r.length===0)return n;var s=/\+/g;r=r.split(t);var a=1e3;i&&typeof i.maxKeys=="number"&&(a=i.maxKeys);var o=r.length;a>0&&o>a&&(o=a);for(var l=0;l<o;++l){var h=r[l].replace(s,"%20"),u=h.indexOf(e),f,c,_,g;u>=0?(f=h.substr(0,u),c=h.substr(u+1)):(f=h,c=""),_=decodeURIComponent(f),g=decodeURIComponent(c),dC(n,_)?Array.isArray(n[_])?n[_].push(g):n[_]=[n[_],g]:n[_]=g}return n},yo=function(r){switch(typeof r){case"string":return r;case"boolean":return r?"true":"false";case"number":return isFinite(r)?r:"";default:return""}},pC=function(r,t,e,i){return t=t||"&",e=e||"=",r===null&&(r=void 0),typeof r=="object"?Object.keys(r).map(function(n){var s=encodeURIComponent(yo(n))+e;return Array.isArray(r[n])?r[n].map(function(a){return s+encodeURIComponent(yo(a))}).join(t):s+encodeURIComponent(yo(r[n]))}).join(t):i?encodeURIComponent(yo(i))+e+encodeURIComponent(yo(r)):""};ul.decode=ul.parse=fC;ul.encode=ul.stringify=pC;var mC=$d.exports,Rr=cC,gC=Lu,_C=CC,vC=MC;function wr(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var xC=/^([a-z0-9.+-]+:)/i,yC=/:[0-9]*$/,EC=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,TC=["<",">",'"',"`"," ","\r",`
`,"	"],bC=["{","}","|","\\","^","`"].concat(TC),qd=["'"].concat(bC),wg=["%","/","?",";","#"].concat(qd),Ag=["/","?","#"],SC=255,Mg=/^[+a-z0-9A-Z_-]{0,63}$/,wC=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,AC={javascript:!0,"javascript:":!0},Zd={javascript:!0,"javascript:":!0},Ka={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Jd=ul;function Lu(r,t,e){if(r&&Rr.isObject(r)&&r instanceof wr)return r;var i=new wr;return i.parse(r,t,e),i}wr.prototype.parse=function(r,t,e){if(!Rr.isString(r))throw new TypeError("Parameter 'url' must be a string, not "+typeof r);var i=r.indexOf("?"),n=i!==-1&&i<r.indexOf("#")?"?":"#",s=r.split(n),a=/\\/g;s[0]=s[0].replace(a,"/"),r=s.join(n);var o=r;if(o=o.trim(),!e&&r.split("#").length===1){var l=EC.exec(o);if(l)return this.path=o,this.href=o,this.pathname=l[1],l[2]?(this.search=l[2],t?this.query=Jd.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var h=xC.exec(o);if(h){h=h[0];var u=h.toLowerCase();this.protocol=u,o=o.substr(h.length)}if(e||h||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var f=o.substr(0,2)==="//";f&&!(h&&Zd[h])&&(o=o.substr(2),this.slashes=!0)}if(!Zd[h]&&(f||h&&!Ka[h])){for(var c=-1,_=0;_<Ag.length;_++){var g=o.indexOf(Ag[_]);g!==-1&&(c===-1||g<c)&&(c=g)}var d,p;c===-1?p=o.lastIndexOf("@"):p=o.lastIndexOf("@",c),p!==-1&&(d=o.slice(0,p),o=o.slice(p+1),this.auth=decodeURIComponent(d)),c=-1;for(var _=0;_<wg.length;_++){var g=o.indexOf(wg[_]);g!==-1&&(c===-1||g<c)&&(c=g)}c===-1&&(c=o.length),this.host=o.slice(0,c),o=o.slice(c),this.parseHost(),this.hostname=this.hostname||"";var v=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!v)for(var A=this.hostname.split(/\./),_=0,E=A.length;_<E;_++){var S=A[_];if(!!S&&!S.match(Mg)){for(var L="",T=0,x=S.length;T<x;T++)S.charCodeAt(T)>127?L+="x":L+=S[T];if(!L.match(Mg)){var m=A.slice(0,_),w=A.slice(_+1),R=S.match(wC);R&&(m.push(R[1]),w.unshift(R[2])),w.length&&(o="/"+w.join(".")+o),this.hostname=m.join(".");break}}}this.hostname.length>SC?this.hostname="":this.hostname=this.hostname.toLowerCase(),v||(this.hostname=mC.toASCII(this.hostname));var M=this.port?":"+this.port:"",C=this.hostname||"";this.host=C+M,this.href+=this.host,v&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),o[0]!=="/"&&(o="/"+o))}if(!AC[u])for(var _=0,E=qd.length;_<E;_++){var b=qd[_];if(o.indexOf(b)!==-1){var D=encodeURIComponent(b);D===b&&(D=escape(b)),o=o.split(b).join(D)}}var O=o.indexOf("#");O!==-1&&(this.hash=o.substr(O),o=o.slice(0,O));var B=o.indexOf("?");if(B!==-1?(this.search=o.substr(B),this.query=o.substr(B+1),t&&(this.query=Jd.parse(this.query)),o=o.slice(0,B)):t&&(this.search="",this.query={}),o&&(this.pathname=o),Ka[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var M=this.pathname||"",P=this.search||"";this.path=M+P}return this.href=this.format(),this};function MC(r){return Rr.isString(r)&&(r=Lu(r)),r instanceof wr?r.format():wr.prototype.format.call(r)}wr.prototype.format=function(){var r=this.auth||"";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,":"),r+="@");var t=this.protocol||"",e=this.pathname||"",i=this.hash||"",n=!1,s="";this.host?n=r+this.host:this.hostname&&(n=r+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&Rr.isObject(this.query)&&Object.keys(this.query).length&&(s=Jd.stringify(this.query));var a=this.search||s&&"?"+s||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Ka[t])&&n!==!1?(n="//"+(n||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):n||(n=""),i&&i.charAt(0)!=="#"&&(i="#"+i),a&&a.charAt(0)!=="?"&&(a="?"+a),e=e.replace(/[?#]/g,function(o){return encodeURIComponent(o)}),a=a.replace("#","%23"),t+n+e+a+i};function CC(r,t){return Lu(r,!1,!0).resolve(t)}wr.prototype.resolve=function(r){return this.resolveObject(Lu(r,!1,!0)).format()};wr.prototype.resolveObject=function(r){if(Rr.isString(r)){var t=new wr;t.parse(r,!1,!0),r=t}for(var e=new wr,i=Object.keys(this),n=0;n<i.length;n++){var s=i[n];e[s]=this[s]}if(e.hash=r.hash,r.href==="")return e.href=e.format(),e;if(r.slashes&&!r.protocol){for(var a=Object.keys(r),o=0;o<a.length;o++){var l=a[o];l!=="protocol"&&(e[l]=r[l])}return Ka[e.protocol]&&e.hostname&&!e.pathname&&(e.path=e.pathname="/"),e.href=e.format(),e}if(r.protocol&&r.protocol!==e.protocol){if(!Ka[r.protocol]){for(var h=Object.keys(r),u=0;u<h.length;u++){var f=h[u];e[f]=r[f]}return e.href=e.format(),e}if(e.protocol=r.protocol,!r.host&&!Zd[r.protocol]){for(var E=(r.pathname||"").split("/");E.length&&!(r.host=E.shift()););r.host||(r.host=""),r.hostname||(r.hostname=""),E[0]!==""&&E.unshift(""),E.length<2&&E.unshift(""),e.pathname=E.join("/")}else e.pathname=r.pathname;if(e.search=r.search,e.query=r.query,e.host=r.host||"",e.auth=r.auth,e.hostname=r.hostname||r.host,e.port=r.port,e.pathname||e.search){var c=e.pathname||"",_=e.search||"";e.path=c+_}return e.slashes=e.slashes||r.slashes,e.href=e.format(),e}var g=e.pathname&&e.pathname.charAt(0)==="/",d=r.host||r.pathname&&r.pathname.charAt(0)==="/",p=d||g||e.host&&r.pathname,v=p,A=e.pathname&&e.pathname.split("/")||[],E=r.pathname&&r.pathname.split("/")||[],S=e.protocol&&!Ka[e.protocol];if(S&&(e.hostname="",e.port=null,e.host&&(A[0]===""?A[0]=e.host:A.unshift(e.host)),e.host="",r.protocol&&(r.hostname=null,r.port=null,r.host&&(E[0]===""?E[0]=r.host:E.unshift(r.host)),r.host=null),p=p&&(E[0]===""||A[0]==="")),d)e.host=r.host||r.host===""?r.host:e.host,e.hostname=r.hostname||r.hostname===""?r.hostname:e.hostname,e.search=r.search,e.query=r.query,A=E;else if(E.length)A||(A=[]),A.pop(),A=A.concat(E),e.search=r.search,e.query=r.query;else if(!Rr.isNullOrUndefined(r.search)){if(S){e.hostname=e.host=A.shift();var L=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;L&&(e.auth=L.shift(),e.host=e.hostname=L.shift())}return e.search=r.search,e.query=r.query,(!Rr.isNull(e.pathname)||!Rr.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!A.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var T=A.slice(-1)[0],x=(e.host||r.host||A.length>1)&&(T==="."||T==="..")||T==="",m=0,w=A.length;w>=0;w--)T=A[w],T==="."?A.splice(w,1):T===".."?(A.splice(w,1),m++):m&&(A.splice(w,1),m--);if(!p&&!v)for(;m--;m)A.unshift("..");p&&A[0]!==""&&(!A[0]||A[0].charAt(0)!=="/")&&A.unshift(""),x&&A.join("/").substr(-1)!=="/"&&A.push("");var R=A[0]===""||A[0]&&A[0].charAt(0)==="/";if(S){e.hostname=e.host=R?"":A.length?A.shift():"";var L=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;L&&(e.auth=L.shift(),e.host=e.hostname=L.shift())}return p=p||e.host&&A.length,p&&!R&&A.unshift(""),A.length?e.pathname=A.join("/"):(e.pathname=null,e.path=null),(!Rr.isNull(e.pathname)||!Rr.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=r.auth||e.auth,e.slashes=e.slashes||r.slashes,e.href=e.format(),e};wr.prototype.parseHost=function(){var r=this.host,t=yC.exec(r);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),r=r.substr(0,r.length-t.length)),r&&(this.hostname=r)};const LC={parse:gC,format:vC,resolve:_C};function mr(r){if(typeof r!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(r)}`)}function Cg(r){return r.split("?")[0].split("#")[0]}function DC(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function RC(r,t,e){return r.replace(new RegExp(DC(t),"g"),e)}function PC(r,t){let e="",i=0,n=-1,s=0,a;for(let o=0;o<=r.length;++o){if(o<r.length)a=r.charCodeAt(o);else{if(a===47)break;a=47}if(a===47){if(!(n===o-1||s===1))if(n!==o-1&&s===2){if(e.length<2||i!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const l=e.lastIndexOf("/");if(l!==e.length-1){l===-1?(e="",i=0):(e=e.slice(0,l),i=e.length-1-e.lastIndexOf("/")),n=o,s=0;continue}}else if(e.length===2||e.length===1){e="",i=0,n=o,s=0;continue}}t&&(e.length>0?e+="/..":e="..",i=2)}else e.length>0?e+=`/${r.slice(n+1,o)}`:e=r.slice(n+1,o),i=o-n-1;n=o,s=0}else a===46&&s!==-1?++s:s=-1}return e}const oi={toPosix(r){return RC(r,"\\","/")},isUrl(r){return/^https?:/.test(this.toPosix(r))},isDataUrl(r){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(r)},hasProtocol(r){return/^[^/:]+:\//.test(this.toPosix(r))},getProtocol(r){mr(r),r=this.toPosix(r);let t="";const e=/^file:\/\/\//.exec(r),i=/^[^/:]+:\/\//.exec(r),n=/^[^/:]+:\//.exec(r);if(e||i||n){const s=(e==null?void 0:e[0])||(i==null?void 0:i[0])||(n==null?void 0:n[0]);t=s,r=r.slice(s.length)}return t},toAbsolute(r,t,e){if(this.isDataUrl(r))return r;const i=Cg(this.toPosix(t!=null?t:bt.ADAPTER.getBaseUrl())),n=Cg(this.toPosix(e!=null?e:this.rootname(i)));return mr(r),r=this.toPosix(r),r.startsWith("/")?oi.join(n,r.slice(1)):this.isAbsolute(r)?r:this.join(i,r)},normalize(r){if(r=this.toPosix(r),mr(r),r.length===0)return".";let t="";const e=r.startsWith("/");this.hasProtocol(r)&&(t=this.rootname(r),r=r.slice(t.length));const i=r.endsWith("/");return r=PC(r,!1),r.length>0&&i&&(r+="/"),e?`/${r}`:t+r},isAbsolute(r){return mr(r),r=this.toPosix(r),this.hasProtocol(r)?!0:r.startsWith("/")},join(...r){var e;if(r.length===0)return".";let t;for(let i=0;i<r.length;++i){const n=r[i];if(mr(n),n.length>0)if(t===void 0)t=n;else{const s=(e=r[i-1])!=null?e:"";this.extname(s)?t+=`/../${n}`:t+=`/${n}`}}return t===void 0?".":this.normalize(t)},dirname(r){if(mr(r),r.length===0)return".";r=this.toPosix(r);let t=r.charCodeAt(0);const e=t===47;let i=-1,n=!0;const s=this.getProtocol(r),a=r;r=r.slice(s.length);for(let o=r.length-1;o>=1;--o)if(t=r.charCodeAt(o),t===47){if(!n){i=o;break}}else n=!1;return i===-1?e?"/":this.isUrl(a)?s+r:s:e&&i===1?"//":s+r.slice(0,i)},rootname(r){mr(r),r=this.toPosix(r);let t="";if(r.startsWith("/")?t="/":t=this.getProtocol(r),this.isUrl(r)){const e=r.indexOf("/",t.length);e!==-1?t=r.slice(0,e):t=r,t.endsWith("/")||(t+="/")}return t},basename(r,t){mr(r),t&&mr(t),r=this.toPosix(r);let e=0,i=-1,n=!0,s;if(t!==void 0&&t.length>0&&t.length<=r.length){if(t.length===r.length&&t===r)return"";let a=t.length-1,o=-1;for(s=r.length-1;s>=0;--s){const l=r.charCodeAt(s);if(l===47){if(!n){e=s+1;break}}else o===-1&&(n=!1,o=s+1),a>=0&&(l===t.charCodeAt(a)?--a===-1&&(i=s):(a=-1,i=o))}return e===i?i=o:i===-1&&(i=r.length),r.slice(e,i)}for(s=r.length-1;s>=0;--s)if(r.charCodeAt(s)===47){if(!n){e=s+1;break}}else i===-1&&(n=!1,i=s+1);return i===-1?"":r.slice(e,i)},extname(r){mr(r),r=this.toPosix(r);let t=-1,e=0,i=-1,n=!0,s=0;for(let a=r.length-1;a>=0;--a){const o=r.charCodeAt(a);if(o===47){if(!n){e=a+1;break}continue}i===-1&&(n=!1,i=a+1),o===46?t===-1?t=a:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||i===-1||s===0||s===1&&t===i-1&&t===e+1?"":r.slice(t,i)},parse(r){mr(r);const t={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return t;r=this.toPosix(r);let e=r.charCodeAt(0);const i=this.isAbsolute(r);let n;t.root=this.rootname(r),i||this.hasProtocol(r)?n=1:n=0;let s=-1,a=0,o=-1,l=!0,h=r.length-1,u=0;for(;h>=n;--h){if(e=r.charCodeAt(h),e===47){if(!l){a=h+1;break}continue}o===-1&&(l=!1,o=h+1),e===46?s===-1?s=h:u!==1&&(u=1):s!==-1&&(u=-1)}return s===-1||o===-1||u===0||u===1&&s===o-1&&s===a+1?o!==-1&&(a===0&&i?t.base=t.name=r.slice(1,o):t.base=t.name=r.slice(a,o)):(a===0&&i?(t.name=r.slice(1,s),t.base=r.slice(1,o)):(t.name=r.slice(a,s),t.base=r.slice(a,o)),t.ext=r.slice(s,o)),t.dir=this.dirname(r),t},sep:"/",delimiter:":"};bt.RETINA_PREFIX=/@([0-9\.]+)x/;bt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;let Uc;function IC(){return typeof Uc>"u"&&(Uc=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:bt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!bt.ADAPTER.getWebGLRenderingContext())return!1;const e=bt.ADAPTER.createCanvas();let i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const n=!!(i&&i.getContextAttributes().stencil);if(i){const s=i.getExtension("WEBGL_lose_context");s&&s.loseContext()}return i=null,n}catch{return!1}}()),Uc}var OC="#f0f8ff",FC="#faebd7",BC="#00ffff",kC="#7fffd4",UC="#f0ffff",NC="#f5f5dc",GC="#ffe4c4",zC="#000000",WC="#ffebcd",HC="#0000ff",VC="#8a2be2",XC="#a52a2a",KC="#deb887",jC="#5f9ea0",YC="#7fff00",$C="#d2691e",qC="#ff7f50",ZC="#6495ed",JC="#fff8dc",QC="#dc143c",tL="#00ffff",eL="#00008b",iL="#008b8b",rL="#b8860b",nL="#a9a9a9",sL="#006400",aL="#a9a9a9",oL="#bdb76b",lL="#8b008b",hL="#556b2f",uL="#ff8c00",cL="#9932cc",dL="#8b0000",fL="#e9967a",pL="#8fbc8f",mL="#483d8b",gL="#2f4f4f",_L="#2f4f4f",vL="#00ced1",xL="#9400d3",yL="#ff1493",EL="#00bfff",TL="#696969",bL="#696969",SL="#1e90ff",wL="#b22222",AL="#fffaf0",ML="#228b22",CL="#ff00ff",LL="#dcdcdc",DL="#f8f8ff",RL="#daa520",PL="#ffd700",IL="#808080",OL="#008000",FL="#adff2f",BL="#808080",kL="#f0fff0",UL="#ff69b4",NL="#cd5c5c",GL="#4b0082",zL="#fffff0",WL="#f0e68c",HL="#fff0f5",VL="#e6e6fa",XL="#7cfc00",KL="#fffacd",jL="#add8e6",YL="#f08080",$L="#e0ffff",qL="#fafad2",ZL="#d3d3d3",JL="#90ee90",QL="#d3d3d3",tD="#ffb6c1",eD="#ffa07a",iD="#20b2aa",rD="#87cefa",nD="#778899",sD="#778899",aD="#b0c4de",oD="#ffffe0",lD="#00ff00",hD="#32cd32",uD="#faf0e6",cD="#ff00ff",dD="#800000",fD="#66cdaa",pD="#0000cd",mD="#ba55d3",gD="#9370db",_D="#3cb371",vD="#7b68ee",xD="#00fa9a",yD="#48d1cc",ED="#c71585",TD="#191970",bD="#f5fffa",SD="#ffe4e1",wD="#ffe4b5",AD="#ffdead",MD="#000080",CD="#fdf5e6",LD="#808000",DD="#6b8e23",RD="#ffa500",PD="#ff4500",ID="#da70d6",OD="#eee8aa",FD="#98fb98",BD="#afeeee",kD="#db7093",UD="#ffefd5",ND="#ffdab9",GD="#cd853f",zD="#ffc0cb",WD="#dda0dd",HD="#b0e0e6",VD="#800080",XD="#663399",KD="#ff0000",jD="#bc8f8f",YD="#4169e1",$D="#8b4513",qD="#fa8072",ZD="#f4a460",JD="#2e8b57",QD="#fff5ee",tR="#a0522d",eR="#c0c0c0",iR="#87ceeb",rR="#6a5acd",nR="#708090",sR="#708090",aR="#fffafa",oR="#00ff7f",lR="#4682b4",hR="#d2b48c",uR="#008080",cR="#d8bfd8",dR="#ff6347",fR="#40e0d0",pR="#ee82ee",mR="#f5deb3",gR="#ffffff",_R="#f5f5f5",vR="#ffff00",xR="#9acd32",yR={aliceblue:OC,antiquewhite:FC,aqua:BC,aquamarine:kC,azure:UC,beige:NC,bisque:GC,black:zC,blanchedalmond:WC,blue:HC,blueviolet:VC,brown:XC,burlywood:KC,cadetblue:jC,chartreuse:YC,chocolate:$C,coral:qC,cornflowerblue:ZC,cornsilk:JC,crimson:QC,cyan:tL,darkblue:eL,darkcyan:iL,darkgoldenrod:rL,darkgray:nL,darkgreen:sL,darkgrey:aL,darkkhaki:oL,darkmagenta:lL,darkolivegreen:hL,darkorange:uL,darkorchid:cL,darkred:dL,darksalmon:fL,darkseagreen:pL,darkslateblue:mL,darkslategray:gL,darkslategrey:_L,darkturquoise:vL,darkviolet:xL,deeppink:yL,deepskyblue:EL,dimgray:TL,dimgrey:bL,dodgerblue:SL,firebrick:wL,floralwhite:AL,forestgreen:ML,fuchsia:CL,gainsboro:LL,ghostwhite:DL,goldenrod:RL,gold:PL,gray:IL,green:OL,greenyellow:FL,grey:BL,honeydew:kL,hotpink:UL,indianred:NL,indigo:GL,ivory:zL,khaki:WL,lavenderblush:HL,lavender:VL,lawngreen:XL,lemonchiffon:KL,lightblue:jL,lightcoral:YL,lightcyan:$L,lightgoldenrodyellow:qL,lightgray:ZL,lightgreen:JL,lightgrey:QL,lightpink:tD,lightsalmon:eD,lightseagreen:iD,lightskyblue:rD,lightslategray:nD,lightslategrey:sD,lightsteelblue:aD,lightyellow:oD,lime:lD,limegreen:hD,linen:uD,magenta:cD,maroon:dD,mediumaquamarine:fD,mediumblue:pD,mediumorchid:mD,mediumpurple:gD,mediumseagreen:_D,mediumslateblue:vD,mediumspringgreen:xD,mediumturquoise:yD,mediumvioletred:ED,midnightblue:TD,mintcream:bD,mistyrose:SD,moccasin:wD,navajowhite:AD,navy:MD,oldlace:CD,olive:LD,olivedrab:DD,orange:RD,orangered:PD,orchid:ID,palegoldenrod:OD,palegreen:FD,paleturquoise:BD,palevioletred:kD,papayawhip:UD,peachpuff:ND,peru:GD,pink:zD,plum:WD,powderblue:HD,purple:VD,rebeccapurple:XD,red:KD,rosybrown:jD,royalblue:YD,saddlebrown:$D,salmon:qD,sandybrown:ZD,seagreen:JD,seashell:QD,sienna:tR,silver:eR,skyblue:iR,slateblue:rR,slategray:nR,slategrey:sR,snow:aR,springgreen:oR,steelblue:lR,tan:hR,teal:uR,thistle:cR,tomato:dR,turquoise:fR,violet:pR,wheat:mR,white:gR,whitesmoke:_R,yellow:vR,yellowgreen:xR};function cl(r,t=[]){return t[0]=(r>>16&255)/255,t[1]=(r>>8&255)/255,t[2]=(r&255)/255,t}function K0(r){let t=r.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}function Zf(r){if(typeof r=="string"&&(r=yR[r.toLowerCase()]||r,r[0]==="#"&&(r=r.slice(1)),r.length===3)){const[t,e,i]=r;r=t+t+e+e+i+i}return parseInt(r,16)}function ER(){const r=[],t=[];for(let i=0;i<32;i++)r[i]=i,t[i]=i;r[Jt.NORMAL_NPM]=Jt.NORMAL,r[Jt.ADD_NPM]=Jt.ADD,r[Jt.SCREEN_NPM]=Jt.SCREEN,t[Jt.NORMAL]=Jt.NORMAL_NPM,t[Jt.ADD]=Jt.ADD_NPM,t[Jt.SCREEN]=Jt.SCREEN_NPM;const e=[];return e.push(t),e.push(r),e}const j0=ER();function Y0(r,t){return j0[t?1:0][r]}function TR(r,t,e,i){return e=e||new Float32Array(4),i||i===void 0?(e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t):(e[0]=r[0],e[1]=r[1],e[2]=r[2]),e[3]=t,e}function Jf(r,t){if(t===1)return(t*255<<24)+r;if(t===0)return 0;let e=r>>16&255,i=r>>8&255,n=r&255;return e=e*t+.5|0,i=i*t+.5|0,n=n*t+.5|0,(t*255<<24)+(e<<16)+(i<<8)+n}function $0(r,t,e,i){return e=e||new Float32Array(4),e[0]=(r>>16&255)/255,e[1]=(r>>8&255)/255,e[2]=(r&255)/255,(i||i===void 0)&&(e[0]*=t,e[1]*=t,e[2]*=t),e[3]=t,e}function bR(r,t=null){const e=r*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let i=0,n=0;i<e;i+=6,n+=4)t[i+0]=n+0,t[i+1]=n+1,t[i+2]=n+2,t[i+3]=n+0,t[i+4]=n+2,t[i+5]=n+3;return t}function q0(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null}function au(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function Lg(r){return!(r&r-1)&&!!r}function Dg(r){let t=(r>65535?1:0)<<4;r>>>=t;let e=(r>255?1:0)<<3;return r>>>=e,t|=e,e=(r>15?1:0)<<2,r>>>=e,t|=e,e=(r>3?1:0)<<1,r>>>=e,t|=e,t|r>>1}function ja(r,t,e){const i=r.length;let n;if(t>=i||e===0)return;e=t+e>i?i-t:e;const s=i-e;for(n=t;n<s;++n)r[n]=r[n+e];r.length=s}function Pa(r){return r===0?0:r<0?-1:1}let SR=0;function qs(){return++SR}const Rg={},rn=Object.create(null),ls=Object.create(null);class Pg{constructor(t,e,i){this.canvas=bt.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=i||bt.RESOLUTION,this.resize(t,e)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}resize(t,e){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(e*this.resolution)}destroy(){this.context=null,this.canvas=null}get width(){return this.canvas.width}set width(t){this.canvas.width=Math.round(t)}get height(){return this.canvas.height}set height(t){this.canvas.height=Math.round(t)}}function wR(r){let t=r.width,e=r.height;const i=r.getContext("2d",{willReadFrequently:!0}),s=i.getImageData(0,0,t,e).data,a=s.length,o={top:null,left:null,right:null,bottom:null};let l=null,h,u,f;for(h=0;h<a;h+=4)s[h+3]!==0&&(u=h/4%t,f=~~(h/4/t),o.top===null&&(o.top=f),(o.left===null||u<o.left)&&(o.left=u),(o.right===null||o.right<u)&&(o.right=u+1),(o.bottom===null||o.bottom<f)&&(o.bottom=f));return o.top!==null&&(t=o.right-o.left,e=o.bottom-o.top+1,l=i.getImageData(o.left,o.top,t,e)),{height:e,width:t,data:l}}let dh;function AR(r,t=globalThis.location){if(r.startsWith("data:"))return"";t=t||globalThis.location,dh||(dh=document.createElement("a")),dh.href=r;const e=LC.parse(dh.href),i=!e.port&&t.port===""||e.port===t.port;return e.hostname!==t.hostname||!i||e.protocol!==t.protocol?"anonymous":""}function $n(r,t=1){const e=bt.RETINA_PREFIX.exec(r);return e?parseFloat(e[1]):t}const Qd=[];function Z0(r,t){if(!r)return null;let e="";if(typeof r=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(e=i[1].toLowerCase())}for(let i=Qd.length-1;i>=0;--i){const n=Qd[i];if(n.test&&n.test(r,e))return new n(r,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class dl{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new Sr("setRealSize"),this.onUpdate=new Sr("update"),this.onError=new Sr("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class wl extends dl{constructor(t,e){const{width:i,height:n}=e||{};if(!i||!n)throw new Error("BufferResource width or height invalid");super(i,n),this.data=t}upload(t,e,i){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Cr.UNPACK);const s=e.realWidth,a=e.realHeight;return i.width===s&&i.height===a?n.texSubImage2D(e.target,0,0,0,s,a,e.format,i.type,this.data):(i.width=s,i.height=a,n.texImage2D(e.target,0,i.internalFormat,s,a,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const MR={scaleMode:dn.NEAREST,format:At.RGBA,alphaMode:Cr.NPM},Io=class extends Sl{constructor(r=null,t=null){super(),t=t||{};const{alphaMode:e,mipmap:i,anisotropicLevel:n,scaleMode:s,width:a,height:o,wrapMode:l,format:h,type:u,target:f,resolution:c,resourceOptions:_}=t;r&&!(r instanceof dl)&&(r=Z0(r,_),r.internal=!0),this.resolution=c||bt.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((o||0)*this.resolution)/this.resolution,this._mipmap=i!=null?i:bt.MIPMAP_TEXTURES,this.anisotropicLevel=n!=null?n:bt.ANISOTROPIC_LEVEL,this._wrapMode=l||bt.WRAP_MODE,this._scaleMode=s!=null?s:bt.SCALE_MODE,this.format=h||At.RGBA,this.type=u||qt.UNSIGNED_BYTE,this.target=f||Va.TEXTURE_2D,this.alphaMode=e!=null?e:Cr.UNPACK,this.uid=qs(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&o>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(r)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(r){this._mipmap!==r&&(this._mipmap=r,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(r){this._scaleMode!==r&&(this._scaleMode=r,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(r){this._wrapMode!==r&&(this._wrapMode=r,this.dirtyStyleId++)}setStyle(r,t){let e;return r!==void 0&&r!==this.scaleMode&&(this.scaleMode=r,e=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,e=!0),e&&this.dirtyStyleId++,this}setSize(r,t,e){return e=e||this.resolution,this.setRealSize(r*e,t*e,e)}setRealSize(r,t,e){return this.resolution=e||this.resolution,this.width=Math.round(r)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Lg(this.realWidth)&&Lg(this.realHeight)}setResolution(r){const t=this.resolution;return t===r?this:(this.resolution=r,this.valid&&(this.width=Math.round(this.width*t)/r,this.height=Math.round(this.height*t)/r,this.emit("update",this)),this._refreshPOT(),this)}setResource(r){if(this.resource===r)return this;if(this.resource)throw new Error("Resource can be set only once");return r.bind(this),this.resource=r,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(r){this.emit("error",this,r)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ls[this.cacheId],delete rn[this.cacheId],this.cacheId=null),this.dispose(),Io.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(r,t,e=bt.STRICT_TEXTURE_CACHE){const i=typeof r=="string";let n=null;if(i)n=r;else{if(!r._pixiId){const a=(t==null?void 0:t.pixiIdPrefix)||"pixiid";r._pixiId=`${a}_${qs()}`}n=r._pixiId}let s=ls[n];if(i&&e&&!s)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return s||(s=new Io(r,t),s.cacheId=n,Io.addToCache(s,n)),s}static fromBuffer(r,t,e,i){r=r||new Float32Array(t*e*4);const n=new wl(r,{width:t,height:e}),s=r instanceof Float32Array?qt.FLOAT:qt.UNSIGNED_BYTE;return new Io(n,Object.assign({},MR,i||{width:t,height:e,type:s}))}static addToCache(r,t){t&&(r.textureCacheIds.includes(t)||r.textureCacheIds.push(t),ls[t]&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),ls[t]=r)}static removeFromCache(r){if(typeof r=="string"){const t=ls[r];if(t){const e=t.textureCacheIds.indexOf(r);return e>-1&&t.textureCacheIds.splice(e,1),delete ls[r],t}}else if(r!=null&&r.textureCacheIds){for(let t=0;t<r.textureCacheIds.length;++t)delete ls[r.textureCacheIds[t]];return r.textureCacheIds.length=0,r}return null}};let pe=Io;pe._globalBatch=0;class J0 extends dl{constructor(t,e){const{width:i,height:n}=e||{};super(i,n),this.items=[],this.itemDirtyIds=[];for(let s=0;s<t;s++){const a=new pe;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)!t[i]||(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof dl?this.addResourceAt(t[i],i):this.addResourceAt(Z0(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const e=this.items.map(i=>i.resource).filter(i=>i).map(i=>i.load());return this._load=Promise.all(e).then(()=>{const{realWidth:i,realHeight:n}=this.items[0];return this.resize(i,n),Promise.resolve(this)}),this._load}}class CR extends J0{constructor(t,e){const{width:i,height:n}=e||{};let s,a;Array.isArray(t)?(s=t,a=t.length):a=t,super(a,{width:i,height:n}),s&&this.initFromArray(s,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Va.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:n,itemDirtyIds:s,items:a}=this,{gl:o}=t;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,n,0,e.format,i.type,null);for(let l=0;l<n;l++){const h=a[l];s[l]<h.dirtyId&&(s[l]=h.dirtyId,h.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,l,h.resource.width,h.resource.height,1,e.format,i.type,h.resource.source))}return!0}}class qn extends dl{constructor(t){const e=t,i=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;super(i,n),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){i===void 0&&!e.startsWith("data:")?t.crossOrigin=AR(e):i!==!1&&(t.crossOrigin=typeof i=="string"?i:"anonymous")}upload(t,e,i,n){const s=t.gl,a=e.realWidth,o=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1&&n.buffered.length===0)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Cr.UNPACK),!this.noSubImage&&e.target===s.TEXTURE_2D&&i.width===a&&i.height===o?s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,i.type,n):(i.width=a,i.height=o,s.texImage2D(e.target,0,i.internalFormat,e.format,i.type,n)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}}class LR extends qn{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Oo=class extends J0{constructor(r,t){const{width:e,height:i,autoLoad:n,linkBaseTexture:s}=t||{};if(r&&r.length!==Oo.SIDES)throw new Error(`Invalid length. Got ${r.length}, expected 6`);super(6,{width:e,height:i});for(let a=0;a<Oo.SIDES;a++)this.items[a].target=Va.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=s!==!1,r&&this.initFromArray(r,t),n!==!1&&this.load()}bind(r){super.bind(r),r.target=Va.TEXTURE_CUBE_MAP}addBaseTextureAt(r,t,e){if(e===void 0&&(e=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||r.parentTextureArray||Object.keys(r._glTextures).length>0)if(r.resource)this.addResourceAt(r.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else r.target=Va.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.parentTextureArray=this.baseTexture,this.items[t]=r;return r.valid&&!this.valid&&this.resize(r.realWidth,r.realHeight),this.items[t]=r,this}upload(r,t,e){const i=this.itemDirtyIds;for(let n=0;n<Oo.SIDES;n++){const s=this.items[n];(i[n]<s.dirtyId||e.dirtyId<t.dirtyId)&&(s.valid&&s.resource?(s.resource.upload(r,s,e),i[n]=s.dirtyId):i[n]<-1&&(r.gl.texImage2D(s.target,0,e.internalFormat,t.realWidth,t.realHeight,0,t.format,e.type,null),i[n]=-1))}return!0}static test(r){return Array.isArray(r)&&r.length===Oo.SIDES}};let Q0=Oo;Q0.SIDES=6;class tx extends qn{constructor(t,e){var i;if(e=e||{},typeof t=="string"){const n=new Image;qn.crossOrigin(n,t,e.crossorigin),n.src=t,t=n}super(t),!t.complete&&!!this._width&&!!this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=((i=e.createBitmap)!=null?i:bt.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,i)=>{const n=this.source;this.url=n.src;const s=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.resize(n.width,n.height),this._load=null,this.createBitmap?e(this.process()):e(this))};n.complete&&n.src?s():(n.onload=s,n.onerror=a=>{i(a),this.onError.emit(a)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,i=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then(n=>n.blob()).then(n=>e(n,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Cr.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,i){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let n=!0;const s=e._glTextures;for(const a in s){const o=s[a];if(o!==i&&o.dirtyId!==e.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}const Gh=class extends qn{constructor(r,t){t=t||{},super(bt.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=r,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(r=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),r(this)},Gh.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const r=new Image;qn.crossOrigin(r,this.svg,this._crossorigin),r.src=this.svg,r.onerror=t=>{!this._resolve||(r.onerror=null,this.onError.emit(t))},r.onload=()=>{if(!this._resolve)return;const t=r.width,e=r.height;if(!t||!e)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=t*this.scale,n=e*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/e*t,n=this._overrideHeight||this._overrideWidth/t*e),i=Math.round(i),n=Math.round(n);const s=this.source;s.width=i,s.height=n,s._pixiId=`canvas_${qs()}`,s.getContext("2d").drawImage(r,0,0,t,e,0,0,i,n),this._resolve(),this._resolve=null}}static getSize(r){const t=Gh.SVG_SIZE.exec(r),e={};return t&&(e[t[1]]=Math.round(parseFloat(t[3])),e[t[5]]=Math.round(parseFloat(t[7]))),e}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(r,t){return t==="svg"||typeof r=="string"&&r.startsWith("data:image/svg+xml")||typeof r=="string"&&Gh.SVG_XML.test(r)}};let fl=Gh;fl.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;fl.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const tf=class extends qn{constructor(r,t){if(t=t||{},!(r instanceof HTMLVideoElement)){const e=document.createElement("video");e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),typeof r=="string"&&(r=[r]);const i=r[0].src||r[0];qn.crossOrigin(e,i,t.crossorigin);for(let n=0;n<r.length;++n){const s=document.createElement("source");let{src:a,mime:o}=r[n];a=a||r[n];const l=a.split("?").shift().toLowerCase(),h=l.slice(l.lastIndexOf(".")+1);o=o||tf.MIME_TYPES[h]||`video/${h}`,s.src=a,s.type=o,e.appendChild(s)}r=e}super(r),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(r=0){if(!this.destroyed){const t=Te.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const r=this.source;return(r.readyState===r.HAVE_ENOUGH_DATA||r.readyState===r.HAVE_FUTURE_DATA)&&r.width&&r.height&&(r.complete=!0),r.addEventListener("play",this._onPlayStart.bind(this)),r.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(r.addEventListener("canplay",this._onCanPlay),r.addEventListener("canplaythrough",this._onCanPlay),r.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,r.load())}),this._load}_onError(r){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(r)}_isSourcePlaying(){const r=this.source;return!r.paused&&!r.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Te.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Te.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const r=this.source;r.removeEventListener("canplay",this._onCanPlay),r.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(r.videoWidth,r.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&r.play()}dispose(){this._isConnectedToTicker&&(Te.shared.remove(this.update,this),this._isConnectedToTicker=!1);const r=this.source;r&&(r.removeEventListener("error",this._onError,!0),r.pause(),r.src="",r.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(r){r!==this._autoUpdate&&(this._autoUpdate=r,!this._autoUpdate&&this._isConnectedToTicker?(Te.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Te.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(r){r!==this._updateFPS&&(this._updateFPS=r)}static test(r,t){return globalThis.HTMLVideoElement&&r instanceof HTMLVideoElement||tf.TYPES.includes(t)}};let Qf=tf;Qf.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];Qf.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};class Ia extends qn{constructor(t,e){var n;var i=(...s)=>{super(...s)};e=e||{},typeof t=="string"?(i(Ia.EMPTY),this.url=t):(i(t),this.url=null),this.crossOrigin=(n=e.crossOrigin)!=null?n:!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const i=await bt.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await i.blob();if(this.destroyed)return;const s=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Cr.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=s,this.update(),t(this)}catch(i){if(this.destroyed)return;e(i),this.onError.emit(i)}}),this._load)}upload(t,e,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){var t;return Ia._EMPTY=(t=Ia._EMPTY)!=null?t:bt.ADAPTER.createCanvas(0,0),Ia._EMPTY}}Qd.push(Ia,tx,LR,Qf,fl,wl,Q0,CR);class DR extends wl{upload(t,e,i){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===Cr.UNPACK);const s=e.realWidth,a=e.realHeight;return i.width===s&&i.height===a?n.texSubImage2D(e.target,0,0,0,s,a,e.format,i.type,this.data):(i.width=s,i.height=a,n.texImage2D(e.target,0,i.internalFormat,s,a,0,e.format,i.type,this.data)),!0}}class ef{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Sr("disposeFramebuffer"),this.multisample=We.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new pe(null,{scaleMode:dn.NEAREST,resolution:1,mipmap:jr.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new pe(new DR(null,{width:this.width,height:this.height}),{scaleMode:dn.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:jr.OFF,format:At.DEPTH_COMPONENT,type:qt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const n=this.colorTextures[i],s=n.resolution;n.setSize(t/s,e/s)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class ex extends pe{constructor(t={}){var e;if(typeof t=="number"){const i=arguments[0],n=arguments[1],s=arguments[2],a=arguments[3];t={width:i,height:n,scaleMode:s,resolution:a}}t.width=t.width||100,t.height=t.height||100,(e=t.multisample)!=null||(t.multisample=We.NONE),super(null,t),this.mipmap=jr.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new ef(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class ix{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const n=e.width,s=e.height;if(i){const a=t.width/2/n,o=t.height/2/s,l=t.x/n+a,h=t.y/s+o;i=we.add(i,we.NW),this.x0=l+a*we.uX(i),this.y0=h+o*we.uY(i),i=we.add(i,2),this.x1=l+a*we.uX(i),this.y1=h+o*we.uY(i),i=we.add(i,2),this.x2=l+a*we.uX(i),this.y2=h+o*we.uY(i),i=we.add(i,2),this.x3=l+a*we.uX(i),this.y3=h+o*we.uY(i)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}const Ig=new ix;function fh(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}class Gt extends Sl{constructor(t,e,i,n,s,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new le(0,0,1,1)),t instanceof Gt&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this._uvs=Ig,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(s||0),s===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new me(a.x,a.y):new me(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;(e==null?void 0:e.url)&&rn[e.url]&&Gt.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Gt.removeFromCache(this),this.textureCacheIds=null}clone(){var n;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new Gt(this.baseTexture,!this.noFrame&&t,e,(n=this.trim)==null?void 0:n.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Ig&&(this._uvs=new ix),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=bt.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else if(t instanceof pe){if(!t.cacheId){const o=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${o}-${qs()}`,pe.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){const o=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${o}_${qs()}`}s=t._pixiId}let a=rn[s];if(n&&i&&!a)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return!a&&!(t instanceof pe)?(e.resolution||(e.resolution=$n(t)),a=new Gt(new pe(t,e)),a.baseTexture.cacheId=s,pe.addToCache(a.baseTexture,s),Gt.addToCache(a,s)):!a&&t instanceof pe&&(a=new Gt(t),Gt.addToCache(a,s)),a}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),n=Gt.from(t,Object.assign({resourceOptions:i},e),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then(()=>Promise.resolve(n))}static fromBuffer(t,e,i,n){return new Gt(pe.fromBuffer(t,e,i,n))}static fromLoader(t,e,i,n){const s=new pe(t,Object.assign({scaleMode:bt.SCALE_MODE,resolution:$n(e)},n)),{resource:a}=s;a instanceof tx&&(a.url=e);const o=new Gt(s);return i||(i=e),pe.addToCache(o.baseTexture,i),Gt.addToCache(o,i),i!==e&&(pe.addToCache(o.baseTexture,e),Gt.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise(l=>{o.baseTexture.once("loaded",()=>l(o))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),rn[e]&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),rn[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=rn[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete rn[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)rn[t.textureCacheIds[e]]===t&&delete rn[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:n,height:s}=t,a=e+n>this.baseTexture.width,o=i+s>this.baseTexture.height;if(a||o){const l=a&&o?"and":"or",h=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,u=`Y: ${i} + ${s} = ${i+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${h} ${l} ${u}`)}this.valid=n&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Gt._EMPTY||(Gt._EMPTY=new Gt(new pe),fh(Gt._EMPTY),fh(Gt._EMPTY.baseTexture)),Gt._EMPTY}static get WHITE(){if(!Gt._WHITE){const t=bt.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Gt._WHITE=new Gt(pe.from(t)),fh(Gt._WHITE),fh(Gt._WHITE.baseTexture)}return Gt._WHITE}}class Zn extends Gt{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const n=this.baseTexture.resolution,s=Math.round(t*n)/n,a=Math.round(e*n)/n;this.valid=s>0&&a>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=a,i&&this.baseTexture.resize(s,a),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Zn(new ex(t))}}class rx{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=We.NONE){const n=new ex(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new Zn(n)}getOptimalTexture(t,e,i=1,n=We.NONE){let s;t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=au(t),e=au(e),s=((t&65535)<<16|e&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);let a=this.texturePool[s].pop();return a||(a=this.createTexture(t,e,n)),a.filterPoolKey=s,a.setResolution(i),a}getFilterTexture(t,e,i){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||We.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const i=this.texturePool[e];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const i=this.texturePool[e];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}rx.SCREEN_KEY=-1;class ou{constructor(t,e=0,i=!1,n=qt.FLOAT,s,a,o){this.buffer=t,this.size=e,this.normalized=i,this.type=n,this.stride=s,this.start=a,this.instance=o}destroy(){this.buffer=null}static from(t,e,i,n,s){return new ou(t,e,i,n,s)}}let RR=0;class Ne{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=RR++,this.disposeRunner=new Sr("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Vr.ELEMENT_ARRAY_BUFFER:Vr.ARRAY_BUFFER}get index(){return this.type===Vr.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Ne(t)}}const PR={Float32Array,Uint32Array,Int32Array,Uint8Array};function IR(r,t){let e=0,i=0;const n={};for(let l=0;l<r.length;l++)i+=t[l],e+=r[l].length;const s=new ArrayBuffer(e*4);let a=null,o=0;for(let l=0;l<r.length;l++){const h=t[l],u=r[l],f=q0(u);n[f]||(n[f]=new PR[f](s)),a=n[f];for(let c=0;c<u.length;c++){const _=(c/h|0)*i+o,g=c%h;a[_+g]=u[c]}o+=h}return new Float32Array(s)}const Og={5126:4,5123:2,5121:1};let OR=0;const FR={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Jn{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=OR++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Sr("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,n=!1,s,a,o,l=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Ne||(e instanceof Array&&(e=new Float32Array(e)),e=new Ne(e));const h=t.split("|");if(h.length>1){for(let f=0;f<h.length;f++)this.addAttribute(h[f],e,i,n,s);return this}let u=this.buffers.indexOf(e);return u===-1&&(this.buffers.push(e),u=this.buffers.length-1),this.attributes[t]=new ou(u,i,n,s,a,o,l),this.instanced=this.instanced||l,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Ne||(t instanceof Array&&(t=new Uint16Array(t)),t=new Ne(t)),t.type=Vr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],i=new Ne;let n;for(n in this.attributes){const s=this.attributes[n],a=this.buffers[s.buffer];t.push(a.data),e.push(s.size*Og[s.type]/4),s.buffer=0}for(i.data=IR(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Jn;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Ne(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new ou(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Vr.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Jn,i=[],n=[],s=[];let a;for(let o=0;o<t.length;o++){a=t[o];for(let l=0;l<a.buffers.length;l++)n[l]=n[l]||0,n[l]+=a.buffers[l].data.length,s[l]=0}for(let o=0;o<a.buffers.length;o++)i[o]=new FR[q0(a.buffers[o].data)](n[o]),e.buffers[o]=new Ne(i[o]);for(let o=0;o<t.length;o++){a=t[o];for(let l=0;l<a.buffers.length;l++)i[l].set(a.buffers[l].data,s[l]),s[l]+=a.buffers[l].data.length}if(e.attributes=a.attributes,a.indexBuffer){e.indexBuffer=e.buffers[a.buffers.indexOf(a.indexBuffer)],e.indexBuffer.type=Vr.ELEMENT_ARRAY_BUFFER;let o=0,l=0,h=0,u=0;for(let f=0;f<a.buffers.length;f++)if(a.buffers[f]!==a.indexBuffer){u=f;break}for(const f in a.attributes){const c=a.attributes[f];(c.buffer|0)===u&&(l+=c.size*Og[c.type]/4)}for(let f=0;f<t.length;f++){const c=t[f].indexBuffer.data;for(let _=0;_<c.length;_++)e.indexBuffer.data[_+h]+=o;o+=t[f].buffers[u].data.length/l,h+=c.length}}return e}}class BR extends Jn{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class nx extends Jn{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Ne(this.vertices),this.uvBuffer=new Ne(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,n=0;return this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i+e.width/t.width,this.uvs[3]=n,this.uvs[4]=i+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=i,this.uvs[7]=n+e.height/t.height,i=e.x,n=e.y,this.vertices[0]=i,this.vertices[1]=n,this.vertices[2]=i+e.width,this.vertices[3]=n,this.vertices[4]=i+e.width,this.vertices[5]=n+e.height,this.vertices[6]=i,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}let kR=0;class Ar{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=kR++,this.static=!!e,this.ubo=!!i,t instanceof Ne?(this.buffer=t,this.buffer.type=Vr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Ne(new Float32Array(1)),this.buffer.type=Vr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(!this.ubo)this.uniforms[t]=new Ar(e,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,i){return new Ar(t,e,i)}static uboFrom(t,e){return new Ar(t,e!=null?e:!0,!0)}}class UR{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=We.NONE,this.sourceFrame=new le,this.destinationFrame=new le,this.bindingSourceFrame=new le,this.bindingDestinationFrame=new le,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const ph=[new me,new me,new me,new me],Nc=new Fe;class sx{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new rx,this.statePool=[],this.quad=new BR,this.quadUv=new nx,this.tempRect=new le,this.activeState={},this.globalUniforms=new Ar({outputFrame:new le,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){var g,d;const i=this.renderer,n=this.defaultFilterStack,s=this.statePool.pop()||new UR,a=this.renderer.renderTexture;let o=e[0].resolution,l=e[0].multisample,h=e[0].padding,u=e[0].autoFit,f=(g=e[0].legacy)!=null?g:!0;for(let p=1;p<e.length;p++){const v=e[p];o=Math.min(o,v.resolution),l=Math.min(l,v.multisample),h=this.useMaxPadding?Math.max(h,v.padding):h+v.padding,u=u&&v.autoFit,f=f||((d=v.legacy)!=null?d:!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),n.push(s),s.resolution=o,s.multisample=l,s.legacy=f,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(h);const c=this.tempRect.copyFrom(a.sourceFrame);i.projection.transform&&this.transformAABB(Nc.copyFrom(i.projection.transform).invert(),c),u?(s.sourceFrame.fit(c),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(c)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,a.current?a.current.resolution:i.resolution,a.sourceFrame,a.destinationFrame,i.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,o,l),s.filters=e,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const _=this.tempRect;_.x=0,_.y=0,_.width=s.sourceFrame.width,_.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(a.sourceFrame),s.bindingDestinationFrame.copyFrom(a.destinationFrame),s.transform=i.projection.transform,i.projection.transform=null,a.bind(s.renderTexture,s.sourceFrame,_),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const s=n.inputSize,a=n.inputPixel,o=n.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],a[0]=Math.round(s[0]*e.resolution),a[1]=Math.round(s[1]*e.resolution),a[2]=1/a[0],a[3]=1/a[1],o[0]=.5*a[2],o[1]=.5*a[3],o[2]=e.sourceFrame.width*s[2]-.5*a[2],o[3]=e.sourceFrame.height*s[3]-.5*a[3],e.legacy){const h=n.filterArea;h[0]=e.destinationFrame.width,h[1]=e.destinationFrame.height,h[2]=e.sourceFrame.x,h[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const l=t[t.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,e.renderTexture,l.renderTexture,gs.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let h=e.renderTexture,u=this.getOptimalFilterTexture(h.width,h.height,e.resolution);u.filterFrame=h.filterFrame;let f=0;for(f=0;f<i.length-1;++f){f===1&&e.multisample>1&&(u=this.getOptimalFilterTexture(h.width,h.height,e.resolution),u.filterFrame=h.filterFrame),i[f].apply(this,h,u,gs.CLEAR,e);const c=h;h=u,u=c}i[f].apply(this,h,l.renderTexture,gs.BLEND,e),f>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(u)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=gs.CLEAR){const{renderTexture:i,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=t.filterFrame.width,a.height=t.filterFrame.height,i.bind(t,t.filterFrame,a)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=n.stateId&1||this.forceClear;(e===gs.CLEAR||e===gs.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,n){const s=this.renderer;s.state.set(t.state),this.bindAndClear(i,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(Nr.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(Nr.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:n}=this.activeState,{orig:s}=e._texture,a=t.set(n.width,0,0,n.height,i.x,i.y),o=e.worldTransform.copyTo(Fe.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/s.width,1/s.height),a.translate(e.anchor.x,e.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,n=We.NONE){return this.texturePool.getOptimalTexture(t,e,i,n)}getFilterTexture(t,e,i){if(typeof t=="number"){const s=t;t=e,e=s}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||We.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=ph[0],n=ph[1],s=ph[2],a=ph[3];i.set(e.left,e.top),n.set(e.left,e.bottom),s.set(e.right,e.top),a.set(e.right,e.bottom),t.apply(i,i),t.apply(n,n),t.apply(s,s),t.apply(a,a);const o=Math.min(i.x,n.x,s.x,a.x),l=Math.min(i.y,n.y,s.y,a.y),h=Math.max(i.x,n.x,s.x,a.x),u=Math.max(i.y,n.y,s.y,a.y);e.x=o,e.y=l,e.width=h-o,e.height=u-l}roundFrame(t,e,i,n,s){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(s){const{a,b:o,c:l,d:h}=s;if((Math.abs(o)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(h)>1e-4))return}s=s?Nc.copyFrom(s):Nc.identity(),s.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}}}sx.extension={type:Pt.RendererSystem,name:"filter"};Yt.add(sx);class Du{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}class ax{constructor(t){this.renderer=t,this.emptyRenderer=new Du(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=i[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,i,n){const{elements:s,ids:a,count:o}=t;let l=0;for(let h=0;h<o;h++){const u=s[h],f=u._batchLocation;if(f>=0&&f<n&&e[f]===u){a[h]=f;continue}for(;l<n;){const c=e[l];if(c&&c._batchEnabled===i&&c._batchLocation===l){l++;continue}a[h]=l,u._batchLocation=l,e[l]=u;break}}}destroy(){this.renderer=null}}ax.extension={type:Pt.RendererSystem,name:"batch"};Yt.add(ax);let Fg=0;class ox{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Fg++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()}init(t){var e;if(t.context)this.initFromContext(t.context);else{const i=this.renderer.background.alpha<1,n=(e=t.premultipliedAlpha)!=null?e:!0;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:i,premultipliedAlpha:n,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Fg++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(bt.PREFER_ENV>=Qs.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault()}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}ox.extension={type:Pt.RendererSystem,name:"context"};Yt.add(ox);class NR{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=We.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const GR=new le;class lx{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new ef(10,10),this.msaaSamples=null}contextChange(){const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new le,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;bt.PREFER_ENV===Qs.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=n=>e.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){const{gl:n}=this;if(t){const s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=i),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let a=0;a<t.colorTextures.length;a++){const o=t.colorTextures[a];this.renderer.texture.unbind(o.parentTextureArray||o)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const a=e.width>>i,o=e.height>>i,l=a/e.width;this.setViewport(e.x*l,e.y*l,a,o)}else{const a=t.width>>i,o=t.height>>i;this.setViewport(0,0,a,o)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,n){const s=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),n=Math.round(n),(s.width!==i||s.height!==n||s.x!==t||s.y!==e)&&(s.x=t,s.y=e,s.width=i,s.height=n,this.gl.viewport(t,e,i,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,n,s=Hd.COLOR|Hd.DEPTH){const{gl:a}=this;a.clearColor(t,e,i,n),a.clear(s)}initFramebuffer(t){const{gl:e}=this,i=new NR(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const n=t.colorTextures;let s=n.length;e.drawBuffers||(s=Math.min(s,1));for(let a=0;a<s;a++){const o=n[a],l=o.parentTextureArray||o;this.renderer.texture.bind(l,0),a===0&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures;let a=s.length;i.drawBuffers||(a=Math.min(a,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer():n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const o=[];for(let l=0;l<a;l++){const h=s[l],u=h.parentTextureArray||h;this.renderer.texture.bind(u,0),l===0&&n.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+l,h.target,u._glTextures[this.CONTEXT_UID].texture,e),o.push(i.COLOR_ATTACHMENT0+l))}if(o.length>1&&i.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,n.stencil)):n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=We.NONE;if(t<=1||e===null)return i;for(let n=0;n<e.length;n++)if(e[n]<=t){i=e[n];break}return i===1&&(i=We.NONE),i}blit(t,e,i){const{current:n,renderer:s,gl:a,CONTEXT_UID:o}=this;if(s.context.webGLVersion!==2||!n)return;const l=n.glFramebuffers[o];if(!l)return;if(!t){if(!l.msaaBuffer)return;const u=n.colorTextures[0];if(!u)return;l.blitFramebuffer||(l.blitFramebuffer=new ef(n.width,n.height),l.blitFramebuffer.addColorTexture(0,u)),t=l.blitFramebuffer,t.colorTextures[0]!==u&&(t.colorTextures[0]=u,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||(e=GR,e.width=n.width,e.height=n.height),i||(i=e);const h=e.width===i.width&&e.height===i.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,l.framebuffer),a.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,a.COLOR_BUFFER_BIT,h?a.NEAREST:a.LINEAR)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose()}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const i=t.width,n=t.height,s=this.gl,a=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,a),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,s.DEPTH24_STENCIL8,i,n):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,i,n),e.stencil=a,s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new le}destroy(){this.renderer=null}}lx.extension={type:Pt.RendererSystem,name:"framebuffer"};Yt.add(lx);const Gc={5126:4,5123:2,5121:1};class hx{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;bt.PREFER_ENV===Qs.WEBGL_LEGACY&&(i=null),i?(t.createVertexArray=()=>i.createVertexArrayOES(),t.bindVertexArray=n=>i.bindVertexArrayOES(n),t.deleteVertexArray=n=>i.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const i=t.getExtension("ANGLE_instanced_arrays");i?(t.vertexAttribDivisor=(n,s)=>i.vertexAttribDivisorANGLE(n,s),t.drawElementsInstanced=(n,s,a,o,l)=>i.drawElementsInstancedANGLE(n,s,a,o,l),t.drawArraysInstanced=(n,s,a,o)=>i.drawArraysInstancedANGLE(n,s,a,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);const a=n[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?i.bindVertexArray(a):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const n=t.buffers[i];e.update(n)}}checkCompatibility(t,e){const i=t.attributes,n=e.attributeData;for(const s in n)if(!i[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(t,e){const i=t.attributes,n=e.attributeData,s=["g",t.id];for(const a in i)n[a]&&s.push(a,n[a].location);return s.join("-")}initGeometryVao(t,e,i=!0){const n=this.gl,s=this.CONTEXT_UID,a=this.renderer.buffer,o=e.program;o.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const l=this.getSignature(t,o),h=t.glVertexArrayObjects[this.CONTEXT_UID];let u=h[l];if(u)return h[o.id]=u,u;const f=t.buffers,c=t.attributes,_={},g={};for(const d in f)_[d]=0,g[d]=0;for(const d in c)!c[d].size&&o.attributeData[d]?c[d].size=o.attributeData[d].size:c[d].size||console.warn(`PIXI Geometry attribute '${d}' size cannot be determined (likely the bound shader does not have the attribute)`),_[c[d].buffer]+=c[d].size*Gc[c[d].type];for(const d in c){const p=c[d],v=p.size;p.stride===void 0&&(_[p.buffer]===v*Gc[p.type]?p.stride=0:p.stride=_[p.buffer]),p.start===void 0&&(p.start=g[p.buffer],g[p.buffer]+=v*Gc[p.type])}u=n.createVertexArray(),n.bindVertexArray(u);for(let d=0;d<f.length;d++){const p=f[d];a.bind(p),i&&p._glBuffers[s].refCount++}return this.activateVao(t,o),h[o.id]=u,h[l]=u,n.bindVertexArray(null),a.unbind(Vr.ARRAY_BUFFER),u}disposeGeometry(t,e){var o;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,s=t.buffers,a=(o=this.renderer)==null?void 0:o.buffer;if(t.disposeRunner.remove(this),!!i){if(a)for(let l=0;l<s.length;l++){const h=s[l]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&a.dispose(s[l],e))}if(!e){for(const l in i)if(l[0]==="g"){const h=i[l];this._activeVao===h&&this.unbind(),n.deleteVertexArray(h)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,a=t.buffers,o=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let l=null;for(const h in o){const u=o[h],f=a[u.buffer],c=f._glBuffers[n];if(e.attributeData[h]){l!==c&&(s.bind(f),l=c);const _=e.attributeData[h].location;if(i.enableVertexAttribArray(_),i.vertexAttribPointer(_,u.size,u.type||i.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)i.vertexAttribDivisor(_,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,i,n){const{gl:s}=this,a=this._activeGeometry;if(a.indexBuffer){const o=a.indexBuffer.data.BYTES_PER_ELEMENT,l=o===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;o===2||o===4&&this.canUseUInt32ElementIndex?a.instanced?s.drawElementsInstanced(t,e||a.indexBuffer.data.length,l,(i||0)*o,n||1):s.drawElements(t,e||a.indexBuffer.data.length,l,(i||0)*o):console.warn("unsupported index buffer type: uint32")}else a.instanced?s.drawArraysInstanced(t,i,e||a.getSize(),n||1):s.drawArrays(t,i,e||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}hx.extension={type:Pt.RendererSystem,name:"geometry"};Yt.add(hx);class zR{constructor(t=null){this.type=Ke.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=bt.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Ke.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}function Bg(r,t,e){const i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}function kg(r,t){const e=r.getShaderSource(t).split(`
`).map((h,u)=>`${u}: ${h}`),i=r.getShaderInfoLog(t),n=i.split(`
`),s={},a=n.map(h=>parseFloat(h.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(h=>h&&!s[h]?(s[h]=!0,!0):!1),o=[""];a.forEach(h=>{e[h-1]=`%c${e[h-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=e.join(`
`);o[0]=l,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function WR(r,t,e,i){r.getProgramParameter(t,r.LINK_STATUS)||(r.getShaderParameter(e,r.COMPILE_STATUS)||kg(r,e),r.getShaderParameter(i,r.COMPILE_STATUS)||kg(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(t)))}function zc(r){const t=new Array(r);for(let e=0;e<t.length;e++)t[e]=!1;return t}function ux(r,t){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return zc(2*t);case"bvec3":return zc(3*t);case"bvec4":return zc(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const cx={};let ya=cx;function HR(){if(ya===cx||(ya==null?void 0:ya.isContextLost())){const r=bt.ADAPTER.createCanvas();let t;bt.PREFER_ENV>=Qs.WEBGL2&&(t=r.getContext("webgl2",{})),t||(t=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),ya=t}return ya}let mh;function VR(){if(!mh){mh=or.MEDIUM;const r=HR();r&&r.getShaderPrecisionFormat&&(mh=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision?or.HIGH:or.MEDIUM)}return mh}function Ug(r,t,e){if(r.substring(0,9)!=="precision"){let i=t;return t===or.HIGH&&e!==or.HIGH&&(i=or.MEDIUM),`precision ${i} float;
${r}`}else if(e!==or.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}const XR={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function dx(r){return XR[r]}let gh=null;const Ng={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function fx(r,t){if(!gh){const e=Object.keys(Ng);gh={};for(let i=0;i<e.length;++i){const n=e[i];gh[r[n]]=Ng[n]}}return gh[t]}const Ya=[{test:r=>r.type==="float"&&r.size===1&&!r.isArray,code:r=>`
            if(uv["${r}"] !== ud["${r}"].value)
            {
                ud["${r}"].value = uv["${r}"]
                gl.uniform1f(ud["${r}"].location, uv["${r}"])
            }
            `},{test:(r,t)=>(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(t==null||t.castToBaseTexture!==void 0),code:r=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${r}"], t);

            if(ud["${r}"].value !== t)
            {
                ud["${r}"].value = t;
                gl.uniform1i(ud["${r}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(r,t)=>r.type==="mat3"&&r.size===1&&!r.isArray&&t.a!==void 0,code:r=>`
            gl.uniformMatrix3fv(ud["${r}"].location, false, uv["${r}"].toArray(true));
            `,codeUbo:r=>`
                var ${r}_matrix = uv.${r}.toArray(true);

                data[offset] = ${r}_matrix[0];
                data[offset+1] = ${r}_matrix[1];
                data[offset+2] = ${r}_matrix[2];
        
                data[offset + 4] = ${r}_matrix[3];
                data[offset + 5] = ${r}_matrix[4];
                data[offset + 6] = ${r}_matrix[5];
        
                data[offset + 8] = ${r}_matrix[6];
                data[offset + 9] = ${r}_matrix[7];
                data[offset + 10] = ${r}_matrix[8];
            `},{test:(r,t)=>r.type==="vec2"&&r.size===1&&!r.isArray&&t.x!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${r}"].location, v.x, v.y);
                }`,codeUbo:r=>`
                v = uv.${r};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:r=>r.type==="vec2"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${r}"].location, v[0], v[1]);
                }
            `},{test:(r,t)=>r.type==="vec4"&&r.size===1&&!r.isArray&&t.width!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${r}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:r=>r.type==="vec4"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${r}"].location, v[0], v[1], v[2], v[3])
                }`}],KR={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},jR={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function YR(r,t){var i;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in r.uniforms){const s=t[n];if(!s){(i=r.uniforms[n])!=null&&i.group&&(r.uniforms[n].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const a=r.uniforms[n];let o=!1;for(let l=0;l<Ya.length;l++)if(Ya[l].test(s,a)){e.push(Ya[l].code(n,a)),o=!0;break}if(!o){const h=(s.size===1&&!s.isArray?KR:jR)[s.type].replace("location",`ud["${n}"].location`);e.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const $R=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function qR(r){let t="";for(let e=0;e<r;++e)e>0&&(t+=`
else `),e<r-1&&(t+=`if(test == ${e}.0){}`);return t}function ZR(r,t){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const i=$R.replace(/%forloop%/gi,qR(r));if(t.shaderSource(e,i),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))r=r/2|0;else break}return r}let Eo;function JR(){if(typeof Eo=="boolean")return Eo;try{Eo=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Eo=!1}return Eo}var QR=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,tP=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;let eP=0;const _h={};class gn{constructor(t,e,i="pixi-shader",n={}){this.extra={},this.id=eP++,this.vertexSrc=t||gn.defaultVertexSrc,this.fragmentSrc=e||gn.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),_h[i]?(_h[i]++,i+=`-${_h[i]}`):_h[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=Ug(this.vertexSrc,bt.PRECISION_VERTEX,or.HIGH),this.fragmentSrc=Ug(this.fragmentSrc,bt.PRECISION_FRAGMENT,VR())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return tP}static get defaultFragmentSrc(){return QR}static from(t,e,i){const n=t+e;let s=Rg[n];return s||(Rg[n]=s=new gn(t,e,i)),s}}class Xr{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof Ar?this.uniformGroup=e:this.uniformGroup=new Ar(e):this.uniformGroup=new Ar({}),this.disposeRunner=new Sr("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const n=e.uniforms[i];if(n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const n=gn.from(t,e);return new Xr(n,i)}}const Wc=0,Hc=1,Vc=2,Xc=3,Kc=4,jc=5;class En{constructor(){this.data=0,this.blendMode=Jt.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Wc)}set blend(t){!!(this.data&1<<Wc)!==t&&(this.data^=1<<Wc)}get offsets(){return!!(this.data&1<<Hc)}set offsets(t){!!(this.data&1<<Hc)!==t&&(this.data^=1<<Hc)}get culling(){return!!(this.data&1<<Vc)}set culling(t){!!(this.data&1<<Vc)!==t&&(this.data^=1<<Vc)}get depthTest(){return!!(this.data&1<<Xc)}set depthTest(t){!!(this.data&1<<Xc)!==t&&(this.data^=1<<Xc)}get depthMask(){return!!(this.data&1<<jc)}set depthMask(t){!!(this.data&1<<jc)!==t&&(this.data^=1<<jc)}get clockwiseFrontFace(){return!!(this.data&1<<Kc)}set clockwiseFrontFace(t){!!(this.data&1<<Kc)!==t&&(this.data^=1<<Kc)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==Jt.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new En;return t.depthTest=!1,t.blend=!0,t}}var iP=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,rP=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;class pl extends Xr{constructor(t,e,i){const n=gn.from(t||pl.defaultVertexSrc,e||pl.defaultFragmentSrc);super(n,i),this.padding=0,this.resolution=bt.FILTER_RESOLUTION,this.multisample=bt.FILTER_MULTISAMPLE,this.enabled=!0,this.autoFit=!0,this.state=new En}apply(t,e,i,n,s){t.applyFilter(this,e,i,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return rP}static get defaultFragmentSrc(){return iP}}var nP=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,sP=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;const Gg=new Fe;class px{constructor(t,e){this._texture=t,this.mapCoord=new Fe,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const i=this.mapCoord;for(let n=0;n<t.length;n+=2){const s=t[n],a=t[n+1];e[n]=s*i.a+a*i.c+i.tx,e[n+1]=s*i.b+a*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const n=e.orig,s=e.trim;s&&(Gg.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(Gg));const a=e.baseTexture,o=this.uClampFrame,l=this.clampMargin/a.resolution,h=this.clampOffset;return o[0]=(e._frame.x+l+h)/a.width,o[1]=(e._frame.y+l+h)/a.height,o[2]=(e._frame.x+e._frame.width-l+h)/a.width,o[3]=(e._frame.y+e._frame.height-l+h)/a.height,this.uClampOffset[0]=h/a.realWidth,this.uClampOffset[1]=h/a.realHeight,this.isSimple=e._frame.width===a.width&&e._frame.height===a.height&&e.rotate===0,!0}}class aP extends pl{constructor(t,e,i){let n=null;typeof t!="string"&&e===void 0&&i===void 0&&(n=t,t=void 0,e=void 0,i=void 0),super(t||nP,e||sP,i),this.maskSprite=n,this.maskMatrix=new Fe}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,n){const s=this._maskSprite,a=s._texture;!a.valid||(a.uvMatrix||(a.uvMatrix=new px(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,e,i,n))}}class mx{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const s=this.maskDataPool.pop()||new zR;s.pooled=!0,s.maskObject=e,i=s}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(n),i._colorMask=n?n._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==Ke.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case Ke.SCISSOR:this.renderer.scissor.push(i);break;case Ke.STENCIL:this.renderer.stencil.push(i);break;case Ke.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case Ke.COLOR:this.pushColorMask(i);break}i.type===Ke.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case Ke.SCISSOR:this.renderer.scissor.pop(e);break;case Ke.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Ke.SPRITE:this.popSpriteMask(e);break;case Ke.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===Ke.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=Ke.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Ke.SCISSOR:t.type=Ke.STENCIL:t.type=Ke.COLOR}pushSpriteMask(t){var u,f;const{maskObject:e}=t,i=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new aP]));const s=this.renderer,a=s.renderTexture;let o,l;if(a.current){const c=a.current;o=t.resolution||c.resolution,l=(u=t.multisample)!=null?u:c.multisample}else o=t.resolution||s.resolution,l=(f=t.multisample)!=null?f:s.multisample;n[0].resolution=o,n[0].multisample=l,n[0].maskSprite=e;const h=i.filterArea;i.filterArea=e.getBounds(!0),s.filter.push(i,n),i.filterArea=h,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(t){const e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}mx.extension={type:Pt.RendererSystem,name:"mask"};Yt.add(mx);class gx{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==i&&(n===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const zg=new Fe,Wg=[],zh=class extends gx{constructor(r){super(r),this.glConst=bt.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const r=this.maskStack[this.maskStack.length-1];return r?r._scissorCounter:0}calcScissorRect(r){var a;if(r._scissorRectLocal)return;const t=r._scissorRect,{maskObject:e}=r,{renderer:i}=this,n=i.renderTexture,s=e.getBounds(!0,(a=Wg.pop())!=null?a:new le);this.roundFrameToPixels(s,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),t&&s.fit(t),r._scissorRectLocal=s}static isMatrixRotated(r){if(!r)return!1;const{a:t,b:e,c:i,d:n}=r;return(Math.abs(e)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4)}testScissor(r){const{maskObject:t}=r;if(!t.isFastRect||!t.isFastRect()||zh.isMatrixRotated(t.worldTransform)||zh.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(r);const e=r._scissorRectLocal;return e.width>0&&e.height>0}roundFrameToPixels(r,t,e,i,n){zh.isMatrixRotated(n)||(n=n?zg.copyFrom(n):zg.identity(),n.translate(-e.x,-e.y).scale(i.width/e.width,i.height/e.height).translate(i.x,i.y),this.renderer.filter.transformAABB(n,r),r.fit(i),r.x=Math.round(r.x*t),r.y=Math.round(r.y*t),r.width=Math.round(r.width*t),r.height=Math.round(r.height*t))}push(r){r._scissorRectLocal||this.calcScissorRect(r);const{gl:t}=this.renderer;r._scissorRect||t.enable(t.SCISSOR_TEST),r._scissorCounter++,r._scissorRect=r._scissorRectLocal,this._useCurrent()}pop(r){const{gl:t}=this.renderer;r&&Wg.push(r._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const r=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=r.y:t=this.renderer.height-r.height-r.y,this.renderer.gl.scissor(r.x,t,r.width,r.height)}};let _x=zh;_x.extension={type:Pt.RendererSystem,name:"scissor"};Yt.add(_x);class vx extends gx{constructor(t){super(t),this.glConst=bt.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,n=t._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const s=t._colorMask;s!==0&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,n,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(t._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=i?i._colorMask:15;n!==0&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(i._colorMask=n,e.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}vx.extension={type:Pt.RendererSystem,name:"stencil"};Yt.add(vx);class xx{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Fe,this.transform=null}update(t,e,i,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(t,e,i,n){const s=this.projectionMatrix,a=n?-1:1;s.identity(),s.a=1/e.width*2,s.d=a*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-a-e.y*s.d}setTransform(t){}destroy(){this.renderer=null}}xx.extension={type:Pt.RendererSystem,name:"projection"};Yt.add(xx);const hs=new le,To=new le;class yx{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new le,this.destinationFrame=new le,this.viewportFrame=new le}bind(t=null,e,i){const n=this.renderer;this.current=t;let s,a,o;t?(s=t.baseTexture,o=s.resolution,e||(hs.width=t.frame.width,hs.height=t.frame.height,e=hs),i||(To.x=t.frame.x,To.y=t.frame.y,To.width=e.width,To.height=e.height,i=To),a=s.framebuffer):(o=n.resolution,e||(hs.width=n._view.screen.width,hs.height=n._view.screen.height,e=hs),i||(i=hs,i.width=e.width,i.height=e.height));const l=this.viewportFrame;l.x=i.x*o,l.y=i.y*o,l.width=i.width*o,l.height=i.height*o,t||(l.y=n.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(a,l),this.renderer.projection.update(i,e,o,!a),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.renderer.background.colorRgba;const i=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,s=i.width!==n.width||i.height!==n.height;if(s){let{x:a,y:o,width:l,height:h}=this.viewportFrame;a=Math.round(a),o=Math.round(o),l=Math.round(l),h=Math.round(h),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(a,o,l,h)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),s&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}yx.extension={type:Pt.RendererSystem,name:"renderTexture"};Yt.add(yx);function oP(r,t,e,i,n){e.buffer.update(n)}const lP={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Ex={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function hP(r){const t=r.map(s=>({data:s,offset:0,dataLen:0,dirty:0}));let e=0,i=0,n=0;for(let s=0;s<t.length;s++){const a=t[s];if(e=Ex[a.data.type],a.data.size>1&&(e=Math.max(e,16)*a.data.size),a.dataLen=e,i%e!==0&&i<16){const o=i%e%16;i+=o,n+=o}i+e>16?(n=Math.ceil(n/16)*16,a.offset=n,n+=e,i=e):(a.offset=n,i+=e,n+=e)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function uP(r,t){const e=[];for(const i in r)t[i]&&e.push(t[i]);return e.sort((i,n)=>i.index-n.index),e}function cP(r,t){if(!r.autoManage)return{size:0,syncFunc:oP};const e=uP(r.uniforms,t),{uboElements:i,size:n}=hP(e),s=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<i.length;a++){const o=i[a],l=r.uniforms[o.data.name],h=o.data.name;let u=!1;for(let f=0;f<Ya.length;f++){const c=Ya[f];if(c.codeUbo&&c.test(o.data,l)){s.push(`offset = ${o.offset/4};`,Ya[f].codeUbo(o.data.name,l)),u=!0;break}}if(!u)if(o.data.size>1){const f=dx(o.data.type),c=Math.max(Ex[o.data.type]/16,1),_=f/c,g=(4-_%4)%4;s.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${o.offset/4};

                t = 0;

                for(var i=0; i < ${o.data.size*c}; i++)
                {
                    for(var j = 0; j < ${_}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${g};
                }

                `)}else{const f=lP[o.data.type];s.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${o.offset/4};
                ${f};
                `)}}return s.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join(`
`))}}class dP{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function fP(r,t){const e={},i=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const s=t.getActiveAttrib(r,n);if(s.name.startsWith("gl_"))continue;const a=fx(t,s.type),o={type:a,name:s.name,size:dx(a),location:t.getAttribLocation(r,s.name)};e[s.name]=o}return e}function pP(r,t){const e={},i=t.getProgramParameter(r,t.ACTIVE_UNIFORMS);for(let n=0;n<i;n++){const s=t.getActiveUniform(r,n),a=s.name.replace(/\[.*?\]$/,""),o=!!s.name.match(/\[.*?\]$/),l=fx(t,s.type);e[a]={name:a,index:n,type:l,size:s.size,isArray:o,value:ux(l,s.size)}}return e}function mP(r,t){var l;const e=Bg(r,r.VERTEX_SHADER,t.vertexSrc),i=Bg(r,r.FRAGMENT_SHADER,t.fragmentSrc),n=r.createProgram();r.attachShader(n,e),r.attachShader(n,i);const s=(l=t.extra)==null?void 0:l.transformFeedbackVaryings;if(s&&(typeof r.transformFeedbackVaryings!="function"||r.transformFeedbackVaryings(n,s.names,s.bufferMode==="separate"?r.SEPARATE_ATTRIBS:r.INTERLEAVED_ATTRIBS)),r.linkProgram(n),r.getProgramParameter(n,r.LINK_STATUS)||WR(r,n,e,i),t.attributeData=fP(n,r),t.uniformData=pP(n,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const h=Object.keys(t.attributeData);h.sort((u,f)=>u>f?1:-1);for(let u=0;u<h.length;u++)t.attributeData[h[u]].location=u,r.bindAttribLocation(n,u,h[u]);r.linkProgram(n)}r.deleteShader(e),r.deleteShader(i);const a={};for(const h in t.uniformData){const u=t.uniformData[h];a[h]={location:r.getUniformLocation(n,h),value:ux(u.type,u.size)}}return new dP(n,a)}let gP=0;const vh={textureCount:0,uboCount:0};class Tx{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=gP++}systemCheck(){if(!JR())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),e||(vh.textureCount=0,vh.uboCount=0,this.syncUniformGroup(t.uniformGroup,vh)),n}setUniforms(t){const e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();(!t.static||t.dirtyId!==i.uniformDirtyGroups[t.id])&&(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=YR(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||t.dirtyId!==0||!i.uniformGroups[t.id]){t.dirtyId=0;const n=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),n(i.uniformData,t.uniforms,this.renderer,vh,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const s=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[a];if(o||(o=this._uboCache[a]=cP(t,this.shader.program.uniformData)),t.autoManage){const l=new Float32Array(o.size/4);t.buffer.update(l)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const n=t.uniforms,s=[`${i}-`];for(const a in n)s.push(a),e[a]&&s.push(e[a].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,i=t.program,n=mP(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Tx.extension={type:Pt.RendererSystem,name:"shader"};Yt.add(Tx);function _P(r,t=[]){return t[Jt.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.ADD]=[r.ONE,r.ONE],t[Jt.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.NONE]=[0,0],t[Jt.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],t[Jt.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],t[Jt.SRC_IN]=[r.DST_ALPHA,r.ZERO],t[Jt.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],t[Jt.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[Jt.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],t[Jt.DST_IN]=[r.ZERO,r.SRC_ALPHA],t[Jt.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],t[Jt.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],t[Jt.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],t[Jt.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],t}const vP=0,xP=1,yP=2,EP=3,TP=4,bP=5,rf=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Jt.NONE,this._blendEq=!1,this.map=[],this.map[vP]=this.setBlend,this.map[xP]=this.setOffset,this.map[yP]=this.setCullFace,this.map[EP]=this.setDepthTest,this.map[TP]=this.setFrontFace,this.map[bP]=this.setDepthMask,this.checks=[],this.defaultState=new En,this.defaultState.blend=!0}contextChange(r){this.gl=r,this.blendModes=_P(r),this.set(this.defaultState),this.reset()}set(r){if(r=r||this.defaultState,this.stateId!==r.data){let t=this.stateId^r.data,e=0;for(;t;)t&1&&this.map[e].call(this,!!(r.data&1<<e)),t=t>>1,e++;this.stateId=r.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,r)}forceState(r){r=r||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(r.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,r);this.stateId=r.data}setBlend(r){this.updateCheck(rf.checkBlendMode,r),this.gl[r?"enable":"disable"](this.gl.BLEND)}setOffset(r){this.updateCheck(rf.checkPolygonOffset,r),this.gl[r?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(r){this.gl[r?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(r){this.gl.depthMask(r)}setCullFace(r){this.gl[r?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(r){this.gl.frontFace(this.gl[r?"CW":"CCW"])}setBlendMode(r){if(r===this.blendMode)return;this.blendMode=r;const t=this.blendModes[r],e=this.gl;t.length===2?e.blendFunc(t[0],t[1]):e.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,e.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD))}setPolygonOffset(r,t){this.gl.polygonOffset(r,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(r,t){const e=this.checks.indexOf(r);t&&e===-1?this.checks.push(r):!t&&e!==-1&&this.checks.splice(e,1)}static checkBlendMode(r,t){r.setBlendMode(t.blendMode)}static checkPolygonOffset(r,t){r.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let bx=rf;bx.extension={type:Pt.RendererSystem,name:"state"};Yt.add(bx);class Sx{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=bt.GC_MAX_IDLE,this.checkCountMax=bt.GC_MAX_CHECK_COUNT,this.mode=bt.GC_MODE}postrender(){!this.renderer.objectRenderer.renderingToScreen||(this.count++,this.mode!==Xf.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let i=!1;for(let n=0;n<e.length;n++){const s=e[n];!s.framebuffer&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[n]=null,i=!0)}if(i){let n=0;for(let s=0;s<e.length;s++)e[s]!==null&&(e[n++]=e[s]);e.length=n}}unload(t){const e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let n=t.children.length-1;n>=0;n--)this.unload(t.children[n])}destroy(){this.renderer=null}}Sx.extension={type:Pt.RendererSystem,name:"textureGC"};Yt.add(Sx);function SP(r){let t;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?t={[qt.UNSIGNED_BYTE]:{[At.RGBA]:r.RGBA8,[At.RGB]:r.RGB8,[At.RG]:r.RG8,[At.RED]:r.R8,[At.RGBA_INTEGER]:r.RGBA8UI,[At.RGB_INTEGER]:r.RGB8UI,[At.RG_INTEGER]:r.RG8UI,[At.RED_INTEGER]:r.R8UI,[At.ALPHA]:r.ALPHA,[At.LUMINANCE]:r.LUMINANCE,[At.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[qt.BYTE]:{[At.RGBA]:r.RGBA8_SNORM,[At.RGB]:r.RGB8_SNORM,[At.RG]:r.RG8_SNORM,[At.RED]:r.R8_SNORM,[At.RGBA_INTEGER]:r.RGBA8I,[At.RGB_INTEGER]:r.RGB8I,[At.RG_INTEGER]:r.RG8I,[At.RED_INTEGER]:r.R8I},[qt.UNSIGNED_SHORT]:{[At.RGBA_INTEGER]:r.RGBA16UI,[At.RGB_INTEGER]:r.RGB16UI,[At.RG_INTEGER]:r.RG16UI,[At.RED_INTEGER]:r.R16UI,[At.DEPTH_COMPONENT]:r.DEPTH_COMPONENT16},[qt.SHORT]:{[At.RGBA_INTEGER]:r.RGBA16I,[At.RGB_INTEGER]:r.RGB16I,[At.RG_INTEGER]:r.RG16I,[At.RED_INTEGER]:r.R16I},[qt.UNSIGNED_INT]:{[At.RGBA_INTEGER]:r.RGBA32UI,[At.RGB_INTEGER]:r.RGB32UI,[At.RG_INTEGER]:r.RG32UI,[At.RED_INTEGER]:r.R32UI,[At.DEPTH_COMPONENT]:r.DEPTH_COMPONENT24},[qt.INT]:{[At.RGBA_INTEGER]:r.RGBA32I,[At.RGB_INTEGER]:r.RGB32I,[At.RG_INTEGER]:r.RG32I,[At.RED_INTEGER]:r.R32I},[qt.FLOAT]:{[At.RGBA]:r.RGBA32F,[At.RGB]:r.RGB32F,[At.RG]:r.RG32F,[At.RED]:r.R32F,[At.DEPTH_COMPONENT]:r.DEPTH_COMPONENT32F},[qt.HALF_FLOAT]:{[At.RGBA]:r.RGBA16F,[At.RGB]:r.RGB16F,[At.RG]:r.RG16F,[At.RED]:r.R16F},[qt.UNSIGNED_SHORT_5_6_5]:{[At.RGB]:r.RGB565},[qt.UNSIGNED_SHORT_4_4_4_4]:{[At.RGBA]:r.RGBA4},[qt.UNSIGNED_SHORT_5_5_5_1]:{[At.RGBA]:r.RGB5_A1},[qt.UNSIGNED_INT_2_10_10_10_REV]:{[At.RGBA]:r.RGB10_A2,[At.RGBA_INTEGER]:r.RGB10_A2UI},[qt.UNSIGNED_INT_10F_11F_11F_REV]:{[At.RGB]:r.R11F_G11F_B10F},[qt.UNSIGNED_INT_5_9_9_9_REV]:{[At.RGB]:r.RGB9_E5},[qt.UNSIGNED_INT_24_8]:{[At.DEPTH_STENCIL]:r.DEPTH24_STENCIL8},[qt.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[At.DEPTH_STENCIL]:r.DEPTH32F_STENCIL8}}:t={[qt.UNSIGNED_BYTE]:{[At.RGBA]:r.RGBA,[At.RGB]:r.RGB,[At.ALPHA]:r.ALPHA,[At.LUMINANCE]:r.LUMINANCE,[At.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[qt.UNSIGNED_SHORT_5_6_5]:{[At.RGB]:r.RGB},[qt.UNSIGNED_SHORT_4_4_4_4]:{[At.RGBA]:r.RGBA},[qt.UNSIGNED_SHORT_5_5_5_1]:{[At.RGBA]:r.RGBA}},t}class Yc{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=qt.UNSIGNED_BYTE,this.internalFormat=At.RGBA,this.samplerType=0}}class wx{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new pe,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=SP(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};const i=new Yc(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Yc(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,e=0){const{gl:i}=this;if(t=t==null?void 0:t.castToBaseTexture(),(t==null?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<i.length;n++)i[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<i.length;n++)i[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:n}=this;if(!!i)for(let s=t-1;s>=0;--s){const a=e[s];a&&a._glTextures[n].samplerType!==Vd.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(t){const e=new Yc(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var i,n;e.internalFormat=(n=(i=this.internalFormats[t.type])==null?void 0:i[t.format])!=null?n:t.format,this.webGLVersion===2&&t.type===qt.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var n;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),(n=t.resource)!=null&&n.upload(i,t,e))e.samplerType!==Vd.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,a=t.realHeight,o=i.gl;(e.width!==s||e.height!==a||e.dirtyId<0)&&(e.width=s,e.height=a,o.texImage2D(t.target,0,e.internalFormat,s,a,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const n=this.managedTextures.indexOf(t);n!==-1&&ja(this.managedTextures,n,1)}}updateTextureStyle(t){var i;const e=t._glTextures[this.CONTEXT_UID];!e||((t.mipmap===jr.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Vn.CLAMP:e.wrapMode=t.wrapMode,(i=t.resource)!=null&&i.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==jr.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===dn.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===dn.LINEAR){const s=Math.min(t.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===dn.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===dn.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}wx.extension={type:Pt.RendererSystem,name:"texture"};Yt.add(wx);const wP=new $f;class Ax{constructor(t){this.renderer=t,this._tempMatrix=new Fe}generateTexture(t,e){const{region:i,...n}=e||{},s=i||t.getLocalBounds(null,!0);s.width===0&&(s.width=1),s.height===0&&(s.height=1);const a=Zn.create({width:s.width,height:s.height,...n});this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const o=t.transform;return t.transform=wP,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,a}destroy(){}}Ax.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"textureGenerator"};Yt.add(Ax);class Mx{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color=typeof t.color=="string"?Zf(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=K0(t),cl(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}Mx.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"background"};Yt.add(Mx);class Cx{constructor(t){this.renderer=t}init(t){this.screen=new le(0,0,t.width,t.height),this.element=t.view||bt.ADAPTER.createCanvas(),this.resolution=t.resolution||bt.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=i,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",i,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Cx.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"_view"};Yt.add(Cx);class Lx{constructor(t){this.renderer=t,this.plugins={}}init(t){for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Lx.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"_plugin"};Yt.add(Lx);class AP extends Sl{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){var n;this.addRunners(...t.runners);const e=((n=t.priority)!=null?n:[]).filter(s=>t.systems[s]),i=[...e,...Object.keys(t.systems).filter(s=>!e.includes(s))];for(const s of i)this.addSystem(t.systems[s],s)}addRunners(...t){t.forEach(e=>{this.runners[e]=new Sr(e)})}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const n in this.runners)this.runners[n].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach(n=>{const s=i.find(a=>this._systemsHash[a]===n);n[t.name](e[s])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}class Dx{constructor(t){this.renderer=t}run(t){const e=this.renderer;e.emitWithCustomOptions(e.runners.init,t),t.hello&&console.log(`PixiJS 7.0.4 - ${e.rendererLogId} - https://pixijs.com`),e.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}Dx.extension={type:[Pt.RendererSystem,Pt.CanvasRendererSystem],name:"startup"};Yt.add(Dx);class Rx{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:n}=this;e&&n.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:n}=this,s=e.createTransformFeedback();t._glTransformFeedbacks[n]=s,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s);for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];!o||(i.buffer.update(o),o._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,a,o._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),s}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];if(!o)continue;const l=o._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!e&&s.dispose(o,e))}!i||(e||n.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Rx.extension={type:Pt.RendererSystem,name:"transformFeedback"};Yt.add(Rx);const Px=[];Yt.handleByList(Pt.Renderer,Px);function MP(r){for(const t of Px)if(t.test(r))return new t(r);throw new Error("Unable to auto-detect a suitable renderer.")}var CP=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const LP=CP,nf=class extends AP{constructor(r){var i,n;super(),r=Object.assign({},bt.RENDER_OPTIONS,r),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Ar({projectionMatrix:new Fe},!0);const t={runners:["init","destroy","contextChange","reset","update","postrender","prerender","resize"],systems:nf.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t);const e={hello:r.hello,_plugin:nf.__plugins,background:{alpha:r.backgroundAlpha,color:(i=r.background)!=null?i:r.backgroundColor,clearBeforeRender:r.clearBeforeRender},_view:{height:r.height,width:r.width,autoDensity:r.autoDensity,resolution:r.resolution,view:r.view},context:{antialias:r.antialias,context:r.context,powerPreference:r.powerPreference,premultipliedAlpha:(n=r.premultipliedAlpha)!=null?n:r.useContextAlpha&&r.useContextAlpha!=="notMultiplied",preserveDrawingBuffer:r.preserveDrawingBuffer}};this.startup.run(e)}static test(r){return r!=null&&r.forceCanvas?!1:IC()}render(r,t){this.objectRenderer.render(r,t)}resize(r,t){this._view.resizeView(r,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(r=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:r}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return this.background.clearBeforeRender}get useContextAlpha(){return this.context.useContextAlpha}get preserveDrawingBuffer(){return this.context.preserveDrawingBuffer}get backgroundColor(){return this.background.color}set backgroundColor(r){this.background.color=r}get backgroundAlpha(){return this.background.color}set backgroundAlpha(r){this.background.alpha=r}get powerPreference(){return this.context.powerPreference}generateTexture(r,t){return this.textureGenerator.generateTexture(r,t)}};let co=nf;co.extension={type:Pt.Renderer,priority:1};co.__plugins={};co.__systems={};Yt.handleByMap(Pt.RendererPlugin,co.__plugins);Yt.handleByMap(Pt.RendererSystem,co.__systems);Yt.add(co);class sf{constructor(){this.texArray=null,this.blend=0,this.type=Nr.TRIANGLES,this.start=0,this.size=0,this.data=null}}class af{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class of{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}class DP{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const i=new Int32Array(t);for(let s=0;s<t;s++)i[s]=s;this.defaultGroupCache[t]=Ar.from({uSamplers:i},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new gn(this.vertexSrc,n)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Fe,default:this.defaultGroupCache[t]};return new Xr(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let i=0;i<t;i++)i>0&&(e+=`
else `),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class Ix extends Jn{constructor(t=!1){super(),this._buffer=new Ne(null,t,!1),this._indexBuffer=new Ne(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,qt.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,qt.FLOAT).addAttribute("aColor",this._buffer,4,!0,qt.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,qt.FLOAT).addIndex(this._indexBuffer)}}var RP=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,PP=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;const Es=class extends Du{constructor(r){super(r),this.setShaderGenerator(),this.geometryClass=Ix,this.vertexSize=6,this.state=En.for2d(),this.size=bt.SPRITE_BATCH_SIZE*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.MAX_TEXTURES=1,this.renderer.on("prerender",this.onPrerender,this),r.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultVertexSrc(){return RP}static get defaultFragmentTemplate(){return PP}setShaderGenerator({vertex:r=Es.defaultVertexSrc,fragment:t=Es.defaultFragmentTemplate}={}){this.shaderGenerator=new DP(r,t)}contextChange(){const r=this.renderer.gl;bt.PREFER_ENV===Qs.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),bt.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=ZR(this.MAX_TEXTURES,r)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:r,_textureArrayPool:t}=Es,e=this.size/4,i=Math.floor(e/this.MAX_TEXTURES)+1;for(;r.length<e;)r.push(new sf);for(;t.length<i;)t.push(new af);for(let n=0;n<this.MAX_TEXTURES;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(r){!r._texture.valid||(this._vertexCount+r.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=r.vertexData.length/2,this._indexCount+=r.indices.length,this._bufferedTextures[this._bufferSize]=r._texture.baseTexture,this._bufferedElements[this._bufferSize++]=r)}buildTexturesAndDrawCalls(){const{_bufferedTextures:r,MAX_TEXTURES:t}=this,e=Es._textureArrayPool,i=this.renderer.batch,n=this._tempBoundTextures,s=this.renderer.textureGC.count;let a=++pe._globalBatch,o=0,l=e[0],h=0;i.copyBoundTextures(n,t);for(let u=0;u<this._bufferSize;++u){const f=r[u];r[u]=null,f._batchEnabled!==a&&(l.count>=t&&(i.boundArray(l,n,a,t),this.buildDrawCalls(l,h,u),h=u,l=e[++o],++a),f._batchEnabled=a,f.touched=s,l.elements[l.count++]=f)}l.count>0&&(i.boundArray(l,n,a,t),this.buildDrawCalls(l,h,this._bufferSize),++o,++a);for(let u=0;u<n.length;u++)n[u]=null;pe._globalBatch=a}buildDrawCalls(r,t,e){const{_bufferedElements:i,_attributeBuffer:n,_indexBuffer:s,vertexSize:a}=this,o=Es._drawCallPool;let l=this._dcIndex,h=this._aIndex,u=this._iIndex,f=o[l];f.start=this._iIndex,f.texArray=r;for(let c=t;c<e;++c){const _=i[c],g=_._texture.baseTexture,d=j0[g.alphaMode?1:0][_.blendMode];i[c]=null,t<c&&f.blend!==d&&(f.size=u-f.start,t=c,f=o[++l],f.texArray=r,f.start=u),this.packInterleavedGeometry(_,n,s,h,u),h+=_.vertexData.length/2*a,u+=_.indices.length,f.blend=d}t<e&&(f.size=u-f.start,++l),this._dcIndex=l,this._aIndex=h,this._iIndex=u}bindAndClearTexArray(r){const t=this.renderer.texture;for(let e=0;e<r.count;e++)t.bind(r.elements[e],r.ids[e]),r.elements[e]=null;r.count=0}updateGeometry(){const{_packedGeometries:r,_attributeBuffer:t,_indexBuffer:e}=this;bt.CAN_UPLOAD_SAME_BUFFER?(r[this._flushId]._buffer.update(t.rawBinaryData),r[this._flushId]._indexBuffer.update(e),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,r[this._flushId]=new this.geometryClass),r[this._flushId]._buffer.update(t.rawBinaryData),r[this._flushId]._indexBuffer.update(e),this.renderer.geometry.bind(r[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const r=this._dcIndex,{gl:t,state:e}=this.renderer,i=Es._drawCallPool;let n=null;for(let s=0;s<r;s++){const{texArray:a,type:o,size:l,start:h,blend:u}=i[s];n!==a&&(n=a,this.bindAndClearTexArray(a)),this.state.blendMode=u,e.set(this.state),t.drawElements(o,l,t.UNSIGNED_SHORT,h*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),bt.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let r=0;r<this._packedGeometryPoolSize;r++)this._packedGeometries[r]&&this._packedGeometries[r].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(r){const t=au(Math.ceil(r/8)),e=Dg(t),i=t*8;this._aBuffers.length<=e&&(this._iBuffers.length=e+1);let n=this._aBuffers[i];return n||(this._aBuffers[i]=n=new of(i*this.vertexSize*4)),n}getIndexBuffer(r){const t=au(Math.ceil(r/12)),e=Dg(t),i=t*12;this._iBuffers.length<=e&&(this._iBuffers.length=e+1);let n=this._iBuffers[e];return n||(this._iBuffers[e]=n=new Uint16Array(i)),n}packInterleavedGeometry(r,t,e,i,n){const{uint32View:s,float32View:a}=t,o=i/this.vertexSize,l=r.uvs,h=r.indices,u=r.vertexData,f=r._texture.baseTexture._batchLocation,c=Math.min(r.worldAlpha,1),_=c<1&&r._texture.baseTexture.alphaMode?Jf(r._tintRGB,c):r._tintRGB+(c*255<<24);for(let g=0;g<u.length;g+=2)a[i++]=u[g],a[i++]=u[g+1],a[i++]=l[g],a[i++]=l[g+1],s[i++]=_,a[i++]=f;for(let g=0;g<h.length;g++)e[n++]=o+h[g]}};let Ru=Es;Ru.extension={name:"batch",type:Pt.RendererPlugin};Ru._drawCallPool=[];Ru._textureArrayPool=[];Yt.add(Ru);class IP{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Ox{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const s=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,s.buffer)}}bindBufferRange(t,e,i){const{gl:n,CONTEXT_UID:s}=this;i=i||0;const a=t._glBuffers[s]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,a.buffer,i*256,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,n=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const s=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,s)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),i&&(e||n.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new IP(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Ox.extension={type:Pt.RendererSystem,name:"buffer"};Yt.add(Ox);class Fx{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=We.HIGH?this.multisample=We.HIGH:e>=We.MEDIUM?this.multisample=We.MEDIUM:e>=We.LOW?this.multisample=We.LOW:this.multisample=We.NONE}destroy(){}}Fx.extension={type:Pt.RendererSystem,name:"_multisample"};Yt.add(Fx);class Bx{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let n,s,a,o;if(e&&(n=e.renderTexture,s=e.clear,a=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!n,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=a,!i.context.isLost){if(n||(this.lastObjectRendered=t),!o){const l=t.enableTempParent();t.updateTransform(),t.disableTempParent(l)}i.renderTexture.bind(n),i.batch.currentRenderer.start(),(s!=null?s:i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),n&&(e.blit&&i.framebuffer.blit(),n.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Bx.extension={type:Pt.RendererSystem,name:"objectRenderer"};Yt.add(Bx);var OP=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class Hg extends pl{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(LP,OP,t),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}tint(t,e){const i=t>>16&255,n=t>>8&255,s=t&255,a=[i/255,0,0,0,0,0,n/255,0,0,0,0,0,s/255,0,0,0,0,0,1,0];this._loadMatrix(a,e)}greyscale(t,e){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const i=Math.cos(t),n=Math.sin(t),s=Math.sqrt,a=1/3,o=s(a),l=i+(1-i)*a,h=a*(1-i)-o*n,u=a*(1-i)+o*n,f=a*(1-i)+o*n,c=i+a*(1-i),_=a*(1-i)-o*n,g=a*(1-i)-o*n,d=a*(1-i)+o*n,p=i+a*(1-i),v=[l,h,u,0,0,f,c,_,0,0,g,d,p,0,0,0,0,0,1,0];this._loadMatrix(v,e)}contrast(t,e){const i=(t||0)+1,n=-.5*(i-1),s=[i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0];this._loadMatrix(s,e)}saturate(t=0,e){const i=t*2/3+1,n=(i-1)*-.5,s=[i,n,n,0,0,n,i,n,0,0,n,n,i,0,0,0,0,0,1,0];this._loadMatrix(s,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,i,n,s){t=t||.2,e=e||.15,i=i||16770432,n=n||3375104;const a=(i>>16&255)/255,o=(i>>8&255)/255,l=(i&255)/255,h=(n>>16&255)/255,u=(n>>8&255)/255,f=(n&255)/255,c=[.3,.59,.11,0,0,a,o,l,t,0,h,u,f,e,0,a-h,o-u,l-f,0,0];this._loadMatrix(c,s)}night(t,e){t=t||.1;const i=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(i,e)}predator(t,e){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}Hg.prototype.grayscale=Hg.prototype.greyscale;bt.SORTABLE_CHILDREN=!1;class lu{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?le.EMPTY:(t=t||new le(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:i,b:n,c:s,d:a,tx:o,ty:l}=t,h=i*e.x+s*e.y+o,u=n*e.x+a*e.y+l;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(t){let e=this.minX,i=this.minY,n=this.maxX,s=this.maxY,a=t[0],o=t[1];e=a<e?a:e,i=o<i?o:i,n=a>n?a:n,s=o>s?o:s,a=t[2],o=t[3],e=a<e?a:e,i=o<i?o:i,n=a>n?a:n,s=o>s?o:s,a=t[4],o=t[5],e=a<e?a:e,i=o<i?o:i,n=a>n?a:n,s=o>s?o:s,a=t[6],o=t[7],e=a<e?a:e,i=o<i?o:i,n=a>n?a:n,s=o>s?o:s,this.minX=e,this.minY=i,this.maxX=n,this.maxY=s}addFrame(t,e,i,n,s){this.addFrameMatrix(t.worldTransform,e,i,n,s)}addFrameMatrix(t,e,i,n,s){const a=t.a,o=t.b,l=t.c,h=t.d,u=t.tx,f=t.ty;let c=this.minX,_=this.minY,g=this.maxX,d=this.maxY,p=a*e+l*i+u,v=o*e+h*i+f;c=p<c?p:c,_=v<_?v:_,g=p>g?p:g,d=v>d?v:d,p=a*n+l*i+u,v=o*n+h*i+f,c=p<c?p:c,_=v<_?v:_,g=p>g?p:g,d=v>d?v:d,p=a*e+l*s+u,v=o*e+h*s+f,c=p<c?p:c,_=v<_?v:_,g=p>g?p:g,d=v>d?v:d,p=a*n+l*s+u,v=o*n+h*s+f,c=p<c?p:c,_=v<_?v:_,g=p>g?p:g,d=v>d?v:d,this.minX=c,this.minY=_,this.maxX=g,this.maxY=d}addVertexData(t,e,i){let n=this.minX,s=this.minY,a=this.maxX,o=this.maxY;for(let l=e;l<i;l+=2){const h=t[l],u=t[l+1];n=h<n?h:n,s=u<s?u:s,a=h>a?h:a,o=u>o?u:o}this.minX=n,this.minY=s,this.maxX=a,this.maxY=o}addVertices(t,e,i,n){this.addVerticesMatrix(t.worldTransform,e,i,n)}addVerticesMatrix(t,e,i,n,s=0,a=s){const o=t.a,l=t.b,h=t.c,u=t.d,f=t.tx,c=t.ty;let _=this.minX,g=this.minY,d=this.maxX,p=this.maxY;for(let v=i;v<n;v+=2){const A=e[v],E=e[v+1],S=o*A+h*E+f,L=u*E+l*A+c;_=Math.min(_,S-s),d=Math.max(d,S+s),g=Math.min(g,L-a),p=Math.max(p,L+a)}this.minX=_,this.minY=g,this.maxX=d,this.maxY=p}addBounds(t){const e=this.minX,i=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s}addBoundsMask(t,e){const i=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,a=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=s&&n<=a){const o=this.minX,l=this.minY,h=this.maxX,u=this.maxY;this.minX=i<o?i:o,this.minY=n<l?n:l,this.maxX=s>h?s:h,this.maxY=a>u?a:u}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const i=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,a=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=s&&n<=a){const o=this.minX,l=this.minY,h=this.maxX,u=this.maxY;this.minX=i<o?i:o,this.minY=n<l?n:l,this.maxX=s>h?s:h,this.maxY=a>u?a:u}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,n,s,a){t-=s,e-=a,i+=s,n+=a,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class De extends Sl{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new $f,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new lu,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const n=e[i];Object.defineProperty(De.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new le),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new le),t=this._localBoundsRect),this._localBounds||(this._localBounds=new lu);const e=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-s,a}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,n){return e&&(t=e.toGlobal(t,i,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,i=1,n=1,s=0,a=0,o=0,l=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=n||1,this.rotation=s,this.skew.x=a,this.skew.y=o,this.pivot.x=l,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new FP),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*jM}set angle(t){this.transform.rotation=t*YM}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class FP extends De{constructor(){super(...arguments),this.sortDirty=null}}De.prototype.displayObjectUpdateTransform=De.prototype.updateTransform;function BP(r,t){return r.zIndex===t.zIndex?r._lastSortedIndex-t._lastSortedIndex:r.zIndex-t.zIndex}class Pi extends De{constructor(){super(),this.children=[],this.sortableChildren=bt.SORTABLE_CHILDREN,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const i=this.getChildIndex(t),n=this.getChildIndex(e);this.children[i]=e,this.children[n]=t,this.onChildrenChange(i<n?i:n)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(t);ja(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],i=this.children.indexOf(e);if(i===-1)return null;e.parent=null,e.transform._parentID=-1,ja(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,ja(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const i=t,n=e,s=n-i;let a;if(s>0&&s<=n){a=this.children.splice(i,s);for(let o=0;o<a.length;++o)a[o].parent=null,a[o].transform&&(a[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let o=0;o<a.length;++o)a[o].emit("removed",this),this.emit("childRemoved",a[o],this,o);return a}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){const n=this.children[e];n._lastSortedIndex=e,!t&&n.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(BP),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const i=this.children[t];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const i=e._mask.isMaskData?e._mask.maskObject:e._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(e._bounds,i._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const i=super.getLocalBounds(t);if(!e)for(let n=0,s=this.children.length;n<s;++n){const a=this.children[n];a.visible&&a.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,n;if(this.cullArea?(i=this.cullArea,n=this.worldTransform):this._render!==Pi.prototype._render&&(i=this.getBounds(!0)),i&&e.intersects(i,n))this._render(t);else if(this.cullArea)return;for(let s=0,a=this.children.length;s<a;++s){const o=this.children[s],l=o.cullable;o.cullable=l||!this.cullArea,o.render(t),o.cullable=l}}render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||((e=this.filters)==null?void 0:e.length))this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let i=0,n=this.children.length;i<n;++i)this.children[i].render(t)}}renderAdvanced(t){var s,a,o;const e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let l=0;l<e.length;l++)e[l].enabled&&this._enabledFilters.push(e[l])}const n=e&&((s=this._enabledFilters)==null?void 0:s.length)||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==Ke.NONE));if(n&&t.batch.flush(),e&&((a=this._enabledFilters)==null?void 0:a.length)&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let l=0,h=this.children.length;l<h;++l)this.children[l].render(t)}n&&t.batch.flush(),i&&t.mask.pop(this),e&&((o=this._enabledFilters)==null?void 0:o.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t==null?void 0:t.children,i=this.removeChildren(0,this.children.length);if(e)for(let n=0;n<i.length;++n)i[n].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}}Pi.prototype.containerUpdateTransform=Pi.prototype.updateTransform;const bo=new me,kP=new Uint16Array([0,1,2,0,2,3]);class ta extends Pi{constructor(t){super(),this._anchor=new Un(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=Jt.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Gt.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=kP,this.pluginName="batch",this.isSprite=!0,this._roundPixels=bt.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Pa(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Pa(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,i=e.a,n=e.b,s=e.c,a=e.d,o=e.tx,l=e.ty,h=this.vertexData,u=t.trim,f=t.orig,c=this._anchor;let _=0,g=0,d=0,p=0;if(u?(g=u.x-c._x*f.width,_=g+u.width,p=u.y-c._y*f.height,d=p+u.height):(g=-c._x*f.width,_=g+f.width,p=-c._y*f.height,d=p+f.height),h[0]=i*g+s*p+o,h[1]=a*p+n*g+l,h[2]=i*_+s*p+o,h[3]=a*p+n*_+l,h[4]=i*_+s*d+o,h[5]=a*d+n*_+l,h[6]=i*g+s*d+o,h[7]=a*d+n*g+l,this._roundPixels){const v=bt.RESOLUTION;for(let A=0;A<h.length;++A)h[A]=Math.round(h[A]*v)/v}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,i=t.orig,n=this._anchor,s=this.transform.worldTransform,a=s.a,o=s.b,l=s.c,h=s.d,u=s.tx,f=s.ty,c=-n._x*i.width,_=c+i.width,g=-n._y*i.height,d=g+i.height;e[0]=a*c+l*g+u,e[1]=h*g+o*c+f,e[2]=a*_+l*g+u,e[3]=h*g+o*_+f,e[4]=a*_+l*d+u,e[5]=h*d+o*_+f,e[6]=a*c+l*d+u,e[7]=h*d+o*c+f}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new lu),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new le),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,bo);const e=this._texture.orig.width,i=this._texture.orig.height,n=-e*this.anchor.x;let s=0;return bo.x>=n&&bo.x<n+e&&(s=-i*this.anchor.y,bo.y>=s&&bo.y<s+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const i=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!i)}this._texture=null}static from(t,e){const i=t instanceof Gt?t:Gt.from(t,e);return new ta(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Pa(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Pa(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Gt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const kx=new Fe;De.prototype._cacheAsBitmap=!1;De.prototype._cacheData=null;De.prototype._cacheAsBitmapResolution=null;De.prototype._cacheAsBitmapMultisample=null;class UP{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(De.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(r){r!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(r){r!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(r){if(this._cacheAsBitmap===r)return;this._cacheAsBitmap=r;let t;r?(this._cacheData||(this._cacheData=new UP),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});De.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};De.prototype._initCachedDisplayObject=function(t){var c,_,g;if((c=this._cacheData)!=null&&c.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const i=this.getLocalBounds(null,!0).clone();if((_=this.filters)!=null&&_.length){const d=this.filters[0].padding;i.pad(d)}i.ceil(bt.RESOLUTION);const n=t.renderTexture.current,s=t.renderTexture.sourceFrame.clone(),a=t.renderTexture.destinationFrame.clone(),o=t.projection.transform,l=Zn.create({width:i.width,height:i.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:(g=this.cacheAsBitmapMultisample)!=null?g:t.multisample}),h=`cacheAsBitmap_${qs()}`;this._cacheData.textureCacheId=h,pe.addToCache(l.baseTexture,h),Gt.addToCache(l,h);const u=this.transform.localTransform.copyTo(kx).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:l,clear:!0,transform:u,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=o,t.renderTexture.bind(n,s,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const f=new ta(l);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-(i.x/i.width),f.anchor.y=-(i.y/i.height),f.alpha=e,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=f.containsPoint.bind(f)};De.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};De.prototype._initCachedDisplayObjectCanvas=function(t){var u;if((u=this._cacheData)!=null&&u.sprite)return;const e=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,s=t._projTransform;e.ceil(bt.RESOLUTION);const a=Zn.create({width:e.width,height:e.height}),o=`cacheAsBitmap_${qs()}`;this._cacheData.textureCacheId=o,pe.addToCache(a.baseTexture,o),Gt.addToCache(a,o);const l=kx;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=e.x,l.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:a,clear:!0,transform:l,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const h=new ta(a);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-(e.x/e.width),h.anchor.y=-(e.y/e.height),h.alpha=i,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)};De.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};De.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};De.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,pe.removeFromCache(this._cacheData.textureCacheId),Gt.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};De.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};De.prototype.name=null;Pi.prototype.getChildByName=function(t,e){for(let i=0,n=this.children.length;i<n;i++)if(this.children[i].name===t)return this.children[i];if(e)for(let i=0,n=this.children.length;i<n;i++){const s=this.children[i];if(!s.getChildByName)continue;const a=s.getChildByName(t,!0);if(a)return a}return null};De.prototype.getGlobalPosition=function(t=new me,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const NP={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};class Al{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Al.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new me,this.page=new me,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class hu extends Al{constructor(){super(...arguments),this.client=new me,this.movement=new me,this.offset=new me,this.global=new me,this.screen=new me}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,n,s,a,o,l,h,u,f,c,_,g,d){throw new Error("Method not implemented.")}}class vr extends hu{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class lf extends hu{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const GP=2048,zP=new me,$c=new me;class WP{constructor(t){this.dispatch=new Sl,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,n)=>i.priority-n.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,n=e.length;i<n;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){const i=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,zP.set(t,e),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,s=i.length-1;n<s;n++)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(t.currentTarget=i[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const n=i.children;if(n)for(let s=0;s<n.length;s++)this.all(t,e,n[s]);t.currentTarget=i,this.notifyTarget(t,e)}propagationPath(t){const e=[t];for(let i=0;i<GP&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestRecursive(t,e,i,n,s){if(!t||!t.visible||s(t,i))return null;if(t.interactiveChildren&&t.children){const a=t.children;for(let o=a.length-1;o>=0;o--){const l=a[o],h=this.hitTestRecursive(l,e||l.interactive,i,n,s);if(h){if(h.length>0&&!h[h.length-1].parent)continue;return(h.length>0||t.interactive)&&h.push(t),h}}}return e&&n(t,i)?t.interactive?[t]:[]:null}hitPruneFn(t,e){var i;if(t.hitArea&&(t.worldTransform.applyInverse(e,$c),!t.hitArea.contains($c.x,$c.y)))return!0;if(t._mask){const n=t._mask.isMaskData?t._mask.maskObject:t._mask;if(n&&!((i=n.containsPoint)!=null&&i.call(n,e)))return!0}return!1}hitTestFn(t,e){return t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){e=e!=null?e:t.type;const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof vr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const n=e.button===2;this.dispatchEvent(e,n?"rightdown":"mousedown")}const i=this.trackingData(t.pointerId);i.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var o;if(!(t instanceof vr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t),i=e.pointerType==="mouse"||e.pointerType==="pen",n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.overTargets);if(n.overTargets&&s!==e.target){const l=t.type==="mousemove"?"mouseout":"pointerout",h=this.createPointerEvent(t,l,s);if(this.dispatchEvent(h,"pointerout"),i&&this.dispatchEvent(h,"mouseout"),!e.composedPath().includes(s)){const u=this.createPointerEvent(t,"pointerleave",s);for(u.eventPhase=u.AT_TARGET;u.target&&!e.composedPath().includes(u.target);)u.currentTarget=u.target,this.notifyTarget(u),i&&this.notifyTarget(u,"mouseleave"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(h)}if(s!==e.target){const l=t.type==="mousemove"?"mouseover":"pointerover",h=this.clonePointerEvent(e,l);this.dispatchEvent(h,"pointerover"),i&&this.dispatchEvent(h,"mouseover");let u=s==null?void 0:s.parent;for(;u&&u!==this.rootTarget.parent&&u!==e.target;)u=u.parent;if(!u||u===this.rootTarget.parent){const c=this.clonePointerEvent(e,"pointerenter");for(c.eventPhase=c.AT_TARGET;c.target&&c.target!==s&&c.target!==this.rootTarget.parent;)c.currentTarget=c.target,this.notifyTarget(c),i&&this.notifyTarget(c,"mouseenter"),c.target=c.target.parent;this.freeEvent(c)}this.freeEvent(h)}const a=this.moveOnAll?"all":"dispatchEvent";this[a](e,"pointermove"),e.pointerType==="touch"&&this[a](e,"touchmove"),i&&(this[a](e,"mousemove"),this.cursor=(o=e.target)==null?void 0:o.cursor),n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var a;if(!(t instanceof vr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),n=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=(a=i.target)==null?void 0:a.cursor);const s=this.clonePointerEvent(i,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof vr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const i=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(e.overTargets),s=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(s),i&&this.dispatchEvent(s,"mouseout");const a=this.createPointerEvent(t,"pointerleave",n);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),i&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;e.overTargets=null,this.freeEvent(s),this.freeEvent(a)}this.cursor=null}mapPointerUp(t){if(!(t instanceof vr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const o=i.button===2;this.dispatchEvent(i,o?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let a=s;if(s&&!i.composedPath().includes(s)){let o=s;for(;o&&!i.composedPath().includes(o);){if(i.currentTarget=o,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const l=i.button===2;this.notifyTarget(i,l?"rightupoutside":"mouseupoutside")}o=o.parent}delete n.pressTargetsByButton[t.button],a=o}if(a){const o=this.clonePointerEvent(i,"click");o.target=a,o.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:o.target,timeStamp:e});const l=n.clicksByButton[t.button];l.target===o.target&&e-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=o.target,l.timeStamp=e,o.detail=l.clickCount,o.pointerType==="mouse"?this.dispatchEvent(o,"click"):o.pointerType==="touch"&&this.dispatchEvent(o,"tap"),this.dispatchEvent(o,"pointertap"),this.freeEvent(o)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof vr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(i){let s=i;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),s=s.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof lf)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const n=this.allocateEvent(vr);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=i!=null?i:this.hitTest(n.global.x,n.global.y),typeof e=="string"&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(lf);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(vr);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e!=null?e:i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof vr&&e instanceof vr&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof hu&&e instanceof hu&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(!!i)if("fn"in i)i.fn.call(i.context,t);else for(let n=0,s=i.length;n<s&&!t.propagationImmediatelyStopped;n++)i[n].fn.call(i[n].context,t)}}const HP=1,VP={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class tp{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new WP(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new vr(null),this.rootWheelEvent=new lf(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:e}=this.renderer;this.setTargetElement(t),this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let i=0,n=e.length;i<n;i++){const s=e[i],a=this.bootstrapEvent(this.rootPointerEvent,s);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);for(let i=0,n=e.length;i<n;i++){const s=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let s=0,a=n.length;s<a;s++){const o=this.bootstrapEvent(this.rootPointerEvent,n[s]);o.type+=i,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);for(let i=0,n=e.length;i<n;i++){const s=this.bootstrapEvent(this.rootPointerEvent,e[i]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){let n;this.domElement.parentElement?n=this.domElement.getBoundingClientRect():n={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const s=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*s,t.y=(i-n.top)*(this.domElement.height/n.height)*s}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,n=t.changedTouches.length;i<n;i++){const s=t.changedTouches[i];typeof s.button>"u"&&(s.button=0),typeof s.buttons>"u"&&(s.buttons=1),typeof s.isPrimary>"u"&&(s.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof s.width>"u"&&(s.width=s.radiusX||1),typeof s.height>"u"&&(s.height=s.radiusY||1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="touch"),typeof s.pointerId>"u"&&(s.pointerId=s.identifier||0),typeof s.pressure>"u"&&(s.pressure=s.force||.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),typeof s.layerX>"u"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY>"u"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const i=t;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=HP),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=VP[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}}tp.extension={name:"events",type:[Pt.RendererSystem,Pt.CanvasRendererSystem]};Yt.add(tp);const XP={interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(r,t,e){const i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;r=i?`${r}capture`:r,t=typeof t=="function"?t:t.handleEvent,this.on(r,t,n)},removeEventListener(r,t,e){const i=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;r=i?`${r}capture`:r,t=typeof t=="function"?t:t.handleEvent,this.off(r,t,n)},dispatchEvent(r){if(!(r instanceof Al))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=null,r.target=this,r.manager.dispatchEvent(r),!r.defaultPrevented}};De.mixin(XP);De.mixin(NP);const KP=9,xh=100,jP=0,YP=0,Vg=2,Xg=1,$P=-1e3,qP=-1e3,ZP=2;class Ux{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(fn.tablet||fn.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${xh}px`,e.style.height=`${xh}px`,e.style.position="absolute",e.style.top=`${jP}px`,e.style.left=`${YP}px`,e.style.zIndex=Vg.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${Xg}px`,t.style.height=`${Xg}px`,t.style.position="absolute",t.style.top=`${$P}px`,t.style.left=`${qP}px`,t.style.zIndex=ZP.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){!this._hookDiv||(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let i=0;i<e.length;i++)this.updateAccessibleObjects(e[i])}update(){const t=performance.now();if(fn.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:i,width:n,height:s}=this.renderer.view.getBoundingClientRect(),{width:a,height:o,resolution:l}=this.renderer,h=n/a*l,u=s/o*l;let f=this.div;f.style.left=`${e}px`,f.style.top=`${i}px`,f.style.width=`${a}px`,f.style.height=`${o}px`;for(let c=0;c<this.children.length;c++){const _=this.children[c];if(_.renderId!==this.renderId)_._accessibleActive=!1,ja(this.children,c,1),this.div.removeChild(_._accessibleDiv),this.pool.push(_._accessibleDiv),_._accessibleDiv=null,c--;else{f=_._accessibleDiv;let g=_.hitArea;const d=_.worldTransform;_.hitArea?(f.style.left=`${(d.tx+g.x*d.a)*h}px`,f.style.top=`${(d.ty+g.y*d.d)*u}px`,f.style.width=`${g.width*d.a*h}px`,f.style.height=`${g.height*d.d*u}px`):(g=_.getBounds(),this.capHitArea(g),f.style.left=`${g.x*h}px`,f.style.top=`${g.y*u}px`,f.style.width=`${g.width*h}px`,f.style.height=`${g.height*u}px`,f.title!==_.accessibleTitle&&_.accessibleTitle!==null&&(f.title=_.accessibleTitle),f.getAttribute("aria-label")!==_.accessibleHint&&_.accessibleHint!==null&&f.setAttribute("aria-label",_.accessibleHint)),(_.accessibleTitle!==f.title||_.tabIndex!==f.tabIndex)&&(f.title=_.accessibleTitle,f.tabIndex=_.tabIndex,this.debug&&this.updateDebugHTML(f))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${xh}px`,e.style.height=`${xh}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=Vg.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:i}=t.target,n=this.renderer.events.rootBoundary,s=Object.assign(new Al(n),{target:i});n.rootTarget=this.renderer.lastObjectRendered,e.forEach(a=>n.dispatchEvent(s,a))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===KP&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Ux.extension={name:"accessibility",type:[Pt.RendererPlugin,Pt.CanvasRendererPlugin]};Yt.add(Ux);const hf=class{constructor(r){this.stage=new Pi,r=Object.assign({forceCanvas:!1},r),this.renderer=MP(r),hf._plugins.forEach(t=>{t.init.call(this,r)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(r,t){const e=hf._plugins.slice(0);e.reverse(),e.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(r),this.renderer=null}};let ep=hf;ep._plugins=[];Yt.handleByList(Pt.Application,ep._plugins);class Nx{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{!this._resizeTo||(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,i;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:s}=this._resizeTo;e=n,i=s}this.renderer.resize(e,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Nx.extension=Pt.Application;Yt.add(Nx);class JP{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const _n=(r,t)=>(Array.isArray(r)||(r=[r]),t?r.map(e=>typeof e=="string"?t(e):e):r);function Gx(r,t,e,i,n){const s=t[e];for(let a=0;a<s.length;a++){const o=s[a];e<t.length-1?Gx(r.replace(i[e],o),t,e+1,i,n):n.push(r.replace(i[e],o))}}function QP(r){const t=/\{(.*?)\}/g,e=r.match(t),i=[];if(e){const n=[];e.forEach(s=>{const a=s.substring(1,s.length-1).split(",");n.push(a)}),Gx(r,n,0,e,i)}else i.push(r);return i}const uu=r=>!Array.isArray(r);class tI{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){return this._cache.get(t)}set(t,e){const i=_n(t);let n;for(let o=0;o<this.parsers.length;o++){const l=this.parsers[o];if(l.test(e)){n=l.getCacheableAssets(i,e);break}}n||(n={},i.forEach(o=>{n[o]=e}));const s=Object.keys(n),a={cacheKeys:s,keys:i};if(i.forEach(o=>{this._cacheMap.set(o,a)}),s.forEach(o=>{this._cache.has(o)&&this._cache.get(o),this._cache.set(o,n[o])}),e instanceof Gt){const o=e;i.forEach(l=>{o.baseTexture!==Gt.EMPTY.baseTexture&&pe.addToCache(o.baseTexture,l),Gt.addToCache(o,l)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return;const e=this._cacheMap.get(t);e.cacheKeys.forEach(n=>{this._cache.delete(n)}),e.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const So=new tI;class eI{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{var s,a;let n=null;for(let o=0;o<this.parsers.length;o++){const l=this.parsers[o];if(l.load&&((s=l.test)==null?void 0:s.call(l,t,e,this))){n=await l.load(t,e,this),i.parser=l;break}}if(!i.parser)return null;for(let o=0;o<this.parsers.length;o++){const l=this.parsers[o];l.parse&&l.parse&&await((a=l.testParse)==null?void 0:a.call(l,n,e,this))&&(n=await l.parse(n,e,this)||n,i.parser=l)}return n})(),i}async load(t,e){let i=0;const n={},s=uu(t),a=_n(t,h=>({src:h})),o=a.length,l=a.map(async h=>{const u=oi.toAbsolute(h.src);if(!n[h.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,h)),n[h.src]=await this.promiseCache[u].promise,e&&e(++i/o)}catch(f){throw delete this.promiseCache[u],delete n[h.src],new Error(`[Loader.load] Failed to load ${u}.
${f}`)}});return await Promise.all(l),s?n[a[0].src]:n}async unload(t){const i=_n(t,n=>({src:n})).map(async n=>{var o,l;const s=oi.toAbsolute(n.src),a=this.promiseCache[s];if(a){const h=await a.promise;(l=(o=a.parser)==null?void 0:o.unload)==null||l.call(o,h,n,this),delete this.promiseCache[s]}});await Promise.all(i)}get parsers(){return this._parsers}}class iI{constructor(){this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}addManifest(t){this._manifest,this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach(n=>{typeof n.name=="string"?i.push(n.name):i.push(...n.name),this.add(n.name,n.srcs)}):Object.keys(e).forEach(n=>{i.push(n),this.add(n,e[n])}),this._bundles[t]=i}add(t,e,i){const n=_n(t);n.forEach(a=>{this._assetMap[a]}),Array.isArray(e)||(typeof e=="string"?e=QP(e):e=[e]);const s=e.map(a=>{var l;let o=a;if(typeof a=="string"){let h=!1;for(let u=0;u<this._parsers.length;u++){const f=this._parsers[u];if(f.test(a)){o=f.parse(a),h=!0;break}}h||(o={src:a})}return o.format||(o.format=o.src.split(".").pop()),o.alias||(o.alias=n),(this._basePath||this._rootPath)&&(o.src=oi.toAbsolute(o.src,this._basePath,this._rootPath)),o.data=(l=o.data)!=null?l:i,o});n.forEach(a=>{this._assetMap[a]=s})}resolveBundle(t){const e=uu(t);t=_n(t);const i={};return t.forEach(n=>{const s=this._bundles[n];s&&(i[n]=this.resolve(s))}),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const i={};for(const n in e)i[n]=e[n].src;return i}return e.src}resolve(t){const e=uu(t);t=_n(t);const i={};return t.forEach(n=>{var s;if(!this._resolverHash[n])if(this._assetMap[n]){let a=this._assetMap[n];const o=this._getPreferredOrder(a),l=a[0];o==null||o.priority.forEach(h=>{o.params[h].forEach(u=>{const f=a.filter(c=>c[h]?c[h]===u:!1);f.length&&(a=f)})}),this._resolverHash[n]=(s=a[0])!=null?s:l}else{let a=n;(this._basePath||this._rootPath)&&(a=oi.toAbsolute(a,this._basePath,this._rootPath)),this._resolverHash[n]={src:a}}i[n]=this._resolverHash[n]}),e?i[t[0]]:i}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const i=t[0],n=this._preferredOrder.find(s=>s.params.format.includes(i.format));if(n)return n}return this._preferredOrder[0]}}class rI{constructor(){this._detections=[],this._initialized=!1,this.resolver=new iI,this.loader=new eI,this.cache=So,this._backgroundLoader=new JP(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var s,a,o,l;if(this._initialized)return;if(this._initialized=!0,t.basePath&&(this.resolver.basePath=t.basePath),t.manifest){let h=t.manifest;typeof h=="string"&&(h=await this.load(h)),this.resolver.addManifest(h)}const e=(a=(s=t.texturePreference)==null?void 0:s.resolution)!=null?a:1,i=typeof e=="number"?[e]:e;let n=[];if((o=t.texturePreference)!=null&&o.format){const h=(l=t.texturePreference)==null?void 0:l.format;n=typeof h=="string"?[h]:h;for(const u of this._detections)await u.test()||(n=await u.remove(n))}else for(const h of this._detections)await h.test()&&(n=await h.add(n));this.resolver.prefer({params:{format:n,resolution:i}})}add(t,e,i){this.resolver.add(t,e,i)}async load(t,e){this._initialized||await this.init();const i=uu(t),n=_n(t).map(o=>typeof o!="string"?(this.resolver.add(o.src,o),o.src):o),s=this.resolver.resolve(n),a=await this._mapLoadToResolve(s,e);return i?a[n[0]]:a}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;typeof t=="string"&&(i=!0,t=[t]);const n=this.resolver.resolveBundle(t),s={},a=Object.keys(n);let o=0,l=0;const h=()=>{e==null||e(++o/l)},u=a.map(f=>{const c=n[f];return l+=Object.keys(c).length,this._mapLoadToResolve(c,h).then(_=>{s[f]=_})});return await Promise.all(u),i?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return So.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=So.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const s=await this.loader.load(i,e);this._backgroundLoader.active=!0;const a={};return i.forEach((o,l)=>{const h=s[o.src],u=[o.src];o.alias&&u.push(...o.alias),a[n[l]]=h,So.set(u,h)}),a}async unload(t){this._initialized||await this.init();const e=_n(t).map(n=>typeof n!="string"?n.src:n),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=_n(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(i=>{So.remove(i.src)}),await this.loader.unload(e)}get detections(){return this._detections}}const Oa=new rI;Yt.handleByList(Pt.LoadParser,Oa.loader.parsers).handleByList(Pt.ResolveParser,Oa.resolver.parsers).handleByList(Pt.CacheParser,Oa.cache.parsers).handleByList(Pt.DetectionParser,Oa.detections);const Kg={loader:Pt.LoadParser,resolver:Pt.ResolveParser,cache:Pt.CacheParser,detection:Pt.DetectionParser};Yt.handle(Pt.Asset,r=>{const t=r.ref;Object.entries(Kg).filter(([e])=>!!t[e]).forEach(([e,i])=>{var n;return Yt.add(Object.assign(t[e],{extension:(n=t[e].extension)!=null?n:i}))})},r=>{const t=r.ref;Object.keys(Kg).filter(e=>!!t[e]).forEach(e=>Yt.remove(t[e]))});const nI={extension:Pt.CacheParser,test:r=>Array.isArray(r)&&r.every(t=>t instanceof Gt),getCacheableAssets:(r,t)=>{const e={};return r.forEach(i=>{t.forEach((n,s)=>{e[i+(s===0?"":s+1)]=n})}),e}};Yt.add(nI);var Yr=(r=>(r[r.Low=0]="Low",r[r.Normal=1]="Normal",r[r.High=2]="High",r))(Yr||{});const sI={extension:{type:Pt.LoadParser,priority:Yr.Low},test(r){return oi.extname(r).includes(".json")},async load(r){return await(await bt.ADAPTER.fetch(r)).json()}};Yt.add(sI);const aI={extension:{type:Pt.LoadParser,priority:Yr.Low},test(r){return oi.extname(r).includes(".txt")},async load(r){return await(await bt.ADAPTER.fetch(r)).text()}};Yt.add(aI);const oI=["normal","bold","100","200","300","400","500","600","700","800","900"],lI=["woff","woff2","ttf","otf"];function hI(r){const t=oi.extname(r);return oi.basename(r,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ")}const uI={extension:{type:Pt.LoadParser,priority:Yr.Low},test(r){const e=r.split("?")[0].split(".").pop();return lI.includes(e)},async load(r,t){var i,n,s,a,o,l;if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const e=bt.ADAPTER.getFontFaceSet();if(e){const h=[],u=(n=(i=t.data)==null?void 0:i.family)!=null?n:hI(r),f=(o=(a=(s=t.data)==null?void 0:s.weights)==null?void 0:a.filter(_=>oI.includes(_)))!=null?o:["normal"],c=(l=t.data)!=null?l:{};for(let _=0;_<f.length;_++){const g=f[_],d=new FontFace(u,`url(${r})`,{...c,weight:g});await d.load(),e.add(d),h.push(d)}return h.length===1?h[0]:h}return null},unload(r){(Array.isArray(r)?r:[r]).forEach(t=>bt.ADAPTER.getFontFaceSet().delete(t))}};Yt.add(uI);let jg=0,qc;const cI="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",dI={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${cI}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},fI={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let Zc;class pI{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([dI.code],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",n=>{i.terminate(),URL.revokeObjectURL(e),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){qc===void 0&&(qc=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<qc&&(Zc||(Zc=URL.createObjectURL(new Blob([fI.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Zc),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise((n,s)=>{this.queue.push({id:t,arguments:e,resolve:n,reject:s})});return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[jg]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:jg++,id:i})}}const Yg=new pI;function ip(r,t){const e=r.split("?")[0],i=oi.extname(e).toLowerCase();return Array.isArray(t)?t.includes(i.toLowerCase()):i.toLowerCase()===t}function Pu(r,t,e){const i=new Gt(r);return i.baseTexture.on("dispose",()=>{delete t.promiseCache[e]}),i}const Jc=[".jpg",".png",".jpeg",".avif",".webp"];async function mI(r){const t=await bt.ADAPTER.fetch(r);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${r}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const rp={extension:{type:Pt.LoadParser,priority:Yr.High},config:{preferWorkers:!0},test(r){let t=!1;for(let e=0;e<Jc.length;e++)if(r.startsWith(`data:image/${Jc[e].slice(1)}`)){t=!0;break}return t||ip(r,Jc)},async load(r,t,e){let i=null;globalThis.createImageBitmap?this.config.preferWorkers&&await Yg.isImageBitmapSupported()?i=await Yg.loadImageBitmap(r):i=await mI(r):i=await new Promise(s=>{i=new Image,i.crossOrigin="anonymous",i.src=r,i.complete?s(i):i.onload=()=>{s(i)}});const n=new pe(i,{resolution:$n(r),...t.data});return n.resource.src=r,Pu(n,e,r)},unload(r){r.destroy(!0)}};Yt.add(rp);Pt.LoadParser,Yr.High,rp.unload;const gI={extension:Pt.ResolveParser,test:rp.test,parse:r=>{var t,e;return{resolution:parseFloat((e=(t=bt.RETINA_PREFIX.exec(r))==null?void 0:t[1])!=null?e:"1"),format:r.split(".").pop(),src:r}}};Yt.add(gI);const _I={extension:{type:Pt.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const r="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await bt.ADAPTER.fetch(r).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async r=>[...r,"avif"],remove:async r=>r.filter(t=>t!=="avif")};Yt.add(_I);const vI={extension:{type:Pt.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const r="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await bt.ADAPTER.fetch(r).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async r=>[...r,"webp"],remove:async r=>r.filter(t=>t!=="webp")};Yt.add(vI);const $g=["png","jpg","jpeg"],xI={extension:{type:Pt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async r=>[...r,...$g],remove:async r=>r.filter(t=>!$g.includes(t))};Yt.add(xI);var Gi=(r=>(r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r))(Gi||{});const cu={[33776]:.5,[33777]:.5,[33778]:1,[33779]:1,[35916]:.5,[35917]:.5,[35918]:1,[35919]:1,[37488]:.5,[37489]:.5,[37490]:1,[37491]:1,[37492]:.5,[37496]:1,[37493]:.5,[37497]:1,[37494]:.5,[37495]:.5,[35840]:.5,[35842]:.5,[35841]:.25,[35843]:.25,[36196]:.5,[35986]:.5,[35986]:1,[34798]:1,[37808]:1};class yI extends wl{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,n;typeof t=="string"?(i=t,n=new Uint8Array):(i=null,n=t),super(n,e),this.origin=i,this.buffer=n?new of(n):null,this.origin&&e.autoLoad!==!1&&this.load(),n!=null&&n.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}async load(){const i=await(await(await fetch(this.origin)).blob()).arrayBuffer();return this.data=new Uint32Array(i),this.buffer=new of(i),this.loaded=!0,this.onBlobLoaded(i),this.update(),this}}class Ns extends yI{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=Ns._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||Ns._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let a=0,o=this.levels;a<o;a++){const{levelID:l,levelWidth:h,levelHeight:u,levelBuffer:f}=this._levelBuffers[a];n.compressedTexImage2D(n.TEXTURE_2D,l,this.format,h,u,0,f)}return!0}onBlobLoaded(){this._levelBuffers=Ns._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,i,n,s,a,o){const l=new Array(i);let h=t.byteOffset,u=a,f=o,c=u+n-1&~(n-1),_=f+s-1&~(s-1),g=c*_*cu[e];for(let d=0;d<i;d++)l[d]={levelID:d,levelWidth:i>1?u:c,levelHeight:i>1?f:_,levelBuffer:new Uint8Array(t.buffer,h,g)},h+=g,u=u>>1||1,f=f>>1||1,c=u+n-1&~(n-1),_=f+s-1&~(s-1),g=c*_*cu[e];return l}}let nn,wa;function qg(){wa={s3tc:nn.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:nn.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:nn.getExtension("WEBGL_compressed_texture_etc"),etc1:nn.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:nn.getExtension("WEBGL_compressed_texture_pvrtc")||nn.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:nn.getExtension("WEBGL_compressed_texture_atc"),astc:nn.getExtension("WEBGL_compressed_texture_astc")}}const EI={extension:{type:Pt.DetectionParser,priority:2},test:async()=>{const t=bt.ADAPTER.createCanvas().getContext("webgl");return t?(nn=t,!0):!1},add:async r=>{wa||qg();const t=[];for(const e in wa)!wa[e]||t.push(e);return[...t,...r]},remove:async r=>(wa||qg(),r.filter(t=>!(t in wa)))};Yt.add(EI);const Qc=4,yh=124,TI=32,Zg=20,bI=542327876,Eh={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},SI={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},Th={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},wI=1,AI=2,MI=4,CI=64,LI=512,DI=131072,RI=827611204,PI=861165636,II=894720068,OI=808540228,FI=4,BI={[RI]:Gi.COMPRESSED_RGBA_S3TC_DXT1_EXT,[PI]:Gi.COMPRESSED_RGBA_S3TC_DXT3_EXT,[II]:Gi.COMPRESSED_RGBA_S3TC_DXT5_EXT},kI={[70]:Gi.COMPRESSED_RGBA_S3TC_DXT1_EXT,[71]:Gi.COMPRESSED_RGBA_S3TC_DXT1_EXT,[73]:Gi.COMPRESSED_RGBA_S3TC_DXT3_EXT,[74]:Gi.COMPRESSED_RGBA_S3TC_DXT3_EXT,[76]:Gi.COMPRESSED_RGBA_S3TC_DXT5_EXT,[77]:Gi.COMPRESSED_RGBA_S3TC_DXT5_EXT,[72]:Gi.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,[75]:Gi.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,[78]:Gi.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function UI(r){const t=new Uint32Array(r);if(t[0]!==bI)throw new Error("Invalid DDS file magic word");const i=new Uint32Array(r,0,yh/Uint32Array.BYTES_PER_ELEMENT),n=i[Eh.HEIGHT],s=i[Eh.WIDTH],a=i[Eh.MIPMAP_COUNT],o=new Uint32Array(r,Eh.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,TI/Uint32Array.BYTES_PER_ELEMENT),l=o[wI];if(l&MI){const h=o[SI.FOURCC];if(h!==OI){const E=BI[h],S=Qc+yh,L=new Uint8Array(r,S);return[new Ns(L,{format:E,width:s,height:n,levels:a})]}const u=Qc+yh,f=new Uint32Array(t.buffer,u,Zg/Uint32Array.BYTES_PER_ELEMENT),c=f[Th.DXGI_FORMAT],_=f[Th.RESOURCE_DIMENSION],g=f[Th.MISC_FLAG],d=f[Th.ARRAY_SIZE],p=kI[c];if(p===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);if(g===FI)throw new Error("DDSParser does not support cubemap textures");if(_===6)throw new Error("DDSParser does not supported 3D texture data");const v=new Array,A=Qc+yh+Zg;if(d===1)v.push(new Uint8Array(r,A));else{const E=cu[p];let S=0,L=s,T=n;for(let m=0;m<a;m++){const w=Math.max(1,L+3&-4),R=Math.max(1,T+3&-4),M=w*R*E;S+=M,L=L>>>1,T=T>>>1}let x=A;for(let m=0;m<d;m++)v.push(new Uint8Array(r,x,S)),x+=S}return v.map(E=>new Ns(E,{format:p,width:s,height:n,levels:a}))}throw l&CI?new Error("DDSParser does not support uncompressed texture data."):l&LI?new Error("DDSParser does not supported YUV uncompressed texture data."):l&DI?new Error("DDSParser does not support single-channel (lumninance) texture data!"):l&AI?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Jg=[171,75,84,88,32,49,49,187,13,10,26,10],NI=67305985,gr={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},uf=64,Qg={[qt.UNSIGNED_BYTE]:1,[qt.UNSIGNED_SHORT]:2,[qt.INT]:4,[qt.UNSIGNED_INT]:4,[qt.FLOAT]:4,[qt.HALF_FLOAT]:8},GI={[At.RGBA]:4,[At.RGB]:3,[At.RG]:2,[At.RED]:1,[At.LUMINANCE]:1,[At.LUMINANCE_ALPHA]:2,[At.ALPHA]:1},zI={[qt.UNSIGNED_SHORT_4_4_4_4]:2,[qt.UNSIGNED_SHORT_5_5_5_1]:2,[qt.UNSIGNED_SHORT_5_6_5]:2};function WI(r,t,e=!1){const i=new DataView(t);if(!HI(r,i))return null;const n=i.getUint32(gr.ENDIANNESS,!0)===NI,s=i.getUint32(gr.GL_TYPE,n),a=i.getUint32(gr.GL_FORMAT,n),o=i.getUint32(gr.GL_INTERNAL_FORMAT,n),l=i.getUint32(gr.PIXEL_WIDTH,n),h=i.getUint32(gr.PIXEL_HEIGHT,n)||1,u=i.getUint32(gr.PIXEL_DEPTH,n)||1,f=i.getUint32(gr.NUMBER_OF_ARRAY_ELEMENTS,n)||1,c=i.getUint32(gr.NUMBER_OF_FACES,n),_=i.getUint32(gr.NUMBER_OF_MIPMAP_LEVELS,n),g=i.getUint32(gr.BYTES_OF_KEY_VALUE_DATA,n);if(h===0||u!==1)throw new Error("Only 2D textures are supported");if(c!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(f!==1)throw new Error("WebGL does not support array textures");const d=4,p=4,v=l+3&-4,A=h+3&-4,E=new Array(f);let S=l*h;s===0&&(S=v*A);let L;if(s!==0?Qg[s]?L=Qg[s]*GI[a]:L=zI[s]:L=cu[o],L===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const T=e?XI(i,g,n):null;let m=S*L,w=l,R=h,M=v,C=A,b=uf+g;for(let D=0;D<_;D++){const O=i.getUint32(b,n);let B=b+4;for(let P=0;P<f;P++){let F=E[P];F||(F=E[P]=new Array(_)),F[D]={levelID:D,levelWidth:_>1||s!==0?w:M,levelHeight:_>1||s!==0?R:C,levelBuffer:new Uint8Array(t,B,m)},B+=m}b+=O+4,b=b%4!==0?b+4-b%4:b,w=w>>1||1,R=R>>1||1,M=w+d-1&~(d-1),C=R+p-1&~(p-1),m=M*C*L}return s!==0?{uncompressed:E.map(D=>{let O=D[0].levelBuffer,B=!1;return s===qt.FLOAT?O=new Float32Array(D[0].levelBuffer.buffer,D[0].levelBuffer.byteOffset,D[0].levelBuffer.byteLength/4):s===qt.UNSIGNED_INT?(B=!0,O=new Uint32Array(D[0].levelBuffer.buffer,D[0].levelBuffer.byteOffset,D[0].levelBuffer.byteLength/4)):s===qt.INT&&(B=!0,O=new Int32Array(D[0].levelBuffer.buffer,D[0].levelBuffer.byteOffset,D[0].levelBuffer.byteLength/4)),{resource:new wl(O,{width:D[0].levelWidth,height:D[0].levelHeight}),type:s,format:B?VI(a):a}}),kvData:T}:{compressed:E.map(D=>new Ns(null,{format:o,width:l,height:h,levels:_,levelBuffers:D})),kvData:T}}function HI(r,t){for(let e=0;e<Jg.length;e++)if(t.getUint8(e)!==Jg[e])return!1;return!0}function VI(r){switch(r){case At.RGBA:return At.RGBA_INTEGER;case At.RGB:return At.RGB_INTEGER;case At.RG:return At.RG_INTEGER;case At.RED:return At.RED_INTEGER;default:return r}}function XI(r,t,e){const i=new Map;let n=0;for(;n<t;){const s=r.getUint32(uf+n,e),a=uf+n+4,o=3-(s+3)%4;if(s===0||s>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<s&&r.getUint8(a+l)!==0;l++);if(l===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const h=new TextDecoder().decode(new Uint8Array(r.buffer,a,l)),u=new DataView(r.buffer,a+l+1,s-l-1);i.set(h,u),n+=4+s+o}return i}const KI={extension:{type:Pt.LoadParser,priority:Yr.High},test(r){return ip(r,".dds")},async load(r,t,e){const n=await(await bt.ADAPTER.fetch(r)).arrayBuffer(),a=UI(n).map(o=>{const l=new pe(o,{mipmap:jr.OFF,alphaMode:Cr.NO_PREMULTIPLIED_ALPHA,resolution:$n(r),...t.data});return Pu(l,e,r)});return a.length===1?a[0]:a},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};Yt.add(KI);const jI={extension:{type:Pt.LoadParser,priority:Yr.High},test(r){return ip(r,".ktx")},async load(r,t,e){const n=await(await bt.ADAPTER.fetch(r)).arrayBuffer(),{compressed:s,uncompressed:a,kvData:o}=WI(r,n),l=s!=null?s:a,h={mipmap:jr.OFF,alphaMode:Cr.NO_PREMULTIPLIED_ALPHA,resolution:$n(r),...t.data},u=l.map(f=>{l===a&&Object.assign(h,{type:f.type,format:f.format});const c=new pe(f,h);return c.ktxKeyValueData=o,Pu(c,e,r)});return u.length===1?u[0]:u},unload(r){Array.isArray(r)?r.forEach(t=>t.destroy(!0)):r.destroy(!0)}};Yt.add(jI);const YI={extension:Pt.ResolveParser,test:r=>{const e=r.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:r=>{var i,n,s,a;if(r.split("?")[0].split(".").pop()==="ktx"){const o=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(o.some(l=>r.endsWith(l)))return{resolution:parseFloat((n=(i=bt.RETINA_PREFIX.exec(r))==null?void 0:i[1])!=null?n:"1"),format:o.find(l=>r.endsWith(l)),src:r}}return{resolution:parseFloat((a=(s=bt.RETINA_PREFIX.exec(r))==null?void 0:s[1])!=null?a:"1"),format:r.split(".").pop(),src:r}}};Yt.add(YI);const t_=new le,e_=4,cf=class{constructor(r){this.renderer=r}async image(r,t,e){const i=new Image;return i.src=await this.base64(r,t,e),i}async base64(r,t,e){const i=this.canvas(r);if(i.toDataURL!==void 0)return i.toDataURL(t,e);if(i.convertToBlob!==void 0){const n=await i.convertToBlob({type:t,quality:e});return await new Promise(s=>{const a=new FileReader;a.onload=()=>s(a.result),a.readAsDataURL(n)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(r,t){const e=this.renderer;let i,n=!1,s,a=!1;r&&(r instanceof Zn?s=r:(s=this.renderer.generateTexture(r),a=!0)),s?(i=s.baseTexture.resolution,t=t!=null?t:s.frame,n=!1,e.renderTexture.bind(s)):(i=e.resolution,t||(t=t_,t.width=e.width,t.height=e.height),n=!0,e.renderTexture.bind(null));const o=Math.round(t.width*i),l=Math.round(t.height*i);let h=new Pg(o,l,1);const u=new Uint8Array(e_*o*l),f=e.gl;f.readPixels(Math.round(t.x*i),Math.round(t.y*i),o,l,f.RGBA,f.UNSIGNED_BYTE,u);const c=h.context.getImageData(0,0,o,l);if(cf.arrayPostDivide(u,c.data),h.context.putImageData(c,0,0),n){const _=new Pg(h.width,h.height,1);_.context.scale(1,-1),_.context.drawImage(h.canvas,0,-l),h.destroy(),h=_}return a&&s.destroy(!0),h.canvas}pixels(r,t){const e=this.renderer;let i,n,s=!1;r&&(r instanceof Zn?n=r:(n=this.renderer.generateTexture(r),s=!0)),n?(i=n.baseTexture.resolution,t=t!=null?t:n.frame,e.renderTexture.bind(n)):(i=e.resolution,t||(t=t_,t.width=e.width,t.height=e.height),e.renderTexture.bind(null));const a=Math.round(t.width*i),o=Math.round(t.height*i),l=new Uint8Array(e_*a*o),h=e.gl;return h.readPixels(Math.round(t.x*i),Math.round(t.y*i),a,o,h.RGBA,h.UNSIGNED_BYTE,l),s&&n.destroy(!0),cf.arrayPostDivide(l,l),l}destroy(){this.renderer=null}static arrayPostDivide(r,t){for(let e=0;e<r.length;e+=4){const i=t[e+3]=r[e+3];i!==0?(t[e]=Math.round(Math.min(r[e]*255/i,255)),t[e+1]=Math.round(Math.min(r[e+1]*255/i,255)),t[e+2]=Math.round(Math.min(r[e+2]*255/i,255))):(t[e]=r[e],t[e+1]=r[e+1],t[e+2]=r[e+2])}}};let zx=cf;zx.extension={name:"extract",type:Pt.RendererSystem};Yt.add(zx);var Rn=(r=>(r.MITER="miter",r.BEVEL="bevel",r.ROUND="round",r))(Rn||{}),Ls=(r=>(r.BUTT="butt",r.ROUND="round",r.SQUARE="square",r))(Ls||{});const ml={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(r,t=20){if(!this.adaptive||!r||isNaN(r))return t;let e=Math.ceil(r/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class Iu{constructor(){this.color=16777215,this.alpha=1,this.texture=Gt.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Iu;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Gt.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}function i_(r,t=!1){const e=r.length;if(e<6)return;let i=0;for(let n=0,s=r[e-2],a=r[e-1];n<e;n+=2){const o=r[n],l=r[n+1];i+=(o-s)*(l+a),s=o,a=l}if(!t&&i>0||t&&i<=0){const n=e/2;for(let s=n+n%2;s<e;s+=2){const a=e-s-2,o=e-s-1,l=s,h=s+1;[r[a],r[l]]=[r[l],r[a]],[r[o],r[h]]=[r[h],r[o]]}}}const Wx={build(r){r.points=r.shape.points.slice()},triangulate(r,t){let e=r.points;const i=r.holes,n=t.points,s=t.indices;if(e.length>=6){i_(e,!1);const a=[];for(let h=0;h<i.length;h++){const u=i[h];i_(u.points,!0),a.push(e.length/2),e=e.concat(u.points)}const o=qf.exports(e,a,2);if(!o)return;const l=n.length/2;for(let h=0;h<o.length;h+=3)s.push(o[h]+l),s.push(o[h+1]+l),s.push(o[h+2]+l);for(let h=0;h<e.length;h++)n.push(e[h])}}},du={build(r){const t=r.points;let e,i,n,s,a,o;if(r.type===si.CIRC){const g=r.shape;e=g.x,i=g.y,a=o=g.radius,n=s=0}else if(r.type===si.ELIP){const g=r.shape;e=g.x,i=g.y,a=g.width,o=g.height,n=s=0}else{const g=r.shape,d=g.width/2,p=g.height/2;e=g.x+d,i=g.y+p,a=o=Math.max(0,Math.min(g.radius,Math.min(d,p))),n=d-a,s=p-o}if(!(a>=0&&o>=0&&n>=0&&s>=0)){t.length=0;return}const l=Math.ceil(2.3*Math.sqrt(a+o)),h=l*8+(n?4:0)+(s?4:0);if(t.length=h,h===0)return;if(l===0){t.length=8,t[0]=t[6]=e+n,t[1]=t[3]=i+s,t[2]=t[4]=e-n,t[5]=t[7]=i-s;return}let u=0,f=l*4+(n?2:0)+2,c=f,_=h;{const g=n+a,d=s,p=e+g,v=e-g,A=i+d;if(t[u++]=p,t[u++]=A,t[--f]=A,t[--f]=v,s){const E=i-d;t[c++]=v,t[c++]=E,t[--_]=E,t[--_]=p}}for(let g=1;g<l;g++){const d=Math.PI/2*(g/l),p=n+Math.cos(d)*a,v=s+Math.sin(d)*o,A=e+p,E=e-p,S=i+v,L=i-v;t[u++]=A,t[u++]=S,t[--f]=S,t[--f]=E,t[c++]=E,t[c++]=L,t[--_]=L,t[--_]=A}{const g=n,d=s+o,p=e+g,v=e-g,A=i+d,E=i-d;t[u++]=p,t[u++]=A,t[--_]=E,t[--_]=p,n&&(t[u++]=v,t[u++]=A,t[--_]=E,t[--_]=v)}},triangulate(r,t){const e=r.points,i=t.points,n=t.indices;if(e.length===0)return;let s=i.length/2;const a=s;let o,l;if(r.type!==si.RREC){const u=r.shape;o=u.x,l=u.y}else{const u=r.shape;o=u.x+u.width/2,l=u.y+u.height/2}const h=r.matrix;i.push(r.matrix?h.a*o+h.c*l+h.tx:o,r.matrix?h.b*o+h.d*l+h.ty:l),s++,i.push(e[0],e[1]);for(let u=2;u<e.length;u+=2)i.push(e[u],e[u+1]),n.push(s++,a,s);n.push(a+1,a,s)}},$I={build(r){const t=r.shape,e=t.x,i=t.y,n=t.width,s=t.height,a=r.points;a.length=0,n>=0&&s>=0&&a.push(e,i,e+n,i,e+n,i+s,e,i+s)},triangulate(r,t){const e=r.points,i=t.points;if(e.length===0)return;const n=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},qI={build(r){du.build(r)},triangulate(r,t){du.triangulate(r,t)}};function r_(r,t,e,i,n,s,a,o){const l=r-e*n,h=t-i*n,u=r+e*s,f=t+i*s;let c,_;a?(c=i,_=-e):(c=-i,_=e);const g=l+c,d=h+_,p=u+c,v=f+_;return o.push(g,d),o.push(p,v),2}function us(r,t,e,i,n,s,a,o){const l=e-r,h=i-t;let u=Math.atan2(l,h),f=Math.atan2(n-r,s-t);o&&u<f?u+=Math.PI*2:!o&&u>f&&(f+=Math.PI*2);let c=u;const _=f-u,g=Math.abs(_),d=Math.sqrt(l*l+h*h),p=(15*g*Math.sqrt(d)/Math.PI>>0)+1,v=_/p;if(c+=v,o){a.push(r,t),a.push(e,i);for(let A=1,E=c;A<p;A++,E+=v)a.push(r,t),a.push(r+Math.sin(E)*d,t+Math.cos(E)*d);a.push(r,t),a.push(n,s)}else{a.push(e,i),a.push(r,t);for(let A=1,E=c;A<p;A++,E+=v)a.push(r+Math.sin(E)*d,t+Math.cos(E)*d),a.push(r,t);a.push(n,s),a.push(r,t)}return p*2}function ZI(r,t){const e=r.shape;let i=r.points||e.points.slice();const n=t.closePointEps;if(i.length===0)return;const s=r.lineStyle,a=new me(i[0],i[1]),o=new me(i[i.length-2],i[i.length-1]),l=e.type!==si.POLY||e.closeStroke,h=Math.abs(a.x-o.x)<n&&Math.abs(a.y-o.y)<n;if(l){i=i.slice(),h&&(i.pop(),i.pop(),o.set(i[i.length-2],i[i.length-1]));const P=(a.x+o.x)*.5,F=(o.y+a.y)*.5;i.unshift(P,F),i.push(P,F)}const u=t.points,f=i.length/2;let c=i.length;const _=u.length/2,g=s.width/2,d=g*g,p=s.miterLimit*s.miterLimit;let v=i[0],A=i[1],E=i[2],S=i[3],L=0,T=0,x=-(A-S),m=v-E,w=0,R=0,M=Math.sqrt(x*x+m*m);x/=M,m/=M,x*=g,m*=g;const C=s.alignment,b=(1-C)*2,D=C*2;l||(s.cap===Ls.ROUND?c+=us(v-x*(b-D)*.5,A-m*(b-D)*.5,v-x*b,A-m*b,v+x*D,A+m*D,u,!0)+2:s.cap===Ls.SQUARE&&(c+=r_(v,A,x,m,b,D,!0,u))),u.push(v-x*b,A-m*b),u.push(v+x*D,A+m*D);for(let P=1;P<f-1;++P){v=i[(P-1)*2],A=i[(P-1)*2+1],E=i[P*2],S=i[P*2+1],L=i[(P+1)*2],T=i[(P+1)*2+1],x=-(A-S),m=v-E,M=Math.sqrt(x*x+m*m),x/=M,m/=M,x*=g,m*=g,w=-(S-T),R=E-L,M=Math.sqrt(w*w+R*R),w/=M,R/=M,w*=g,R*=g;const F=E-v,I=A-S,y=E-L,k=T-S,U=F*y+I*k,N=I*y-k*F,W=N<0;if(Math.abs(N)<.001*Math.abs(U)){u.push(E-x*b,S-m*b),u.push(E+x*D,S+m*D),U>=0&&(s.join===Rn.ROUND?c+=us(E,S,E-x*b,S-m*b,E-w*b,S-R*b,u,!1)+4:c+=2,u.push(E-w*D,S-R*D),u.push(E+w*b,S+R*b));continue}const G=(-x+v)*(-m+S)-(-x+E)*(-m+A),z=(-w+L)*(-R+S)-(-w+E)*(-R+T),X=(F*z-y*G)/N,K=(k*G-I*z)/N,$=(X-E)*(X-E)+(K-S)*(K-S),q=E+(X-E)*b,J=S+(K-S)*b,Q=E-(X-E)*D,rt=S-(K-S)*D,mt=Math.min(F*F+I*I,y*y+k*k),vt=W?b:D,_t=mt+vt*vt*d;$<=_t?s.join===Rn.BEVEL||$/d>p?(W?(u.push(q,J),u.push(E+x*D,S+m*D),u.push(q,J),u.push(E+w*D,S+R*D)):(u.push(E-x*b,S-m*b),u.push(Q,rt),u.push(E-w*b,S-R*b),u.push(Q,rt)),c+=2):s.join===Rn.ROUND?W?(u.push(q,J),u.push(E+x*D,S+m*D),c+=us(E,S,E+x*D,S+m*D,E+w*D,S+R*D,u,!0)+4,u.push(q,J),u.push(E+w*D,S+R*D)):(u.push(E-x*b,S-m*b),u.push(Q,rt),c+=us(E,S,E-x*b,S-m*b,E-w*b,S-R*b,u,!1)+4,u.push(E-w*b,S-R*b),u.push(Q,rt)):(u.push(q,J),u.push(Q,rt)):(u.push(E-x*b,S-m*b),u.push(E+x*D,S+m*D),s.join===Rn.ROUND?W?c+=us(E,S,E+x*D,S+m*D,E+w*D,S+R*D,u,!0)+2:c+=us(E,S,E-x*b,S-m*b,E-w*b,S-R*b,u,!1)+2:s.join===Rn.MITER&&$/d<=p&&(W?(u.push(Q,rt),u.push(Q,rt)):(u.push(q,J),u.push(q,J)),c+=2),u.push(E-w*b,S-R*b),u.push(E+w*D,S+R*D),c+=2)}v=i[(f-2)*2],A=i[(f-2)*2+1],E=i[(f-1)*2],S=i[(f-1)*2+1],x=-(A-S),m=v-E,M=Math.sqrt(x*x+m*m),x/=M,m/=M,x*=g,m*=g,u.push(E-x*b,S-m*b),u.push(E+x*D,S+m*D),l||(s.cap===Ls.ROUND?c+=us(E-x*(b-D)*.5,S-m*(b-D)*.5,E-x*b,S-m*b,E+x*D,S+m*D,u,!1)+2:s.cap===Ls.SQUARE&&(c+=r_(E,S,x,m,b,D,!1,u)));const O=t.indices,B=ml.epsilon*ml.epsilon;for(let P=_;P<c+_-2;++P)v=u[P*2],A=u[P*2+1],E=u[(P+1)*2],S=u[(P+1)*2+1],L=u[(P+2)*2],T=u[(P+2)*2+1],!(Math.abs(v*(S-T)+E*(T-A)+L*(A-S))<B)&&O.push(P,P+1,P+2)}function JI(r,t){let e=0;const i=r.shape,n=r.points||i.points,s=i.type!==si.POLY||i.closeStroke;if(n.length===0)return;const a=t.points,o=t.indices,l=n.length/2,h=a.length/2;let u=h;for(a.push(n[0],n[1]),e=1;e<l;e++)a.push(n[e*2],n[e*2+1]),o.push(u,u+1),u++;s&&o.push(u,h)}function n_(r,t){r.lineStyle.native?JI(r,t):ZI(r,t)}class s_{static curveTo(t,e,i,n,s,a){const o=a[a.length-2],h=a[a.length-1]-e,u=o-t,f=n-e,c=i-t,_=Math.abs(h*c-u*f);if(_<1e-8||s===0)return(a[a.length-2]!==t||a[a.length-1]!==e)&&a.push(t,e),null;const g=h*h+u*u,d=f*f+c*c,p=h*f+u*c,v=s*Math.sqrt(g)/_,A=s*Math.sqrt(d)/_,E=v*p/g,S=A*p/d,L=v*c+A*u,T=v*f+A*h,x=u*(A+E),m=h*(A+E),w=c*(v+S),R=f*(v+S),M=Math.atan2(m-T,x-L),C=Math.atan2(R-T,w-L);return{cx:L+t,cy:T+e,radius:s,startAngle:M,endAngle:C,anticlockwise:u*f>c*h}}static arc(t,e,i,n,s,a,o,l,h){const u=o-a,f=ml._segmentsCount(Math.abs(u)*s,Math.ceil(Math.abs(u)/su)*40),c=u/(f*2),_=c*2,g=Math.cos(c),d=Math.sin(c),p=f-1,v=p%1/p;for(let A=0;A<=p;++A){const E=A+v*A,S=c+a+_*E,L=Math.cos(S),T=-Math.sin(S);h.push((g*L+d*T)*s+i,(g*-T+d*L)*s+n)}}}class np{static curveLength(t,e,i,n,s,a,o,l){let u=0,f=0,c=0,_=0,g=0,d=0,p=0,v=0,A=0,E=0,S=0,L=t,T=e;for(let x=1;x<=10;++x)f=x/10,c=f*f,_=c*f,g=1-f,d=g*g,p=d*g,v=p*t+3*d*f*i+3*g*c*s+_*o,A=p*e+3*d*f*n+3*g*c*a+_*l,E=L-v,S=T-A,L=v,T=A,u+=Math.sqrt(E*E+S*S);return u}static curveTo(t,e,i,n,s,a,o){const l=o[o.length-2],h=o[o.length-1];o.length-=2;const u=ml._segmentsCount(np.curveLength(l,h,t,e,i,n,s,a));let f=0,c=0,_=0,g=0,d=0;o.push(l,h);for(let p=1,v=0;p<=u;++p)v=p/u,f=1-v,c=f*f,_=c*f,g=v*v,d=g*v,o.push(_*l+3*c*v*t+3*f*g*i+d*s,_*h+3*c*v*e+3*f*g*n+d*a)}}class sp{static curveLength(t,e,i,n,s,a){const o=t-2*i+s,l=e-2*n+a,h=2*i-2*t,u=2*n-2*e,f=4*(o*o+l*l),c=4*(o*h+l*u),_=h*h+u*u,g=2*Math.sqrt(f+c+_),d=Math.sqrt(f),p=2*f*d,v=2*Math.sqrt(_),A=c/d;return(p*g+d*c*(g-v)+(4*_*f-c*c)*Math.log((2*d+A+g)/(A+v)))/(4*p)}static curveTo(t,e,i,n,s){const a=s[s.length-2],o=s[s.length-1],l=ml._segmentsCount(sp.curveLength(a,o,t,e,i,n));let h=0,u=0;for(let f=1;f<=l;++f){const c=f/l;h=a+(t-a)*c,u=o+(e-o)*c,s.push(h+(t+(i-t)*c-h)*c,u+(e+(n-e)*c-u)*c)}}}class QI{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const td={[si.POLY]:Wx,[si.CIRC]:du,[si.ELIP]:du,[si.RECT]:$I,[si.RREC]:qI},a_=[],bh=[];class fu{constructor(t,e=null,i=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new fu(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Ea=new me,Hx=class extends Ix{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new lu,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let r=0;r<this.drawCalls.length;r++)this.drawCalls[r].texArray.clear(),bh.push(this.drawCalls[r]);this.drawCalls.length=0;for(let r=0;r<this.batches.length;r++){const t=this.batches[r];t.reset(),a_.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(r,t=null,e=null,i=null){const n=new fu(r,t,e,i);return this.graphicsData.push(n),this.dirty++,this}drawHole(r,t=null){if(!this.graphicsData.length)return null;const e=new fu(r,null,null,t),i=this.graphicsData[this.graphicsData.length-1];return e.lineStyle=i.lineStyle,i.holes.push(e),this.dirty++,this}destroy(){super.destroy();for(let r=0;r<this.graphicsData.length;++r)this.graphicsData[r].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(r){const t=this.graphicsData;for(let e=0;e<t.length;++e){const i=t[e];if(!!i.fillStyle.visible&&i.shape&&(i.matrix?i.matrix.applyInverse(r,Ea):Ea.copyFrom(r),i.shape.contains(Ea.x,Ea.y))){let n=!1;if(i.holes){for(let s=0;s<i.holes.length;s++)if(i.holes[s].shape.contains(Ea.x,Ea.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const r=this.uvs,t=this.graphicsData;let e=null,i=null;this.batches.length>0&&(e=this.batches[this.batches.length-1],i=e.style);for(let o=this.shapeIndex;o<t.length;o++){this.shapeIndex++;const l=t[o],h=l.fillStyle,u=l.lineStyle;td[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(h.visible||u.visible)&&this.processHoles(l.holes);for(let c=0;c<2;c++){const _=c===0?h:u;if(!_.visible)continue;const g=_.texture.baseTexture,d=this.indices.length,p=this.points.length/2;g.wrapMode=Vn.REPEAT,c===0?this.processFill(l):this.processLine(l);const v=this.points.length/2-p;v!==0&&(e&&!this._compareStyles(i,_)&&(e.end(d,p),e=null),e||(e=a_.pop()||new QI,e.begin(_,d,p),this.batches.push(e),i=_),this.addUvs(this.points,r,_.texture,p,v,_.matrix))}}const n=this.indices.length,s=this.points.length/2;if(e&&e.end(n,s),this.batches.length===0){this.batchable=!0;return}const a=s>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(r,t){return!(!r||!t||r.texture.baseTexture!==t.texture.baseTexture||r.color+r.alpha!==t.color+t.alpha||!!r.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let r=0,t=this.graphicsData.length;r<t;r++){const e=this.graphicsData[r],i=e.fillStyle,n=e.lineStyle;if(i&&!i.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const r=this.batches;for(let t=0,e=r.length;t<e;t++){const i=r[t];for(let n=0;n<i.size;n++){const s=i.start+n;this.indicesUint16[s]=this.indicesUint16[s]-i.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const r=this.batches;for(let t=0;t<r.length;t++)if(r[t].style.native)return!1;return this.points.length<Hx.BATCHABLE_SIZE*2}buildDrawCalls(){let r=++pe._globalBatch;for(let u=0;u<this.drawCalls.length;u++)this.drawCalls[u].texArray.clear(),bh.push(this.drawCalls[u]);this.drawCalls.length=0;const t=this.colors,e=this.textureIds;let i=bh.pop();i||(i=new sf,i.texArray=new af),i.texArray.count=0,i.start=0,i.size=0,i.type=Nr.TRIANGLES;let n=0,s=null,a=0,o=!1,l=Nr.TRIANGLES,h=0;this.drawCalls.push(i);for(let u=0;u<this.batches.length;u++){const f=this.batches[u],c=8,_=f.style,g=_.texture.baseTexture;o!==!!_.native&&(o=!!_.native,l=o?Nr.LINES:Nr.TRIANGLES,s=null,n=c,r++),s!==g&&(s=g,g._batchEnabled!==r&&(n===c&&(r++,n=0,i.size>0&&(i=bh.pop(),i||(i=new sf,i.texArray=new af),this.drawCalls.push(i)),i.start=h,i.size=0,i.texArray.count=0,i.type=l),g.touched=1,g._batchEnabled=r,g._batchLocation=n,g.wrapMode=Vn.REPEAT,i.texArray.elements[i.texArray.count++]=g,n++)),i.size+=f.size,h+=f.size,a=g._batchLocation,this.addColors(t,_.color,_.alpha,f.attribSize,f.attribStart),this.addTextureIds(e,a,f.attribSize,f.attribStart)}pe._globalBatch=r,this.packAttributes()}packAttributes(){const r=this.points,t=this.uvs,e=this.colors,i=this.textureIds,n=new ArrayBuffer(r.length*3*4),s=new Float32Array(n),a=new Uint32Array(n);let o=0;for(let l=0;l<r.length/2;l++)s[o++]=r[l*2],s[o++]=r[l*2+1],s[o++]=t[l*2],s[o++]=t[l*2+1],a[o++]=e[l],s[o++]=i[l];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(r){r.holes.length?Wx.triangulate(r,this):td[r.type].triangulate(r,this)}processLine(r){n_(r,this);for(let t=0;t<r.holes.length;t++)n_(r.holes[t],this)}processHoles(r){for(let t=0;t<r.length;t++){const e=r[t];td[e.type].build(e),e.matrix&&this.transformPoints(e.points,e.matrix)}}calculateBounds(){const r=this._bounds;r.clear(),r.addVertexData(this.points,0,this.points.length),r.pad(this.boundsPadding,this.boundsPadding)}transformPoints(r,t){for(let e=0;e<r.length/2;e++){const i=r[e*2],n=r[e*2+1];r[e*2]=t.a*i+t.c*n+t.tx,r[e*2+1]=t.b*i+t.d*n+t.ty}}addColors(r,t,e,i,n=0){const s=(t>>16)+(t&65280)+((t&255)<<16),a=Jf(s,e);r.length=Math.max(r.length,n+i);for(let o=0;o<i;o++)r[n+o]=a}addTextureIds(r,t,e,i=0){r.length=Math.max(r.length,i+e);for(let n=0;n<e;n++)r[i+n]=t}addUvs(r,t,e,i,n,s=null){let a=0;const o=t.length,l=e.frame;for(;a<n;){let u=r[(i+a)*2],f=r[(i+a)*2+1];if(s){const c=s.a*u+s.c*f+s.tx;f=s.b*u+s.d*f+s.ty,u=c}a++,t.push(u/l.width,f/l.height)}const h=e.baseTexture;(l.width<h.width||l.height<h.height)&&this.adjustUvs(t,e,o,n)}adjustUvs(r,t,e,i){const n=t.baseTexture,s=1e-6,a=e+i*2,o=t.frame,l=o.width/n.width,h=o.height/n.height;let u=o.x/o.width,f=o.y/o.height,c=Math.floor(r[e]+s),_=Math.floor(r[e+1]+s);for(let g=e+2;g<a;g+=2)c=Math.min(c,Math.floor(r[g]+s)),_=Math.min(_,Math.floor(r[g+1]+s));u-=c,f-=_;for(let g=e;g<a;g+=2)r[g]=(r[g]+u)*l,r[g+1]=(r[g+1]+f)*h}};let Vx=Hx;Vx.BATCHABLE_SIZE=100;class ap extends Iu{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Ls.BUTT,this.join=Rn.MITER,this.miterLimit=10}clone(){const t=new ap;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const tO=new Float32Array(3),ed={},Wh=class extends Pi{constructor(r=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Iu,this._lineStyle=new ap,this._matrix=null,this._holeMode=!1,this.state=En.for2d(),this._geometry=r||new Vx,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=Jt.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Wh(this._geometry)}set blendMode(r){this.state.blendMode=r}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(r){this._tint=r}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(r=null,t=0,e=1,i=.5,n=!1){return typeof r=="number"&&(r={width:r,color:t,alpha:e,alignment:i,native:n}),this.lineTextureStyle(r)}lineTextureStyle(r){r=Object.assign({width:0,texture:Gt.WHITE,color:r!=null&&r.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:Ls.BUTT,join:Rn.MITER,miterLimit:10},r),this.currentPath&&this.startPoly();const t=r.width>0&&r.alpha>0;return t?(r.matrix&&(r.matrix=r.matrix.clone(),r.matrix.invert()),Object.assign(this._lineStyle,{visible:t},r)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const r=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Xa,this.currentPath.closeStroke=!1,this.currentPath.points.push(r[t-2],r[t-1]))}else this.currentPath=new Xa,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(r,t){return this.startPoly(),this.currentPath.points[0]=r,this.currentPath.points[1]=t,this}lineTo(r,t){this.currentPath||this.moveTo(0,0);const e=this.currentPath.points,i=e[e.length-2],n=e[e.length-1];return(i!==r||n!==t)&&e.push(r,t),this}_initCurve(r=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[r,t]):this.moveTo(r,t)}quadraticCurveTo(r,t,e,i){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),sp.curveTo(r,t,e,i,n),this}bezierCurveTo(r,t,e,i,n,s){return this._initCurve(),np.curveTo(r,t,e,i,n,s,this.currentPath.points),this}arcTo(r,t,e,i,n){this._initCurve(r,t);const s=this.currentPath.points,a=s_.curveTo(r,t,e,i,n,s);if(a){const{cx:o,cy:l,radius:h,startAngle:u,endAngle:f,anticlockwise:c}=a;this.arc(o,l,h,u,f,c)}return this}arc(r,t,e,i,n,s=!1){if(i===n)return this;if(!s&&n<=i?n+=su:s&&i<=n&&(i+=su),n-i===0)return this;const o=r+Math.cos(i)*e,l=t+Math.sin(i)*e,h=this._geometry.closePointEps;let u=this.currentPath?this.currentPath.points:null;if(u){const f=Math.abs(u[u.length-2]-o),c=Math.abs(u[u.length-1]-l);f<h&&c<h||u.push(o,l)}else this.moveTo(o,l),u=this.currentPath.points;return s_.arc(o,l,r,t,e,i,n,s,u),this}beginFill(r=0,t=1){return this.beginTextureFill({texture:Gt.WHITE,color:r,alpha:t})}beginTextureFill(r){r=Object.assign({texture:Gt.WHITE,color:16777215,alpha:1,matrix:null},r),this.currentPath&&this.startPoly();const t=r.alpha>0;return t?(r.matrix&&(r.matrix=r.matrix.clone(),r.matrix.invert()),Object.assign(this._fillStyle,{visible:t},r)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(r,t,e,i){return this.drawShape(new le(r,t,e,i))}drawRoundedRect(r,t,e,i,n){return this.drawShape(new Yf(r,t,e,i,n))}drawCircle(r,t,e){return this.drawShape(new Kf(r,t,e))}drawEllipse(r,t,e,i){return this.drawShape(new jf(r,t,e,i))}drawPolygon(...r){let t,e=!0;const i=r[0];i.points?(e=i.closeStroke,t=i.points):Array.isArray(r[0])?t=r[0]:t=r;const n=new Xa(t);return n.closeStroke=e,this.drawShape(n),this}drawShape(r){return this._holeMode?this._geometry.drawHole(r,this._matrix):this._geometry.drawShape(r,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const r=this._geometry.graphicsData;return r.length===1&&r[0].shape.type===si.RECT&&!r[0].matrix&&!r[0].holes.length&&!(r[0].lineStyle.visible&&r[0].lineStyle.width)}_render(r){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(r)):(r.batch.flush(),this._renderDirect(r))}_populateBatches(){const r=this._geometry,t=this.blendMode,e=r.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=r.batchDirty,this.batches.length=e,this.vertexData=new Float32Array(r.points);for(let i=0;i<e;i++){const n=r.batches[i],s=n.style.color,a=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),o=new Float32Array(r.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),l=new Uint16Array(r.indicesUint16.buffer,n.start*2,n.size),h={vertexData:a,blendMode:t,indices:l,uvs:o,_batchRGB:cl(s),_tintRGB:s,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[i]=h}}_renderBatched(r){if(!!this.batches.length){r.batch.setObjectRenderer(r.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,e=this.batches.length;t<e;t++){const i=this.batches[t];i.worldAlpha=this.worldAlpha*i.alpha,r.plugins[this.pluginName].render(i)}}}_renderDirect(r){const t=this._resolveDirectShader(r),e=this._geometry,i=this.tint,n=this.worldAlpha,s=t.uniforms,a=e.drawCalls;s.translationMatrix=this.transform.worldTransform,s.tint[0]=(i>>16&255)/255*n,s.tint[1]=(i>>8&255)/255*n,s.tint[2]=(i&255)/255*n,s.tint[3]=n,r.shader.bind(t),r.geometry.bind(e,t),r.state.set(this.state);for(let o=0,l=a.length;o<l;o++)this._renderDrawCallDirect(r,e.drawCalls[o])}_renderDrawCallDirect(r,t){const{texArray:e,type:i,size:n,start:s}=t,a=e.count;for(let o=0;o<a;o++)r.texture.bind(e.elements[o],o);r.geometry.draw(i,n,s)}_resolveDirectShader(r){let t=this.shader;const e=this.pluginName;if(!t){if(!ed[e]){const{MAX_TEXTURES:i}=r.plugins[e],n=new Int32Array(i);for(let o=0;o<i;o++)n[o]=o;const s={tint:new Float32Array([1,1,1,1]),translationMatrix:new Fe,default:Ar.from({uSamplers:n},!0)},a=r.plugins[e]._shader.program;ed[e]=new Xr(a,s)}t=ed[e]}return t}_calculateBounds(){this.finishPoly();const r=this._geometry;if(!r.graphicsData.length)return;const{minX:t,minY:e,maxX:i,maxY:n}=r.bounds;this._bounds.addFrame(this.transform,t,e,i,n)}containsPoint(r){return this.worldTransform.applyInverse(r,Wh._TEMP_POINT),this._geometry.containsPoint(Wh._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const r=cl(this.tint,tO);for(let t=0;t<this.batches.length;t++){const e=this.batches[t],i=e._batchRGB,n=r[0]*i[0]*255,s=r[1]*i[1]*255,a=r[2]*i[2]*255,o=(n<<16)+(s<<8)+(a|0);e._tintRGB=(o>>16)+(o&65280)+((o&255)<<16)}}}calculateVertices(){const r=this.transform._worldID;if(this._transformID===r)return;this._transformID=r;const t=this.transform.worldTransform,e=t.a,i=t.b,n=t.c,s=t.d,a=t.tx,o=t.ty,l=this._geometry.points,h=this.vertexData;let u=0;for(let f=0;f<l.length;f+=2){const c=l[f],_=l[f+1];h[u++]=e*c+n*_+a,h[u++]=s*_+i*c+o}}closePath(){const r=this.currentPath;return r&&(r.closeStroke=!0,this.finishPoly()),this}setMatrix(r){return this._matrix=r,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(r){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(r)}};let Ou=Wh;Ou._TEMP_POINT=new me;class eO{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const id=new me,o_=new Xa,Xx=class extends Pi{constructor(r,t,e,i=Nr.TRIANGLES){super(),this.geometry=r,this.shader=t,this.state=e||En.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=bt.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(r){this._geometry!==r&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=r,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(r){this.shader=r}get material(){return this.shader}set blendMode(r){this.state.blendMode=r}get blendMode(){return this.state.blendMode}set roundPixels(r){this._roundPixels!==r&&(this._transformID=-1),this._roundPixels=r}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(r){this.shader.tint=r}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(r){this.shader.texture=r}_render(r){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Nr.TRIANGLES&&t.length<Xx.BATCHABLE_SIZE*2?this._renderToBatch(r):this._renderDefault(r)}_renderDefault(r){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),r.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),r.shader.bind(t),r.state.set(this.state),r.geometry.bind(this.geometry,t),r.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(r){const t=this.geometry,e=this.shader;e.uvMatrix&&(e.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=e._tintRGB,this._texture=e.texture;const i=this.material.pluginName;r.batch.setObjectRenderer(r.plugins[i]),r.plugins[i].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,s=n.a,a=n.b,o=n.c,l=n.d,h=n.tx,u=n.ty,f=this.vertexData;for(let c=0;c<f.length/2;c++){const _=e[c*2],g=e[c*2+1];f[c*2]=s*_+o*g+h,f[c*2+1]=a*_+l*g+u}if(this._roundPixels){const c=bt.RESOLUTION;for(let _=0;_<f.length;++_)f[_]=Math.round(f[_]*c)/c}this.vertexDirty=i}calculateUvs(){const r=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=r.data:(this.batchUvs||(this.batchUvs=new eO(r,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(r){if(!this.getBounds().contains(r.x,r.y))return!1;this.worldTransform.applyInverse(r,id);const t=this.geometry.getBuffer("aVertexPosition").data,e=o_.points,i=this.geometry.getIndex().data,n=i.length,s=this.drawMode===4?3:1;for(let a=0;a+2<n;a+=s){const o=i[a]*2,l=i[a+1]*2,h=i[a+2]*2;if(e[0]=t[o],e[1]=t[o+1],e[2]=t[l],e[3]=t[l+1],e[4]=t[h],e[5]=t[h+1],o_.contains(id.x,id.y))return!0}return!1}destroy(r){super.destroy(r),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let df=Xx;df.BATCHABLE_SIZE=100;var iO=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,rO=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class l_ extends Xr{constructor(t,e){const i={uSampler:t,alpha:1,uTextureMatrix:Fe.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(i,e.uniforms),super(e.program||gn.from(rO,iO),i),this._colorDirty=!1,this.uvMatrix=new px(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this.tint=e.tint,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture;$0(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class nO extends Jn{constructor(t,e,i){super();const n=new Ne(t),s=new Ne(e,!0),a=new Ne(i,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,qt.FLOAT).addAttribute("aTextureCoord",s,2,!1,qt.FLOAT).addIndex(a),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class h_{constructor(t,e,i){this.geometry=new Jn,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let s=t[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||qt.FLOAT,offset:s.offset},e[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new Ne(bR(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];o.offset=e,e+=o.size,this.dynamicStride+=o.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new Ne(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];o.offset=n,n+=o.size,this.staticStride+=o.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new Ne(this.staticData,!0,!1);for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];t.addAttribute(o.attributeName,this.dynamicBuffer,0,o.type===qt.UNSIGNED_BYTE,o.type,this.dynamicStride*4,o.offset*4)}for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];t.addAttribute(o.attributeName,this.staticBuffer,0,o.type===qt.UNSIGNED_BYTE,o.type,this.staticStride*4,o.offset*4)}}uploadDynamic(t,e,i){for(let n=0;n<this.dynamicProperties.length;n++){const s=this.dynamicProperties[n];s.uploadFunction(t,e,i,s.type===qt.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let n=0;n<this.staticProperties.length;n++){const s=this.staticProperties[n];s.uploadFunction(t,e,i,s.type===qt.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var sO=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,aO=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Kx extends Du{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Fe,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:qt.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Xr.from(aO,sO,{}),this.state=En.for2d()}render(t){const e=t.children,i=t._maxSize,n=t._batchSize,s=this.renderer;let a=e.length;if(a===0)return;a>i&&!t.autoResize&&(a=i);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const l=e[0]._texture.baseTexture,h=l.alphaMode>0;this.state.blendMode=Y0(t.blendMode,h),s.state.set(this.state);const u=s.gl,f=t.worldTransform.copyTo(this.tempMatrix);f.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=f.toArray(!0),this.shader.uniforms.uColor=TR(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,h),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let c=!1;for(let _=0,g=0;_<a;_+=n,g+=1){let d=a-_;d>n&&(d=n),g>=o.length&&o.push(this._generateOneMoreBuffer(t));const p=o[g];p.uploadDynamic(e,_,d);const v=t._bufferUpdateIDs[g]||0;c=c||p._updateID<v,c&&(p._updateID=t._updateID,p.uploadStatic(e,_,d)),s.geometry.bind(p.geometry),u.drawElements(u.TRIANGLES,d*6,u.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],i=t._maxSize,n=t._batchSize,s=t._properties;for(let a=0;a<i;a+=n)e.push(new h_(this.properties,s,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,i=t._properties;return new h_(this.properties,i,e)}uploadVertices(t,e,i,n,s,a){let o=0,l=0,h=0,u=0;for(let f=0;f<i;++f){const c=t[e+f],_=c._texture,g=c.scale.x,d=c.scale.y,p=_.trim,v=_.orig;p?(l=p.x-c.anchor.x*v.width,o=l+p.width,u=p.y-c.anchor.y*v.height,h=u+p.height):(o=v.width*(1-c.anchor.x),l=v.width*-c.anchor.x,h=v.height*(1-c.anchor.y),u=v.height*-c.anchor.y),n[a]=l*g,n[a+1]=u*d,n[a+s]=o*g,n[a+s+1]=u*d,n[a+s*2]=o*g,n[a+s*2+1]=h*d,n[a+s*3]=l*g,n[a+s*3+1]=h*d,a+=s*4}}uploadPosition(t,e,i,n,s,a){for(let o=0;o<i;o++){const l=t[e+o].position;n[a]=l.x,n[a+1]=l.y,n[a+s]=l.x,n[a+s+1]=l.y,n[a+s*2]=l.x,n[a+s*2+1]=l.y,n[a+s*3]=l.x,n[a+s*3+1]=l.y,a+=s*4}}uploadRotation(t,e,i,n,s,a){for(let o=0;o<i;o++){const l=t[e+o].rotation;n[a]=l,n[a+s]=l,n[a+s*2]=l,n[a+s*3]=l,a+=s*4}}uploadUvs(t,e,i,n,s,a){for(let o=0;o<i;++o){const l=t[e+o]._texture._uvs;l?(n[a]=l.x0,n[a+1]=l.y0,n[a+s]=l.x1,n[a+s+1]=l.y1,n[a+s*2]=l.x2,n[a+s*2+1]=l.y2,n[a+s*3]=l.x3,n[a+s*3+1]=l.y3,a+=s*4):(n[a]=0,n[a+1]=0,n[a+s]=0,n[a+s+1]=0,n[a+s*2]=0,n[a+s*2+1]=0,n[a+s*3]=0,n[a+s*3+1]=0,a+=s*4)}}uploadTint(t,e,i,n,s,a){for(let o=0;o<i;++o){const l=t[e+o],h=l._texture.baseTexture.alphaMode>0,u=l.alpha,f=u<1&&h?Jf(l._tintRGB,u):l._tintRGB+(u*255<<24);n[a]=f,n[a+s]=f,n[a+s*2]=f,n[a+s*3]=f,a+=s*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Kx.extension={name:"particle",type:Pt.RendererPlugin};Yt.add(Kx);bt.UPLOADS_PER_FRAME=4;var Fu=(r=>(r[r.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",r[r.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",r))(Fu||{});const rd={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Fu.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},oO=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];class Qn{constructor(t){this.styleID=0,this.reset(),sd(this,t,t)}clone(){const t={};return sd(t,this,rd),new Qn(t)}reset(){sd(this,rd,rd)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=nd(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=nd(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){lO(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=nd(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let n=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!oO.includes(n)&&(n=`"${n}"`),e[i]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}}function u_(r){return typeof r=="number"?K0(r):(typeof r=="string"&&r.startsWith("0x")&&(r=r.replace("0x","#")),r)}function nd(r){if(Array.isArray(r)){for(let t=0;t<r.length;++t)r[t]=u_(r[t]);return r}else return u_(r)}function lO(r,t){if(!Array.isArray(r)||!Array.isArray(t)||r.length!==t.length)return!1;for(let e=0;e<r.length;++e)if(r[e]!==t[e])return!1;return!0}function sd(r,t,e){for(const i in e)Array.isArray(t[i])?r[i]=t[i].slice():r[i]=t[i]}const Sh={willReadFrequently:!0};class Wt{constructor(t,e,i,n,s,a,o,l,h){this.text=t,this.style=e,this.width=i,this.height=n,this.lines=s,this.lineWidths=a,this.lineHeight=o,this.maxLineWidth=l,this.fontProperties=h}static measureText(t,e,i,n=Wt._canvas){i=i==null?e.wordWrap:i;const s=e.toFontString(),a=Wt.measureFont(s);a.fontSize===0&&(a.fontSize=e.fontSize,a.ascent=e.fontSize);const o=n.getContext("2d",Sh);o.font=s;const h=(i?Wt.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),u=new Array(h.length);let f=0;for(let d=0;d<h.length;d++){const p=o.measureText(h[d]).width+(h[d].length-1)*e.letterSpacing;u[d]=p,f=Math.max(f,p)}let c=f+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);const _=e.lineHeight||a.fontSize+e.strokeThickness;let g=Math.max(_,a.fontSize+e.strokeThickness)+(h.length-1)*(_+e.leading);return e.dropShadow&&(g+=e.dropShadowDistance),new Wt(t,e,c,g,h,u,_+e.leading,f,a)}static wordWrap(t,e,i=Wt._canvas){const n=i.getContext("2d",Sh);let s=0,a="",o="";const l=Object.create(null),{letterSpacing:h,whiteSpace:u}=e,f=Wt.collapseSpaces(u),c=Wt.collapseNewlines(u);let _=!f;const g=e.wordWrapWidth+h,d=Wt.tokenize(t);for(let p=0;p<d.length;p++){let v=d[p];if(Wt.isNewline(v)){if(!c){o+=Wt.addLine(a),_=!f,a="",s=0;continue}v=" "}if(f){const E=Wt.isBreakingSpace(v),S=Wt.isBreakingSpace(a[a.length-1]);if(E&&S)continue}const A=Wt.getFromCache(v,h,l,n);if(A>g)if(a!==""&&(o+=Wt.addLine(a),a="",s=0),Wt.canBreakWords(v,e.breakWords)){const E=Wt.wordWrapSplit(v);for(let S=0;S<E.length;S++){let L=E[S],T=1;for(;E[S+T];){const m=E[S+T],w=L[L.length-1];if(Wt.canBreakChars(w,m,v,S,e.breakWords))break}S+=L.length-1;const x=Wt.getFromCache(L,h,l,n);x+s>g&&(o+=Wt.addLine(a),_=!1,a="",s=0),a+=L,s+=x}}else{a.length>0&&(o+=Wt.addLine(a),a="",s=0);const E=p===d.length-1;o+=Wt.addLine(v,!E),_=!1,a="",s=0}else A+s>g&&(_=!1,o+=Wt.addLine(a),a="",s=0),(a.length>0||!Wt.isBreakingSpace(v)||_)&&(a+=v,s+=A)}return o+=Wt.addLine(a,!1),o}static addLine(t,e=!0){return t=Wt.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,i,n){let s=i[t];if(typeof s!="number"){const a=t.length*e;s=n.measureText(t).width+a,i[t]=s}return s}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!Wt.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:Wt._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:Wt._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let i="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const s=t[n],a=t[n+1];if(Wt.isBreakingSpace(s,a)||Wt.isNewline(s)){i!==""&&(e.push(i),i=""),e.push(s);continue}i+=s}return i!==""&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,n,s){return!0}static wordWrapSplit(t){return t.split("")}static measureFont(t){if(Wt._fonts[t])return Wt._fonts[t];const e={ascent:0,descent:0,fontSize:0},i=Wt._canvas,n=Wt._context;n.font=t;const s=Wt.METRICS_STRING+Wt.BASELINE_SYMBOL,a=Math.ceil(n.measureText(s).width);let o=Math.ceil(n.measureText(Wt.BASELINE_SYMBOL).width);const l=Math.ceil(Wt.HEIGHT_MULTIPLIER*o);o=o*Wt.BASELINE_MULTIPLIER|0,i.width=a,i.height=l,n.fillStyle="#f00",n.fillRect(0,0,a,l),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(s,0,o);const h=n.getImageData(0,0,a,l).data,u=h.length,f=a*4;let c=0,_=0,g=!1;for(c=0;c<o;++c){for(let d=0;d<f;d+=4)if(h[_+d]!==255){g=!0;break}if(!g)_+=f;else break}for(e.ascent=o-c,_=u-f,g=!1,c=l;c>o;--c){for(let d=0;d<f;d+=4)if(h[_+d]!==255){g=!0;break}if(!g)_-=f;else break}return e.descent=c-o,e.fontSize=e.ascent+e.descent,Wt._fonts[t]=e,e}static clearMetrics(t=""){t?delete Wt._fonts[t]:Wt._fonts={}}static get _canvas(){if(!Wt.__canvas){let t;try{const e=new OffscreenCanvas(0,0),i=e.getContext("2d",Sh);if(i!=null&&i.measureText)return Wt.__canvas=e,e;t=bt.ADAPTER.createCanvas()}catch{t=bt.ADAPTER.createCanvas()}t.width=t.height=10,Wt.__canvas=t}return Wt.__canvas}static get _context(){return Wt.__context||(Wt.__context=Wt._canvas.getContext("2d",Sh)),Wt.__context}}Wt._fonts={};Wt.METRICS_STRING="|\xC9q\xC5";Wt.BASELINE_SYMBOL="M";Wt.BASELINE_MULTIPLIER=1.4;Wt.HEIGHT_MULTIPLIER=2;Wt._newlines=[10,13];Wt._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const hO={texture:!0,children:!1,baseTexture:!0},jx=class extends ta{constructor(r,t,e){let i=!1;e||(e=bt.ADAPTER.createCanvas(),i=!0),e.width=3,e.height=3;const n=Gt.from(e);n.orig=new le,n.trim=new le,super(n),this._ownCanvas=i,this.canvas=e,this.context=e.getContext("2d",{willReadFrequently:!0}),this._resolution=bt.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=r,this.style=t,this.localStyleID=-1}updateText(r){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&r)return;this._font=this._style.toFontString();const e=this.context,i=Wt.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=i.width,s=i.height,a=i.lines,o=i.lineHeight,l=i.lineWidths,h=i.maxLineWidth,u=i.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,s)+t.padding*2)*this._resolution),e.scale(this._resolution,this._resolution),e.clearRect(0,0,this.canvas.width,this.canvas.height),e.font=this._font,e.lineWidth=t.strokeThickness,e.textBaseline=t.textBaseline,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit;let f,c;const _=t.dropShadow?2:1;for(let g=0;g<_;++g){const d=t.dropShadow&&g===0,p=d?Math.ceil(Math.max(1,s)+t.padding*2):0,v=p*this._resolution;if(d){e.fillStyle="black",e.strokeStyle="black";const E=t.dropShadowColor,S=cl(typeof E=="number"?E:Zf(E)),L=t.dropShadowBlur*this._resolution,T=t.dropShadowDistance*this._resolution;e.shadowColor=`rgba(${S[0]*255},${S[1]*255},${S[2]*255},${t.dropShadowAlpha})`,e.shadowBlur=L,e.shadowOffsetX=Math.cos(t.dropShadowAngle)*T,e.shadowOffsetY=Math.sin(t.dropShadowAngle)*T+v}else e.fillStyle=this._generateFillStyle(t,a,i),e.strokeStyle=t.stroke,e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;let A=(o-u.fontSize)/2;o-u.fontSize<0&&(A=0);for(let E=0;E<a.length;E++)f=t.strokeThickness/2,c=t.strokeThickness/2+E*o+u.ascent+A,t.align==="right"?f+=h-l[E]:t.align==="center"&&(f+=(h-l[E])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(a[E],f+t.padding,c+t.padding-p,!0),t.fill&&this.drawLetterSpacing(a[E],f+t.padding,c+t.padding-p)}this.updateTexture()}drawLetterSpacing(r,t,e,i=!1){const s=this._style.letterSpacing,a=jx.experimentalLetterSpacing&&("letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype);if(s===0||a){a&&(this.context.letterSpacing=s,this.context.textLetterSpacing=s),i?this.context.strokeText(r,t,e):this.context.fillText(r,t,e);return}let o=t;const l=Array.from?Array.from(r):r.split("");let h=this.context.measureText(r).width,u=0;for(let f=0;f<l.length;++f){const c=l[f];i?this.context.strokeText(c,o,e):this.context.fillText(c,o,e);let _="";for(let g=f+1;g<l.length;++g)_+=l[g];u=this.context.measureText(_).width,o+=h-u+s,h=u}}updateTexture(){const r=this.canvas;if(this._style.trim){const s=wR(r);s.data&&(r.width=s.width,r.height=s.height,this.context.putImageData(s.data,0,0))}const t=this._texture,e=this._style,i=e.trim?0:e.padding,n=t.baseTexture;t.trim.width=t._frame.width=r.width/this._resolution,t.trim.height=t._frame.height=r.height/this._resolution,t.trim.x=-i,t.trim.y=-i,t.orig.width=t._frame.width-i*2,t.orig.height=t._frame.height-i*2,this._onTextureUpdate(),n.setRealSize(r.width,r.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(r){this._autoResolution&&this._resolution!==r.resolution&&(this._resolution=r.resolution,this.dirty=!0),this.updateText(!0),super._render(r)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(r,t){return this.updateText(!0),this._textureID===-1&&(r=!1),super.getBounds(r,t)}getLocalBounds(r){return this.updateText(!0),super.getLocalBounds.call(this,r)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(r,t,e){const i=r.fill;if(Array.isArray(i)){if(i.length===1)return i[0]}else return i;let n;const s=r.dropShadow?r.dropShadowDistance:0,a=r.padding||0,o=this.canvas.width/this._resolution-s-a*2,l=this.canvas.height/this._resolution-s-a*2,h=i.slice(),u=r.fillGradientStops.slice();if(!u.length){const f=h.length+1;for(let c=1;c<f;++c)u.push(c/f)}if(h.unshift(i[0]),u.unshift(0),h.push(i[i.length-1]),u.push(1),r.fillGradientType===Fu.LINEAR_VERTICAL){n=this.context.createLinearGradient(o/2,a,o/2,l+a);const f=e.fontProperties.fontSize+r.strokeThickness;for(let c=0;c<t.length;c++){const _=e.lineHeight*(c-1)+f,g=e.lineHeight*c;let d=g;c>0&&_>g&&(d=(g+_)/2);const p=g+f,v=e.lineHeight*(c+1);let A=p;c+1<t.length&&v<p&&(A=(p+v)/2);const E=(A-d)/l;for(let S=0;S<h.length;S++){let L=0;typeof u[S]=="number"?L=u[S]:L=S/h.length;let T=Math.min(1,Math.max(0,d/l+L*E));T=Number(T.toFixed(5)),n.addColorStop(T,h[S])}}}else{n=this.context.createLinearGradient(a,l/2,o+a,l/2);const f=h.length+1;let c=1;for(let _=0;_<h.length;_++){let g;typeof u[_]=="number"?g=u[_]:g=c/f,n.addColorStop(g,h[_]),c++}}return n}destroy(r){typeof r=="boolean"&&(r={children:r}),r=Object.assign({},hO,r),super.destroy(r),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(r){this.updateText(!0);const t=Pa(this.scale.x)||1;this.scale.x=t*r/this._texture.orig.width,this._width=r}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(r){this.updateText(!0);const t=Pa(this.scale.y)||1;this.scale.y=t*r/this._texture.orig.height,this._height=r}get style(){return this._style}set style(r){r=r||{},r instanceof Qn?this._style=r:this._style=new Qn(r),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(r){r=String(r==null?"":r),this._text!==r&&(this._text=r,this.dirty=!0)}get resolution(){return this._resolution}set resolution(r){this._autoResolution=!1,this._resolution!==r&&(this._resolution=r,this.dirty=!0)}};let op=jx;op.experimentalLetterSpacing=!1;class uO{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function cO(r,t){var i;let e=!1;if((i=r==null?void 0:r._textures)!=null&&i.length){for(let n=0;n<r._textures.length;n++)if(r._textures[n]instanceof Gt){const s=r._textures[n].baseTexture;t.includes(s)||(t.push(s),e=!0)}}return e}function dO(r,t){if(r.baseTexture instanceof pe){const e=r.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function fO(r,t){if(r._texture&&r._texture instanceof Gt){const e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function pO(r,t){return t instanceof op?(t.updateText(!0),!0):!1}function mO(r,t){if(t instanceof Qn){const e=t.toFontString();return Wt.measureFont(e),!0}return!1}function gO(r,t){if(r instanceof op){t.includes(r.style)||t.push(r.style),t.includes(r)||t.push(r);const e=r._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function _O(r,t){return r instanceof Qn?(t.includes(r)||t.push(r),!0):!1}class vO{constructor(t){this.limiter=new uO(bt.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{!this.queue||this.prepareItems()},this.registerFindHook(gO),this.registerFindHook(_O),this.registerFindHook(cO),this.registerFindHook(dO),this.registerFindHook(fO),this.registerUploadHook(pO),this.registerUploadHook(mO)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Te.system.addOnce(this.tick,this,Ys.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let i=0,n=this.uploadHooks.length;i<n;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)Te.system.addOnce(this.tick,this,Ys.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Pi)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&Te.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}}function Yx(r,t){return t instanceof pe?(t._glTextures[r.CONTEXT_UID]||r.texture.bind(t),!0):!1}function xO(r,t){if(!(t instanceof Ou))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:i}=e;for(let n=0;n<i.length;n++){const{texture:s}=i[n].style;s&&Yx(r,s.baseTexture)}return e.batchable||r.geometry.bind(e,t._resolveDirectShader(r)),!0}function yO(r,t){return r instanceof Ou?(t.push(r),!0):!1}class $x extends vO{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(yO),this.registerUploadHook(Yx),this.registerUploadHook(xO)}}$x.extension={name:"prepare",type:Pt.RendererSystem};Yt.add($x);const Fo=class{constructor(r,t,e=null){this.linkedSheets=[],this._texture=r instanceof Gt?r:null,this.baseTexture=r instanceof pe?r:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const i=this.baseTexture.resource;this.resolution=this._updateResolution(e||(i?i.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(r=null){const{scale:t}=this.data.meta;let e=$n(r,null);return e===null&&(e=parseFloat(t!=null?t:"1")),e!==1&&this.baseTexture.setResolution(e),e}parse(){return new Promise(r=>{this._callback=r,this._batchIndex=0,this._frameKeys.length<=Fo.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(r){let t=r;const e=Fo.BATCH_SIZE;for(;t-r<e&&t<this._frameKeys.length;){const i=this._frameKeys[t],n=this._frames[i],s=n.frame;if(s){let a=null,o=null;const l=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,h=new le(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);n.rotated?a=new le(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):a=new le(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(o=new le(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution)),this.textures[i]=new Gt(this.baseTexture,a,h,o,n.rotated?2:0,n.anchor),Gt.addToCache(this.textures[i],i)}t++}}_processAnimations(){const r=this.data.animations||{};for(const t in r){this.animations[t]=[];for(let e=0;e<r[t].length;e++){const i=r[t][e];this.animations[t].push(this.textures[i])}}}_parseComplete(){const r=this._callback;this._callback=null,this._batchIndex=0,r.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Fo.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Fo.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(r=!1){var t;for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,r&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let ff=Fo;ff.BATCH_SIZE=1e3;const EO=["jpg","png","jpeg","avif","webp"];function qx(r,t,e){const i={};if(r.forEach(n=>{i[n]=t}),Object.keys(t.textures).forEach(n=>{i[n]=t.textures[n]}),!e){const n=oi.dirname(r[0]);t.linkedSheets.forEach((s,a)=>{const o=qx([`${n}/${t.data.meta.related_multi_packs[a]}`],s,!0);Object.assign(i,o)})}return i}const TO={extension:Pt.Asset,cache:{test:r=>r instanceof ff,getCacheableAssets:(r,t)=>qx(r,t,!1)},resolver:{test:r=>{const e=r.split("?")[0].split("."),i=e.pop(),n=e.pop();return i==="json"&&EO.includes(n)},parse:r=>{var e,i;const t=r.split(".");return{resolution:parseFloat((i=(e=bt.RETINA_PREFIX.exec(r))==null?void 0:e[1])!=null?i:"1"),format:t[t.length-2],src:r}}},loader:{extension:{type:Pt.LoadParser,priority:Yr.Normal},async testParse(r,t){return oi.extname(t.src).includes(".json")&&!!r.frames},async parse(r,t,e){var h,u;let i=oi.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");const n=i+r.meta.image,a=(await e.load([n]))[n],o=new ff(a.baseTexture,r,t.src);await o.parse();const l=(h=r==null?void 0:r.meta)==null?void 0:h.related_multi_packs;if(Array.isArray(l)){const f=[];for(const _ of l){if(typeof _!="string")continue;const g=i+_;(u=t.data)!=null&&u.ignoreMultiPack||f.push(e.load({src:g,data:{ignoreMultiPack:!0}}))}const c=await Promise.all(f);o.linkedSheets=c,c.forEach(_=>{_.linkedSheets=[o].concat(o.linkedSheets.filter(g=>g!==_))})}return o},unload(r){r.destroy(!0)}}};Yt.add(TO);class pu extends ta{constructor(t,e=!0){super(t[0]instanceof Gt?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){!this._playing||(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Te.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Te.shared.add(this.update,this,Ys.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=this.animationSpeed*t,i=this.currentFrame;if(this._durations!==null){let n=this._currentTime%1*this._durations[this.currentFrame];for(n+=e/60*1e3;n<0;)this._currentTime--,n+=this._durations[this.currentFrame];const s=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);n>=this._durations[this.currentFrame];)n-=this._durations[this.currentFrame]*s,this._currentTime+=s;this._currentTime+=n/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i?this.onLoop():this.animationSpeed<0&&this.currentFrame>i&&this.onLoop()),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let i=0;i<t.length;++i)e.push(Gt.from(t[i]));return new pu(e)}static fromImages(t){const e=[];for(let i=0;i<t.length;++i)e.push(Gt.from(t[i]));return new pu(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof Gt)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Te.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Te.shared.add(this.update,this),this._isConnectedToTicker=!0))}}new me;var bO=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,c_=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,SO=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,wO=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,AO=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`;const wh=new Fe;class Zx extends Du{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new nx,this.state=En.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Xr.from(c_,bO,e),this.shader=t.context.webGLVersion>1?Xr.from(wO,AO,e):Xr.from(c_,SO,e)}render(t){const e=this.renderer,i=this.quad;let n=i.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const s=t.uvRespectAnchor?t.anchor.x:0,a=t.uvRespectAnchor?t.anchor.y:0;n=i.uvs,n[0]=n[6]=-s,n[1]=n[3]=-a,n[2]=n[4]=1-s,n[5]=n[7]=1-a,i.invalidate();const o=t._texture,l=o.baseTexture,h=l.alphaMode>0,u=t.tileTransform.localTransform,f=t.uvMatrix;let c=l.isPowerOfTwo&&o.frame.width===l.width&&o.frame.height===l.height;c&&(l._glTextures[e.CONTEXT_UID]?c=l.wrapMode!==Vn.CLAMP:l.wrapMode===Vn.CLAMP&&(l.wrapMode=Vn.REPEAT));const _=c?this.simpleShader:this.shader,g=o.width,d=o.height,p=t._width,v=t._height;wh.set(u.a*g/p,u.b*g/v,u.c*d/p,u.d*d/v,u.tx/p,u.ty/v),wh.invert(),c?wh.prepend(f.mapCoord):(_.uniforms.uMapCoord=f.mapCoord.toArray(!0),_.uniforms.uClampFrame=f.uClampFrame,_.uniforms.uClampOffset=f.uClampOffset),_.uniforms.uTransform=wh.toArray(!0),_.uniforms.uColor=$0(t.tint,t.worldAlpha,_.uniforms.uColor,h),_.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),_.uniforms.uSampler=o,e.shader.bind(_),e.geometry.bind(i),this.state.blendMode=Y0(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Zx.extension={name:"tilingSprite",type:Pt.RendererPlugin};Yt.add(Zx);class mu{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Hh{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const s in e){const a=e[s].match(/^[a-z]+/gm)[0],o=e[s].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(const h in o){const u=o[h].split("="),f=u[0],c=u[1].replace(/"/gm,""),_=parseFloat(c),g=isNaN(_)?c:_;l[f]=g}i[a].push(l)}const n=new mu;return i.info.forEach(s=>n.info.push({face:s.face,size:parseInt(s.size,10)})),i.common.forEach(s=>n.common.push({lineHeight:parseInt(s.lineHeight,10)})),i.page.forEach(s=>n.page.push({id:parseInt(s.id,10),file:s.file})),i.char.forEach(s=>n.char.push({id:parseInt(s.id,10),page:parseInt(s.page,10),x:parseInt(s.x,10),y:parseInt(s.y,10),width:parseInt(s.width,10),height:parseInt(s.height,10),xoffset:parseInt(s.xoffset,10),yoffset:parseInt(s.yoffset,10),xadvance:parseInt(s.xadvance,10)})),i.kerning.forEach(s=>n.kerning.push({first:parseInt(s.first,10),second:parseInt(s.second,10),amount:parseInt(s.amount,10)})),i.distanceField.forEach(s=>n.distanceField.push({distanceRange:parseInt(s.distanceRange,10),fieldType:s.fieldType})),n}}class pf{static test(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new mu,i=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),l=t.getElementsByTagName("distanceField");for(let h=0;h<i.length;h++)e.info.push({face:i[h].getAttribute("face"),size:parseInt(i[h].getAttribute("size"),10)});for(let h=0;h<n.length;h++)e.common.push({lineHeight:parseInt(n[h].getAttribute("lineHeight"),10)});for(let h=0;h<s.length;h++)e.page.push({id:parseInt(s[h].getAttribute("id"),10)||0,file:s[h].getAttribute("file")});for(let h=0;h<a.length;h++){const u=a[h];e.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(let h=0;h<o.length;h++)e.kerning.push({first:parseInt(o[h].getAttribute("first"),10),second:parseInt(o[h].getAttribute("second"),10),amount:parseInt(o[h].getAttribute("amount"),10)});for(let h=0;h<l.length;h++)e.distanceField.push({fieldType:l[h].getAttribute("fieldType"),distanceRange:parseInt(l[h].getAttribute("distanceRange"),10)});return e}}class mf{static test(t){if(typeof t=="string"&&t.includes("<font>")){const e=new globalThis.DOMParser().parseFromString(t,"text/xml");return pf.test(e)}return!1}static parse(t){const e=new globalThis.DOMParser().parseFromString(t,"text/xml");return pf.parse(e)}}const ad=[Hh,pf,mf];function MO(r){for(let t=0;t<ad.length;t++)if(ad[t].test(r))return ad[t];return null}function CO(r,t,e,i,n,s){const a=e.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;let o;const l=e.dropShadow?e.dropShadowDistance:0,h=e.padding||0,u=r.width/i-l-h*2,f=r.height/i-l-h*2,c=a.slice(),_=e.fillGradientStops.slice();if(!_.length){const g=c.length+1;for(let d=1;d<g;++d)_.push(d/g)}if(c.unshift(a[0]),_.unshift(0),c.push(a[a.length-1]),_.push(1),e.fillGradientType===Fu.LINEAR_VERTICAL){o=t.createLinearGradient(u/2,h,u/2,f+h);let g=0;const p=(s.fontProperties.fontSize+e.strokeThickness)/f;for(let v=0;v<n.length;v++){const A=s.lineHeight*v;for(let E=0;E<c.length;E++){let S=0;typeof _[E]=="number"?S=_[E]:S=E/c.length;const L=A/f+S*p;let T=Math.max(g,L);T=Math.min(T,1),o.addColorStop(T,c[E]),g=T}}}else{o=t.createLinearGradient(h,f/2,u+h,f/2);const g=c.length+1;let d=1;for(let p=0;p<c.length;p++){let v;typeof _[p]=="number"?v=_[p]:v=d/g,o.addColorStop(v,c[p]),d++}}return o}function LO(r,t,e,i,n,s,a){const o=e.text,l=e.fontProperties;t.translate(i,n),t.scale(s,s);const h=a.strokeThickness/2,u=-(a.strokeThickness/2);if(t.font=a.toFontString(),t.lineWidth=a.strokeThickness,t.textBaseline=a.textBaseline,t.lineJoin=a.lineJoin,t.miterLimit=a.miterLimit,t.fillStyle=CO(r,t,a,s,[o],e),t.strokeStyle=a.stroke,a.dropShadow){const f=a.dropShadowColor,c=cl(typeof f=="number"?f:Zf(f)),_=a.dropShadowBlur*s,g=a.dropShadowDistance*s;t.shadowColor=`rgba(${c[0]*255},${c[1]*255},${c[2]*255},${a.dropShadowAlpha})`,t.shadowBlur=_,t.shadowOffsetX=Math.cos(a.dropShadowAngle)*g,t.shadowOffsetY=Math.sin(a.dropShadowAngle)*g}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;a.stroke&&a.strokeThickness&&t.strokeText(o,h,u+e.lineHeight-l.descent),a.fill&&t.fillText(o,h,u+e.lineHeight-l.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Jx(r){return Array.from?Array.from(r):r.split("")}function DO(r){typeof r=="string"&&(r=[r]);const t=[];for(let e=0,i=r.length;e<i;e++){const n=r[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const s=n[0].charCodeAt(0),a=n[1].charCodeAt(0);if(a<s)throw new Error("[BitmapFont]: Invalid character range.");for(let o=s,l=a;o<=l;o++)t.push(String.fromCharCode(o))}else t.push(...Jx(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}function Vh(r){return r.codePointAt?r.codePointAt(0):r.charCodeAt(0)}const xr=class{constructor(r,t,e){var h,u;const[i]=r.info,[n]=r.common,[s]=r.page,[a]=r.distanceField,o=$n(s.file),l={};this._ownsTextures=e,this.font=i.face,this.size=i.size,this.lineHeight=n.lineHeight/o,this.chars={},this.pageTextures=l;for(let f=0;f<r.page.length;f++){const{id:c,file:_}=r.page[f];l[c]=t instanceof Array?t[f]:t[_],(a==null?void 0:a.fieldType)&&a.fieldType!=="none"&&(l[c].baseTexture.alphaMode=Cr.NO_PREMULTIPLIED_ALPHA,l[c].baseTexture.mipmap=jr.OFF)}for(let f=0;f<r.char.length;f++){const{id:c,page:_}=r.char[f];let{x:g,y:d,width:p,height:v,xoffset:A,yoffset:E,xadvance:S}=r.char[f];g/=o,d/=o,p/=o,v/=o,A/=o,E/=o,S/=o;const L=new le(g+l[_].frame.x/o,d+l[_].frame.y/o,p,v);this.chars[c]={xOffset:A,yOffset:E,xAdvance:S,kerning:{},texture:new Gt(l[_].baseTexture,L),page:_}}for(let f=0;f<r.kerning.length;f++){let{first:c,second:_,amount:g}=r.kerning[f];c/=o,_/=o,g/=o,this.chars[_]&&(this.chars[_].kerning[c]=g)}this.distanceFieldRange=a==null?void 0:a.distanceRange,this.distanceFieldType=(u=(h=a==null?void 0:a.fieldType)==null?void 0:h.toLowerCase())!=null?u:"none"}destroy(){for(const r in this.chars)this.chars[r].texture.destroy(),this.chars[r].texture=null;for(const r in this.pageTextures)this._ownsTextures&&this.pageTextures[r].destroy(!0),this.pageTextures[r]=null;this.chars=null,this.pageTextures=null}static install(r,t,e){let i;if(r instanceof mu)i=r;else{const s=MO(r);if(!s)throw new Error("Unrecognized data format for font.");i=s.parse(r)}t instanceof Gt&&(t=[t]);const n=new xr(i,t,e);return xr.available[n.font]=n,n}static uninstall(r){const t=xr.available[r];if(!t)throw new Error(`No font found named '${r}'`);t.destroy(),delete xr.available[r]}static from(r,t,e){if(!r)throw new Error("[BitmapFont] Property `name` is required.");const{chars:i,padding:n,resolution:s,textureWidth:a,textureHeight:o,...l}=Object.assign({},xr.defaultOptions,e),h=DO(i),u=t instanceof Qn?t:new Qn(t),f=a,c=new mu;c.info[0]={face:u.fontFamily,size:u.fontSize},c.common[0]={lineHeight:u.fontSize};let _=0,g=0,d,p,v,A=0;const E=[];for(let L=0;L<h.length;L++){d||(d=bt.ADAPTER.createCanvas(),d.width=a,d.height=o,p=d.getContext("2d"),v=new pe(d,{resolution:s,...l}),E.push(new Gt(v)),c.page.push({id:E.length-1,file:""}));const T=h[L],x=Wt.measureText(T,u,!1,d),m=x.width,w=Math.ceil(x.height),R=Math.ceil((u.fontStyle==="italic"?2:1)*m);if(g>=o-w*s){if(g===0)throw new Error(`[BitmapFont] textureHeight ${o}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${T}')`);--L,d=null,p=null,v=null,g=0,_=0,A=0;continue}if(A=Math.max(w+x.fontProperties.descent,A),R*s+_>=f){if(_===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${T}')`);--L,g+=A*s,g=Math.ceil(g),_=0,A=0;continue}LO(d,p,x,_,g,s,u);const M=Vh(x.text);c.char.push({id:M,page:E.length-1,x:_/s,y:g/s,width:R,height:w,xoffset:0,yoffset:0,xadvance:Math.ceil(m-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0))}),_+=(R+2*n)*s,_=Math.ceil(_)}for(let L=0,T=h.length;L<T;L++){const x=h[L];for(let m=0;m<T;m++){const w=h[m],R=p.measureText(x).width,M=p.measureText(w).width,b=p.measureText(x+w).width-(R+M);b&&c.kerning.push({first:Vh(x),second:Vh(w),amount:b})}}const S=new xr(c,E,!0);return xr.available[r]!==void 0&&xr.uninstall(r),xr.available[r]=S,S}};let Si=xr;Si.ALPHA=[["a","z"],["A","Z"]," "];Si.NUMERIC=[["0","9"]];Si.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];Si.ASCII=[[" ","~"]];Si.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:xr.ALPHANUMERIC};Si.available={};var RO=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,PO=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const d_=[],f_=[],p_=[],Qx=class extends Pi{constructor(r,t={}){super(),this._tint=16777215;const{align:e,tint:i,maxWidth:n,letterSpacing:s,fontName:a,fontSize:o}=Object.assign({},Qx.styleDefaults,t);if(!Si.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=e,this._tint=i,this._font=void 0,this._fontName=a,this._fontSize=o,this.text=r,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=s,this._anchor=new Un(()=>{this.dirty=!0},this,0,0),this._roundPixels=bt.ROUND_PIXELS,this.dirty=!0,this._resolution=bt.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var R;const r=Si.available[this._fontName],t=this.fontSize,e=t/r.size,i=new me,n=[],s=[],a=[],o=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",l=Jx(o),h=this._maxWidth*r.size/t,u=r.distanceFieldType==="none"?d_:f_;let f=null,c=0,_=0,g=0,d=-1,p=0,v=0,A=0,E=0;for(let M=0;M<l.length;M++){const C=l[M],b=Vh(C);if(/(?:\s)/.test(C)&&(d=M,p=c,E++),C==="\r"||C===`
`){s.push(c),a.push(-1),_=Math.max(_,c),++g,++v,i.x=0,i.y+=r.lineHeight,f=null,E=0;continue}const D=r.chars[b];if(!D)continue;f&&D.kerning[f]&&(i.x+=D.kerning[f]);const O=p_.pop()||{texture:Gt.EMPTY,line:0,charCode:0,prevSpaces:0,position:new me};O.texture=D.texture,O.line=g,O.charCode=b,O.position.x=i.x+D.xOffset+this._letterSpacing/2,O.position.y=i.y+D.yOffset,O.prevSpaces=E,n.push(O),c=O.position.x+Math.max(D.xAdvance-D.xOffset,D.texture.orig.width),i.x+=D.xAdvance+this._letterSpacing,A=Math.max(A,D.yOffset+D.texture.height),f=b,d!==-1&&h>0&&i.x>h&&(++v,ja(n,1+d-v,1+M-d),M=d,d=-1,s.push(p),a.push(n.length>0?n[n.length-1].prevSpaces:0),_=Math.max(_,p),g++,i.x=0,i.y+=r.lineHeight,f=null,E=0)}const S=l[l.length-1];S!=="\r"&&S!==`
`&&(/(?:\s)/.test(S)&&(c=p),s.push(c),_=Math.max(_,c),a.push(-1));const L=[];for(let M=0;M<=g;M++){let C=0;this._align==="right"?C=_-s[M]:this._align==="center"?C=(_-s[M])/2:this._align==="justify"&&(C=a[M]<0?0:(_-s[M])/a[M]),L.push(C)}const T=n.length,x={},m=[],w=this._activePagesMeshData;u.push(...w);for(let M=0;M<T;M++){const C=n[M].texture,b=C.baseTexture.uid;if(!x[b]){let D=u.pop();if(!D){const B=new nO;let P,F;r.distanceFieldType==="none"?(P=new l_(Gt.EMPTY),F=Jt.NORMAL):(P=new l_(Gt.EMPTY,{program:gn.from(PO,RO),uniforms:{uFWidth:0}}),F=Jt.NORMAL_NPM);const I=new df(B,P);I.blendMode=F,D={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:I,vertices:null,uvs:null,indices:null}}D.index=0,D.indexCount=0,D.vertexCount=0,D.uvsCount=0,D.total=0;const{_textureCache:O}=this;O[b]=O[b]||new Gt(C.baseTexture),D.mesh.texture=O[b],D.mesh.tint=this._tint,m.push(D),x[b]=D}x[b].total++}for(let M=0;M<w.length;M++)m.includes(w[M])||this.removeChild(w[M].mesh);for(let M=0;M<m.length;M++)m[M].mesh.parent!==this&&this.addChild(m[M].mesh);this._activePagesMeshData=m;for(const M in x){const C=x[M],b=C.total;if(!(((R=C.indices)==null?void 0:R.length)>6*b)||C.vertices.length<df.BATCHABLE_SIZE*2)C.vertices=new Float32Array(4*2*b),C.uvs=new Float32Array(4*2*b),C.indices=new Uint16Array(6*b);else{const D=C.total,O=C.vertices;for(let B=D*4*2;B<O.length;B++)O[B]=0}C.mesh.size=6*b}for(let M=0;M<T;M++){const C=n[M];let b=C.position.x+L[C.line]*(this._align==="justify"?C.prevSpaces:1);this._roundPixels&&(b=Math.round(b));const D=b*e,O=C.position.y*e,B=C.texture,P=x[B.baseTexture.uid],F=B.frame,I=B._uvs,y=P.index++;P.indices[y*6+0]=0+y*4,P.indices[y*6+1]=1+y*4,P.indices[y*6+2]=2+y*4,P.indices[y*6+3]=0+y*4,P.indices[y*6+4]=2+y*4,P.indices[y*6+5]=3+y*4,P.vertices[y*8+0]=D,P.vertices[y*8+1]=O,P.vertices[y*8+2]=D+F.width*e,P.vertices[y*8+3]=O,P.vertices[y*8+4]=D+F.width*e,P.vertices[y*8+5]=O+F.height*e,P.vertices[y*8+6]=D,P.vertices[y*8+7]=O+F.height*e,P.uvs[y*8+0]=I.x0,P.uvs[y*8+1]=I.y0,P.uvs[y*8+2]=I.x1,P.uvs[y*8+3]=I.y1,P.uvs[y*8+4]=I.x2,P.uvs[y*8+5]=I.y2,P.uvs[y*8+6]=I.x3,P.uvs[y*8+7]=I.y3}this._textWidth=_*e,this._textHeight=(i.y+r.lineHeight)*e;for(const M in x){const C=x[M];if(this.anchor.x!==0||this.anchor.y!==0){let B=0;const P=this._textWidth*this.anchor.x,F=this._textHeight*this.anchor.y;for(let I=0;I<C.total;I++)C.vertices[B++]-=P,C.vertices[B++]-=F,C.vertices[B++]-=P,C.vertices[B++]-=F,C.vertices[B++]-=P,C.vertices[B++]-=F,C.vertices[B++]-=P,C.vertices[B++]-=F}this._maxLineHeight=A*e;const b=C.mesh.geometry.getBuffer("aVertexPosition"),D=C.mesh.geometry.getBuffer("aTextureCoord"),O=C.mesh.geometry.getIndex();b.data=C.vertices,D.data=C.uvs,O.data=C.indices,b.update(),D.update(),O.update()}for(let M=0;M<n.length;M++)p_.push(n[M]);this._font=r,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(r){this._autoResolution&&this._resolution!==r.resolution&&(this._resolution=r.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:e,size:i}=Si.available[this._fontName];if(e!=="none"){const{a:n,b:s,c:a,d:o}=this.worldTransform,l=Math.sqrt(n*n+s*s),h=Math.sqrt(a*a+o*o),u=(Math.abs(l)+Math.abs(h))/2,f=this.fontSize/i,c=r._view.resolution;for(const _ of this._activePagesMeshData)_.mesh.shader.uniforms.uFWidth=u*t*f*c}super._render(r)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const r=Si.available[this._fontName];if(!r)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==r&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(r){if(this._tint!==r){this._tint=r;for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=r}}get align(){return this._align}set align(r){this._align!==r&&(this._align=r,this.dirty=!0)}get fontName(){return this._fontName}set fontName(r){if(!Si.available[r])throw new Error(`Missing BitmapFont "${r}"`);this._fontName!==r&&(this._fontName=r,this.dirty=!0)}get fontSize(){var r;return(r=this._fontSize)!=null?r:Si.available[this._fontName].size}set fontSize(r){this._fontSize!==r&&(this._fontSize=r,this.dirty=!0)}get anchor(){return this._anchor}set anchor(r){typeof r=="number"?this._anchor.set(r):this._anchor.copyFrom(r)}get text(){return this._text}set text(r){r=String(r==null?"":r),this._text!==r&&(this._text=r,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(r){this._maxWidth!==r&&(this._maxWidth=r,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(r){this._letterSpacing!==r&&(this._letterSpacing=r,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(r){r!==this._roundPixels&&(this._roundPixels=r,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(r){this._autoResolution=!1,this._resolution!==r&&(this._resolution=r,this.dirty=!0)}destroy(r){const{_textureCache:t}=this,i=Si.available[this._fontName].distanceFieldType==="none"?d_:f_;i.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],i.filter(n=>t[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=Gt.EMPTY});for(const n in t)t[n].destroy(),delete t[n];this._font=null,this._textureCache=null,super.destroy(r)}};let IO=Qx;IO.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const OO=[".xml",".fnt"],FO={extension:{type:Pt.LoadParser,priority:Yr.Normal},test(r){return OO.includes(oi.extname(r))},async testParse(r){return Hh.test(r)||mf.test(r)},async parse(r,t,e){const i=Hh.test(r)?Hh.parse(r):mf.parse(r),{src:n}=t,{page:s}=i,a=[];for(let h=0;h<s.length;++h){const u=s[h].file,f=oi.join(oi.dirname(n),u);a.push(f)}const o=await e.load(a),l=a.map(h=>o[h]);return Si.install(i,l,!0)},async load(r,t){return(await bt.ADAPTER.fetch(r)).text()},unload(r){r.destroy()}};Yt.add(FO);var gf=Ei.registerPlugin(If)||Ei;gf.core.Tween;class BO{constructor(){H(this,"_isLoaded",!1);H(this,"textures",[]);H(this,"load",async(t,e,i)=>new Promise(async n=>{for(const s in t)Oa.add(s,t[s]),await Oa.load(s);for(let s=0;s<i;s++)this.textures.push(Gt.from(`${e}${s}.png`));n()}))}}class ty extends Pi{constructor(){super();H(this,"resource");H(this,"as");H(this,"progress",0);H(this,"fps",30);H(this,"tween");H(this,"play",(e=-1)=>{e!=-1&&(this.as.currentFrame=e),this.as.stop(),this.as.play()});H(this,"stop",()=>{this.tween&&this.tween.kill(),this.as.stop()});H(this,"stopLastFrame",(e=void 0,i=1)=>{let n=this.as.currentFrame,s=this.as.totalFrames-1,a=(s-n)*(1/this.fps)*i;this.stop(),this.tween=gf.to(this.as,{currentFrame:s,duration:a,ease:"none",onComplete:()=>e?e():void 0})});H(this,"reversePlay",(e=void 0,i=1)=>{const n=this.as.currentFrame*(1/this.fps)*i;this.stop(),this.tween=gf.to(this.as,{currentFrame:0,duration:n,ease:"none",onComplete:()=>e?e():void 0})});this.resource=new BO}async setup(e,i,n){await this.resource.load(e,i,n),this.as=new pu(this.resource.textures),this.as.animationSpeed=.5,this.as.gotoAndStop(0),this.addChild(this.as)}}const kO={"s1-0":"/wp-content/themes/camcom/assets/morphing/s1/s1-0.json","s1-1":"/wp-content/themes/camcom/assets/morphing/s1/s1-1.json","s1-2":"/wp-content/themes/camcom/assets/morphing/s1/s1-2.json","s1-3":"/wp-content/themes/camcom/assets/morphing/s1/s1-3.json"};class UO extends ty{constructor(){super();H(this,"setup",async()=>{await super.setup(kO,"s1_",90),this.as.loop=!0})}}const NO={"s2-0":"/wp-content/themes/camcom/assets/morphing/s2/s2-0.json","s2-1":"/wp-content/themes/camcom/assets/morphing/s2/s2-1.json"};class GO extends ty{constructor(){super();H(this,"_fadeTween");H(this,"setup",async()=>{await super.setup(NO,"s2_",58),this.as.loop=!1})}}class zO extends Pi{constructor(){super();H(this,"_logos");H(this,"_fadeTween");H(this,"_timeline");H(this,"_cx",300);H(this,"_cy",300);H(this,"_graphics");H(this,"_message");H(this,"setup",async()=>{this._graphics=new Ou,this.addChild(this._graphics),new Array(12).fill(0),this._logos=new Array(12).fill(0).map((i,n)=>{const s=Gt.from(`/wp-content/themes/camcom/assets/images/our-group/logo${n+1}.webp`),a=new ta(s);return a.anchor.set(.5),a.position.set(this._cx,this._cy),this.addChild(a),a}),this.alpha=0,this._message.changeEndColor(56,77,116)});H(this,"animate",()=>{const e=kE(0,0,180,180);this._timeline=Ot.timeline(),this._logos.forEach((n,s)=>{n.zIndex=this._logos.length-s,Ot.set(n,{x:this._getX(0,e),y:this._getY(0,e)}),Ot.set(n.scale,{x:.1,y:.1})}),this._timeline.fromTo(this,{alpha:0},{alpha:1,duration:1,ease:"circ.out"});const i={progress:0};this._timeline.to(i,{progress:1,ease:"sine.inOut",duration:2,onUpdate:()=>{const n=Math.PI*-.5,s=Math.PI*2*i.progress+n;this._graphics.clear(),this._graphics.lineStyle(1,11974344),this._graphics.arc(this._cx,this._cy,e,n,s),this._logos.forEach((a,o)=>{let l=o/this._logos.length;l>i.progress&&(l=i.progress),Ot.set(a,{x:this._getX(l,e),y:this._getY(l,e)})})}},"<"),this._timeline.call(()=>this._message.animate())});H(this,"_getX",(e,i)=>{const n=Math.PI*2*e-Math.PI*.5;return Math.cos(n)*i+this._cx});H(this,"_getY",(e,i)=>{const n=Math.PI*2*e-Math.PI*.5;return Math.sin(n)*i+this._cy});H(this,"fadeOut",e=>{this._fadeTween&&this._fadeTween.kill(),this._timeline&&this._timeline.kill(),this._message.reset(),this._fadeTween=Ot.to(this,{alpha:0,duration:.4,ease:"quad.out",onComplete:()=>e()})});this.sortableChildren=!0,this._message=new be(document.querySelector(".morphing_text .js_grad_image_self"),{alive:!0})}}class WO{constructor(){H(this,"_step1");H(this,"_step2");H(this,"_step3");H(this,"_canvas");H(this,"_app");H(this,"_wrapper");H(this,"_fadeTween");H(this,"setup",async()=>{await this._step1.setup(),await this._step2.setup(),await this._step3.setup(),this._setTrigger()});H(this,"_setTrigger",()=>{const t=document.querySelector(".section_our_philosophy");Ot.to(t,{scrollTrigger:{trigger:t,markers:!1,start:"0% 100%",end:"100% 0%",onEnter:()=>this._sectionEnter(),onLeaveBack:()=>this._sectionLeaveBack(),onLeave:()=>this._sectionLeave(),onEnterBack:()=>this._sectionEnterBack()}});const e=t.querySelector(".morphing_step2");Ot.to(this._step2,{scrollTrigger:{trigger:e,markers:!1,start:"10% 90%",end:"65% 100%",onEnter:()=>this._step2Enter(),onLeaveBack:()=>this._step2LeaveBack(),onLeave:()=>this._step2Leave(),onEnterBack:()=>this._step2EnterBack()}}),this._wrapper.addChild(this._step1),this._app.stage.addChild(this._wrapper)});H(this,"_sectionEnter",()=>{this._app.start(),this._step1.play()});H(this,"_sectionLeaveBack",()=>{this._app.stop(),this._step1.stop()});H(this,"_sectionLeave",()=>{this._app.stop()});H(this,"_sectionEnterBack",()=>{this._app.start()});H(this,"_step2Enter",()=>{this._step2.stop(),this._step1.stopLastFrame(()=>{this._wrapper.removeChild(this._step1),this._wrapper.addChild(this._step2),this._step2.stopLastFrame(void 0,.7)},.6)});H(this,"_step2LeaveBack",()=>{this._step1.stop(),this._step2.reversePlay(()=>{this._wrapper.addChild(this._step1),this._wrapper.removeChild(this._step2),this._step1.play()},.4)});H(this,"_step2Leave",()=>{this._wrapperFadeOut(()=>{this._wrapper.removeChild(this._step2),this._app.stage.addChild(this._step3),this._step3.animate()})});H(this,"_step2EnterBack",()=>{this._step3.fadeOut(()=>{this._app.stage.removeChild(this._step3),this._wrapper.addChild(this._step2),this._wrapperFadeIn()})});H(this,"_wrapperFadeOut",t=>{this._fadeTween&&this._fadeTween.kill(),this._fadeTween=Ot.to(this._wrapper,{alpha:0,duration:.4,ease:"quad.out",onComplete:()=>t()})});H(this,"_wrapperFadeIn",()=>{this._fadeTween&&this._fadeTween.kill(),this._fadeTween=Ot.to(this._wrapper,{alpha:1,duration:.4,ease:"quad.out"})});this._step1=new UO,this._step2=new GO,this._step3=new zO,this._wrapper=new Pi,this._canvas=document.querySelector(".morphing"),this._app=new ep({view:this._canvas,width:600,height:600,backgroundAlpha:0,backgroundColor:0,antialias:!0,autoStart:!1,resolution:2});const t=new tp(this._app.renderer);t.autoPreventDefault=!1}}class HO{constructor(){H(this,"_target");H(this,"_progress");H(this,"_value",0);H(this,"_showCls","show");H(this,"start",()=>{const t=document.querySelector(".main_contents");Ot.to(this._progress,{scaleY:1,ease:"none",scrollTrigger:{trigger:t,markers:!1,scrub:2,start:"1% 0%",end:"100%, 70%",onEnter:this._show,onLeaveBack:this._hide,onLeave:this._hide,onEnterBack:this._show}})});H(this,"_show",()=>{this._target.classList.add(this._showCls)});H(this,"_hide",()=>{this._target.classList.remove(this._showCls)});this._target=document.querySelector(".page_progress"),this._progress=this._target.querySelector(".value")}}Ot.registerPlugin(de);Ot.registerPlugin(_l);class VO{constructor(){H(this,"_parser");H(this,"_footer");H(this,"_lastedWindowWidth");H(this,"_loading");H(this,"_gradientImages");H(this,"_gradientTexts");H(this,"_sectionTitles");H(this,"_philosophy");H(this,"_group");H(this,"_name");H(this,"_brandLogo");H(this,"_topics");H(this,"_modal");H(this,"_morphing");H(this,"_progress");H(this,"_menu");H(this,"_appVisual");H(this,"_loadStart",()=>{this._loading.once(T0,()=>{delete this._loading,this._footer.resize(),this._progress.start(),this._menu.start(),BE()}),this._loading.start(),setTimeout(()=>this._setVh(),500)});H(this,"_showModal",()=>{});H(this,"_hideModal",()=>{});H(this,"_resize",()=>{(this._lastedWindowWidth>=Do&&window.innerWidth<Do||this._lastedWindowWidth<Do&&window.innerWidth>=Do)&&location.reload(),(this._lastedWindowWidth!==window.innerWidth||this._parser.getOS().name!=="iOS"&&this._parser.getOS().name!=="Android")&&(this._lastedWindowWidth=window.innerWidth,this._footer.resize(),this._appVisual.resize(),this._gradientImages!==void 0&&this._gradientImages.resize(),this._loading!==void 0&&this._loading.resize()),this._parser.getOS().name!=="iOS"&&this._parser.getOS().name!=="Android"&&this._setVh()});H(this,"_setVh",()=>{const t=window.innerHeight;document.documentElement.style.setProperty("--vh",`${t}px`)});this._lastedWindowWidth=window.innerWidth,this._setVh(),this._appVisual=new hM(document.querySelector(".bg_canvas")),this._menu=new pM,this._loading=new _M,this._footer=new uM,this._parser=new Gd.exports.UAParser,this._gradientImages=new vM,this._gradientImages.once(b0,()=>{delete this._gradientImages}),this._gradientTexts=new xM,this._gradientTexts.once(S0,()=>{delete this._gradientTexts}),this._sectionTitles=new bM,this._sectionTitles.once(C0,()=>{delete this._sectionTitles}),this._philosophy=new BM,this._philosophy.once(O0,()=>{delete this._philosophy}),this._morphing=new WO,this._morphing.setup(),this._group=new zM,this._name=new MM,this._name.once(D0,()=>{delete this._name}),this._brandLogo=new LM,this._brandLogo.once(P0,()=>{delete this._brandLogo}),this._topics=new EM,this._topics.once(A0,()=>{delete this._topics}),this._modal=new UM,this._modal.on(B0,this._showModal),this._modal.on(k0,this._hideModal),this._progress=new HO,this._loadStart(),window.addEventListener("resize",this._resize)}}window.onload=()=>new VO;
